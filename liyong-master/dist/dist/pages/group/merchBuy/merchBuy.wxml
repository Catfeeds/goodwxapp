<wxs src="../../../filter.wxs" module="filter"></wxs><block wx:if="{{ !displayError }}"><view id="page"><view class="merchBuy__address ui-flex ui-alignItemsCenter {{ !address ? 'merchBuy__address--empty' : '' }}" bindtap="gotoChooseAddress"><image class="icon" src="https://imgcdn.youhaodongxi.com/weapp/icon-order-address-1d9c77309c.png"></image><view class="ui-marginLeft10 ui-flex1" wx:if="{{ address }}"><view class="ui-flex ui-alignItemsCenter"><view class="name">{{ address.recipient }}</view><view class="telphone ui-marginLeft15">{{ address.tel }}</view><view class="tag ui-marginLeft15">{{ addressTagMap[address.type].title }}</view></view><view class="ui-marginTop10 ui-fontSize13 ui-blackLighter">{{ address._pcdName }} {{ address.address }}</view></view><view class="ui-flex1 ui-marginLeft10 ui-fontSize14" wx:else="wx:else">选择收货地址</view><view class="arrow"></view></view><view class="merchBuy__merchTypes ui-marginTop10"><merchTypeSelect class="ui-block {{ index != 0 ? 'ui-marginTop10' : '' }}" wx:for="{{ merchTypes }}" wx:for-item="merchType" wx:key="{{ merchType.merchTypeId }}" merchType="{{ merchType }}" bind:add="addMerchType" bind:minus="minusMerchType" data-merch-type-id="{{ merchType.merchTypeId }}" data-num="{{ merchType._select }}"><view class="ui-marginLeft5" slot="countdown" wx:if="{{ merchType.promotion.promotionValidType == 2 && filter.isNowBetweenIn(merchType.promotion.startTime, merchType.promotion.endTime) }}"><countdown seconds="{{ filter.diffWithNow(merchType.promotion.endTime) }}" data-id="{{ merchType.merchTypeId }}" bind:over="countdownOver"></countdown></view></merchTypeSelect></view><view class="merchBuy__merchTypesLimit" wx:if="{{ merch.saleItem && merchTypeSelectCount < merch.saleItem }}"><view>{{ merch.saleItem }}件起售，</view><view class="ui-highLight">还差{{ merch.saleItem - merchTypeSelectCount }}件</view></view><view class="merchBuy__bill ui-marginTop10"><view class="merchAmount"><view class="ui-flex"><view>商品金额</view><view class="ui-fontSize12 ui-highLight ui-marginLeft5" wx:if="{{ bill.discountFee }}">已立减{{ bill.discountFee }}元</view></view><view>￥{{ filter.toFixed(bill.merchFee, 2) }}</view></view><view class="expressFee ui-marginTop10"><view>运费</view><view>￥{{ filter.toFixed(bill.expressFee, 2) }}</view></view><view class="coupon ui-marginTop15" bindtap="gotoChooseCoupon"><view class="ui-flex"><view class="icon-order-coupon ui-marginRight5"></view><view>优惠券</view><view class="ui-fontSize12 ui-highLight ui-marginLeft5" wx:if="{{ validCouponList.length > 0 }}">{{ validCouponList.length }}个可用</view></view><block wx:if="{{ !merch.canUseCoupon }}"><view class="ui-highLight">不参与优惠券促销</view></block><block wx:elif="{{ !merchTypeSelectCount }}"><view class="ui-blackLighter">请先选择规格和数量</view></block><block wx:elif="{{ buying.couponId === 0 }}"><view class="ui-flex"><view class="ui-highLight">不使用优惠券</view><view class="arrow ui-marginLeft5"></view></view></block><block wx:elif="{{ !buying.couponId }}"><view class="ui-flex"><view class="ui-blackLighter">暂无可用优惠券</view><view class="arrow ui-marginLeft5"></view></view></block><block wx:else="wx:else"><view class="ui-flex"><view class="ui-highLight">-￥{{ filter.toFixed(bill.couponFee, 2) }}</view><view class="arrow ui-marginLeft5"></view></view></block></view><view class="coin"><view class="ui-flex"><view>金币</view><view class="ui-marginLeft5">共 {{ coinAmount }} 金币，满100金币可用</view></view><view class="coin__actionWrapper ui-marginTop10"><view class="coin__action"><view class="minus {{ buying.coin == 0 ? 'minus--disabled' : '' }}" bindtap="minusUseCoin" data-coin="{{ buying.coin }}"></view><view class="ui-flex1 ui-flex ui-flexCenter">{{ buying.coin }}</view><view class="add {{ coinAmount - 100 < buying.coin || bill.merchFee * 100 < buying.coin + 100 ? 'add--disabled' : '' }}" bindtap="addUseCoin" data-coin="{{ buying.coin }}"></view></view><view class="ui-highLight">-￥{{ filter.toFixed(bill.coinFee, 2) }}</view></view></view></view><view class="fixedBottom"><view class="ui-flex ui-alignItemsCenter"><view class="total__name">总计</view><view class="total__unit">￥</view><view class="total__price">{{ filter.toFixed(bill.orderFee, 2) }}</view></view><view class="button button--primary" bindtap="pay">确认支付</view></view></view></block><view id="error" wx:if="{{ displayError && !isFetching }}"><view class="content ui-fontSize14 ui-blackLight"><image src="https://imgcdn.youhaodongxi.com/weapp/500-a637418d0e.png"></image><view class="ui-marginTop10" wx:if="{{ displayError }}">{{ displayError.message }}</view><view class="ui-marginTop10" wx:else="wx:else">页面加载失败，请稍后重试~</view><view class="ui-fontSize14 reloadLink" bindtap="reload">重新加载</view></view></view>