<wxs src="../../../filter.wxs" module="filter"></wxs><block wx:if="{{ !displayError }}"><view id="page" wx:if="{{ merch }}"><swiper indicator-dots="true"><swiper-item wx:for="{{ merch.carouselFileList }}" wx:for-item="poster" wx:key="{{ poster.fileId }}"><image src="{{ poster.url }}"></image></swiper-item></swiper><view class="merch__buyers"><view class="ui-flex ui-alignItemsCenter" bindtap="gotoMerchShareOrderList"><view>{{ merch.manualSetBuyerTotal }} 人已抢</view><view class="arrow"></view></view><view class="ui-flex ui-alignItemsCenter"><image class="avatar" src="https://imgcdn.youhaodongxi.com/avatar/201710/23225/IMG_2985.JPG"></image><image class="avatar" src="https://imgcdn.youhaodongxi.com/avatar/201710/23225/IMG_2985.JPG"></image><image class="avatar" src="https://imgcdn.youhaodongxi.com/avatar/201710/23225/IMG_2985.JPG"></image><view class="ui-marginLeft10">15位好友在买</view></view></view><view class="merch__title">{{ merch.title }}</view><view class="merch__tag ui-marginTop10 ui-marginLeft15" wx:if="{{ merch.tagTitle }}">{{ merch.tagTitle }}</view><view class="merch__intro ui-marginTop10 ui-marginLeft15" wx:if="{{ descriptionArray.length }}"><view wx:for="{{ descriptionArray }}" wx:key="{{ index }}">· {{ item }}</view></view><view class="merch__types"><merchType class="ui-block ui-marginBottom10" wx:for="{{ merchTypes }}" wx:for-item="merchType" wx:key="{{ merchType.merchTypeId }}" merchType="{{ merchType }}" bind:subscribe="merchTypeSubscribe" data-merch-type-id="{{ merchType.merchTypeId }}"><view class="ui-marginLeft5" slot="countdown" wx:if="{{ merchType.promotion.promotionValidType == 2 && filter.isNowBetweenIn(merchType.promotion.startTime, merchType.promotion.endTime) }}"><countdown seconds="{{ filter.diffWithNow(merchType.promotion.endTime) }}" data-id="{{ merchType.merchTypeId }}" bind:over="countdownOver"></countdown></view></merchType></view><view class="merch__delivery"><view class="ui-flex"><view class="ui-blackLighter">送至：</view><view class="ui-flex1" bindtap="showChooseLocationPopup"><view>{{ location.province.name }} {{ location.city.name }}</view><view><text class="ui-highLight">22</text><text>点截单次日达（五环外隔日达）</text></view></view><view class="arrow"></view></view><view class="button ui-marginTop20" bindtap="showDeliveryModal">配送区域及时效</view></view><view class="merch__expressFee ui-flex"><view class="ui-blackLighter">运费：</view><view class="ui-flex1">{{ merch.deliveryArea }}</view></view><view class="merch__author"><view class="avatar"><image src="{{ merch.saler.salerAvatar }}"></image></view><view class="content"><image class="icon-slogan-edit" src="https://imgcdn.youhaodongxi.com/weapp/icon-slogan-edit-b4a66baae6.png" bindtap="gotoMerchEdit"></image><view>{{ groupon.slogon }}</view></view></view><view class="merch__shareOrderList" wx:if="{{ shareOrderList.length }}"><view class="title">晒单</view><shareOrder wx:for="{{ shareOrderList }}" wx:for-item="shareOrder" wx:key="{{ shareOrder.shareOrder.shareOrderId }}" shareOrder="{{ shareOrder }}"></shareOrder><view class="button ui-marginTop30" bindtap="gotoMerchShareOrderList">查看全部晒单</view></view><view class="merch__detail"><view class="title">详情</view><rich-text class="ui-block ui-marginTop20" nodes="{{ filter.fixHTML(merch.content) }}"></rich-text></view><view class="fixedBottom"><view class="iconWrapper" bindtap="gotoGroupIndex"><view class="icon-home"></view></view><view class="button button--disabled" wx:if="{{ !merch.couldDelivery }}">该地区暂不支持配送</view><view class="button button--disabled" wx:elif="{{ (merch.soldOut || popupMerchTypeList.length == 0) &&         merch.isSubscribe }}">已订阅</view><view class="button button--primary" wx:elif="{{ merch.soldOut || popupMerchTypeList.length == 0 }}" bindtap="merchSubscribe">到货提醒</view><view class="button button--primary" wx:else="wx:else" bindtap="gotoMerchBuy">立即购买</view></view><modal class="modal__subscribeSuccess" wx:if="{{ subscribeSuccessModal }}"><view class="modal__body" slot="body"><image class="icon" src="https://imgcdn.youhaodongxi.com/weapp/icon-subscribe-success-059b180a1a.png"></image><view class="ui-marginTop30">订阅成功</view><view class="ui-marginTop10 ui-fontSize12 ui-blackLight"><view>该商品到货后</view><view>会按照订阅顺序通过微信消息通知您</view></view><view class="button button--primary" bindtap="hideSubscribeSuccessModal">我知道了</view></view></modal><modal class="modal__delivery" wx:if="{{ deliveryModal }}" closeIcon="true" bind:closeIcon="hideDeliveryModal"><view class="modal__body" slot="body"><view class="ui-fontWeightBold">配送区域及时效</view><view class="ui-marginTop5 ui-fontSize12 ui-highLight">公司地址对于周五周六和节假日不发货，收货时间顺延</view><view class="content"><view wx:for="{{ deliveryTimeArray }}" wx:key="{{ index }}">{{ item }}</view></view></view></modal><popup class="popup__selectMerchType" wx:if="{{ chooseMerchTypePopup }}" bind:close="closeChooseMerchTypePopup"><view class="popup__header" slot="header">请选择要购买的规格</view><view class="popup__body" slot="body"><view class="merchType {{ filter.includes(chooseMerchTypeIds, merchType.merchTypeId) ? 'merchType--active' : '' }}" wx:for="{{ popupMerchTypeList }}" wx:for-item="merchType" wx:key="{{ merchType.merchTypeId }}" data-merch-type-id="{{ merchType.merchTypeId }}" bindtap="chooseMerchType">{{ merchType.content }}</view></view><view class="popup__footer" slot="footer"><view class="button button--primary" bindtap="gotoMerchBuyByPopup">立即购买</view></view></popup><popup class="popup__selectLocation" wx:if="{{ chooseLocationPopup }}" bind:close="closeChooseLocationPopup"><view class="popup__header ui-flex" slot="header"><view class="item {{ !chooseLocation.provinceId ? 'item--active' : '' }}" bindtap="chooseLocationChangeTab">省份</view><view class="item {{ chooseLocation.provinceId ? 'item--active' : '' }}">城市</view></view><view class="popup__body" slot="body"><block wx:if="{{ !chooseLocation.provinceId }}"><view class="item" wx:for="{{ provinceIds }}" wx:key="{{ provinceId }}" wx:for-item="provinceId" data-province-id="{{ provinceId }}" bindtap="chooseLocationProvince">{{ provinceMap[provinceId] }}</view></block><block wx:else="wx:else"><view class="item" wx:for="{{ cityIds }}" wx:key="{{ cityId }}" wx:for-item="cityId" data-city-id="{{ cityId }}" bindtap="chooseLocationCity">{{ cityMap[cityId] }}</view></block></view></popup></view><view id="shell" wx:else="wx:else"><view class="shell" style="width:100%;height:210px;"></view><view style="padding:0 15px;"><view style="margin-top:10px;display:flex;justify-content:space-between;"><view class="shell" style="width:100px;height:30px;"></view><view class="shell" style="width:200px;height:30px;"></view></view><view class="shell" style="margin-top:10px;width:100%;height:48px;"></view><view class="shell" style="margin-top:10px;width:55px;height:20px;"></view><view class="shell" style="margin-top:10px;width:200px;height:30px;"></view><view class="shell" style="margin-top:10px;width:100%;height:85px;"></view><view class="shell" style="margin-top:10px;width:100%;height:85px;"></view><view class="shell" style="margin-top:10px;width:100%;height:85px;"></view></view></view></block><view id="error" wx:if="{{ displayError && !isFetching }}"><view class="content ui-fontSize14 ui-blackLight"><image src="https://imgcdn.youhaodongxi.com/weapp/500-a637418d0e.png"></image><view class="ui-marginTop10" wx:if="{{ displayError }}">{{ displayError.message }}</view><view class="ui-marginTop10" wx:else="wx:else">页面加载失败，请稍后重试~</view><view class="ui-fontSize14 reloadLink" bindtap="reload">重新加载</view></view></view>