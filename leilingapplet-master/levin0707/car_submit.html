<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>全新致炫 不要压力 放大马力</title>
		<link rel="stylesheet" href="https://cdn.zwmedia.com.cn/Public/Home/Default/Css/font-awesome-4.5.0/css/font-awesome.min.css">
		<script>
			var _hmt = _hmt || [];
			(function() {
				var hm = document.createElement("script");
				hm.src = "https://hm.baidu.com/hm.js?0b8361ed949a428a21f428536ec16aff";
				var s = document.getElementsByTagName("script")[0];
				s.parentNode.insertBefore(hm, s);
			})();
		</script>
		<style type="text/css">
			* {
				margin: 0px;
				padding: 0px;
			}
			
			html,
			body {
				width: 100%;
				height: 100%;
				-moz-user-select: none;
				/*火狐*/
				-webkit-user-select: none;
				/*webkit浏览器*/
				-ms-user-select: none;
				/*IE10*/
				-khtml-user-select: none;
				/*早期浏览器*/
				user-select: none;
				-webkit-tap-highlight-color: rgba(255, 0, 0, 0);
			}
			
			.file {
				position: relative;
				display: inline-block;
				border: 1px solid;
				border-radius: 4px;
				overflow: hidden;
				text-decoration: none;
				text-indent: 0;
				line-height: 32px;
    			width: 62%;
				display: none;
				
			}
			
			.file input {
				position: absolute;
				font-size: 100px;
				right: 0;
				top: 0;
				opacity: 0;
			}
			
			/*input::-ms-input-placeholder{text-align: center;}
			input::-webkit-input-placeholder{text-align: center;}*/
			
			.file:hover {
				background: #AADFFD;
				border-color: #78C3F3;
				color: #004974;
				text-decoration: none;
			}
			
			.me-ss {
				display: block;
				width: 92%;
				margin: auto;
				text-align: center;
				padding-top: 8%;
			}
			
			#input-text {
				border-radius: 10px;
			}
			
			.worker {
				width: 100%;
				padding-top: 2%;
				padding-bottom: 2%;
			}
			
			.customer {
				width: 100%;
				padding-bottom: 5%;
			}
			
			.worker p,
			.customer p {
				color: white;
				font-size: 20px;
			}
			
			.worker input,
			.customer input {
				display: inline-block;
				width: 85%;
				height: 30px;
				border-radius: 5px;
				border: none;
				margin-left: 7%;
				margin-top: 3%;
				font-size: 16px;
			}
			
			.wintness {
				width: 100%;
				padding-bottom: 3%;
			}
			
			.wintness p {
				display: block;
			}
			
			.img-tips {
				display: block;
				float: left;
				margin-left: 10%;
				color: white;
				background-color: darksalmon;
				width: 100px;
				height: 30px;
				line-height: 30px;
				border-radius: 5px;
			}
			
			.submit-message {
				display: block;
				margin: auto;
				width: 30%;
				height: 40px;
				margin-top: 5%;
				border-radius: 4px;
				border: none;
				background-color: lightgray;
				color: white;
				font-size: 18px;
				width: 62%;
				height: 32px;
			}
			
			#imagePreview {
				filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale);
				margin: auto;
				margin-top: 5%;
				margin-bottom: 5%;
			}
			
			.main-bg {
				position: absolute;
				top: 0%;
				left: 0%;
				width: 100%;
				height: 100%;
				z-index: -1;
			}
			
			.car-tips {
				position: absolute;
				top: 0%;
				left: 0%;
				width: 100%;
				height: 100%;
				display: table;
				border-radius: 5px;
				display: none;
				background: rgba(0, 0, 0, 0.5);
				z-index: 10000;
			}
			
			.car-tips div {
				margin: auto;
				width: 60%;
				margin-top: 25%;
				background: white;
				text-align: center;
				padding-top: 35px;
				padding-bottom: 35px;
				padding-left: 10px;
				padding-right: 10px;
				border-radius: 10px;
			}
			
			.car-tips p {
				display: inline-block;
				margin: auto;
				letter-spacing: 3px;
				text-align: left;
			}
			
			.fa-exclamation {
				color: red;
				visibility: hidden;
				font-weight: bolder;
			}
			
			.nah {
				font-size: 16px;
				position: relative;
				width: 100%;
				height: 44px;
				line-height: 44px;
				text-align: center;
				background-color: white;
				border-bottom: 1px solid #CDCDCD;
				z-index: 99999;
			}
			
			.nah i {
				position: absolute;
				font-size: 22px;
				color: #737373;
				top: 11.5px;
				float: left;
				width: 18%;
				-webkit-text-stroke: 2px;
				-webkit-text-stroke-color: white;
			}
			
			.nah span {
				color: black;
				display: inline-block;
				width: 100%;
			}
		</style>
	</head>

	<body>
		<img class="main-bg" src="">
		<div class="me-ss">
			<div id="input-text">
				<div class="worker">
					<p>4S店接待人员</p>

					<span>
						<input type="text" id="workerName" oninput="checkN(this.id)" placeholder="&nbsp;请输入4S店接待人员姓名" onkeyup="value=value.replace(/[^\a-zA-Z\u4E00-\u9FA5]/g,'')" onbeforepaste="clipboardData.setData('text',clipboardData.getData('text').replace(/[^\a-zA-Z\u4E00-\u9FA5]/g,''))"/>
						<i class="fa fa-exclamation tipOne">!</i>
					</span>
					<span>
						<input type="tel" maxlength="11" oninput="checkh(this.id)" id="workerPhone" placeholder="&nbsp;请输入4S店接待人员手机号" />
						<i class="fa fa-exclamation tipTwo">!</i>
					</span>
				</div>

				<div class="customer">
					<p>试驾人员</p>
					<!--<input type="text" id="tryPeople" placeholder="&nbsp;请输入姓名" />-->
					<span>
						<input type="tel" maxlength="11" oninput="checkc(this.id)" id="tryPhone" placeholder="&nbsp;请输入预约试驾时提交的手机号码" />
						<i class="fa fa-exclamation tipThree">!</i>
					</span>

					<!--<span <!--style="display: block;font-size: 0.8rem;color: red;margin-top: 5%;">必须跟预约试驾时提交的手机号码一致</span>-->
				</div>

				<div class="wintness">
					<!--<span class="img-tips">上传图片</span>-->
					<a href="javascript:;" class="file">请上传照片
						<!--				 <input class="serverImg" id="imgName" name="imgName" /> -->
						<input type="file" / accept="image/*" value="请选择图片" id="imageInput" />
					</a>

					<div id="imagePreview"></div>

					<button class="submit-message">提交</button>

				</div>
			</div>
		</div>
		<div class="car-tips">
			<div>
				<p style="text-align: center;">恭喜您提交成功</p>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="https://cdn.zwmedia.com.cn/Public/Home/Default/Js/jquery-1.9.1.min.js"></script>
	<script src="javascript/lrz.all.bundle.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		function getUrlParam(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
			var r = window.location.search.substr(1).match(reg); //匹配目标参数
			if(r != null) return unescape(r[2]);
			return null; //返回参数值
		}
		var part1 =  new RegExp('zhwzpush');
		var source = getUrlParam('source');
		var moudle_code = getUrlParam('ch');

		function getUrlParam(name) {
			var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
			var r = window.location.search.substr(1).match(reg); //匹配目标参数
			if(r != null) return unescape(r[2]);
			return null; //返回参数值
		}

		var ch = getUrlParam('ch');

		if(ch == '004020') {
			$('.main-bg').attr('src', 'images/car-bg.png');
			$('#input-text').css('background', 'rgba(125,200,230,0.8)');
			$('.file').css('background-color', 'rgba(125,200,230,0.8)');
			$('.file').css('color', '#03A9F4');
			$('.file').css('border-color', '#03A9F4');
			$('.car-tips p').css('color', 'rgb(125,200,230)');
		} else if(ch == '004021') {
			if (part1.test(source)){
				$('.main-bg').attr('src', 'images/car-bg3.png');
				$('#input-text').css('background-color', 'rgba(127, 192, 218,0.3)');
				$('.file').css('background-color', 'rgba(112,92,174,0.3)');
				$('.file').css('border-color', 'rgba(112,92,174,0.3)');
				$('.file').css('color', 'rgb(112,92,174)');
				$('.car-tips p').css('color', 'rgb(112,92,174)');		
			}else{
				$('.main-bg').attr('src', 'images/car-bg4-1.png');
				$('#input-text').css('background-color', 'rgba(190,198,83,0.3)');
				$('.file').css('background-color', 'rgba(190,198,83,0.3)');
				$('.file').css('border-color', 'rgba(190,198,83,0.3)');
				$('.file').css('color', 'rgb(190,198,83)');
				$('.car-tips p').css('color', 'rgb(190,198,83)');
			}
				
		} else {
			$('.main-bg').attr('src', 'images/car-bg2.png');
			$('#input-text').css('background-color', 'rgba(137,48,39,0.3)');
			$('.file').css('background-color', 'rgba(137,48,39,0.3)');
			$('.file').css('border-color', 'rgba(137,48,39,0.3)');
			$('.file').css('color', 'rgb(137,48,39)');
			$('.car-tips p').css('color', 'rgb(137,48,39)');
		}
		var isCommit = false;

		$('.car-tips').click(function() {

			$('.car-tips').hide();
		});

		function showmsg(msg) {

			if(msg) {
				$('.car-tips p').html(msg);
				if(isCommit) {
					$('.car-tips').show();
				} else {

					$('.car-tips').show();
					setTimeout(function() {
						$('.car-tips').hide();
					}, 6000);
					return;
				}

			} else {
				$('.car-tips').show();
				setTimeout(function() {
					$('.car-tips').hide();
				}, 3000);
				return;
			}
		}
		//

		function checktipsOne() {

			if(!$('#workerName').val()) {
				$('.tipOne').css('visibility', 'visible');
			} else {
				$('.tipOne').css('visibility', 'hidden');
			}
		}

		//验证手机号
		function isPhoneNo(phone) {
			var pattern = /^1[34578]\d{9}$/;
			return pattern.test(phone);
		}

		function checkN(thisInput) {

			var ss = '#' + thisInput;
			var val = $(ss).val();
			if(!val) {
				$('.tipOne').css('visibility', 'visible');
			} else {
				$('.tipOne').css('visibility', 'hidden');
			}
		}

		function checkh(thisInput) {

			var ss = '#' + thisInput;
			var val = $(ss).val();

			if(!isPhoneNo(val)) {
				$('.tipTwo').css('visibility', 'visible');

				if(!$('#workerName').val()) {
					$('.tipOne').css('visibility', 'visible');
				} else {
					$('.tipOne').css('visibility', 'hidden');
				}

			} else {
				$('.tipTwo').css('visibility', 'hidden');

				if(!$('#workerName').val()) {
					$('.tipOne').css('visibility', 'visible');

				} else {
					$('.tipOne').css('visibility', 'hidden');
				}
			}
		}

		function checkc(thisInput) {

			var ss = '#' + thisInput;
			var val = $(ss).val();
			if(!isPhoneNo(val)) {
                $('.file').css('display','none');
				$('.tipThree').css('visibility', 'visible');

				if(!$('#workerPhone').val()) {
					$('.tipTwo').css('visibility', 'visible');
					checktipsOne();
				} else {
					$('.tipTwo').css('visibility', 'hidden');
					checktipsOne();
				}

			} else {

				$.ajax({

					url : 'data/userinfodata.php',
					data : {action:'checkTelSubmit', tel: val},
					type : 'post',
					success : function(res) {
                        var data = eval("("+res+")")
						if (data.status == 1) {

							showmsg(data.info);
						}else{
                            $('.file').css('display','inline-block');
						}
					}
				})
				$('.tipThree').css('visibility', 'hidden');

				if(!$('#workerPhone').val()) {
					$('.tipTwo').css('visibility', 'visible');
					checktipsOne();
				} else {
					$('.tipTwo').css('visibility', 'hidden');
					checktipsOne();
				}

			}
		}

		//点击提交
		$('.submit-message').click(function() {

			var workerName = $('#workerName').val();
			var workerNum = $('#workerPhone').val();
			var customerNum = $('#tryPhone').val();

			if(!workerName) {
				var msg = '请输入4S店接待人员姓名';
				showmsg(msg);
				return;
			}

			if(!isPhoneNo(workerNum)) {
				var msg = '接待人员手机号码不正确';
				showmsg(msg);
				return;
			}

			if(!isPhoneNo(customerNum)) {
				var msg = '试驾人员手机号码不正确';
				showmsg(msg);
				return;
			}
			////
			if(!dataurl) {
				var msg = '请选择照片';
				showmsg(msg);
				return;
			}
			//
			var url = 'data/userinfodata.php';
            
			var data = {
				action: 'submit',
				workerName: workerName,
				workerNum: workerNum,
				customerNum: customerNum,
				imageData: dataurl,
				ch: moudle_code,
				source:source,
			};

			$.post(url, data, function(res) {

				if(res) {

					$('.submit-message').html('已提交');
					$('.submit-message').off("click");
					$('.car-tips').off('click');
					showmsg(res);
					$("#workerName").val("");
					$("#workerPhone").val("");
					$("#tryPhone").val("");
					$("#imagePreview").hide();
					$('.car-tips').click(function() {
						$('.car-tips').hide();
						window.history.go(-1);
					});

				} else {
					showmsg(res);
				}
			});

		});
		var dataurl = '';
		[].forEach.call(document.querySelectorAll('[data-src]'), function(el) {
			(function(el) {
				el.addEventListener('click', function() {
					el.src = 'img/loading.gif';

					lrz(el.dataset.src)
						.then(function(rst) {
							el.src = rst.base64;

							return rst;
						});
				});

				fireEvent(el, 'click');
			})(el);
		});

		document.querySelector('#imageInput').addEventListener('change', function() {
			var that = this;
			$('#choseImage').remove();
			lrz(that.files[0], {
					width: 800
				})
				.then(function(rst) {
					var img = new Image(),
						div = document.createElement('div'),
						p = document.createElement('p'),
						sourceSize = toFixed2(that.files[0].size / 1024),
						resultSize = toFixed2(rst.fileLen / 1024),
						scale = parseInt(100 - (resultSize / sourceSize * 100));

					p.style.fontSize = 13 + 'px';
					p.innerHTML = resultSize + 'KB';
					p.style.color = 'white';
					div.style.height = '100px';
					img.style.height = '90px';
					div.id = 'choseImage';
					div.appendChild(img);
					div.appendChild(p);

					if(ch == '004020') {

						$('.submit-message').css('background-color', '#03A9F4');

					} else if(ch == '004021') {
						if (part1.test(source)){
							$('.submit-message').css('background-color', 'rgb(112,92,174)');
						}else{
							$('.submit-message').css('background-color', 'rgb(190,198,83)');
						}
						

					} else {

						$('.submit-message').css('background-color', 'rgb(137,48,39)');

					}
					img.onload = function() {
						document.querySelector('#imagePreview').appendChild(div);
					};

					img.src = rst.base64;
					dataurl = rst.base64;
					console.log(dataurl);
					return rst;
				});
		});

		function toFixed2(num) {
			return parseFloat(+num.toFixed(0));
		}

		String.prototype.render = function(obj) {
			var str = this,
				reg;

			Object.keys(obj).forEach(function(v) {
				reg = new RegExp('\\!\\{' + v + '\\}', 'g');
				str = str.replace(reg, obj[v]);
			});

			return str;
		};

		function fireEvent(element, event) {
			var evt;

			if(document.createEventObject) {

				evt = document.createEventObject();
				return element.fireEvent('on' + event, evt)
			} else {

				evt = document.createEvent('HTMLEvents');

				evt.initEvent(event, true, true);
				return !element.dispatchEvent(evt);
			}
		}

		function getCookie(name) {
			var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
			if(arr = document.cookie.match(reg))
				return unescape(arr[2]);
			else
				return null;
		}
		if(moudle_code == '004020') {

			document.title = "雷凌大空间 任你尽情舒展";
		} else if(moudle_code == '004021') {

			document.title = "全新致炫 不要压力 放大马力";
		} else {

			document.title = "雷凌Turbo 换芯上市";
		}
		var navih = '<div class="nah"><i class="fa fa-chevron-left"></i><span class = "head-name">' + document.title + '</span></div>';
		if(getCookie('user_platform_code') == 'MSYHC') {

			$('body').prepend(navih);
		}
		$('.nah i').click(function() {
			window.history.go(-1);
		});
	</script>

</html>