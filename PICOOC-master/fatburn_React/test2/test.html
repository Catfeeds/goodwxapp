<!DOCTYPE html>
<html lang="zh-cn">

<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>react</title>
    <link rel="stylesheet" type="text/css" href="./css/bootstrap.css">
    <style type="text/css">
    table th,
    table td {
        text-align: center;
    }
    html{
        min-height: 100%;
        position: relative;
    }
    body{
        height: 100vh;
        position: relative;
    }
    #t1{
        width: 100%;
        height: 300px;
        position: absolute;
        bottom: 0;
        overflow: hidden;
        vertical-align: middle;
        background: #999;
    }
    #t2{
        width: 100%;
        position: relative;
        vertical-align: middle;
        overflow: scroll;
    }
    .info{
        width: 100%;
        height: 60px;
        line-height: 60px;
        color: #000;
        font-size: 16px;
        vertical-align: middle;
        text-align: center;
        border-top:1px solid #666;
        border-bottom:1px solid #666;
    }
    </style>
    
    <script>
  
    </script>
    <script type="text/javascript" src="js/jquery-3.0.0.min.js"></script>
    <script src="src/react.min.js"></script>
    <script src="src/react-dom.min.js"></script>

    <script src="src/browser.min.js"></script>
    <script src="src/pubsub.js"></script>
</head>

<body>
   <div id="t1">
        <div id="t2">

        </div>

   </div>
</body>
<script>
$(function (){
    for(var i=0;i<100;i++){
        $("#t2").append("<div class=\"info\">"+i+"</div>");
    }
    var moveY=0;
    var startY=0;
    var t=0;
    var time1;
    var moveLength=60;
    $("#t1").on("touchstart",function(event){
        $("#t1").unbind("scroll");
        time1=setInterval(function(){
            t++;
        },100);
        startY=event.touches[0].clientY;

        // console.log("start"+event.touches[0].identifier);
        // console.log("start"+event.touches[0].clientX);
        // console.log("start"+event.touches[0].clientY);
        // console.log("start"+event.touches[0].target);
       /// $("#t1").css("transform","translate3d(0px,"+event.touches[0].clientY+", 0px)");
    });
    $("#t1").on("touchmove",function(){
        // console.log("move"+event.touches[0].identifier);
        // console.log("move"+event.touches[0].clientX);
        // console.log("move"+event.touches[0].clientY);
        // console.log("move"+event.touches[0].target);
        moveY=moveY+(startY-event.touches[0].clientY)*2/100;
     //  $("#t1").animate({"transform":"translate(0,"+y+")"},100);
        //var move=event.touches[0].clientY-startY;
        // if(move>0){
        //     if(moveY%moveLength!=0){
        //         moveY=(parseInt(moveY/moveLength)-1)*moveLength;
        //     }
        // }
        // else{
        //     if(moveY%moveLength!=0){
        //         moveY=(parseInt(moveY/moveLength)+1)*moveLength;
        //     }
        // }
        
        console.log("moveY:"+moveY);
        if(moveY>0 && moveY<($("#t2").height()-5*60)){
            $("#t2").css("transform","translate(0,"+-moveY+"px)");
        }
        else if(moveY<0 || moveY==0){
            moveY=0;
            $("#t2").css("transform","translate(0,"+0+"px)");
        }
        else{
            moveY=$("#t2").height()-5*60;
            $("#t2").css("transform","translate(0,"+-($("#t2").height()-5*60)+"px)");
        }
//$("#t2").css("margin-top",y+"px");

        //$("#t1").animate(function(){$("#t1").css("height",100)},200);
       // $("#t1").animate({"height":100},200);
       // $("#t1").css("transform","translate(0,"+y+")");
    });
    $("#t1").on("touchend touchcancel",function(){
        // console.log("end"+event.changedTouches[0].identifier);
        // console.log("end"+event.changedTouches[0].clientX);
        // console.log("end"+event.changedTouches[0].clientY);
        // console.log("end"+event.changedTouches[0].target);
        clearInterval(time1);
        
        console.log(($("#t2").height()-5*60));
        var v=Math.abs(event.changedTouches[0].clientY-startY)/t;
        console.log("a:"+v);
        moveY=moveY+(startY-event.changedTouches[0].clientY)/10;
        var move=event.changedTouches[0].clientY-startY;
        console.log("moveY:"+(event.changedTouches[0].clientY-startY));
        // if(moveY>0 && moveY<($("#t2").height()-5*60)){
        //     $("#t2").css("transform","translate(0,"+-moveY+"px)");
        // }
        // else if(moveY<0 || moveY==0){
        //     moveY=0;
        //     $("#t2").css("transform","translate(0,"+0+"px)");
        // }
        // else{
        //     moveY=$("#t2").height()-5*60;
        //     $("#t2").css("transform","translate(0,"+-($("#t2").height()-5*60)+"px)");
        // }
        // var speed=v*500/3;
        // console.log("speed:"+speed);
        // moveY=moveY+v;
        // if(moveY%moveLength!=0){
        //     moveY=(parseInt(moveY/moveLength)+1)*moveLength;
        // }
        // $("#t2").css("transition","transform:translate(0,"+-4000+"px)");
        /*if(moveY>0 && moveY<($("#t2").height()-5*60)){
            $("#t2").animate({"transform":"translate(0,"+-moveY+"px)"},speed);
        }
        else if(moveY<0 || moveY==0){
            moveY=0;
            $("#t2").animate({"transform":"translate(0,"+0+"px)"},speed);
        }
        else{
            moveY=$("#t2").height()-5*60;
            $("#t2").animate({"transform":"translate(0,"+-($("#t2").height()-5*60)+"px)"},speed);
        }*/
        var a=10;
        var time2=setInterval(function(){
            if(v<0){
                clearInterval(time2);
            }
            else{
                a=a+1;
                v=v-a;

                if(move>0){
                    moveY=moveY-v;
                    console.log("move1:"+(parseInt(moveY/moveLength)));
                    if(moveY%moveLength!=0){
                        if(parseInt(moveY/moveLength)>0){
                            moveY=(parseInt(moveY/moveLength))*moveLength;
                        }
                        else{
                            moveY=(parseInt(moveY/moveLength)+1)*moveLength;
                        }
                        //moveY=(parseInt(moveY/moveLength))*moveLength;
                    }
                }
                else{
                    moveY=moveY+v;
                    console.log("move2:"+(parseInt(moveY/moveLength)));
                    console.log("move3:"+(moveY%moveLength));
                    if(moveY%moveLength!=0){
                        if(parseInt(moveY/moveLength)>0){
                            moveY=(parseInt(moveY/moveLength))*moveLength;
                        }
                        else{
                            moveY=(parseInt(moveY/moveLength)+1)*moveLength;
                        }
                    }
                }

                console.log("aa:"+a);
                
                console.log("moveY1:"+moveY);
                if(moveY>0 && moveY<($("#t2").height()-5*60)){
                    $("#t2").css("transform","translate(0,"+-moveY+"px)");
                }
                else if(moveY<0 || moveY==0){
                    moveY=0;
                    $("#t2").css("transform","translate(0,"+0+"px)");
                }
                else{
                    moveY=$("#t2").height()-5*60;
                    $("#t2").css("transform","translate(0,"+-($("#t2").height()-5*60)+"px)");
                }
            }
            
        },100);
        


        // $("#t1").on("scroll",function(){
        //     console.log("scroll"+$("#t1").scrollTop());
        // });
    });

    // $("#t1").on("touchcancel",function(){
    //     console.log("cancel"+event.changedTouches[0].identifier);
    //     console.log("cancel"+event.changedTouches[0].clientX);
    //     console.log("cancel"+event.changedTouches[0].clientY);
    //     console.log("cancel"+event.changedTouches[0].target);
    // });
    // $("#t1").on("pointercancel",function(){
    //     console.log("cancel"+event.changedTouches[0].identifier);
    //     console.log("cancel"+event.changedTouches[0].clientX);
    //     console.log("cancel"+event.changedTouches[0].clientY);
    //     console.log("cancel"+event.changedTouches[0].target);
    // });

})
</script>
</html>
