webpackJsonp([23],{228:function(e,t,a){"use strict";var r=a(0),o=a(1),n=a(3),i=(getParamByUrl("roleId"),getParamByUrl("userId"),navigator.userAgent),s={outAppLogin:0!=getCookie("appOutPhone")};window.publicData=s;var c=r.createClass({displayName:"PaymentCont",getInitialState:function(){var e={title:"支付",color:"",opacity:"",backgroundColor:"",backgroundOpacity:""};return e=JSON.stringify(e),isOutAppAndLowVersion()||appFc.controlTitle(e),{goodsInfos:{},endTime:"",startTime:"",btnColor:{backgroundColor:"#35D0C5"},bgStyle:{display:"none"}}},componentWillMount:function(){0==s.outAppLogin&&(window.location.href="productDetails.html?linkId="+getParamByUrl("linkId"))},componentDidMount:function(){var e=this,t=(getParamByUrl("code"),getParamByUrl("fromGo"));$.ajax({url:ajaxLink+"/v1/api/campOrder/orderInfo"+window.location.search,type:"get",success:function(a){if(200==a.code){var r=a.resp,o={couponId:r.couponId,couponPrice:r.couponPrice,currentPrice:r.currentPrice,goodsId:r.goodsId,isCoupon:r.isCoupon,origPrice:r.origPrice,phoneNo:r.phoneNo,sourceType:r.sourceType,weChat:r.weChat,orderType:r.orderType};e.setState({goodsInfos:o});var n=new Date(r.endTime).getTime();("iOS"==getParamByUrl("os")||i.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/))&&(n=new Date(r.endTime.replace(/-/g,"/")).getTime());var s=null;s=setInterval(function(){var t=(new Date).getTime();if(t<=n){var a=n-t,r=parseInt(a/1e3),o=Math.floor(r/86400),i=Math.floor((r-24*o*60*60)/3600),c=Math.floor((r-24*o*60*60-3600*i)/60),l=Math.floor(r-24*o*60*60-3600*i-60*c);i=(i<10?"0":"")+i,c=(c<10?"0":"")+c,l=(l<10?"0":"")+l,$("#hour").html(i+":"),$("#minute").html(c+":"),$("#second").html(l)}else t>n&&(e.setState({btnColor:{backgroundColor:"#999"}}),$("#hour").html("00:"),$("#minute").html("00:"),$("#second").html("00"),clearInterval(s))},1e3),"false"==t&&e.setState({bgStyle:{display:"block"}})}else $(".error-main-t").html(datamessage),$(".errorAlert").css("display","block"),$(".error-main").css("margin-top",-$(".fixbg-main").height()/2)},error:function(){$(".error-main-t").html("网络错误"),$(".errorAlert").css("display","block"),$(".error-main").css("margin-top",-$(".fixbg-main").height()/2)}})},goWechatPay:function(e){var t=getParamByUrl("orderId");$.ajax({url:ajaxLink+"/v1/api/picooc/getPublicPayOrder?payType=1&orderId="+t,type:"get",dataType:"json",contentType:"application/json",success:function(e){if(200==e.code){var t=function(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:a,timeStamp:o,nonceStr:n,package:r,signType:i,paySign:s},function(e){"get_brand_wcpay_request:ok"==e.err_msg&&(location.href="https://a.picooc.com/web/fatburn/ordered.html"+location.search),"get_brand_wcpay_request:fail"==e.err_msg||e.err_msg})},a=e.resp.appId,r=e.resp.package,o=e.resp.timeStamp,n=e.resp.nonceStr,i=e.resp.signType,s=e.resp.paySign;"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",t,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",t),document.attachEvent("onWeixinJSBridgeReady",t)):t()}else $(".error-main-t").html(e.message),$(".errorAlert").css("display","block"),$(".error-main").css("margin-top",-$(".fixbg-main").height()/2)},error:function(){$(".error-main-t").html("网络错误"),$(".errorAlert").css("display","block"),$(".error-main").css("margin-top",-$(".fixbg-main").height()/2)}})},ClickHandle:function(){this.state.goodsInfos;if("micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i))this.goWechatPay();else{var e=decodeURIComponent(getParamByUrl("orderUrl")),t=location.origin+location.pathname+removeParamByUrl("fromGo"),a=encodeURIComponent(t);location.href=e+"&redirect_url="+a}},CompletePay:function(e){e.stopPropagation();var t=this.state.goodsInfos;t.orderType;$(".fixbg").hide(),$.ajax({url:ajaxLink+"/v1/api/campOrder/orderInfo"+window.location.search,type:"get",success:function(e){200==e.code&&(0==e.resp.orderType?$(".alerts").stop(!0).fadeIn(200).delay(2e3).fadeOut(200):1==e.resp.orderType&&(location.href="ordered.html"+removeParamByUrl("orderUrl")))}})},ErrorPay:function(e){e.stopPropagation(),$(".fixbg").hide()},leftFunction:function(){window.location.href="productDetails.html?eventName=fatBurn&typeSize=1&refer=1&linkId="+getParamByUrl("linkId")},render:function(){var e=this,t=this.state.goodsInfos,a=t.currentPrice,o=this.state.btnColor,i=this.state.bgStyle,s="";return s="micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?"10":"5",r.createElement("div",{className:"PaymentCont"},r.createElement("div",{className:"row noAppTitle"},r.createElement("div",{className:"col-xs-4 col-sm-4 left",onClick:e.leftFunction},"关闭"),r.createElement("div",{className:"col-xs-4 col-sm-4 middle"},r.createElement("img",{src:"https://cdn2.picooc.com/web/res/fatburn/image/sell/productDetails/logoLeft.png"})),r.createElement("div",{className:"col-xs-4 col-sm-4"})),r.createElement("div",{className:"timetips"},"请"+s+"分钟内付款，超时未付款订单将被取消"),r.createElement("div",{className:"payway"},"微信支付",r.createElement("div",{className:"wechatOption"})),r.createElement("div",{className:"payfooter"},r.createElement("div",{className:"nowPay"},r.createElement("span",null,"实付款："),r.createElement("span",null,"￥"+a)),r.createElement("div",{className:"paybtn",onClick:this.ClickHandle,style:o},r.createElement("p",{className:"ljpay"},"立即支付"),r.createElement("p",{className:"payTime"},r.createElement("span",{id:"hour"}),r.createElement("span",{id:"minute"}),r.createElement("span",{id:"second"})))),r.createElement(n,null),r.createElement("aside",{className:"row fixbg",style:i},r.createElement("div",{className:"col-xs-12 col-sm-12 fixbg-main",style:{top:"35%"}},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-xs-12 col-sm-12 fixbg-main-t"},"请确认微信支付是否已完成"),r.createElement("div",{className:"col-xs-12 col-sm-12 fixbg-main-btn"},r.createElement("div",{className:"row"},r.createElement("div",{className:"col-xs-12 col-sm-12 fixbg-main-btn1",onClick:this.CompletePay},"已支付完成"),r.createElement("div",{className:"col-xs-12 col-sm-12 fixbg-main-btn2",onClick:this.ErrorPay},"取消")))))),r.createElement("aside",{className:"alertBox"},r.createElement("div",{className:"alerts",style:{display:"none"}},"您的订单还未完成支付，请重新支付～")))}});o.render(r.createElement(c,null),document.getElementById("paymentCont"))}},[228]);