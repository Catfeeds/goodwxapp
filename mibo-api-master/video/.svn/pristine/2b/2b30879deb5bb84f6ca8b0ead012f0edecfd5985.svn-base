<?php

class Model_Ad extends PhalApi_Model_NotORM {

    protected function getTableName($id) {
        return 'ad';
    }

    public function getList() {
        $list = DI()->redis->get_time('get_ad');

        $channel = DI()->request->get('channel');
        $channel = !empty($channel) ? $channel : '';

        $ad = [];
        if(isset($list) && !empty($list)) {
            $list = json_decode($list, true);
            foreach($list as $val) {
                if($val['channel'] == $channel) {
                    $ad = $val;
                    break;
                }
            }

            if(empty($ad)) {
                $ad = $list[0];
            }
        } else {

            $list = DI()->notorm->ad->where('status = 1')->fetchAll();


            foreach($list as $val) {
                if($val['channel'] == $channel) {
                    $ad = $val;
                    break;
                }
            }

            if(empty($ad)) {
                $ad = $list[0];
            }

            DI()->redis->set_time('get_ad', json_encode($list), 60 * 60 * 3);
        }
        return $ad;
    }




}
