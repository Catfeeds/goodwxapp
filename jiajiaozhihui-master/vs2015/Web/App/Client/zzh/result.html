<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>栀子会-入班考试</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" >
    <link href="css/blockUI.css" >
</head>
<body>
<div class="container" style="padding-top:30px;">
    <div id="my">

    </div>
    <div style="height: 5px; background: #eee;"></div>
    <div id="top" style="padding-top:15px;">

    </div>
</div>

<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script>
    var o=getQueryString("o");
    console.log(o);
    if(getQueryString("o")==null){
        //return
    }
    $.ajax({
        url:'http://161s5g6007.51mypc.cn/app/appstart/basic/resolver.ashx',
        type:"POST",
        dataType:"JSON",
        data:{
            o:getQueryString("o"),
            url:window.location.href
        },
        success:function(res){
            wx.config({
                debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                appId: res.info.jsSdk.appId, // 必填，公众号的唯一标识
                timestamp:res.info.jsSdk.timestamp, // 必填，生成签名的时间戳
                nonceStr:res.info.jsSdk.nonceStr, // 必填，生成签名的随机串
                signature: res.info.jsSdk.signature,// 必填，签名，见附录1
                jsApiList: ['onMenuShareTimeline','onMenuShareAppMessage','onMenuShareQQ','onMenuShareWeibo','onMenuShareQZone'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
            });
            var data={
                title:'新手测试',
                desc:'',
                link:'http://161s5g6007.51mypc.cn/app/appstart/basic/baseinfo.ashx?redirect_url=http://161s5g6007.51mypc.cn/app/client/zzh/ready.html?r=a=app001|h=start',
                imgUrl:'http://161s5g6007.51mypc.cn/app/client/character/imgs/logo.png',
            };
            wx.onMenuShareTimeline(data);
            wx.onMenuShareAppMessage(data);
            wx.onMenuShareQQ(data);
            wx.onMenuShareWeibo(data);

            console.log(res);
            var score=getQueryString("score");
            var timer=getQueryString("timer");
            $.getJSON('http://161s5g6007.51mypc.cn/app/project/gardenia/controller/testcontroller.ashx',{
                score:score,timer:timer,openid:res.info.openId
            },function(res){
                var li='';
                console.log(res);

                li+='<div class="media" style="border-bottom:1px solid #eee; position: relative;">';
                li+='<div class="media-left">';
                li+='   <a href="#"><img style="width:40px;" class="media-object" src="'+res.my.headImgUrl+'" ></a>';
                li+='</div>';
                li+='<div class="media-body">';
                li+='   <h4 class="media-heading">'+res.my.nickName+'</h4>';
                li+='   <p>分数:'+res.my.score+'  时间:'+res.my.timer+'</p>';
                li+='</div>';
                li+='<div style="position: absolute;top:0;right:5px;display: flex;align-items: center; height: 100%;"><span >第'+res.my.index+'名</span></div>';
                li+='</div>';
                $("#my").empty();
                $("#my").append(li);

                li='';
                $.each(res.top,function(i,ele){
                    li+='<div class="media" style="border-bottom:1px solid #eee; position: relative;">';
                    li+='<div class="media-left">';
                    li+='   <a href="#"><img style="width:40px;" class="media-object" src="'+ele.headImgUrl+'" ></a>';
                    li+='</div>';
                    li+='<div class="media-body">';
                    li+='   <h4 class="media-heading">'+ele.nickName+'</h4>';
                    li+='   <p>分数:'+ele.score+'  时间:'+ele.timer+'</p>';
                    li+='</div>';
                    li+='<div style="position: absolute;top:0;right:5px;display: flex;align-items: center; height: 100%;">';
                    if(ele.index>3){
                        li+='<span >'+ele.index+'</span>';
                    }else{
                        li+='<img style="width:40px;" src="./imgs/rank'+ele.index+'.png">';
                    }
                    li+='</div>';
                    li+='</div>';
                })
                $("#top").empty();
                $("#top").append(li);
                console.log(res);
            })
        }
    });

    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]); return null;
    };

</script>
</body>

</html>