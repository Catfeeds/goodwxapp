<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>栀子会-入班考试</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">  
    <link href="css/blockUI.css" >
    <link href="http://cdn.bootcss.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        body{
            background: url(./imgs/index.jpg) no-repeat;
            background-size:100%;
            position: relative;
        }
        .selectedAnswer{
            font-weight: bolder;
            color: rgb(0,118,103);
            font-size:15px;
        }
    </style>
  </head>
  <body>
            <div class="panel panel-default" style="background: none;">
                <div class="panel-heading" style="font-size:18px;background: none;">
                    第<span id="sn"></span >题
                    <small>请选择</small>
                    <span class="fa fa-hand-o-down"></span>
                </div>
                <ul class="list-group" style="background:none;">
                        
                </ul>
            </div>        
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <script src="js/jquery.blockUI.js"></script>
    <script>
        var object={};
        var totalScore=0;
        var date1=new Date();
        $.getJSON('./sourse/db.json',function(res){
            console.log(res);
            object=res;
            read(0)
        });
        function read(index){
            $("#sn").text(index+1);
            var data=  object.data[index];
            var li='';
            li+='<div class="page-header" style="margin: 0;" >';
            li+='   <h4 style="padding-left:5px; padding-right:5px;font-weight: bolder;">'+data.title+'</h4>';
            li+='</div>';
            $.each(data.items,function(i,ele){

                if(data.type=="image"){
                    li+='<li style="background:none;padding:15px 5px;" class="list-group-item" data-sn="'+ele.sn+'" data-index="'+index+'" ><span>'+ele.value+'</span><img style="width:100px;" src="'+ele.text+'"></li>'
                }else if(data.type=="text") {
                    li+='<li style="background:none;padding:15px 5px;" class="list-group-item" data-sn="'+ele.sn+'" data-index="'+index+'" >'+ele.value+' '+ele.text+'</li>'
                }
            });
            $(".list-group").empty();
            $(".list-group").append(li);
        }
        var results=[];
        $(document).on('click','.list-group-item',function(){
            $.blockUI({ css: { 
                border: 'none', 
                padding: '15px', 
                backgroundColor: '#000', 
                '-webkit-border-radius': '10px', 
                '-moz-border-radius': '10px', 
                opacity: 0,
                color: '#000'
            } });

            $(this).addClass("selectedAnswer");
            var index=$(this).data("index");
            var row= object.data[+index];
            var right=row.right;
            var score=row.score||0;
            var sn=$(this).data("sn");
            var selected=row.items[+sn-1];
            console.log(selected);
            if(right==selected.value){
                totalScore+=score;
            }
            setTimeout(function(){
                if(+index>=object.data.length-1 ){
                    var date2=new Date();
                    var t=date2.getTime()-date1.getTime(); //豪秒
                    window.location.href="result.html?o="+getQueryString("o")+"&score="+totalScore+"&timer="+t;
                }else{
                    read(+index+1);
                }
                $.unblockUI();
            },500);
        })
        function analyze(data){
            var arr = [];
            data.sort();
            for (var i = 0; i < data.length;) {
                var count = 0;
                for (var j = i; j < data.length; j++) {
                    if (data[i] === data[j]) {
                        count++;
                    }
                }
                arr.push({result: data[i],count: count})
                i+=count;
            }
            console.log(arr);
            var max=0;
            var index=0;
            for (var k = 0; k < arr.length; k++) {
                if(arr[k].count>max){
                    max=arr[k].count;
                    index=k;
                }
                
            }
            return arr[index].result;
        }
        function getQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        };
    </script>
  </body>
</html>

