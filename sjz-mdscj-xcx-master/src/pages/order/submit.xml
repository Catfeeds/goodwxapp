<form bindsubmit="formSubmit" report-submit='true'>
  <button formType="submit" class="formIdBtn">
    <view class="order-submit" wx:if="{{state.address || props.isReady}}">
      <image class="order-address-bar" src="../../images/envelope_title.png"></image>
      <view class="order-address flex items-center" catchtap="handleShowSelector">
        <view class="order-address-info flex-auto">
          <text class="order-address-info-name">{{state.address.consignee}}   {{state.address.phone}}</text>
          <text class="order-address-info-detail">{{state.addressStr}}</text>
        </view>
        <text class="iconfont icon-unie93d order-address-icon flex-none"></text>
      </view>

      <view class="order-margin"></view>

      <view class="order-info flex flex-column">

        <view class="order-product flex">
          <image class="order-img flex flex-none" src="{{props.detail.orderBOs[0].orderItems[0].orderItem.img}}"/>
          <view class="order-product-right flex-auto">
            <text class="order-product-name">{{props.detail.orderBOs[0].orderItems[0].orderItem.productName}}</text>
            <text class="order-product-sku">{{props.detail.orderBOs[0].orderItems[0].orderItem.skuStr}}</text>
            <view class="flex justify-between">
              <text class="order-product-price">{{props.detail.orderBOs[0].orderItems[0].orderItem.promotionPrice / 100}}</text>
              <text class="order-product-quantity">{{props.detail.orderBOs[0].orderItems[0].orderItem.quantity}}</text>
            </view>
          </view>
        </view>

        <view class="order-info-item flex justify-between">
          <text>运费</text>
          <text class="order-log-price">{{props.detail.orderBOs[0].priceDetail.originalLogisticsAmount / 100}}</text>
        </view>

        <view class="order-info-item">
          <view>买家留言:</view>
          <view>
            <block wx:if="{{state.showSelector || state.showModalCoupons}}">
              <textarea value="{{state.remarkText}}" bindinput="handleRemarkChange" class="order-remark color-trans" auto-height="true"
                        placeholder=""></textarea>
            </block>
            <block wx:else="">
              <textarea value="{{state.remarkText}}" bindinput="handleRemarkChange" class="order-remark" auto-height="true"
                        placeholder="选填"></textarea>
            </block>
          </view>
        </view>

        <view class="order-info-item" wx:if="{{props.detail.orderBOs[0].remark.cardId != null}}">
          <view>身份证(请务必正确填写)</view>
          <view>
            <block wx:if="{{state.showSelector || state.showModalCoupons}}">
              <textarea value="{{state.cardId}}" bindinput="handlecardIdChange" class="order-remark" auto-height="true"
                        placeholder=""></textarea>
            </block>
            <block wx:else="">
              <textarea value="{{state.remarkText}}" bindinput="handleRemarkChange" class="order-remark" auto-height="true"
                        placeholder="保税仓商品身份证号码必填，清关所需"></textarea>
            </block>
          </view>
        </view>

        <view class="order-info-item order-summary self-end">
          <text>应付：<text class="order-summary-price">{{(props.detail.orderBOs[0].priceDetail.finalAmount + props.detail.orderBOs[0].priceDetail.couponsAmount)/100 || 0}}</text>(含运费<text class="order-log-price">{{props.detail.orderBOs[0].priceDetail.originalLogisticsAmount/100 || 0}}</text>)</text>
        </view>
      </view>

      <view class="order-margin"></view>

      <view class="order-coupons" catchtap="handleToggleCoupons">
        <text>优惠券: </text>
        <text class="tag" wx:if="{{props.dataCoupons.num > 0}}">{{props.dataCoupons.num}}张可用</text>
        <text class="tag grey" wx:else="">暂无可用</text>

        <text class="iconfont icon-unie93d"></text>

        <text class="coupon-price grey" wx:if="{{props.dataCoupons.num >0 && !props.dataCoupons.selectedData.couponNo}}">未使用</text>
        <block wx:if="{{props.dataCoupons.num>0 && props.dataCoupons.selectedData.type !== 3 && props.dataCoupons.selectedData.couponNo}}">
          <text class="coupon-price">-￥{{ props.dataCoupons.selectedData.profitFee_show }}</text>
        </block>
        <block wx:if="{{props.dataCoupons.num>0 && props.dataCoupons.selectedData.type === 3 && props.dataCoupons.selectedData.couponNo}}">
          <text class="coupon-price">{{ props.dataCoupons.selectedData.profitFee_show }} 折</text>
        </block>
      </view>
      <view class="order-margin"></view>

      <view class="order-pay-select">
        <view class="order-info-item flex justify-between">
          <text>支付方式</text>
          <text>微信支付</text>
        </view>
      </view>

      <view class="order-bottom flex items-center">
        <text class="order-submit-summary flex-auto">总计：<text class="order-summary-price">{{props.detail.totalFinalAmount / 100}}</text>(含运费<text class="order-log-price">{{props.detail.totalLogisticAmount / 100}}</text>)</text>
        <text catchtap="handleSubmit" class="order-submit-btn flex-none">立即支付</text>
      </view>

      <view hidden="{{!state.showSelector}}" class="order-address-selector" catchtap="handleCloseSelector">
        <scroll-view class="address-selector-body" scroll-y="true">
          <view wx:for="{{props.addressList}}" wx:key="{{item.id}}" class="address-item flex items-center" data-address="{{item}}" catchtap="handleSelectAddress">
            <text wx:if="{{item.id === state.address.id}}" class="iconfont icon-unie61b flex-none selected"></text>
            <text wx:else="" class="iconfont icon-unie6d7 flex-none"></text>
            <view class="order-address-info flex-auto">
              <text class="order-address-info-name">{{item.consignee}}   {{item.phone}}</text>
              <text class="order-address-info-detail">{{item.province}} {{item.city}} {{item.district}} {{item.strict}}</text>
            </view>

            <view class="order-address-edit flex-none" data-id="{{item.id}}" catchtap="handleAddressEdit">
              <text class="iconfont icon-unie93d" data-id="{{item.id}}"></text>
            </view>
          </view>

          <view class="address-add-btn flex items-center" catchtap="handleAddAddress">
            <text class="flex-none iconfont icon-unie6d92"></text>
            <text>新增收货地址</text>
          </view>
        </scroll-view>
      </view>

      <view class="modal-coupons" hidden="{{!state.showModalCoupons}}" catchtap="handleToggleCoupons">
        <view class="modal-container">
          <view class="title">请选择优惠券</view>
          <text class="close iconfont icon-untitled94" catchtap="handleToggleCoupons"></text>
          <scroll-view class="modal-scroll" scroll-y="true">
            <view class="list">
              <block wx:for="{{props.dataCoupons.list}}">
                <view class="item {{item.id === props.dataCoupons.selectedData.id ? 'selected' : ''}}">
                <view
                  class="item-main"
                  data-item="{{item}}"
                  catchtap="handleSelectCoupons">
                  <view class="price" data-item="{{item}}">
                    <view data-item="{{item}}" class="big-price" wx:if="{{item.type !== 3}}">￥<text>{{item.profitFee_show}}</text></view>
                    <view data-item="{{item}}" class="big-price" wx:if="{{item.type === 3}}"><text>{{item.profitFee_show}}折</text></view>
                    <view data-item="{{item}}">{{item.couponRuleVO.fullFee_show}}</view>
                  </view>
                  <view class="info" data-item="{{item}}">
                    <view class="big-word" data-item="{{item}}">{{item.couponName}}</view>
                    <view data-item="{{item}}">• 有效期至{{item.endTime_show}}</view>
                  </view>
                  <view data-item="{{item}}" class="icon iconfont {{item.couponNo === props.dataCoupons.selectedData.couponNo ? 'icon-unie61b' : 'icon-unie6d7'}}"></view>
                </view>
                <view>
              </block>
            </view>
          </scroll-view>
        </view>
      </view>
    </view>
  </button>
</form>
