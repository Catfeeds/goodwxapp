module("vizengine_math.js",function(){var h=com.vizengine.core.Object;com.vizengine.gesture={};h.extend("com.vizengine.gesture.Point",{init:function(a,b){this.x=null==a?0:a;this.y=null==b?0:b},x:0,y:0,distanceTo:function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))}});var k=com.vizengine.gesture.Point;k.extend("com.vizengine.gesture.TouchPoint",{init:function(a,b){k.prototype.init.apply(this,arguments);this.absX=this.x;this.absY=this.y}});var l=com.vizengine.gesture.TouchPoint;
h.extend("com.vizengine.gesture.TouchEvent",{init:function(){this.state=0;this.touchPoints=[]},getCenter:function(){if(null==this.touchPoints||1>this.touchPoints.length)return null;var a=0,b=0,c;for(c in this.touchPoints)var e=this.touchPoints[c],a=a+e.x,b=b+e.y;return new k(a/this.touchPoints.length,b/this.touchPoints.length)},getRadius:function(){if(1>=this.touchPoints.length)return 0;var a=this.getCenter(),b=0,c;for(c in this.touchPoints)b+=this.touchPoints[c].distanceTo(a);return b/this.touchPoints.length},
getX:function(a){if(null==a){if(1==this.touchPoints.length)return this.touchPoints[0].x;for(var b=a=0;b<this.touchPoints.length;b++)a+=this.touchPoints[b].x;return a/this.touchPoints.length}return this.touchPoints.length>a?this.touchPoints[a].x:0},getAbsX:function(a){if(null==a){if(1==this.touchPoints.length)return this.touchPoints[0].absX;for(var b=a=0;b<this.touchPoints.length;b++)a+=this.touchPoints[b].absX;return a/this.touchPoints.length}return this.touchPoints.length>a?this.touchPoints[a].absX:
0},getY:function(a){if(null==a){if(1==this.touchPoints.length)return this.touchPoints[0].y;for(var b=a=0;b<this.touchPoints.length;b++)a+=this.touchPoints[b].y;return a/this.touchPoints.length}return this.touchPoints.length>a?this.touchPoints[a].y:0},getAbsY:function(a){if(null==a){if(1==this.touchPoints.length)return this.touchPoints[0].absY;for(var b=a=0;b<this.touchPoints.length;b++)a+=this.touchPoints[b].absY;return a/this.touchPoints.length}return this.touchPoints.length>a?this.touchPoints[a].absY:
0},getCount:function(){return this.touchPoints.length},getTouchPoints:function(){return this.touchPoints},offsetCopy:function(a,b){var c=new m;c.state=this.state;c.ghost=this.ghost;for(var e in this.touchPoints){var d=this.touchPoints[e],f=new l;f.x=d.x+a;f.y=d.y+b;f.absX=d.absX;f.absY=d.absY;c.touchPoints[e]=f}return c},applyMartix4:function(a){var b=new m;b.state=this.state;b.ghost=this.ghost;for(var c in this.touchPoints){var e=this.touchPoints[c],d=new l,f=new com.vizengine.math.Vector3(e.x,e.y,
0);f.applyMatrix4(a);d.x=f.x;d.y=f.y;d.absX=e.absX;d.absY=e.absY;b.touchPoints[c]=d}return b}});var m=com.vizengine.gesture.TouchEvent;h.extend("com.vizengine.gesture.GestureDetector",{detect:function(a){return!1}});var g=com.vizengine.gesture.GestureDetector;g.extend("com.vizengine.gesture.TapGestureDetector",{init:function(){g.prototype.init(this,arguments);this.downPoint=null;this.downTime=0},callback:null,getPointInRoot:function(a){var b=a.getAbsX();a=a.getAbsY();return new l(b,a)},detect:function(a){if(null==
this.callback)return!1;if(0==a.state)this.downTime=(new Date).getTime(),this.downPoint=this.getPointInRoot(a);else if(2==a.state){var b=(new Date).getTime(),c=this.getPointInRoot(a);if(null==this.downPoint)return!1;if(200>b-this.downTime&&6>this.downPoint.distanceTo(c))return this.callback(a);this.downPoint=null}return!0}});g.extend("com.vizengine.gesture.SweepGestureDetector",{init:function(){g.prototype.init.apply(this,arguments);this.cancelCallback=null;this.touchTrack=[];this.mutiTouch=!1},callback:null,
detect:function(a){if(null==this.callback)return!1;0==a.state&&1==a.touchPoints.length&&(this.mutiTouch=!1);1<a.touchPoints.length&&(this.mutiTouch=!0);if(this.mutiTouch)a.ghost&&null!=this.cancelCallback&&this.cancelCallback(),2==a.state&&this.callback(0,0,a);else{if(0==a.state){var b=(new Date).getTime();a=a.touchPoints[0];a.time=b;this.touchTrack.length=0;this.touchTrack[0]=a}else if(1==a.state)b=(new Date).getTime(),a=a.touchPoints[0],a.time=b,this.touchTrack[this.touchTrack.length]=a;else if(2<=
a.state){var b=(new Date).getTime(),c=a.touchPoints[0];c.time=b;for(var e=null,d=this.touchTrack.length-1;0<=d;d--){var f=this.touchTrack[d];50<b-f.time&&(e=f)}null==e&&0<this.touchTrack.length&&(e=this.touchTrack[0]);this.touchTrack.length=0;return null!=e&&(d=b-e.time,0<d)?(b=(c.absY-e.absY)/d,c=(c.absX-e.absX)/d,e=Math.abs(b),d=Math.abs(c),3.4<d&&(d=3.4/d,c*=d,b*=d),3.4<e&&(d=3.4/e,c*=d,b*=d),this.callback(c,b,a)):this.callback(0,0,a)}return!1}}});g.extend("com.vizengine.gesture.PanGestureDetector",
{init:function(){g.prototype.init.apply(this,arguments);this.touchDownY=this.touchDownX=0;this.touching=!1;this.fingerCount=0;this.draging=!1},callback:null,detect:function(a){var b=!1;if(null==this.callback)return b;var c=0,e=0;this.fingerCount!=a.touchPoints.length&&(this.fingerCount=a.touchPoints.length,this.touching=!1);0==this.touching&&(a=a.offsetCopy(0,0),a.state=0);0==a.state?(this.touching=!0,this.touchDownX=a.getAbsX(),this.touchDownY=a.getAbsY()):(c=a.getAbsX()-this.touchDownX,e=a.getAbsY()-
this.touchDownY);1==a.state&&(this.draging=!0);if(this.draging||0==a.state)b=this.callback(c,e,a);2==a.state&&(this.draging=this.touching=!1);return b}});g.extend("com.vizengine.gesture.TwistGestureDetector",{init:function(){g.prototype.init.apply(this,arguments);this.touching=!1;this.fingerCount=0},callback:null,getRotation:function(a){return 2>a.touchPoints.length?0:Math.atan2(a.touchPoints[0].x-a.touchPoints[1].x,a.touchPoints[0].y-a.touchPoints[1].y)},detect:function(a){if(null==this.callback)return!1;
var b=0,c=a.touchPoints.length,e=a.getCenter();this.fingerCount!=c&&(this.fingerCount=c,this.touching=!1);0==this.touching&&1==a.state&&(a=a.offsetCopy(0,0),a.state=0);0==a.state?(this.touching=!0,this.initRotation=this.getRotation(a)):b=this.getRotation(a)-this.initRotation;if(2==a.state)this.touching=!1;else return this.callback(e,b,a);return!1}});g.extend("com.vizengine.gesture.PinchGestureDetector",{init:function(){g.prototype.init.apply(this,arguments);this.fingerCount=this.initRadius=0},callback:null,
detect:function(a){if(null==this.callback||2>a.touchPoints.length)return!1;var b=!1;if(0==a.state||this.fingerCount!=a.touchPoints.length)this.initRadius=a.getRadius(),this.fingerCount=a.touchPoints.length,b=!0;var c=a.getRadius()/this.initRadius;return 2>a.state?this.callback(c,b,a):!1}})});
