module("/libs/vizengine_location.js","/libs/vizengine_engine3d.js","/libs/vizengine_engine3d_webgl.js","/libs/vizengine_engine3d_css3d.js",function(){var p=com.vizengine.core.Object,k=com.vizengine.view.View,v=com.vizengine.gesture.PanGestureDetector,w=com.vizengine.gesture.SweepGestureDetector,x=com.vizengine.gesture.PinchGestureDetector,l=com.vizengine.animation.Animation,n=com.vizengine.animation.DecelerateInterpolator;if(com.vizengine.core.Platform.vizengineMobile)k.extend("com.vizengine.view.PanoView",
{setMarkerDragEnable:function(a){},isMarkerDragEnabled:function(){},setMarkerDragCallback:function(a){},setHDEnable:function(a){},setOnScaleCallback:function(a){},setOnFovChangeCallback:function(a){},isHDEnabled:function(){},setFov:function(a){},getFov:function(){},setZoom:function(a){},getZoom:function(){},_snapshot:function(){},getSnapshotDiv:function(){},isVREnabled:function(){},setVREnable:function(a){},setPanoId:function(a,b,c){},getPanoId:function(){},setAutoplayLoopTime:function(a){},setAutoplayEnable:function(a){},
isAutoplayEnabled:function(){},autoPlay:function(){},stopAutoPlay:function(){},setGravityEnable:function(a){},isGravityEnabled:function(){},isTrackingDevice:function(){},trackingDevice:function(){},stopTrackingDevice:function(){},setHeading:function(a){},setPitch:function(a){},setRoll:function(a){},getHeading:function(){},getPitch:function(){},getRoll:function(){}});else{l.extend("com.vizengine.animation.PanoAnimation",{init:function(){l.prototype.init.apply(this,arguments);this.toRoll=this.toPitch=
this.toHeading=this.fromFov=this.fromRoll=this.fromPitch=this.fromHeading=0;this.enableFov=this.enableRoll=this.enablePitch=this.enableHeading=!1},animateFrame:function(a,b){this.enableHeading&&a.panoViewInternal.setHeading(this.fromHeading+(this.toHeading-this.fromHeading)*b);this.enablePitch&&a.panoViewInternal.setPitch(this.fromPitch+(this.toPitch-this.fromPitch)*b);this.enableRoll&&a.panoViewInternal.setRoll(this.fromRoll+(this.toRoll-this.fromRoll)*b);this.enableFov&&a.panoViewInternal._setFov(this.fromFov+
(this.toFov-this.fromFov)*b)}});l.extend("com.vizengine.animation.PanoFlyAnimation",{init:function(){l.prototype.init.apply(this,arguments);this.toRoll=this.toPitch=this.toHeading=this.fromRoll=this.fromPitch=this.fromHeading=0;this.enablePitch=this.enableHeading=!0;this.enableRoll=!1},animateFrame:function(a,b){this.enableHeading&&a._setHeading(this.fromHeading+(this.toHeading-this.fromHeading)*b);this.enablePitch&&a._setPitch(this.fromPitch+(this.toPitch-this.fromPitch)*b);this.enableRoll&&a._setRoll(this.fromRoll+
(this.toRoll-this.fromRoll)*b)}});var r=com.vizengine.animation.PanoFlyAnimation;l.extend("com.vizengine.animation.PanoScaleAnimation",{init:function(){l.prototype.init.apply(this,arguments);this.toFov=this.fromFov=0},animateFrame:function(a,b){a._scaleCamera(this.fromFov+(this.toFov-this.fromFov)*b)}});var t=com.vizengine.animation.PanoScaleAnimation,y=new function(){this.taskQueue=[];this.addTask=function(a){this.taskQueue.push(a);this.processTask()};this.runningTaskCount=0;this.maxTaskCount=2;
this.processTask=function(){if(0!=this.taskQueue.length&&!(this.runningTaskCount>=this.maxTaskCount)){var a=this;this.runningTaskCount++;this.taskQueue.shift()(function(){a.runningTaskCount--;a.processTask()})}}},u=function(a,b,c){y.addTask(function(d){var e=new Image;e.crossOrigin="*";e.onload=function(){b(e);d();e=null};e.onerror=function(){null!=c&&c(null);d();e=null};a=(window.__pano__proxy||window.__vizengine__proxy||"")+a;e.src=a})};p.extend("BoxPanoTileLoader",{init:function(a,b,c,d){p.prototype.init.apply(this,
arguments);this.boxPano=a;this.level=b;this.column=c;this.row=d;this.textureLoadCallback=null;this.loadState=0;this.mcRow=this.boxPano._mcRow;this.position=new THREE.Vector3;this._setTilePosition(this.position);this.texture=this.material=this.geometry=null},_getTilePath:function(){return""+this.level+"/"+this.column+"_"+this.row},_generateTileUrl:function(){return this.boxPano.urlProvider(this.boxPano.panoView.panoId,this.level,this.row,this.column)},_getFaceId:function(){return Math.floor(this.column/
this._getFaceRowCount())},_getFaceRowCount:function(){return-1==this.level?Math.pow(2,this.level+1):Math.pow(2,this.level)*this.mcRow},_getFaceWidth:function(){return 400-2*this.level},_getCellWidth:function(){return this._getFaceWidth()/this._getFaceRowCount()},_getCellX:function(){var a=this._getFaceRowCount(),b=this._getFaceId();return this.column-a*b},_getCellY:function(){return this.row},_setTilePosition:function(a){var b=this._getFaceWidth(),c=this._getCellWidth(),d=this._getFaceId(),e=this._getCellX(),
f=this._getCellY();0==d?(a.x=-b/2+c/2+e*c,a.y=b/2,a.z=b/2-c/2-f*c):1==d?(a.x=b/2,a.y=b/2-c/2-e*c,a.z=b/2-c/2-f*c):2==d?(a.x=b/2-c/2-e*c,a.y=-b/2,a.z=b/2-c/2-f*c):3==d?(a.x=-b/2,a.y=-b/2+c/2+e*c,a.z=b/2-c/2-f*c):4==d?(a.x=-b/2+c/2+e*c,a.y=-b/2+c/2+f*c,a.z=b/2):5==d&&(a.x=-b/2+c/2+e*c,a.y=b/2-c/2-f*c,a.z=-b/2)},_setTileRotation:function(a){var b=this._getFaceId();0==b?a.x=Math.PI/2:1==b?(a.y=-Math.PI/2,a.z=-Math.PI/2):2==b?(a.x=-Math.PI/2,a.z=Math.PI):3==b?(a.y=Math.PI/2,a.z=Math.PI/2):4==b?a.x=Math.PI:
5==b&&(a.z=0)},_setFaceVertexUVS:function(a){if(!(0<=this.level)){var b=this._getFaceId();a[0][0][0].x=b/6;a[0][0][1].x=b/6;a[0][0][2].x=(b+1)/6;a[0][1][0].x=b/6;a[0][1][1].x=(b+1)/6;a[0][1][2].x=(b+1)/6}},_createMesh:function(a){var b=this;if(0==this.boxPano.panoView._renderType){var c=this._getCellWidth();this.texture=new THREE.Texture;this.texture.image=a;this.texture.needsUpdate=!0;this.material=new THREE.MeshBasicMaterial({map:this.texture});this.geometry=new THREE.PlaneGeometry(c,c,1);this.mesh=
new THREE.Mesh(this.geometry,this.material);this._setTilePosition(this.mesh.position);this._setTileRotation(this.mesh.rotation);this._setFaceVertexUVS(this.geometry.faceVertexUvs)}else this.mesh=new THREE.CSS3DObject(function(){var c=b._getCellWidth();if(0>b.level){var e=a,f=b._getFaceId(),g=document.createElement("canvas"),h=g.getContext("2d");g.width=c;g.height=c;h.drawImage(e,-f*c,0,6*c,c);a=g}else a=a.cloneNode(!0),a.width=c,a.height=c,a.style.width=c+"px",a.style.height=c+"px";return a}),this._setTilePosition(this.mesh.position),
this._setTileRotation(this.mesh.rotation);this.boxPano.rootObject.add(this.mesh)},setImage:function(a){this._createMesh(a);this.loadState=2;this.textureLoadCallback()},setImageWithoutCallback:function(a){this._createMesh(a);this.loadState=2},load:function(){var a=this;this.dispose();this.loadState=1;var b=this._generateTileUrl();u(b,function(b){0!=a.loadState&&(a.setImage(b),a=null)},function(){this.loadState=0})},dispose:function(){null!=this.boxPano&&null!=this.boxPano.rootObject&&null!=this.mesh&&
this.boxPano.rootObject.remove(this.mesh);null!=this.texture&&(this.texture.dispose(),this.texture=null);null!=this.material&&(this.material.dispose(),this.material=null);null!=this.geometry&&(this.geometry.dispose(),this.geometry=null);this.geometry=this.texture=this.material=this.mesh=null;this.loadState=0}});p.extend("BoxPano",{init:function(a){p.prototype.init.apply(this,arguments);this.panoId=null;this.panoView=a;this._tileLayerCount=1;this._maxVisibleTileCount=com.vizengine.core.Platform.mobile?
44:88;this._maxCacheTileCount=1536;this.urlProvider=function(a,c,d,e){0>c&&(e=d=0);if(a&&"[QQ]"==a.substring(0,4))return window.location.protocol+"//webapp.visualbusiness.cn/vizengine/v1.0.46/PanoViewer/TileProxy.jsp?panoId="+a+"&level="+c+"&column="+e+"&row="+d;var f=window.location.protocol+"//tiles.pano.visualbusiness.cn/";a&&"[TT]"==a.substring(0,4)&&(f=window.location.protocol+"//tilestest.pano.visualbusiness.cn/",a=a.substring(4));rootView&&rootView._interceptedPanotileUrl&&(f=rootView._interceptedPanotileUrl);
return-1>c?f+a+"/sv.xml":-1==c?f+a+"/cube/thumb.jpg":f+a+"/cube/"+c+"_"+d+"_"+e+".jpg"};this.tileLoaders=[];this._createObjects()},startCheck:function(){null==this.updater&&(this.updater={},this.contCheck())},contCheck:function(){if(null!=this.updater){this._checkAndLoadTiles();var a=this;setTimeout(function(){a.contCheck();a=null},3E3)}},stopCheck:function(){this.updater=null},_createObjects:function(){this.loader=new THREE.TextureLoader;this.loader.crossOrigin="*"},_createTileLoaders:function(){var a=
this,b=a._tileLayerCount;1>a._tileLayerCount&&(b=1);4<a._tileLayerCount&&(b=4);for(var c=-1;c<b;c++){var d=1;0<=c&&(d=Math.pow(2,c)*this._mcRow);for(var e=6*d,f=0;f<d;f++)for(var g=0;g<e;g++){var h=new BoxPanoTileLoader(this,c,g,f);h.textureLoadCallback=function(){a.textureLoadCallback();a._onTileLoaded()};h.loader=this.loader;h.index=c+"-"+g+"-"+f;this.tileLoaders.push(h)}}},_checkAndLoadTiles:function(){this.panoView._userControlling||(this._updateTileLoaderSeq(),this._loadMoreTiles())},_updateTileLoaderSeq:function(){var a=
new THREE.Vector3(0,0,-300),b=this.panoView.camera.rotation;null!=b&&a.applyEuler(b);var c=this.panoView._getCurrentSuitableLayer();this.tileLoaders.sort(function(b,e){var f=0>b.level;if(f!=0>e.level)return f?-1:1;f=b.level<=c;if(f!=e.level<=c)return f?-1:1;if(!f&&b.level!=e.level)return b.level-e.level;var f=b.position.distanceTo(a),g=e.position.distanceTo(a);return f-g})},_onTileLoaded:function(){this._checkAndLoadTiles()},_loadMoreTiles:function(){for(var a=this.panoView._getSuitableLayer(this.panoView._fov),
b=0;b<this.tileLoaders.length;b++){var c=this.tileLoaders[b];if(b<this._maxVisibleTileCount){if(0==c.loadState){c.load();break}}else(b>this._maxCacheTileCount-1||c.level>a)&&c.dispose()}},_loadThumbImage:function(a){var b=this.urlProvider(this.panoId,-1,0,0);u(b,a,a)},setPanoId:function(a,b){this.panoId=a;var c=this;this._loadThumbImage(function(d){if(a!=c.panoId)b.call(c);else{c.panoView.dispose();c.panoView.cleanScene();c.rootObject=new THREE.Object3D;b.call(c);c._createTileLoaders();for(var e=
0;6>e;e++)c.tileLoaders[e].setImageWithoutCallback(d);c.panoView.requestDraw();c._onTileLoaded();c._onTileLoaded();c._onTileLoaded();c.startCheck()}})},notifyUserControllEnd:function(){this._checkAndLoadTiles()},dispose:function(){for(var a in this.tileLoaders)this.tileLoaders[a].dispose();this.tileLoaders.length=0;this.stopCheck()}});l.extend("com.vizengine.animation.PanoViewFadeAnimation",{animateFrame:function(a,b){a.snapDiv.style.opacity=1-b}});var z=com.vizengine.animation.PanoViewFadeAnimation;
l.extend("com.vizengine.animation.PanoViewAlphaAnimation",{animateFrame:function(a,b){a.snapDiv.style.opacity=1-b;$(a.snapDiv).css("filter","blur("+5*(1-b)+"px)")}});k.extend("com.vizengine.view.PanoViewInternal",{init:function(a){k.prototype.init.apply(this,arguments);this.scene=new THREE.Scene;this.panoId="";this.drag=this.hd=!1;this.onFovChangeCallback=this.onPitchChangeCallback=this.onHeadingChangeCallback=this.onUserTouchBeginCallback=this.onScaleCallBack=null;this._headingNorthDelta=0;this._dirty=
!1;this._fov=this._defaultFov=com.vizengine.core.Platform.mobile?100:80;this._currentTrans=this._defaultTrans=330;this._deviceOrientationCallback=null;this._trackingDeviceHeading=this._trackingBaseDeviceHeading=this._trackingBaseCameraHeading=0;this._autoPlaying=!1;this._autoPlayLoopTime=14E4;this._needUpdateAnnotations=!0;this._userControlling=!1;this.onMarkerDragCallback=null;this.panoGestureDetectors=[];this.patches=[];var b=this,c=!1,d=new v,e=null;d.callback=function(a,d,h){if(b.drag)if(0==h.state){b.startAnimation(null);
b.initPitch=b._getPitch();b.initHeading=b._getHeading();b._userControllBegin();c=!1;for(d=0;d<b.panoView.leftEye.subViews.length-1;d++){a=b.panoView.leftEye.subViews[d];var k=null==a.dragEnable||a.dragEnable,l=h,q=a.translateX+a.frame.x,m=a.translateY+a.frame.y,A=q+a.frame.width,p=m+a.frame.height,n=l.getX(),l=l.getY();if(n>q&&n<A&&l>m&&l<p&&a.visible&&k){c=!0;e=a;if(null!=b.onMarkerDragCallback)b.onMarkerDragCallback(e,0);break}}null!=e&&(b.deltaDragX=h.getX()-(e.translateX+e.frame.x),b.deltaDragY=
h.getY()-(e.translateY+e.frame.y))}else if(c){if(null!=e&&(k=h.getX()-b.deltaDragX+e.anchorX*e.frame.width,a=h.getY()-b.deltaDragY+e.anchorY*e.frame.height,d=b.frame.height/2/Math.tan(b._fov/180*Math.PI/2),k-=b.frame.width/2,q=a-b.frame.height/2,a=b.getHeading()+180*Math.atan(k/d)/Math.PI,d=b.getPitch()+180*Math.atan(q/d)/Math.PI,e.panoHeading=a,e.panoPitch=d,b.panoView._updateAnnotations()),2==h.state&&null!=b.onMarkerDragCallback)b.onMarkerDragCallback(e,1)}else a=b.initHeading+a/b._currentTrans,
d=b.initPitch+d/b._currentTrans,b._setHeading(a),b._setPitch(d);else 0==h.state?(b.startAnimation(null),b.initPitch=b._getPitch(),b.initHeading=b._getHeading(),b._userControllBegin()):(a=b.initHeading+a/b._currentTrans,d=b.initPitch+d/b._currentTrans,b._setHeading(a),b._setPitch(d));b.requestDraw();return!0};this.panoGestureDetectors.push(d);d=new w;d.callback=function(a,d){c||b._fly(a,d)};d.cancelCallback=function(){b._userControllEnd(!0)};this.panoGestureDetectors.push(d);d=new x;d.callback=function(a,
c){if(c)b.initFov=b._getFov();else if(b._scaleCamera(b.initFov/a),null!=b.onScaleCallBack)b.onScaleCallBack()};this.panoGestureDetectors.push(d);this.setVREnable(!1)},setMarkerDragEnable:function(a){this.drag=k.parseBoolean(a)},isMarkerDragEnabled:function(){return this.drag},setMarkerDragCallback:function(a){this.onMarkerDragCallback=a},setHDEnable:function(a){this.hd=k.parseBoolean(a)},setOnScaleCallback:function(a){this.onScaleCallBack=a},setOnFovChangeCallback:function(a){this.onFovChangeCallback=
a},isHDEnabled:function(){return this.hd},_checkIfTryWebgl:function(){return!0},_webglAvailable:function(){try{if(!this._checkIfTryWebgl())return!1;var a=document.createElement("canvas");return!(!window.WebGLRenderingContext||!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}},_createRender:function(){this._webglAvailable()?(this.leftRenderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0}),this.rightRenderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0}),this._renderType=
0):(this.leftRenderer=new THREE.CSS3DRenderer,this.rightRenderer=new THREE.CSS3DRenderer,this._renderType=1)},_createPanoModel:function(){this.pano=new BoxPano(this);var a=this;this.textureLoadCallback=function(){a.requestDraw()};this.pano.textureLoadCallback=this.textureLoadCallback},_createNativeView:function(){var a=k.prototype._createNativeView.apply(this,arguments);this._createPanoModel();var b=document.createElement("div");b.style.position="absolute";var c=new THREE.PerspectiveCamera(90,window.innerWidth/
window.innerHeight,1,1E3);c.position.x=0;c.position.y=0;c.position.z=0;c.rotation.order="ZXY";c.rotation.x=Math.PI/2;c.rotation.y=0;c.rotation.z=0;this._createRender();var d=this.leftRenderer,e=this.rightRenderer;null!=d.setPixelRatio&&d.setPixelRatio(window.devicePixelRatio);null!=e.setPixelRatio&&e.setPixelRatio(window.devicePixelRatio);d.setClearColor(16777215,1);e.setClearColor(16777215,1);this.loader=new THREE.TextureLoader;this.loader.crossOrigin="*";this.scene=null;this.camera=c;this.leftContainer=
document.createElement("div");this.leftContainer.style.position="absolute";this.rightContainer=document.createElement("div");this.rightContainer.style.position="absolute";this.snapDiv=document.createElement("div");this.snapDiv.id="snapshot";this.snapDiv.style.position="absolute";this.snapDiv.style.display="none";this.leftContainer.appendChild(this.leftRenderer.domElement);this.rightContainer.appendChild(this.rightRenderer.domElement);b.appendChild(this.leftContainer);b.appendChild(this.rightContainer);
b.appendChild(this.snapDiv);b.style.overflow="hidden";a.div=b;a.oldAddNativeView=a.addNativeView;a.addNativeView=function(a,b){this.oldAddNativeView(a,b+3)};a.oldRemoveNativeViewAt=a.removeNativeViewAt;a.removeNativeViewAt=function(a){this.oldRemoveNativeViewAt(a+3)};return a},_getFov:function(){return this._fov},_setFov:function(a){this._fov=a;this._setFovForCamera(this.camera,a);if(null!=this.onFovChangeCallback)this.onFovChangeCallback(this.getFov());this.requestDraw()},_setFovForCamera:function(a,
b){a.fov=b;a.updateProjectionMatrix()},setFov:function(a){var b=this._getDefaultFov()/a;this._currentTrans=this._defaultTrans*b;this._setFov(a)},getFov:function(){return this._getFov()},_getDefaultFov:function(){return this._defaultFov},log2:function(a){return Math.log(a)/Math.log(2)},_getSuitableFov:function(a){a/=1.5;0>a&&(a=0);var b=this._getDefaultFov()/360*Math.PI;return 720*Math.atan(Math.tan(b/2)/Math.pow(2,a))/Math.PI},_getSuitableLayer:function(a){var b=this._getDefaultFov()/360*Math.PI;
a=this.log2(Math.tan(b/2)/Math.tan(a/360*Math.PI/2));return 1.5*a},_getCurrentSuitableLayer:function(a){null==a&&(a=this._getFov());a=this._getSuitableLayer(a);a=Math.floor(a);0>a&&(a=0);a>this.pano._tileLayerCount-1&&(a=this.pano._tileLayerCount-1);return a},setZoom:function(a){a=this._getSuitableFov(a);this._setFov(a)},getZoom:function(){return this._getSuitableLayer(this._fov)},_scaleCamera:function(a){var b=this._getDefaultFov();a>b&&(a=b);var c=this._getSuitableFov(this.pano._tileLayerCount-
.5);a<c&&(a=c);this._currentTrans=b/a*this._defaultTrans;this._setFov(a)},_fly:function(a,b){var c=this,d=Math.abs(a)/.002,e=-(.001*d*d*(0<a?1:-1))/this._currentTrans,f=Math.abs(b)/.002,g=.001*f*f*(0<b?1:-1)/this._currentTrans,h=new n(2),d=d>f?d:f,f=this._getPitch(),g=f+g;g>Math.PI?g=Math.PI:0>g&&(g=0);var k=new r;k.fromHeading=this._getHeading();k.toHeading=k.fromHeading-e;k.fromPitch=f;k.toPitch=g;k.duration=d;k.callback=function(){c._userControllEnd(!0)};k.timeInterplator=h;this.startAnimation(k)},
_userControllBegin:function(){this._userControlling=!0;if(null!=this.onUserTouchBeginCallback)this.onUserTouchBeginCallback()},_userControllEnd:function(a){this._userControlling=!1;this._trackingBaseCameraHeading=this._getHeading();this._trackingBaseDeviceHeading=this._trackingDeviceHeading;this._autoPlaying&&a&&this.delayAutoplay(1);if(null!=this._deviceOrientationCallback){a=new n(2);var b=new r;b.enableHeading=!1;b.enableRoll=!0;b.timeInterplator=a;b.duration=800;b.fromPitch=this._getPitch();b.toPitch=
null!=this._trackingDevicePitch?this._trackingDevicePitch:b.fromPitch;b.fromRoll=this._getRoll();b.toRoll=null!=this._trackingDeviceRoll?this._trackingDeviceRoll:b.fromRoll;b.pulling=!0;this.startAnimation(b)}null!=this.pano&&this.pano.notifyUserControllEnd()},dispatchLayout:function(){k.prototype.dispatchLayout.apply(this,arguments);var a=this._getDefaultFov();this._fov>a&&(this._fov=a);this._setFov(this._fov);this.camera.near=1;this.camera.far=4E4;if(this.enableVR){this.camera.aspect=.5*this.frame.width/
this.frame.height;var a=this.frame.width/2,b=this.frame.height;this.leftContainer.style.width=a+"px";this.leftContainer.style.height=b+"px";this.rightContainer.style.left=a+"px";this.rightContainer.style.width=a+"px";this.rightContainer.style.height=b+"px";this.leftRenderer.setSize(this.frame.width/2,this.frame.height);this.rightRenderer.setSize(this.frame.width/2,this.frame.height);null!=this.leftRenderer.setViewport&&this.leftRenderer.setViewport(0,0,this.frame.width/2,this.frame.height);null!=
this.rightRenderer.setViewport&&this.rightRenderer.setViewport(0,0,this.frame.width/2,this.frame.height)}else this.camera.aspect=this.frame.width/this.frame.height,a=this.frame.width,b=this.frame.height,this.leftContainer.style.width=a+"px",this.leftContainer.style.height=b+"px",this.leftRenderer.setSize(this.frame.width,this.frame.height),null!=this.leftRenderer.setViewport&&this.leftRenderer.setViewport(0,0,this.frame.width,this.frame.height);this.camera.updateProjectionMatrix();this.onDraw()},
cloneCanvas:function(a){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return b},_snapshot:function(){if(0==this._renderType){var a=this.cloneCanvas(this.leftRenderer.domElement);this.snapDiv.style.width=this.frame.width+"px";this.snapDiv.style.height=this.frame.height+"px";var b=this.snapDiv.childNodes.length-1}else a=this._nativeView.div.childNodes[0].cloneNode(!0),this.snapDiv.style.width=this.frame.width+"px",this.snapDiv.style.height=
this.frame.height+"px",b=this.snapDiv.childNodes.length-1;for(;0<=b;b--)this.snapDiv.removeChild(this.snapDiv.childNodes[b]);this.snapDiv.appendChild(a);a.style.width=this.frame.width+"px";a.style.height=this.frame.height+"px";return a},getSnapshotDiv:function(){return this.snapDiv},onDraw:function(){null!=this.scene&&(this._dirty=!1,this.enableVR?(this.leftRenderer.render(this.scene,this.camera),this.rightRenderer.render(this.scene,this.camera)):this.leftRenderer.render(this.scene,this.camera))},
removePatch:function(a){a=this.patches.indexOf(a);0<=a&&null!=this.patches[a].mesh&&this.scene.remove(this.patches[a].mesh);this.patches.splice(a,1)},_updatePatches:function(){for(var a=0;a<this.patches.length;a++)this._updatePatch(this.patches[a])},_updatePatch:function(a){if(null!=a.mesh){var b=new THREE.Euler(Math.PI*(90-a.pitch)/180,0,(a.heading+this._headingNorthDelta)/180*-1*Math.PI,"ZXY"),c=new THREE.Vector3(0,0,-100);c.applyEuler(b);a.mesh.position.copy(c);a.mesh.rotation.copy(b)}},addPatch:function(a,
b,c,d,e){a=k.resolvePath(this.getContextPath(),a);var f={imageUrl:a,heading:b,pitch:c,width:d,height:e,mesh:null};this.patches.push(f);"http"!=a.substring(0,4)&&"//"!=a.substring(0,2)&&"data:"!=a.substring(0,5)&&(a=window.__app__baseurl+a);var g=this;b=new THREE.TextureLoader;b.crossOrigin="*";b.load(a,function(a){var b=a.image;if(!(0>g.patches.indexOf(f))){if(0==g._renderType){a=new THREE.Texture;a.image=b;a.needsUpdate=!0;a=new THREE.MeshBasicMaterial({map:a});a.transparent=!0;var c=200*Math.tan(f.width*
Math.PI/360),d=200*Math.tan(f.height*Math.PI/360),e=new THREE.PlaneGeometry(c,d,1);a=new THREE.Mesh(e,a)}else c=200*Math.tan(f.width*Math.PI/360),d=200*Math.tan(f.height*Math.PI/360),a=new THREE.CSS3DObject(function(){var a=b.cloneNode(!0);a.width=c;a.height=d;a.style.width=c+"px";a.style.height=d+"px";return a});f.mesh=a;g._updatePatch(f);g.scene.add(a)}},function(a){console.log(a.loaded/a.total*100+"% loaded")},function(a){console.log("An error happened")});return f},isVREnabled:function(){return this.enableVR},
setVREnable:function(a){a?(this.trackingDevice(),this.enableVR=!0,this.leftContainer.style.display="block",this.rightContainer.style.display="block"):(this.stopTrackingDevice(),this.enableVR=!1,this.leftContainer.style.display="block",this.rightContainer.style.display="none");this.requestLayout()},_loadMeta:function(a){var b=this.pano.urlProvider(this.panoId,-2);if(null==b)a();else{var c=this;c._headingNorthDelta=0;b=(window.__pano__proxy||window.__vizengine__proxy||"")+b;loadResource(b,function(b){b=
nativeParseXMLToJson(b);b=JSON.parse(b);var e=b.children[0].attributes.dir;null!=e&&(c._headingNorthDelta=parseFloat(e));e=b.children[0].attributes.mcln;b=b.children[0].attributes.mclevel0.split("*")[0];c.pano._mcRow=parseInt(b);c.pano._tileLayerCount=parseInt(e);c.applyLimitFov();c._updatePatches();a&&a()})}},applyLimitFov:function(){var a=this._getSuitableFov(this.pano._tileLayerCount-1);this._fov<a?this._scaleCamera(a):this._scaleCamera(this._fov)},isPatch:function(a){for(var b=0;b<this.patches.length;b++)if(a==
this.patches[b].mesh)return!0;return!1},cleanScene:function(){for(var a=0;a<this.scene.children.length;a++){var b=this.scene.children[this.scene.children.length-a-1];this.isPatch(b)||this.scene.remove(b)}},_isDisablePanoAnimation:function(){return 0<=navigator.userAgent.indexOf("HUAWEI NXT-UL00 BUILD")?!0:!1},setPanoId:function(a,b,c){if(a==this.panoId)b&&b.call(this);else{null==c||1==c?(c=new z,c.duration=600):c=null;this._isDisablePanoAnimation()&&(c=null);this.enableVR&&(c=null);this.startAnimation(null);
var d=this;null!=c&&(d._snapshot(),d.snapDiv.style.display="block",d.snapDiv.style.opacity=1);this.panoId=a;this.dispose();com.vizengine.core.StringUtil.isEmpty(this.panoId)?b&&b.call(this):this._loadMeta(function(){a==d.panoId&&d.pano.setPanoId(a,function(){null!=d.pano.rootObject&&(d.pano.rootObject.add(d.camera),d.scene.add(d.pano.rootObject),null!=c?(c.callback=function(){d.startAnimation(null);d.snapDiv.style.display="none";d._userControllEnd(!0)},d.startAnimation(c)):(d.snapDiv.style.display=
"none",d._userControllEnd(!1)),null!=b&&b.call(d))})})}},getPanoId:function(){return this.panoId},dispose:function(){this.pano.dispose()},setAutoplayLoopTime:function(a){this._autoPlayLoopTime=a},setAutoplayEnable:function(a){a?this.autoPlay():this.stopAutoPlay()},isAutoplayEnabled:function(){return this._autoPlaying},autoPlay:function(){if(!this.isGravityEnabled()&&(this._autoPlaying=!0,null==this.animation)){var a=new r;a.fps=24;a.fromHeading=this._getHeading();a.toHeading=this._getHeading()-2*
Math.PI;a.enablePitch=!1;a.duration=this._autoPlayLoopTime*Math.pow(2,this._getSuitableLayer(this._fov));a.repeatCount=0;this.startAnimation(a)}},stopAutoPlay:function(){this._autoPlaying=!1;this.startAnimation(null)},setGravityEnable:function(a){a?this.trackingDevice():this.stopTrackingDevice()},isGravityEnabled:function(){return this.isTrackingDevice()},isTrackingDevice:function(){return null!=this._deviceOrientationCallback},trackingDevice:function(){var a=this;this.startAnimation(null);this.setAutoplayEnable(!1);
null==this._deviceOrientationCallback&&(this._deviceOrientationCallback=function(b){var c=b.gamma/180*Math.PI,d=b.beta/180*Math.PI;b=b.alpha/180*Math.PI;if(90==window.orientation){var e=new THREE.Euler;e.set(d,c,b,"ZXY");e.reorder("ZYX");b=e.z-Math.PI/2;d=-e.y;c=e.x}else-90==window.orientation&&(e=new THREE.Euler,e.set(d,c,b,"ZXY"),e.reorder("ZYX"),b=e.z+Math.PI/2,d=e.y,c=-e.x);a._trackingDeviceHeading=b;a._trackingDevicePitch=d;a._trackingDeviceRoll=c;a._autoPlaying||a._userControlling||(b=a._trackingBaseCameraHeading+
(a._trackingDeviceHeading-a._trackingBaseDeviceHeading),a._setHeading(b),null!=a.animation&&a.animation.pulling?a.animation.toPitch=d:(a._setPitch(d),a._setRoll(c)))},window.addEventListener("deviceorientation",this._deviceOrientationCallback));a._userControllEnd(!1)},stopTrackingDevice:function(){null!=this._deviceOrientationCallback&&(window.removeEventListener("deviceorientation",this._deviceOrientationCallback),this._deviceOrientationCallback=null,this.setRoll(0));this._userControllEnd(!1)},setHeading:function(a){a=
parseFloat(a);a=(a+this._headingNorthDelta)/180*-1*Math.PI;this._setHeading(a)},_setHeading:function(a){this.camera.rotation.z=a;this.requestDraw();if(null!=this.onHeadingChangeCallback)this.onHeadingChangeCallback(this.getHeading())},setPitch:function(a){a=parseFloat(a);a=Math.PI*(90-a)/180;this._setPitch(a)},_normalPitch:function(a){a%=2*Math.PI;0>a&&(a+=2*Math.PI);a>1.5*Math.PI?a=0:a>Math.PI&&(a=Math.PI);return a},_setPitch:function(a){null==this._deviceOrientationCallback&&(a=this._normalPitch(a));
this.camera.rotation.x=a;this.requestDraw();if(null!=this.onPitchChangeCallback)this.onPitchChangeCallback(this.getPitch())},delayAutoplay:function(a){this._autoPlaying&&null==this.animation&&this.setAutoplayEnable(!0)},requestDraw:function(){if(!this._dirty){this._dirty=!0;var a=this;setTimeout(function(){a._dirty=!1;a.onDraw()},0)}},setRoll:function(a){a=Math.PI*a/180;this._setRoll(a)},_setRoll:function(a){this.camera.rotation.y=a},getHeading:function(){return-180*this._getHeading()/Math.PI-this._headingNorthDelta},
_getHeading:function(){return this.camera.rotation.z},getPitch:function(){return 90-180*this._getPitch()/Math.PI},_getPitch:function(){return this.camera.rotation.x},getRoll:function(){return 180*this._getRoll()/Math.PI},_getRoll:function(){return this.camera.rotation.y}});k.extend("com.vizengine.view.PanoView",{init:function(){k.prototype.init.apply(this,arguments);var a=this;this.onFovChangeCallback=this.onHeadingChangeCallback=this.onPitchChangeCallback=null;this.panoViewInternal=new com.vizengine.view.PanoViewInternal;
this.panoViewInternal.panoView=this;this.panoViewInternal.onPitchChangeCallback=function(){a.onPitchChangeCallback&&a.onPitchChangeCallback.apply(a,arguments);a._updateAnnotations();a._checkUpdateCursorState()};this.panoViewInternal.onHeadingChangeCallback=function(){a.onHeadingChangeCallback&&a.onHeadingChangeCallback.apply(a,arguments);a._updateAnnotations();a._checkUpdateCursorState()};this.panoViewInternal.onFovChangeCallback=function(){a.onFovChangeCallback&&a.onFovChangeCallback.apply(a,arguments);
a._updateAnnotations();a._checkUpdateCursorState()};k.prototype.addView.call(this,this.panoViewInternal);this.leftEye=new k;this.leftEye.setId("leftEye");this.rightEye=new k;this.rightEye.setId("rightEye");this.leftEye.setClipToBounds(!0);this.leftEye.setGravity("left");this.rightEye.setClipToBounds(!0);this.rightEye.setGravity("right");k.prototype.addView.call(this,this.leftEye);k.prototype.addView.call(this,this.rightEye);this.keyEnable=this.mouseWheelEnable=!0;this._createVRCursor();var b=function(b){if(a.touchable&&
a.mouseWheelEnable){b.preventDefault();var c=window.event||b,f=0;c.ctrlKey?f=-c.deltaY/3:(f=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail)),f*=2);var c=new n(2),g=a.panoViewInternal;g.startAnimation(null);if(0>f){var h=new t;h.fromFov=g._getFov();h.toFov=h.fromFov-f;h.duration=600;h.timeInterplator=c;h.callback=function(){g._scaleCamera(this.toFov);if(null!=a.onScaleCallBack)a.onScaleCallBack()};h.animateFrame(g,0);g.startAnimation(h)}else 0<f&&(h=new t,h.fromFov=g._getFov(),h.toFov=h.fromFov-f,
h.duration=600,h.timeInterplator=c,h.callback=function(){g._scaleCamera(this.toFov);if(null!=a.onScaleCallBack)a.onScaleCallBack()},h.animateFrame(g,0),g.startAnimation(h));b.stopPropagation()}},c=this._nativeView.div;c.addEventListener?(c.addEventListener("mousewheel",b,!1),c.addEventListener("DOMMouseScroll",b,!1)):c.attachEvent("onmousewheel",b);this.setVREnable(!1);this.adaptor={markers:[],getView:function(a){return this.markers[a]},getCount:function(){return this.markers.length}}},dispose:function(){this.panoViewInternal.dispose()},
dispatchTouch:function(a){k.prototype.dispatchTouch.apply(this,arguments);if(this.touchable)for(var b in this.panoViewInternal.panoGestureDetectors)this.panoViewInternal.panoGestureDetectors[b].detect(a);else window.__preventDefault__=!1},setMarkerDragCallback:function(a){this.panoViewInternal.setMarkerDragCallback(a)},dispatchKey:function(a){this.keyEnable&&(0==a.state?37==a.keyCode?(this.delayAutoplay(1),a=new com.vizengine.animation.Animation,a.duration=8E3,a.repeatCount=0,a.fromHeading=this.getHeading(),
a.toHeading=a.fromHeading-360,a.animateFrame=function(a,c){a.setHeading(this.fromHeading+(this.toHeading-this.fromHeading)*c)},this.panoViewInternal.startAnimation(a)):39==a.keyCode?(this.delayAutoplay(1),a=new com.vizengine.animation.Animation,a.duration=8E3,a.repeatCount=0,a.fromHeading=this.getHeading(),a.toHeading=a.fromHeading+360,a.animateFrame=function(a,c){a.setHeading(this.fromHeading+(this.toHeading-this.fromHeading)*c)},this.panoViewInternal.startAnimation(a)):38==a.keyCode?(this.delayAutoplay(1),
a=new com.vizengine.animation.Animation,a.duration=8E3*((this.getPitch()+90)/360),a.repeatCount=1,a.fromPitch=this.getPitch(),a.toPitch=-90,a.animateFrame=function(a,c){a.setPitch(this.fromPitch+(this.toPitch-this.fromPitch)*c)},this.panoViewInternal.startAnimation(a)):40==a.keyCode&&(this.delayAutoplay(1),a=new com.vizengine.animation.Animation,a.duration=8E3*((90-this.getPitch())/360),a.repeatCount=1,a.fromPitch=this.getPitch(),a.toPitch=90,a.animateFrame=function(a,c){a.setPitch(this.fromPitch+
(this.toPitch-this.fromPitch)*c)},this.panoViewInternal.startAnimation(a)):(this.panoViewInternal.startAnimation(null),this.delayAutoplay(1)))},delayAutoplay:function(a){this.panoViewInternal.delayAutoplay(a)},_createVRCursor:function(){var a={width:"27dp",height:"27dp",clipToBounds:"true",gravity:"center",children:[{id:"cursorImg",type:"ImageView",width:"wrap",height:"fill",src:"data:image/png;base64,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"}]};
this.leftCursor=k.parse(a);this.leftEye.addView(this.leftCursor);this.rightCursor=k.parse(a);this.rightEye.addView(this.rightCursor)},_setCursorProgress:function(a){0>a?(this.leftCursor.$("cursorImg").setTranslateX(0),this.rightCursor.$("cursorImg").setTranslateX(0)):(a=-27*(Math.floor(15*a)+1),this.leftCursor.$("cursorImg").setTranslateX(a),this.rightCursor.$("cursorImg").setTranslateX(a))},_startCursorSelect:function(){if(!this.cursorAnimation){var a=this;this.cursorAnimation=new l;this.cursorAnimation.duration=
2E3;this.cursorAnimation.animateFrame=function(b,c){a._setCursorProgress(c);1<=c&&(a.cursorAnimation=null,a.currentCursorMarker&&a.currentCursorMarker.trigerClick())};this.cursorAnimation.callback=function(){a._setCursorProgress(-1);a.cursorAnimation=null};this.cursorAnimation.cancelCallback=function(){a._setCursorProgress(-1);a.cursorAnimation=null};this.leftCursor.startAnimation(this.cursorAnimation)}},_cancelCursorSelect:function(){this.leftCursor.startAnimation(null)},_updateAnnotationsInEye:function(a){for(var b=
0;b<a.subViews.length-1;b++){var c=a.subViews[b];null==c.panoPitch&&(c.panoPitch=0);null==c.panoHeading&&(c.panoHeading=0);var d=new THREE.Euler(Math.PI*(90-c.panoPitch)/180,0,(c.panoHeading+this.panoViewInternal._headingNorthDelta)/180*-1*Math.PI,"ZXY"),e=new THREE.Vector3(0,0,-200);e.applyEuler(d);e.applyMatrix4(this.panoViewInternal.camera.matrixWorldInverse);c.setVisible(0>e.z);var d=c.measureWidth(),f=c.measureHeight();e.applyMatrix4(this.panoViewInternal.camera.projectionMatrix);var g=a.frame.height/
2-e.y*a.frame.height/2;c.setTranslateX(e.x*a.frame.width/2+a.frame.width/2-c.anchorX*d);c.setTranslateY(g-c.anchorY*f);d=new THREE.Vector3(0,0,-1);d.applyMatrix4(this.panoViewInternal.camera.matrixWorldInverse);e=d.x;d=d.y;e=(0>e?-1:1)*Math.round(Math.asin(d/Math.sqrt(e*e+d*d))/Math.PI*180)+90*(0>e?-1:1);isNaN(e)||c.setRotateZ(-e)}},_updateAnnotations:function(){this.vrEnable?(this._updateAnnotationsInEye(this.leftEye),this._updateAnnotationsInEye(this.rightEye)):this._updateAnnotationsInEye(this.leftEye)},
_checkUpdateCursorState:function(){if(this.vrEnable){for(var a=this.leftEye.frame.width/2,b=this.leftEye.frame.height/2,c=0;c<this.leftEye.subViews.length-1;c++){var d=this.leftEye.subViews[c],e=d.translateX,f=e+d.frame.width,g=d.translateY,h=g+d.frame.height;if(a>e&&a<f&&b>g&&b<h&&d.visible)return this._startCursorSelect(),this.currentCursorMarker=d}this._cancelCursorSelect();return null}},_interceptMarker:function(a){},addView:function(a,b){a.setVisible(!1);this._interceptMarker(a);null==b&&(b=
this.adaptor.markers.length);if(b<this.adaptor.markers.length){var c=this.adaptor.markers.slice(0,b),d=this.adaptor.markers.slice(b);c.push(a);this.adaptor.markers=c.concat(d)}else this.adaptor.markers.push(a);this.notifyDataChanged()},clearViews:function(){this.adaptor.markers.length=0;this.notifyDataChanged()},removeViewAt:function(a){this.adaptor.markers.splice(a,1);this.notifyDataChanged()},removeView:function(a){for(var b=-1,c=0;c<this.adaptor.markers.length;c++)if(this.adaptor.markers[c]==a){b=
c;break}0<=b&&this.removeViewAt(b)},addPatch:function(a,b,c,d,e){return this.panoViewInternal.addPatch.apply(this.panoViewInternal,arguments)},removePatch:function(a){this.panoViewInternal.removePatch(a)},setAdaptor:function(a){this.adaptor=a;this.notifyDataChanged()},notifyDataChanged:function(){if(null!=this.adaptor){for(;1<this.leftEye.subViews.length;)this.leftEye.removeViewAt(0);for(;1<this.rightEye.subViews.length;)this.rightEye.removeViewAt(0);for(var a=this.adaptor.getCount()-1;0<=a;a--){var b=
this.adaptor.getView(a);this._interceptMarker(b);this.leftEye.addView(b,0);this.vrEnable&&(b=this.adaptor.getView(a),this._interceptMarker(b),this.rightEye.addView(b,0))}this._updateAnnotations()}},setPanoId:function(a,b){var c=this;this.panoViewInternal.setPanoId(a,function(){b&&b.call(c);c._updateAnnotations()})},getPanoId:function(){return this.panoViewInternal.panoId},setHeading:function(a){this.panoViewInternal.setHeading(a)},setFov:function(a){this.panoViewInternal.setFov(a)},getHeading:function(){return this.panoViewInternal.getHeading()},
setPitch:function(a){this.panoViewInternal.setPitch(a)},getPitch:function(){return this.panoViewInternal.getPitch()},setVREnable:function(a){this.vrEnable=k.parseBoolean(a);this.panoViewInternal.setVREnable(this.vrEnable);this.vrEnable?(this.leftEye.setWidth("match 0.5"),this.rightEye.setWidth("match 0.5"),this.leftCursor.setVisible(!0)):(this.leftEye.setWidth("match 1"),this.rightEye.setWidth("0dp"),this.leftCursor.setVisible(!1));this.notifyDataChanged();this.requestLayout();window.rootView&&window.rootView.resize()},
setAutoplayEnable:function(a){this.autoplayEnable=k.parseBoolean(a);this.panoViewInternal.setAutoplayEnable(this.autoplayEnable)},setMouseWheelEnable:function(a){this.mouseWheelEnable=k.parseBoolean(a)},setKeyEnable:function(a){this.keyEnable=k.parseBoolean(a)},setMarkerDragEnable:function(a){this.panoViewInternal.setMarkerDragEnable(a)}});var m=com.vizengine.view.PanoView;m.getHeadingByLatLon=function(a,b,c,d){a=new LatLon(a,b);c=new LatLon(c,d);return a.bearingTo(c)};m.getPitchByLatLon=function(a,
b,c,d){a=new LatLon(a,b);c=new LatLon(c,d);c=a.distanceTo(c);return Math.atan(3/c)};var B=l.extend({init:function(a){l.prototype.init.apply(this,arguments);this.fromAngle=3*-Math.PI/4;this.toAngle=0;this.fromX=a.earthCamera.position.x;this.fromY=a.earthCamera.position.y;this.fromZ=a.earthCamera.position.z;this.toX=a.scene.position.x;this.toY=a.scene.position.y;this.toZ=a.scene.position.z;this.lkFromX=0;this.lkFromY=1E4;this.lkToX=this.lkFromZ=0;this.lkToY=2E4;this.lkToZ=0;this.repeatCount=1;this.duration=
6E3;this.timeInterplator=new n(2)},animateFrame:function(a,b){a.setCameraInfo(this.fromAngle+(this.toAngle-this.fromAngle)*b,this.fromX+(this.toX-this.fromX)*b,this.fromY+(this.toY-this.fromY)*b,this.fromZ+(this.toZ-this.fromZ)*b,this.lkFromX+(this.lkToX-this.lkFromX)*b,this.lkFromY+(this.lkToY-this.lkFromY)*b,this.lkFromZ+(this.lkToZ-this.lkFromZ)*b);a._nativeView.div.style.webkitFilter="blur("+(.94>b?0:1<b?0:.998>b?(b-.94)/(.998-.94)*10:10*(1-b)/(1-.998))+"px)"}});m.extend("com.vizengine.view.EarthPanoView",
{init:function(){m.prototype.init.apply(this,arguments);var a=new THREE.PerspectiveCamera(90,window.innerWidth/window.innerHeight,1,1E3);a.position.x=0;a.position.y=0;a.position.z=3E4;a.rotation.order="ZXY";a.rotation.x=0;a.rotation.y=0;a.rotation.z=0;this.earthCamera=a;this.earthScene=new THREE.Scene;a=new THREE.Matrix4;a.makeRotationY(200/180*Math.PI);var b=new THREE.Matrix4;b.makeRotationX(-23/180*Math.PI);a.multiplyMatrices(a,b);b=new THREE.Vector3(0,0,20200);b.applyMatrix4(a);var c=new THREE.Euler;
c.setFromRotationMatrix(a,"ZXY");this.scene.position.x=b.x;this.scene.position.y=b.y;this.scene.position.z=b.z;this.scene.rotation.x=c.x;this.scene.rotation.y=c.y;this.scene.rotation.z=c.z;this.earthCamera.position.x=5*b.x;this.earthCamera.position.y=5*b.y;this.earthCamera.position.z=5*b.z;this.earthScene.add(this.scene);this.createEarth();this.animation=new B(this)},setCameraInfo:function(a,b,c,d,e,f,g){var h=new THREE.Matrix4;h.makeRotationY(a);a=new THREE.Vector3(b,c,d);a.applyMatrix4(h);this.earthCamera.position.x=
a.x;this.earthCamera.position.y=a.y;this.earthCamera.position.z=a.z;this.earthCamera.lookAt(new THREE.Vector3(e,f,g))},createEarth:function(){var a=this;(new THREE.TextureLoader).load("earth.jpg",function(b){var c=new THREE.SphereGeometry(2E4,20,20);b=new THREE.MeshBasicMaterial({map:b,overdraw:.5});c=new THREE.Mesh(c,b);a.earthScene.add(c)})},dispatchLayout:function(){m.prototype.dispatchLayout.apply(this,arguments);this.earthCamera.aspect=this.frame.width/this.frame.height;this._setFovForCamera(this.earthCamera,
this._fov);this.earthCamera.near=1;this.earthCamera.far=4E5;this.earthCamera.updateProjectionMatrix()},onDraw:function(){m.prototype.init.apply(this,arguments);this.renderer.render(this.earthScene,this.earthCamera)}})}});
