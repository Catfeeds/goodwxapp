module("/libs/vizengine_engine3d.js",function(){var e=com.vizengine.engine3d.Render,f=com.vizengine.engine3d.Plane;e.extend("com.vizengine.engine3d.RenderCSS3D",{init:function(a){e.prototype.init.apply(this,arguments);this.view=a;this.renderCount=0;this.contextArray=[]},render:function(a,d){if(0!=this.view.frame.width&&0!=this.view.frame.height){this.world=a;this.camera=d;var c=new com.vizengine.math.Matrix4;c.translate(this.view.frame.width/2,this.view.frame.height/2,0);c.scale(1,-1,1);c.scale(this.view.frame.width/
2,this.view.frame.height/2,1);c.multiply(d.projectionMatrix);var b=d.getWorldMatrix().getInverse();c.multiply(b);this._renderObject3D(a,c);this.releaseResource();this.renderCount++}},releaseResource:function(){for(var a=this.contextArray.length-1;0<=a;a--){var d=this.contextArray[a];d.renderCount!=this.renderCount&&(this.releaseContext(d),this.contextArray.splice(a,1))}},releaseContext:function(a){null!=a.div&&(this.view._nativeView.div.removeChild(a.div),a.div=null)},_renderObject3D:function(a,d){a instanceof
f&&this._renderPlane(a,d);for(var c=0;c<a.children.length;c++){var b=a.children[c],e=d.clone();e.multiply(b.matrix);this._renderObject3D(b,e)}},_renderPlane:function(a,d){if(null!=a.width&&null!=a.height&&null!=a.texture.image){var c=this._getOrCreateContext(a);null==c.div&&(c.div=a.texture.image.cloneNode(),c.div.style.position="absolute",c.div.style.transformOrigin="0px 0px 0px",this.view._nativeView.div.appendChild(c.div));c.div.style.width=a.texture.image.width+"px";c.div.style.height=a.texture.image.height+
"px";var b=a.width/a.texture.image.width;d.scale(b,-b,1);d.translate(-a.texture.image.width/2,-a.texture.image.height/2,0);b=d.elements;b="matrix3d("+b[0].toFixed(6)+","+b[1].toFixed(6)+","+b[2].toFixed(6)+","+b[3].toFixed(6)+","+b[4].toFixed(6)+","+b[5].toFixed(6)+","+b[6].toFixed(6)+","+b[7].toFixed(6)+","+b[8].toFixed(6)+","+b[9].toFixed(6)+","+b[10].toFixed(6)+","+b[11].toFixed(6)+","+b[12].toFixed(6)+","+b[13].toFixed(6)+","+b[14].toFixed(6)+","+b[15].toFixed(6)+")";c.div.style.webkitTransform=
b;c.div.style.WebkitTransform=b;c.div.style.MozTransform=b;c.div.style.oTransform=b;c.div.style.transform=b}},_getOrCreateContext:function(a){null==a.css3DContext&&(a.css3DContext={});if(null==a.css3DContext[this.id]){var d={};a.css3DContext[this.id]=d;this.contextArray.push(d)}a.css3DContext[this.id].renderCount=this.renderCount;return a.css3DContext[this.id]}})});
