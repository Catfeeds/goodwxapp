<bundle>
	<res path="./libs/vizengine.js"><![CDATA[(function(){function k(){}"undefined"==typeof com&&(com={});"undefined"==typeof com.vizengine&&(com.vizengine={});"undefined"==typeof com.appengine&&(com.appengine=com.vizengine);var g=function(a,c){return null==a||null==c||a.length<c.length?!1:a.substring(a.length-c.length,a.length)==c},h=com.vizengine.mergeObject=function(){for(var a={},c=0;c<arguments.length;c++){var b=arguments[c];if(null!=b)if(b instanceof Array)for(c=0;c<b.length;c++){var d=b[c],e;for(e in d)a[e]=d[e]}else for(e in b)a[e]=b[e]}return a};
com.vizengine.Module=function(a){this.path=a;this.packageObject=this.script=null;this.loadState=0;this.loadRequests=[];this.templateScripts=[];this.templateDatas=[]};var f=com.vizengine.Module;f.prototype.isLoaded=function(){return 2<=this.loadState};f.prototype.isProcessed=function(){return 3==this.loadState};f.currentTemplateContextPath=null;f.prototype.isScript=function(){return g(this.path,".js")};f.prototype.isViewTemplate=function(){return f.isViewTemplate(this.path)};f.isViewTemplate=function(a){return g(a,
".jpl")||g(a,".xml")};f.prototype.isXMLTemplate=function(){return g(this.path,".xml")};f.prototype.isTextTemplate=function(){return g(this.path,".txt")};f.prototype.isJson=function(){return g(this.path,".json")};var p=function(a){for(;;){var c=a.indexOf("/./");if(0>c)break;a=a.replace(/\/\.\//g,"/")}for(;;){c=a.indexOf("/../");if(0>c)break;var b=a.substring(0,c),d=b.lastIndexOf("/"),e="";0<=d&&(e=b.substring(0,d+1));a=e+a.substring(c+4)}return a};f.prototype.processScriptContent=function(a){var c=
this,b=evaluateScript(this.script,p(this.path)),d=function(){null!=b&&(c.packageObject=b.packageObject);c.loadState=3;a()};null==b||b.ready||null==b.__bridge__flag__?d():b.callback=d};f.prototype.processTextContent=function(a){this.packageObject=this.script;this.loadState=3;a()};f.prototype.applyTemplateScripts=function(a){for(var c=0;c<this.templateScripts.length;c++)(0,this.templateScripts[c])(a)};f.prototype.processTextTemplate=function(a){var c=this;this.render=template.compile(this.script,{filename:this.path});
this.packageObject=function(){f.currentTemplateContextPath=c.path;for(var a=[],b=0;b<c.templateDatas.length;b++)a.push(c.templateDatas[b]);for(b=0;b<arguments.length;b++)a.push(arguments[b]);return c.render(h.apply(null,a))};for(var b=[],d=this.script,e=/(?:{{\s*include\s+)(?:'|")([\w$0-9_\/\.]+)(?:'|")/;null!=(res=d.match(e));)b.push(com.vizengine.view.View.resolvePath(this.path,res[1])),d=d.substring(res.index+res[0].length);var l=function(){for(var d=0;d<b.length;d++)if(!com.vizengine.moduleManager.isModuleProcessed(b[d]))return;
for(d=0;d<b.length;d++){var e=com.vizengine.moduleManager[b[d]];e.isJson()&&c.templateDatas.push(e.packageObject)}c.loadState=3;a()};if(0==b.length)l();else for(d=0;d<b.length;d++)com.vizengine.moduleManager.loadModule(b[d],function(){l()})};f.prototype.processViewTemplateContent=function(a){var c=this;this.render=template.compile(this.script,{filename:this.path});this.packageObject=function(){f.currentTemplateContextPath=c.path;for(var a=[],b=0;b<c.templateDatas.length;b++)a.push(c.templateDatas[b]);
for(b=0;b<arguments.length;b++)a.push(arguments[b]);a=h.apply(null,a);b=c.render(a);c.isXMLTemplate()&&(b=nativeParseXMLToJson(b));a=com.vizengine.view.View.parse(b,{contextPath:c.path},a,c.path);c.applyTemplateScripts(a);return a};for(var b=[],d=this.script,e=null,e=this.isXMLTemplate()?/\<\s*include\s+(?:(?!src[=\s])[\w]+\s*=\s*\"[0-9\w\s\.\$\/\:'\#\{\}:,]*\"\s+)*src\s*=\s*\"([0-9\w\s\.\$\/\:'\{\}:,]*)\"/:/(?:{{\s*include\s+)(?:'|")([\w$0-9_\/\.]+)(?:'|")/;null!=(res=d.match(e));)b.push(com.vizengine.view.View.resolvePath(this.path,
res[1])),d=d.substring(res.index+res[0].length);var l=function(){for(var d=0;d<b.length;d++){var e=com.vizengine.moduleManager[b[d]];e.isScript()&&e.packageObject instanceof Function&&c.templateScripts.push(e.packageObject);e.isJson()&&c.templateDatas.push(e.packageObject)}c.loadState=3;a()};if(0==b.length)l();else{var m=0,g=function(){m<b.length?com.vizengine.moduleManager.loadModule(b[m],function(){m++;g()}):l()};g()}};f.prototype.processJsonContent=function(a){this.packageObject=JSON.parse(this.script);
this.loadState=3;a()};f.prototype.processModelContent=function(a){var c=this,b=function(){for(var b=0;b<c.loadRequests.length;b++)c.loadRequests[b].callback();c.loadRequests.length=0;a()};com.vizengine.moduleManager.contextPath=this.path;this.isScript()?this.processScriptContent(b):this.isViewTemplate()?this.processViewTemplateContent(b):this.isJson()?this.processJsonContent(b):this.processTextContent(b)};f.prototype.load=function(a){if(3==this.loadState)a();else if(0<this.loadState)this.loadRequests.push({callback:a});
else{this.loadState=1;var c=this;loadResource(this.path,function(b){if(c.isJson()||c.isViewTemplate())b=com.vizengine.view.View.deleteComment(b);c.script=b;c.loadState=null==b?4:2;c.processModelContent(a)})}};k.prototype.loadModule=function(a,c){null==this[a]&&(this[a]=new f(a));this[a].load(c)};k.prototype.isModuleProcessed=function(a){return null==this[a]?!1:this[a].isProcessed()};k.prototype.resolveScriptPath=function(a){if(null==this.contextPath||null==a||"/"==a[0]||"http"==a.substring(0,4))return a;
var c=this.contextPath.lastIndexOf("/");return 0<=c?this.contextPath.substring(0,c+1)+a:"/"+a};com.vizengine.moduleManager=new k;window.module=function(){for(var a=[],c=null,b=0;b<arguments.length;b++){var d=arguments[b];if(d instanceof Function)c=d;else if(d instanceof Array)for(var e=0;e<d.length;e++)a.push(d[e]);else a.push(d)}for(b=0;b<a.length;b++)a[b]=com.vizengine.moduleManager.resolveScriptPath(a[b]);var f={__bridge__flag__:!0,ready:!1,callback:null},g=function(){for(var b=0;b<a.length;b++)if(!com.vizengine.moduleManager.isModuleProcessed(a[b]))return!1;
return!0},k=function(){for(var b=[],c=0;c<a.length;c++)b.push(com.vizengine.moduleManager[a[c]].packageObject);return b},h=0,n=function(){h<a.length?com.vizengine.moduleManager.loadModule(a[h],function(){h++;n()}):g()&&(f.ready=!0,f.packageObject=c.apply(null,k()),f.callback&&f.callback(f.packageObject))};n();if(null==a||0==a.length)f.ready=!0,f.packageObject=c();return f};null==window.require&&(window.require=window.module);var q=function(){template.onerror=function(a){for(var c in a);throw new TypeError(a.filename+
" : "+a.message);};template.get=function(a){var c=com.vizengine.view.View.resolvePath(f.currentTemplateContextPath,a),b=com.vizengine.moduleManager[c];return null!=b&&b.isViewTemplate()?function(){for(var a=[],e=0;e<b.templateDatas.length;e++)a.push(b.templateDatas[e]);for(e=0;e<arguments.length;e++)a.push(arguments[e]);a=h.apply(null,a);a=b.render.call(null,a);b.isXMLTemplate()&&(a=nativeParseXMLToJson(a));a=JSON.parse(a);a.__template__path__=c;a.contextPath=c;return a=JSON.stringify(a)}:function(){return""}};
template.defaults.parser=function(a,c){a=a.replace(/^\s/,"");var b=a.split(" "),d=b.shift(),e=b.join(" ");switch(d){case "if":a="if("+e+"){";break;case "else":b="if"===b.shift()?" if("+b.join(" ")+")":"";a="}else"+b+"{";break;case "/if":a="}";break;case "each":d=b[0]||"$data";e=(b[2]||"$value")+","+(b[3]||"$index");"as"!==(b[1]||"as")&&(d="[]");a="$each("+d+",function("+e+"){";break;case "/each":a="});";break;case "echo":a="print("+e+");";break;case "print":case "include":a=d+"("+b.join(",")+");";
break;default:if(/^\s*\|\s*[\w\$]/.test(e)){b=!0;0===a.indexOf("#")&&(a=a.substr(1),b=!1);for(var d=0,e=a.split("|"),f=e.length,g=e[d++];d<f;d++)g=filtered(g,e[d]);a=(b?"=":"=#")+g}else a=template.helpers[d]?"=#"+d+"("+b.join(",")+");":"=("+d+"==null?'"+e+"':"+d+")"}return a}};module(["/libs/vizengine_model3d.js"],function(){q();if(null!=window.onVizEngineLoaded)window.onVizEngineLoaded()})})();
]]></res>
	<res path="./libs/vizengine_animation.js"><![CDATA[module("/libs/vizengine_gesture.js",function(){com.vizengine.animation={};var h=com.vizengine.core.Object;h.extend("com.vizengine.animation.TimeInterceptor",{getInterception:function(a){return a}});var k=com.vizengine.animation.TimeInterceptor;com.vizengine.animation.TimeInterplator=k;k.extend("com.vizengine.animation.DecelerateInterceptor",{init:function(a){k.prototype.init.apply(this,arguments);this.factor=null!=a?a:1},getInterception:function(a){var b=0;return b=1==this.factor?1-(1-a)*(1-a):1-
Math.pow(1-a,2*this.factor)}});com.vizengine.animation.DecelerateInterpolator=com.vizengine.animation.DecelerateInterceptor;h.extend("com.vizengine.animation.Animation",{init:function(){h.prototype.init.apply(this,arguments);this.callback=null;this.delay=this._beginTime=0;this.duration=1E3;this.timeInterplator=this.timeInterceptor=null;this.repeatCount=1;this._repeated=0},animate:function(a){var b=(new Date).getTime(),c=0;0==this._beginTime?this._beginTime=b:(c=b-this._beginTime-this.delay,this._repeated=
Math.floor(c/this.duration),c%=this.duration,c=c<this.duration?c/this.duration:1);if(this.delay>b-this._beginTime)return!0;b=!1;0<this.repeatCount&&this._repeated>=this.repeatCount&&(b=!0);b&&(c=1);var e=c,d=null!=this.timeInterceptor?this.timeInterceptor:this.timeInterplator;null!=d&&(e=d.getInterception(c));1<e&&(e=1);this.animateFrame(a,e);if(b){if(null!=this.callback){var f=this.callback;f.target=this;this.callback=null;f&&setTimeout(function(){f.call(f.target,!1);f=f.target=null})}return!1}return!0},
terminateIfNotFinished:function(){if(null!=this.callback){var a=this.callback;this.callback=null;a.call(this,!0)}},animateFrame:function(a,b){}});var d=com.vizengine.animation.Animation;d.animationViews=[];d.animating=!1;d.animateFrame=function(){for(var a=0,b=(new Date).getTime(),c=d.animationViews.length-1;0<=c;c--){var e=d.animationViews[c];if(null==e.animation)d.animationViews.splice(c,1);else if(e.animation.animate(e)){var g=60;null!=e.animation.fps&&(g=e.animation.fps);g>a&&(a=g)}else e.animation=
null,d.animationViews.splice(c,1)}a=1E3/a;c=0;b=(new Date).getTime()-b;b<a&&(c=a-b);0<d.animationViews.length?setTimeout(d.animateFrame,c):d.animating=!1};d.requestAnimation=function(a){d.animationViews.push(a);d.animating||(d.animating=!0,d.animateFrame())};d.terminateAnimation=function(a){for(var b=0;b<d.animationViews.length;b++){var c=d.animationViews[b];if(c==a){null!=c.animation&&(c.animation.terminateIfNotFinished(),c.animation=null);break}}};d.extend("com.vizengine.animation.AnimationSet",
{init:function(){d.prototype.init.apply(this,arguments);this.animations=[]},addAnimation:function(a){this.animations.push(a);this._updateAnimations()},_updateAnimations:function(){var a=0,b;for(b in this.animations){var c=this.animations[b];if(0==c.repeatCount){this.repeatCount=0;break}c.duration+c.delay>a&&(a=c.duration*c.repeatCount+c.delay)}this.duration=a;for(b in this.animations){var c=this.animations[b],e=c.delay/a;c.startProgress=e;c.endProgress=e+c.duration/a}},animateFrame:function(a,b){for(var c in this.animations)this.animations[c].animate(a);
return!1}});d.extend("com.vizengine.animation.AnimationList",{init:function(){d.prototype.init.apply(this,arguments);this.animations=[]},addAnimation:function(a){this.animations.push(a);this._updateAnimations()},_updateAnimations:function(){var a=0,b;for(b in this.animations)var c=this.animations[b],a=a+c.duration;var e=0;for(b in this.animations)c=this.animations[b],c.startProgress=e/a,c.endProgress=(e+c.duration)/a,e+=c.duration},animateFrame:function(a,b){for(var c in this.animations){var e=this.animations[c];
if(b<=e.endProgress)return c=(b-e.startProgress)/(e.endProgress-e.startProgress),null!=e.timeInterplator&&(c=e.timeInterplator.getInterpolation(c)),e.animateFrame(a,c)}return!1}});d.extend("com.vizengine.animation.TranslateAnimation",{fromTranslateX:null,fromTranslateY:null,toTranslateX:null,toTranslateY:null,animateFrame:function(a,b){null!=this.fromTranslateX&&null!=this.toTranslateX&&a.setTranslateX(this.fromTranslateX+(this.toTranslateX-this.fromTranslateX)*b);null!=this.fromTranslateY&&null!=
this.toTranslateY&&a.setTranslateY(this.fromTranslateY+(this.toTranslateY-this.fromTranslateY)*b)}});d.extend("com.vizengine.animation.RotateAnimation",{fromRotateX:null,toRotateX:null,fromRotateY:null,toRotateY:null,fromRotateZ:null,toRotateZ:null,animateFrame:function(a,b){var c=null,e=null,d=null;null!=this.fromRotateX&&null!=this.toRotateX&&(c=this.fromRotateX+(this.toRotateX-this.fromRotateX)*b);null!=this.fromRotateY&&null!=this.toRotateY&&(e=this.fromRotateY+(this.toRotateY-this.fromRotateY)*
b);null!=this.fromRotateZ&&null!=this.toRotateZ&&(d=this.fromRotateZ+(this.toRotateZ-this.fromRotateZ)*b);null!=c&&a.setRotateX(c);null!=e&&a.setRotateY(e);null!=d&&a.setRotateZ(d)}});d.extend("com.vizengine.animation.ScaleAnimation",{fromScaleX:null,fromScaleY:null,toScaleX:null,toScaleY:null,animateFrame:function(a,b){null!=this.fromScaleX&&null!=this.toScaleX&&a.setScaleX(this.fromScaleX+(this.toScaleX-this.fromScaleX)*b);null!=this.fromScaleY&&null!=this.toScaleY&&a.setScaleY(this.fromScaleY+
(this.toScaleY-this.fromScaleY)*b)}});d.extend("com.vizengine.animation.BezierAnimation",{init:function(){d.prototype.init.apply(this,arguments);this.bezierPoints=[];this.bezierPoints[0]=new UPPoint;this.bezierPoints[1]=new UPPoint;this.bezierPoints[2]=new UPPoint;this.bezierPoints[3]=new UPPoint;this.bezierPoints[0].x=0;this.bezierPoints[0].y=0;this.bezierPoints[1].x=0;this.bezierPoints[1].y=.7;this.bezierPoints[2].x=.3;this.bezierPoints[2].y=1;this.bezierPoints[3].x=1;this.bezierPoints[3].y=1},
setBezierCP1:function(a,b){this.bezierPoints[1].x=a;this.bezierPoints[1].y=b},setBezierCP2:function(a,b){this.bezierPoints[2].x=a;this.bezierPoints[2].y=b},getPointFromBezier:function(a){var b=this.bezierPoints,c,d,g,f,h,l,m,k,n=new UPPoint;g=3*(b[1].x-b[0].x);d=3*(b[2].x-b[1].x)-g;c=b[3].x-b[0].x-g-d;l=3*(b[1].y-b[0].y);h=3*(b[2].y-b[1].y)-l;f=b[3].y-b[0].y-l-h;m=a*a;k=m*a;n.x=c*k+d*m+g*a+b[0].x;n.y=f*k+h*m+l*a+b[0].y;return n},animateFrame:function(a,b){var c=this.getPointFromBezier(b);a.setTranslate(c.x,
c.y,0)}});d.extend("com.vizengine.animation.AlphaAnimation",{fromAlpha:null,toAlpha:null,animateFrame:function(a,b){a.setAlpha(this.fromAlpha+(this.toAlpha-this.fromAlpha)*b)}})});
]]></res>
	<res path="./libs/vizengine_class.js"><![CDATA[module("/libs/vizengine_template.js",function(){var d=!1;this.Class=function(){};var g=function(a){a=a.split(".");for(var c="",b=0;b<a.length-1;b++)c=0==b?a[0]:c+("."+a[b]),"undefined"==eval("typeof "+c)&&eval(c+"={}")};Class.extend=function(a,c){function b(){!d&&this.init&&this.init.apply(this,arguments)}null==c&&(c=a,a=null);null!=a&&g(a);d=!0;var e=new this;d=!1;for(var f in c)e[f]=c[f];b.prototype=e;b.prototype.constructor=b;b.extend=arguments.callee;b.className=a;null!=a&&(window.__temp__obj__=
b,eval(a+"=window.__temp__obj__;"),delete window.__temp__obj__);return b}});
]]></res>
	<res path="./libs/vizengine_core.js"><![CDATA[module("vizengine_class.js",function(){com.vizengine.core={};com.vizengine.core.Platform={chrome:-1<navigator.userAgent.indexOf("Chrome"),trident:-1<navigator.userAgent.indexOf("Trident"),presto:-1<navigator.userAgent.indexOf("Presto"),webKit:-1<navigator.userAgent.indexOf("AppleWebKit"),gecko:-1<navigator.userAgent.indexOf("Gecko")&&-1==navigator.userAgent.indexOf("KHTML"),mobile:!!navigator.userAgent.match(/AppleWebKit.*Mobile.*/),ios:!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),
android:-1<navigator.userAgent.indexOf("Android")||-1<navigator.userAgent.indexOf("Linux"),iPhone:-1<navigator.userAgent.indexOf("iPhone"),iPad:-1<navigator.userAgent.indexOf("iPad"),webApp:-1==navigator.userAgent.indexOf("Safari"),weixin:-1<navigator.userAgent.indexOf("MicroMessenger"),qq:" qq"==navigator.userAgent.match(/\sQQ/i),vizengineiOS:-1<navigator.userAgent.indexOf("vizengine-iOS"),vizengineAndroid:-1<navigator.userAgent.indexOf("vizengine-android"),vizengineMobile:-1<navigator.userAgent.indexOf("vizengine-")};
Class.extend("com.vizengine.core.Object",{init:function(){},interceptMethod:function(a,b){g.interceptMethod(this,a,b)},getClassName:function(){return this.constructor.className},getSimpleClassName:function(){var a=this.constructor.className.lastIndexOf(".");0>a&&(a=-1);return this.constructor.className.substring(a+1)}});var g=com.vizengine.core.Object;g.interceptMethod=function(a,b,c){var d=a[b];a[b]=function(){this._origin=d;var a=c.apply(this,arguments);delete this._origin;return a}};g.extend("com.vizengine.core.LRUCache",
{init:function(a){g.prototype.init.apply(this,arguments);this.capacity=a;this.keyMap=new Set;this.queue=[];this.onCacheRemoveCallback=null},contains:function(a){return this.keyMap.has(a)},get:function(a){if(this.keyMap.has(a))for(var b=0;b<this.queue.length;b++)if(this.queue[b].key===a){var c=this.queue[b].value;this.queue=this.queue.slice(0,b).concat(this.queue.slice(b+1));this.queue.unshift({key:a,value:c});break}return c},set:function(a,b){if(this.keyMap.has(a)){for(var c=-1,d=0;d<this.queue.length;d++)if(this.queue[d].key===
a){c=d;break}this.queue=this.queue.slice(0,c).concat(this.queue.slice(c+1))}else this.keyMap.add(a);this.queue.unshift({key:a,value:b});if(this.queue.length>this.capacity&&(c=this.queue.pop(),this.keyMap["delete"](c.key),this.onCacheRemoveCallback))this.onCacheRemoveCallback(c.key,c.value)}});com.vizengine.core.StringUtil={endsWith:function(a,b){return null==a||null==b||0==b.length||a.length<b.length?!1:a.substring(a.length-b.length,a.length)==b},startsWith:function(a,b){return null==a||null==b||
0==b.length||a.length<b.length?!1:a.substring(0,b.length)==b},firstToUpper:function(a){return null==a||0==a.length?a:a.substring(0,1).toUpperCase()+a.substring(1)},isEmpty:function(a){return null==a||0==a.length?!0:/^\s*$/.test(a)},trim:function(a){return a.replace(/(^\s*)|(\s*$)/g,"")}};com.vizengine.core.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(a){var b="",c,d,e,h,k,f,g=0;for(a=l._utf8_encode(a);g<a.length;)c=a.charCodeAt(g++),d=a.charCodeAt(g++),
e=a.charCodeAt(g++),h=c>>2,c=(c&3)<<4|d>>4,k=(d&15)<<2|e>>6,f=e&63,isNaN(d)?k=f=64:isNaN(e)&&(f=64),b=b+this._keyStr.charAt(h)+this._keyStr.charAt(c)+this._keyStr.charAt(k)+this._keyStr.charAt(f);return b},decode:function(a){var b="",c,d,e,h,k,f=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<a.length;)c=this._keyStr.indexOf(a.charAt(f++)),d=this._keyStr.indexOf(a.charAt(f++)),h=this._keyStr.indexOf(a.charAt(f++)),k=this._keyStr.indexOf(a.charAt(f++)),c=c<<2|d>>4,d=(d&15)<<4|h>>2,e=(h&3)<<6|k,b+=String.fromCharCode(c),
64!=h&&(b+=String.fromCharCode(d)),64!=k&&(b+=String.fromCharCode(e));return b=l._utf8_decode(b)},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):(127<d&&2048>d?b+=String.fromCharCode(d>>6|192):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128)),b+=String.fromCharCode(d&63|128))}return b},_utf8_decode:function(a){for(var b="",c=0,d=c1=c2=0;c<a.length;)d=a.charCodeAt(c),128>d?(b+=String.fromCharCode(d),
c++):191<d&&224>d?(c2=a.charCodeAt(c+1),b+=String.fromCharCode((d&31)<<6|c2&63),c+=2):(c2=a.charCodeAt(c+1),c3=a.charCodeAt(c+2),b+=String.fromCharCode((d&15)<<12|(c2&63)<<6|c3&63),c+=3);return b}};var l=com.vizengine.core.Base64;com.vizengine.core.RequestUtil={getRequestParam:function(a){var b={params:{},frameworkParams:{},setParam:function(a,b){this[a]=b;"@"==a[0]?this.frameworkParams[a.substring(1)]=b:this.params[a]=b},toString:function(){var a="",b=!0,c;for(c in this.params)b?b=!1:a+="&",a+=c,
a+="=",a+=encodeURIComponent(this.params[c]);for(c in this.frameworkParams.length)b?b=!1:a+="&",a+="@"+c,a+="=",a+=encodeURIComponent(this.frameworkParams[c]);return a}};if(null==a)return b;var c=a.indexOf("?");if(0<=c)a=a.substring(c+1);else return b;a=a.split("&");for(c=0;c<a.length;c++){var d=a[c].split("=")[0],e=decodeURIComponent(a[c].split("=")[1]);b[d]=e;"@"==d[0]?b.frameworkParams[d.substring(1)]=e:b.params[d]=e}return b}};window.trace=function(a){var b=arguments.callee.caller,c=0;a=a||10;
for(log("vizenginePROFILE ***----------------------------------------  ** "+(c+1));b&&c<a;)b.toString().replace(/\n/g,"\nvizenginePROFILE "),log(b.toString()),b=b.caller,c++,log("vizenginePROFILE ***---------------------------------------- ** "+(c+1))};window.argumentsToArray=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);return b};null==window.setInterval&&(window.setInterval=function(a,b){var c={running:!0},d=function(){setTimeout(function(){c.running&&(a(),d())},b)};d();return c},window.clearInterval=
function(a){a.running=!1})});
]]></res>
	<res path="./libs/vizengine_device.js"><![CDATA[module("vizengine_view.js",function(){var a=com.vizengine.core.Object;com.vizengine.device={};a.extend("com.vizengine.device.Device",{});window.device=new com.vizengine.device.Device});
]]></res>
	<res path="./libs/vizengine_engine3d.js"><![CDATA[module("/libs/vizengine_core.js","/libs/vizengine_math.js",function(){var c=com.vizengine.core.Object,g=com.vizengine.math.Matrix4;c.extend("com.vizengine.engine3d.DataBuffer",{init:function(a){this.dataArray=[];this.dataUnit=a},isEmpty:function(){return 0==this.dataArray.length}});var d=com.vizengine.engine3d.DataBuffer;c.extend("com.vizengine.engine3d.Object3D",{init:function(){c.prototype.init.apply(this,arguments);this.matrix=new g;this.geometryBuffer={indices:new d(1),vertices:new d(3),normals:new d(3),
uvs:new d(2),colors:new d(3)};this.texture={image:null};this.children=[]},add:function(a){a.parent=this;this.children.push(a)},remove:function(a){for(var b=0;b<this.children.length;b++)if(a==this.children[b])return this.children.splice(b,1),a},removeAt:function(a){this.children.splice(a,1)},getWorldMatrix:function(){for(var a=new g,b=this;null!=b;)a.multiply(b.matrix,a),b=b.parent;return a}});var e=com.vizengine.engine3d.Object3D;e.extend("com.vizengine.engine3d.Camera",{init:function(){e.prototype.init.apply(this,
arguments);this.projectionMatrix=new g}});e.extend("com.vizengine.engine3d.Plane",{init:function(){e.prototype.init.apply(this,arguments)},setSize:function(a,b){this.width=a;this.height=b;var c=a/2,d=b/2;this.geometryBuffer.vertices.dataArray=[-1*c,-1*d,0,c,-1*d,0,c,d,0,-1*c,d,0];this.geometryBuffer.vertices.dataUnit=3;this.geometryBuffer.uvs.dataArray=[0,0,1,0,1,1,0,1];this.geometryBuffer.uvs.dataUnit=2;this.geometryBuffer.indices.dataArray=[0,1,2,0,2,3];this.geometryBuffer.indices.dataUnit=1}});
c.extend("com.vizengine.engine3d.Render",{init:function(){c.prototype.init.apply(this,arguments);null==f.instanceCount?f.instanceCount=1:f.instanceCount++;this.id="render_"+f.instanceCount},render:function(a,b){}});var f=com.vizengine.engine3d.Render;return{}});
]]></res>
	<res path="./libs/vizengine_engine3d_css3d.js"><![CDATA[module("/libs/vizengine_engine3d.js",function(){var e=com.vizengine.engine3d.Render,f=com.vizengine.engine3d.Plane;e.extend("com.vizengine.engine3d.RenderCSS3D",{init:function(a){e.prototype.init.apply(this,arguments);this.view=a;this.renderCount=0;this.contextArray=[]},render:function(a,d){if(0!=this.view.frame.width&&0!=this.view.frame.height){this.world=a;this.camera=d;var c=new com.vizengine.math.Matrix4;c.translate(this.view.frame.width/2,this.view.frame.height/2,0);c.scale(1,-1,1);c.scale(this.view.frame.width/
2,this.view.frame.height/2,1);c.multiply(d.projectionMatrix);var b=d.getWorldMatrix().getInverse();c.multiply(b);this._renderObject3D(a,c);this.releaseResource();this.renderCount++}},releaseResource:function(){for(var a=this.contextArray.length-1;0<=a;a--){var d=this.contextArray[a];d.renderCount!=this.renderCount&&(this.releaseContext(d),this.contextArray.splice(a,1))}},releaseContext:function(a){null!=a.div&&(this.view._nativeView.div.removeChild(a.div),a.div=null)},_renderObject3D:function(a,d){a instanceof
f&&this._renderPlane(a,d);for(var c=0;c<a.children.length;c++){var b=a.children[c],e=d.clone();e.multiply(b.matrix);this._renderObject3D(b,e)}},_renderPlane:function(a,d){if(null!=a.width&&null!=a.height&&null!=a.texture.image){var c=this._getOrCreateContext(a);null==c.div&&(c.div=a.texture.image.cloneNode(),c.div.style.position="absolute",c.div.style.transformOrigin="0px 0px 0px",this.view._nativeView.div.appendChild(c.div));c.div.style.width=a.texture.image.width+"px";c.div.style.height=a.texture.image.height+
"px";var b=a.width/a.texture.image.width;d.scale(b,-b,1);d.translate(-a.texture.image.width/2,-a.texture.image.height/2,0);b=d.elements;b="matrix3d("+b[0].toFixed(6)+","+b[1].toFixed(6)+","+b[2].toFixed(6)+","+b[3].toFixed(6)+","+b[4].toFixed(6)+","+b[5].toFixed(6)+","+b[6].toFixed(6)+","+b[7].toFixed(6)+","+b[8].toFixed(6)+","+b[9].toFixed(6)+","+b[10].toFixed(6)+","+b[11].toFixed(6)+","+b[12].toFixed(6)+","+b[13].toFixed(6)+","+b[14].toFixed(6)+","+b[15].toFixed(6)+")";c.div.style.webkitTransform=
b;c.div.style.WebkitTransform=b;c.div.style.MozTransform=b;c.div.style.oTransform=b;c.div.style.transform=b}},_getOrCreateContext:function(a){null==a.css3DContext&&(a.css3DContext={});if(null==a.css3DContext[this.id]){var d={};a.css3DContext[this.id]=d;this.contextArray.push(d)}a.css3DContext[this.id].renderCount=this.renderCount;return a.css3DContext[this.id]}})});
]]></res>
	<res path="./libs/vizengine_engine3d_webgl.js"><![CDATA[module("/libs/vizengine_engine3d.js",function(){var f=com.vizengine.engine3d.Render;f.extend("com.vizengine.engine3d.RenderWebGL",{init:function(a){f.prototype.init.apply(this,arguments);this.canvas=document.createElement("canvas");this.canvas.id="webglcanvas"+this.id;this.canvas.style.width="100%";this.canvas.style.height="100%";this.contextArray=[];this.view=a;this.renderCount=0;a._nativeView.div.appendChild(this.canvas);this.initGL(this.canvas);this.initShaders();var c=this;a.interceptMethod("dispatchLayout",
function(){var a=this._origin.apply(this,arguments);c.canvas.width=this.frame.width*window.devicePixelRatio;c.canvas.height=this.frame.height*window.devicePixelRatio;c.gl.viewportWidth=c.canvas.width;c.gl.viewportHeight=c.canvas.height;return a})},_renderObject3D:function(a,c){this._checkAndSendVertices(a);this._checkAndSendTexture(a);this.gl.uniformMatrix4fv(this.shaderProgram.mvMatrixUniform,!1,new Float32Array(c.elements));this._renderObject3DNode(a);for(var d=0;d<a.children.length;d++){var b=
a.children[d],e=c.clone();e.multiply(b.matrix);this._renderObject3D(b,e)}},_renderObject3DNode:function(a){a=this._getOrCreateWebGLContext(a);if(null!=a.texture){var c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,a.vertexPositionBuffer);c.vertexAttribPointer(this.shaderProgram.vertexPositionAttribute,a.vertexPositionBuffer.itemSize,c.FLOAT,!1,0,0);c.bindBuffer(c.ARRAY_BUFFER,a.vertexTextureCoordBuffer);c.vertexAttribPointer(this.shaderProgram.textureCoordAttribute,a.vertexTextureCoordBuffer.itemSize,c.FLOAT,
!1,0,0);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,a.texture);c.uniform1i(this.shaderProgram.samplerUniform,0);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,a.vertexIndexBuffer);c.drawElements(c.TRIANGLES,a.vertexIndexBuffer.numItems,c.UNSIGNED_SHORT,0)}},_getOrCreateWebGLContext:function(a){null==a.webglContext&&(a.webglContext={});if(null==a.webglContext[this.id]){var c={};a.webglContext[this.id]=c;this.contextArray.push(c)}a.webglContext[this.id].renderCount=this.renderCount;return a.webglContext[this.id]},
_checkAndSendTexture:function(a){var c=this._getOrCreateWebGLContext(a);if(null==c.texture&&null!=a.texture.image){var d=this.gl,b=d.createTexture();c.texture=b;b.image=a.texture.image;d.bindTexture(d.TEXTURE_2D,b);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,b.image);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.bindTexture(d.TEXTURE_2D,null)}},_checkAndSendVertices:function(a){var c=
this._getOrCreateWebGLContext(a);if(null==c.vertexPositionBuffer&&!a.geometryBuffer.vertices.isEmpty()){var c=this._getOrCreateWebGLContext(a),d=this.gl,b=d.createBuffer();c.vertexPositionBuffer=b;d.bindBuffer(d.ARRAY_BUFFER,b);var e=a.geometryBuffer.vertices.dataArray;d.bufferData(d.ARRAY_BUFFER,new Float32Array(e),d.STATIC_DRAW);b.itemSize=a.geometryBuffer.vertices.dataUnit;b.numItems=e.length/a.geometryBuffer.vertices.dataUnit;b=d.createBuffer();c.vertexTextureCoordBuffer=b;d.bindBuffer(d.ARRAY_BUFFER,
b);e=a.geometryBuffer.uvs.dataArray;d.bufferData(d.ARRAY_BUFFER,new Float32Array(e),d.STATIC_DRAW);b.itemSize=a.geometryBuffer.uvs.dataUnit;b.numItems=e.length/a.geometryBuffer.uvs.dataUnit;b=d.createBuffer();c.vertexIndexBuffer=b;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,b);c=a.geometryBuffer.indices.dataArray;d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),d.STATIC_DRAW);b.itemSize=a.geometryBuffer.indices.dataUnit;b.numItems=c.length/a.geometryBuffer.indices.dataUnit}},render:function(a,c){var d=
this.shaderProgram,b=this.gl;b.clearColor(0,0,0,1);b.enable(b.DEPTH_TEST);b.viewport(0,0,b.viewportWidth,b.viewportHeight);b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);b.uniformMatrix4fv(d.pMatrixUniform,!1,new Float32Array(c.projectionMatrix.elements));d=new com.vizengine.math.Matrix4;b=c.getWorldMatrix().getInverse();d.multiply(b);this._renderObject3D(a,d);this.releaseResource();this.renderCount++},releaseResource:function(){for(var a=this.contextArray.length-1;0<=a;a--){var c=this.contextArray[a];
c.renderCount!=this.renderCount&&(this.releaseContext(c),this.contextArray.splice(a,1))}},releaseContext:function(a){null!=a.texture&&(this.gl.deleteTexture(a.texture),a.texture=null);null!=a.vertexPositionBuffer&&(this.gl.deleteBuffer(a.vertexPositionBuffer),a.vertexPositionBuffer=null);null!=a.vertexTextureCoordBuffer&&(this.gl.deleteBuffer(a.vertexTextureCoordBuffer),a.vertexTextureCoordBuffer=null);null!=a.vertexIndexBuffer&&(this.gl.deleteBuffer(a.vertexIndexBuffer),a.vertexIndexBuffer=null)},
initGL:function(a){try{this.gl=a.getContext("experimental-webgl"),this.gl.viewportWidth=a.width,this.gl.viewportHeight=a.height}catch(c){}this.gl||alert("Could not initialise WebGL, sorry :-(")},initShaders:function(){var a=this.gl,c=this.getShader(a,a.FRAGMENT_SHADER),d=this.getShader(a,a.VERTEX_SHADER),b=a.createProgram();this.shaderProgram=b;a.attachShader(b,d);a.attachShader(b,c);a.linkProgram(b);a.getProgramParameter(b,a.LINK_STATUS)||alert("Could not initialise shaders");a.useProgram(b);b.vertexPositionAttribute=
a.getAttribLocation(b,"aVertexPosition");a.enableVertexAttribArray(b.vertexPositionAttribute);b.textureCoordAttribute=a.getAttribLocation(b,"aTextureCoord");a.enableVertexAttribArray(b.textureCoordAttribute);b.pMatrixUniform=a.getUniformLocation(b,"uPMatrix");b.mvMatrixUniform=a.getUniformLocation(b,"uMVMatrix");b.samplerUniform=a.getUniformLocation(b,"uSampler")},getShader:function(a,c){var d=null,b=null;if(c==a.FRAGMENT_SHADER)d="precision mediump float;\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nvoid main(void) {\ngl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n}",
b=a.createShader(a.FRAGMENT_SHADER);else if(c==a.VERTEX_SHADER)d="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat4 uMVMatrix;\nuniform mat4 uPMatrix;\nvarying vec2 vTextureCoord;\nvoid main(void) {\ngl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\nvTextureCoord = aTextureCoord;\n}",b=a.createShader(a.VERTEX_SHADER);else return null;a.shaderSource(b,d);a.compileShader(b);return a.getShaderParameter(b,a.COMPILE_STATUS)?b:(alert(a.getShaderInfoLog(b)),null)}})});
]]></res>
	<res path="./libs/vizengine_gesture.js"><![CDATA[module("vizengine_math.js",function(){var h=com.vizengine.core.Object;com.vizengine.gesture={};h.extend("com.vizengine.gesture.Point",{init:function(a,b){this.x=null==a?0:a;this.y=null==b?0:b},x:0,y:0,distanceTo:function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))}});var k=com.vizengine.gesture.Point;k.extend("com.vizengine.gesture.TouchPoint",{init:function(a,b){k.prototype.init.apply(this,arguments);this.absX=this.x;this.absY=this.y}});var l=com.vizengine.gesture.TouchPoint;
h.extend("com.vizengine.gesture.TouchEvent",{init:function(){this.state=0;this.touchPoints=[]},getCenter:function(){if(null==this.touchPoints||1>this.touchPoints.length)return null;var a=0,b=0,c;for(c in this.touchPoints)var e=this.touchPoints[c],a=a+e.x,b=b+e.y;return new k(a/this.touchPoints.length,b/this.touchPoints.length)},getRadius:function(){if(1>=this.touchPoints.length)return 0;var a=this.getCenter(),b=0,c;for(c in this.touchPoints)b+=this.touchPoints[c].distanceTo(a);return b/this.touchPoints.length},
getX:function(a){if(null==a){if(1==this.touchPoints.length)return this.touchPoints[0].x;for(var b=a=0;b<this.touchPoints.length;b++)a+=this.touchPoints[b].x;return a/this.touchPoints.length}return this.touchPoints.length>a?this.touchPoints[a].x:0},getAbsX:function(a){if(null==a){if(1==this.touchPoints.length)return this.touchPoints[0].absX;for(var b=a=0;b<this.touchPoints.length;b++)a+=this.touchPoints[b].absX;return a/this.touchPoints.length}return this.touchPoints.length>a?this.touchPoints[a].absX:
0},getY:function(a){if(null==a){if(1==this.touchPoints.length)return this.touchPoints[0].y;for(var b=a=0;b<this.touchPoints.length;b++)a+=this.touchPoints[b].y;return a/this.touchPoints.length}return this.touchPoints.length>a?this.touchPoints[a].y:0},getAbsY:function(a){if(null==a){if(1==this.touchPoints.length)return this.touchPoints[0].absY;for(var b=a=0;b<this.touchPoints.length;b++)a+=this.touchPoints[b].absY;return a/this.touchPoints.length}return this.touchPoints.length>a?this.touchPoints[a].absY:
0},getCount:function(){return this.touchPoints.length},getTouchPoints:function(){return this.touchPoints},offsetCopy:function(a,b){var c=new m;c.state=this.state;c.ghost=this.ghost;for(var e in this.touchPoints){var d=this.touchPoints[e],f=new l;f.x=d.x+a;f.y=d.y+b;f.absX=d.absX;f.absY=d.absY;c.touchPoints[e]=f}return c},applyMartix4:function(a){var b=new m;b.state=this.state;b.ghost=this.ghost;for(var c in this.touchPoints){var e=this.touchPoints[c],d=new l,f=new com.vizengine.math.Vector3(e.x,e.y,
0);f.applyMatrix4(a);d.x=f.x;d.y=f.y;d.absX=e.absX;d.absY=e.absY;b.touchPoints[c]=d}return b}});var m=com.vizengine.gesture.TouchEvent;h.extend("com.vizengine.gesture.GestureDetector",{detect:function(a){return!1}});var g=com.vizengine.gesture.GestureDetector;g.extend("com.vizengine.gesture.TapGestureDetector",{init:function(){g.prototype.init(this,arguments);this.downPoint=null;this.downTime=0},callback:null,getPointInRoot:function(a){var b=a.getAbsX();a=a.getAbsY();return new l(b,a)},detect:function(a){if(null==
this.callback)return!1;if(0==a.state)this.downTime=(new Date).getTime(),this.downPoint=this.getPointInRoot(a);else if(2==a.state){var b=(new Date).getTime(),c=this.getPointInRoot(a);if(null==this.downPoint)return!1;if(200>b-this.downTime&&6>this.downPoint.distanceTo(c))return this.callback(a);this.downPoint=null}return!0}});g.extend("com.vizengine.gesture.SweepGestureDetector",{init:function(){g.prototype.init.apply(this,arguments);this.cancelCallback=null;this.touchTrack=[];this.mutiTouch=!1},callback:null,
detect:function(a){if(null==this.callback)return!1;0==a.state&&1==a.touchPoints.length&&(this.mutiTouch=!1);1<a.touchPoints.length&&(this.mutiTouch=!0);if(this.mutiTouch)a.ghost&&null!=this.cancelCallback&&this.cancelCallback(),2==a.state&&this.callback(0,0,a);else{if(0==a.state){var b=(new Date).getTime();a=a.touchPoints[0];a.time=b;this.touchTrack.length=0;this.touchTrack[0]=a}else if(1==a.state)b=(new Date).getTime(),a=a.touchPoints[0],a.time=b,this.touchTrack[this.touchTrack.length]=a;else if(2<=
a.state){var b=(new Date).getTime(),c=a.touchPoints[0];c.time=b;for(var e=null,d=this.touchTrack.length-1;0<=d;d--){var f=this.touchTrack[d];50<b-f.time&&(e=f)}null==e&&0<this.touchTrack.length&&(e=this.touchTrack[0]);this.touchTrack.length=0;return null!=e&&(d=b-e.time,0<d)?(b=(c.absY-e.absY)/d,c=(c.absX-e.absX)/d,e=Math.abs(b),d=Math.abs(c),3.4<d&&(d=3.4/d,c*=d,b*=d),3.4<e&&(d=3.4/e,c*=d,b*=d),this.callback(c,b,a)):this.callback(0,0,a)}return!1}}});g.extend("com.vizengine.gesture.PanGestureDetector",
{init:function(){g.prototype.init.apply(this,arguments);this.touchDownY=this.touchDownX=0;this.touching=!1;this.fingerCount=0;this.draging=!1},callback:null,detect:function(a){var b=!1;if(null==this.callback)return b;var c=0,e=0;this.fingerCount!=a.touchPoints.length&&(this.fingerCount=a.touchPoints.length,this.touching=!1);0==this.touching&&(a=a.offsetCopy(0,0),a.state=0);0==a.state?(this.touching=!0,this.touchDownX=a.getAbsX(),this.touchDownY=a.getAbsY()):(c=a.getAbsX()-this.touchDownX,e=a.getAbsY()-
this.touchDownY);1==a.state&&(this.draging=!0);if(this.draging||0==a.state)b=this.callback(c,e,a);2==a.state&&(this.draging=this.touching=!1);return b}});g.extend("com.vizengine.gesture.TwistGestureDetector",{init:function(){g.prototype.init.apply(this,arguments);this.touching=!1;this.fingerCount=0},callback:null,getRotation:function(a){return 2>a.touchPoints.length?0:Math.atan2(a.touchPoints[0].x-a.touchPoints[1].x,a.touchPoints[0].y-a.touchPoints[1].y)},detect:function(a){if(null==this.callback)return!1;
var b=0,c=a.touchPoints.length,e=a.getCenter();this.fingerCount!=c&&(this.fingerCount=c,this.touching=!1);0==this.touching&&1==a.state&&(a=a.offsetCopy(0,0),a.state=0);0==a.state?(this.touching=!0,this.initRotation=this.getRotation(a)):b=this.getRotation(a)-this.initRotation;if(2==a.state)this.touching=!1;else return this.callback(e,b,a);return!1}});g.extend("com.vizengine.gesture.PinchGestureDetector",{init:function(){g.prototype.init.apply(this,arguments);this.fingerCount=this.initRadius=0},callback:null,
detect:function(a){if(null==this.callback||2>a.touchPoints.length)return!1;var b=!1;if(0==a.state||this.fingerCount!=a.touchPoints.length)this.initRadius=a.getRadius(),this.fingerCount=a.touchPoints.length,b=!0;var c=a.getRadius()/this.initRadius;return 2>a.state?this.callback(c,b,a):!1}})});
]]></res>
	<res path="./libs/vizengine_global.js"><![CDATA[module("vizengine_device.js",function(){com.vizengine.Global={putByKey:function(a,h){nativePutByKey(a,h)},getByKey:function(a){return nativeGetByKey(a)},removeByKey:function(a,h){null==h&&(h=!1);nativeRemoveByKey(a,h?1:0)},http:function(){var a=arguments[0].toUpperCase(),h=arguments[1],g={},k={},l=null;3==arguments.length?l=arguments[2]:4==arguments.length?(k=arguments[2],l=arguments[3]):5==arguments.length&&(g=arguments[2],k=arguments[3],l=arguments[4]);null==g&&(g={});null==k&&(k={});if("POST"!=
a&&"PUT"!=a){var m=null,n;for(n in k)m=null==m?"":m+"&",m+=encodeURIComponent(n)+"="+encodeURIComponent(k[n]);null!=m&&(0>h.indexOf("?")&&(h+="?"),h+=m);k={}}var f={_isCanceled:!1,cancel:function(){this._isCanceled=!0}};nativeHttpFetch(a,h,g,k,function(){f._isCanceled||l.apply(null,arguments)});return f},get:function(){var a=argumentsToArray(arguments);a.unshift("GET");return this.http.apply(this,a)},post:function(){var a=argumentsToArray(arguments);a.unshift("POST");return this.http.apply(this,a)},
callup:function(a){nativeCallup(a)},share:function(a,h){nativeShare(this._fixShareData(a),h)},_fixShareData:function(a){null==a&&(a={});null==a.title&&(a.title="\u7f3a\u5c11\u5206\u4eab\u6807\u9898");null==a.url&&(a.url="http://www.baidu.com");null==a.text&&(a.text="\u7f3a\u5c11\u5206\u4eab\u5185\u5bb9");null==a.img&&(a.img="https://dev.umeng.com/images/tab2_1.png");return a},isSupportShareTo:function(a){return nativeIsSupportShareTo(a)},isSupportNaviTo:function(a){return nativeIsSupportNaviTo(a)},
navi:function(a){nativeNavi(a)},setStatusBarLight:function(a){nativeSetStatusBarLight(0!=a)},setStatusBarHidden:function(a){nativeSetStatusBarHidden(0!=a)},emailTo:function(a){nativeEmailTo(a)},pickImageFromAlbum:function(a){nativeGetMedia("album","image",a)},pickImageFromCamera:function(a){nativeGetMedia("camera","image",a)},trackBeginPage:function(a){nativeTrackBeginPage(a)},trackEndPage:function(a){nativeTrackEndPage(a)},trackCustomEvent:function(a){nativeTrackCustomEvent(a)},getSetting:function(a){return nativeGetAuthority(a)},
openSetting:function(a){nativeOpenUrl(a)},openUrl:function(a){nativeOpenUrl(a)},exitApp:function(){nativeExitApp()},getVersion:function(){return nativeGetVersion()},rc4:function(a,h){for(var g=0,k=0,l=new Uint8Array(256),m=new Uint8Array(256),n=0,g=0;256>g;g++)l[g]=g,m[g]=h[g%h.length];for(g=0;256>g;g++)k=(k+l[g]+m[g])%256,n=l[g],l[g]=l[k],l[k]=n;for(m=n=k=g=0;m<a.length;m++)g=(g+1)%256,k=(k+l[g])%256,n=l[g],l[g]=l[k],l[k]=n,n=(l[g]+l[k])%256,a[m]^=l[n];return a},md5:function(a){function h(a,c){var d,
e,b,f,g;b=a&2147483648;f=c&2147483648;d=a&1073741824;e=c&1073741824;g=(a&1073741823)+(c&1073741823);return d&e?g^2147483648^b^f:d|e?g&1073741824?g^3221225472^b^f:g^1073741824^b^f:g^b^f}function g(a,b,c,d,e,f,g){a=h(a,h(h(b&c|~b&d,e),g));return h(a<<f|a>>>32-f,b)}function k(a,b,c,d,e,f,g){a=h(a,h(h(b&d|c&~d,e),g));return h(a<<f|a>>>32-f,b)}function l(a,b,d,c,e,f,g){a=h(a,h(h(b^d^c,e),g));return h(a<<f|a>>>32-f,b)}function m(a,b,d,c,e,f,g){a=h(a,h(h(d^(b|~c),e),g));return h(a<<f|a>>>32-f,b)}function n(a){var b=
"",d="",c;for(c=0;3>=c;c++)d=a>>>8*c&255,d="0"+d.toString(16),b+=d.substr(d.length-2,2);return b}var f=[],p,q,r,t,c,d,e,b;a=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",d=0;d<a.length;d++){var c=a.charCodeAt(d);128>c?b+=String.fromCharCode(c):(127<c&&2048>c?b+=String.fromCharCode(c>>6|192):(b+=String.fromCharCode(c>>12|224),b+=String.fromCharCode(c>>6&63|128)),b+=String.fromCharCode(c&63|128))}return b}(a);f=function(a){var b,c=a.length;b=c+8;for(var d=16*((b-b%64)/64+1),e=Array(d-1),f=0,g=
0;g<c;)b=(g-g%4)/4,f=g%4*8,e[b]|=a.charCodeAt(g)<<f,g++;b=(g-g%4)/4;e[b]|=128<<g%4*8;e[d-2]=c<<3;e[d-1]=c>>>29;return e}(a);c=1732584193;d=4023233417;e=2562383102;b=271733878;for(a=0;a<f.length;a+=16)p=c,q=d,r=e,t=b,c=g(c,d,e,b,f[a+0],7,3614090360),b=g(b,c,d,e,f[a+1],12,3905402710),e=g(e,b,c,d,f[a+2],17,606105819),d=g(d,e,b,c,f[a+3],22,3250441966),c=g(c,d,e,b,f[a+4],7,4118548399),b=g(b,c,d,e,f[a+5],12,1200080426),e=g(e,b,c,d,f[a+6],17,2821735955),d=g(d,e,b,c,f[a+7],22,4249261313),c=g(c,d,e,b,f[a+
8],7,1770035416),b=g(b,c,d,e,f[a+9],12,2336552879),e=g(e,b,c,d,f[a+10],17,4294925233),d=g(d,e,b,c,f[a+11],22,2304563134),c=g(c,d,e,b,f[a+12],7,1804603682),b=g(b,c,d,e,f[a+13],12,4254626195),e=g(e,b,c,d,f[a+14],17,2792965006),d=g(d,e,b,c,f[a+15],22,1236535329),c=k(c,d,e,b,f[a+1],5,4129170786),b=k(b,c,d,e,f[a+6],9,3225465664),e=k(e,b,c,d,f[a+11],14,643717713),d=k(d,e,b,c,f[a+0],20,3921069994),c=k(c,d,e,b,f[a+5],5,3593408605),b=k(b,c,d,e,f[a+10],9,38016083),e=k(e,b,c,d,f[a+15],14,3634488961),d=k(d,e,
b,c,f[a+4],20,3889429448),c=k(c,d,e,b,f[a+9],5,568446438),b=k(b,c,d,e,f[a+14],9,3275163606),e=k(e,b,c,d,f[a+3],14,4107603335),d=k(d,e,b,c,f[a+8],20,1163531501),c=k(c,d,e,b,f[a+13],5,2850285829),b=k(b,c,d,e,f[a+2],9,4243563512),e=k(e,b,c,d,f[a+7],14,1735328473),d=k(d,e,b,c,f[a+12],20,2368359562),c=l(c,d,e,b,f[a+5],4,4294588738),b=l(b,c,d,e,f[a+8],11,2272392833),e=l(e,b,c,d,f[a+11],16,1839030562),d=l(d,e,b,c,f[a+14],23,4259657740),c=l(c,d,e,b,f[a+1],4,2763975236),b=l(b,c,d,e,f[a+4],11,1272893353),e=
l(e,b,c,d,f[a+7],16,4139469664),d=l(d,e,b,c,f[a+10],23,3200236656),c=l(c,d,e,b,f[a+13],4,681279174),b=l(b,c,d,e,f[a+0],11,3936430074),e=l(e,b,c,d,f[a+3],16,3572445317),d=l(d,e,b,c,f[a+6],23,76029189),c=l(c,d,e,b,f[a+9],4,3654602809),b=l(b,c,d,e,f[a+12],11,3873151461),e=l(e,b,c,d,f[a+15],16,530742520),d=l(d,e,b,c,f[a+2],23,3299628645),c=m(c,d,e,b,f[a+0],6,4096336452),b=m(b,c,d,e,f[a+7],10,1126891415),e=m(e,b,c,d,f[a+14],15,2878612391),d=m(d,e,b,c,f[a+5],21,4237533241),c=m(c,d,e,b,f[a+12],6,1700485571),
b=m(b,c,d,e,f[a+3],10,2399980690),e=m(e,b,c,d,f[a+10],15,4293915773),d=m(d,e,b,c,f[a+1],21,2240044497),c=m(c,d,e,b,f[a+8],6,1873313359),b=m(b,c,d,e,f[a+15],10,4264355552),e=m(e,b,c,d,f[a+6],15,2734768916),d=m(d,e,b,c,f[a+13],21,1309151649),c=m(c,d,e,b,f[a+4],6,4149444226),b=m(b,c,d,e,f[a+11],10,3174756917),e=m(e,b,c,d,f[a+2],15,718787259),d=m(d,e,b,c,f[a+9],21,3951481745),c=h(c,p),d=h(d,q),e=h(e,r),b=h(b,t);return(n(c)+n(d)+n(e)+n(b)).toLowerCase()},base64Encode:function(a){return com.vizengine.core.Base64.encode(a)},
base64Decode:function(a){return com.vizengine.core.Base64.decode(a)}};com.vizengine.$=com.vizengine.Global});
]]></res>
	<res path="./libs/vizengine_location.js"><![CDATA[module("vizengine_global.js",function(){var d=com.vizengine.$;com.vizengine.core.Object.extend("com.vizengine.location.LocationManager",{});var e=function(b,c){d.get(window.location.protocol+"//apis.map.qq.com/ws/geocoder/v1/?location="+b.latitude+","+b.longitude+"&key=DGPBZ-7V6RX-ANC4R-ZLIA3-ROB7F-ESBTM",{},function(a){a=JSON.parse(a);null!=a&&null!=a.result&&null!=a.result.ad_info&&(a=a.result.ad_info,b.adcode=a.adcode,b.nation=a.nation,b.province=a.province,b.city=a.city,b.district=a.district);
c(b)})};com.vizengine.location.LocationManager.getLocation=function(b,c){nativeGetLocation(b,function(a){null!=a&&null==a.nation?e(a,c):c(a)})}});
]]></res>
	<res path="./libs/vizengine_math.js"><![CDATA[module("vizengine_core.js",function(){var B=com.vizengine.core.Object;B.extend("com.vizengine.math.Matrix4",{init:function(){this.elements=[];this.identity()},set:function(b,c,a,e,g,h,d,k,l,m,n,p,q,r,t,u){var f=this.elements;f[0]=b;f[4]=c;f[8]=a;f[12]=e;f[1]=g;f[5]=h;f[9]=d;f[13]=k;f[2]=l;f[6]=m;f[10]=n;f[14]=p;f[3]=q;f[7]=r;f[11]=t;f[15]=u;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},fromArray:function(b,c){null==c&&(c=0);for(var a=0;16>a;a++)this.elements[a]=
b[a+c];return this},toArray:function(b,c){null==b&&(b=[]);null==c&&(c=0);var a=this.elements;b[c]=a[0];b[c+1]=a[1];b[c+2]=a[2];b[c+3]=a[3];b[c+4]=a[4];b[c+5]=a[5];b[c+6]=a[6];b[c+7]=a[7];b[c+8]=a[8];b[c+9]=a[9];b[c+10]=a[10];b[c+11]=a[11];b[c+12]=a[12];b[c+13]=a[13];b[c+14]=a[14];b[c+15]=a[15];return b},equals:function(b){var c=this.elements;b=b.elements;for(var a=0;16>a;a++)if(c[a]!==b[a])return!1;return!0},clone:function(){return(new com.vizengine.math.Matrix4).fromArray(this.elements)},copyFrom:function(b){var c=
this.elements;b=b.elements;for(var a=0;16>a;a++)c[a]=b[a];return this},multiply:function(){var b,c;if(1==arguments.length)b=this,c=arguments[0];else if(2==arguments.length)b=arguments[0],c=arguments[1];else return null;var a=b.elements,e=c.elements;c=this.elements;b=a[0];var g=a[4],h=a[8],d=a[12],k=a[1],l=a[5],m=a[9],n=a[13],p=a[2],q=a[6],r=a[10],t=a[14],u=a[3],f=a[7],w=a[11],a=a[15],x=e[0],y=e[4],z=e[8],A=e[12],v=e[1],C=e[5],D=e[9],E=e[13],F=e[2],G=e[6],H=e[10],I=e[14],J=e[3],K=e[7],L=e[11],e=e[15];
c[0]=b*x+g*v+h*F+d*J;c[4]=b*y+g*C+h*G+d*K;c[8]=b*z+g*D+h*H+d*L;c[12]=b*A+g*E+h*I+d*e;c[1]=k*x+l*v+m*F+n*J;c[5]=k*y+l*C+m*G+n*K;c[9]=k*z+l*D+m*H+n*L;c[13]=k*A+l*E+m*I+n*e;c[2]=p*x+q*v+r*F+t*J;c[6]=p*y+q*C+r*G+t*K;c[10]=p*z+q*D+r*H+t*L;c[14]=p*A+q*E+r*I+t*e;c[3]=u*x+f*v+w*F+a*J;c[7]=u*y+f*C+w*G+a*K;c[11]=u*z+f*D+w*H+a*L;c[15]=u*A+f*E+w*I+a*e;return this},premultiply:function(b){return this.multiply(b,this)},translate:function(b,c,a){return this.multiply((new x).setTranslation(b,c,a))},rotateX:function(b){return this.multiply((new x).setRotationX(b))},
rotateY:function(b){return this.multiply((new x).setRotationY(b))},rotateZ:function(b){return this.multiply((new x).setRotationZ(b))},scale:function(b,c,a){return this.multiply((new x).setScale(b,c,a))},perspective:function(b,c,a,e){return this.multiply((new x).setPerspective(b,c,a,e))},setTranslation:function(b,c,a){this.set(1,0,0,b,0,1,0,c,0,0,1,a,0,0,0,1);return this},setRotationX:function(b){var c=Math.cos(b);b=Math.sin(b);this.set(1,0,0,0,0,c,-b,0,0,b,c,0,0,0,0,1);return this},setRotationY:function(b){var c=
Math.cos(b);b=Math.sin(b);this.set(c,0,b,0,0,1,0,0,-b,0,c,0,0,0,0,1);return this},setRotationZ:function(b){var c=Math.cos(b);b=Math.sin(b);this.set(c,-b,0,0,b,c,0,0,0,0,1,0,0,0,0,1);return this},setScale:function(b,c,a){this.set(b,0,0,0,0,c,0,0,0,0,a,0,0,0,0,1);return this},setFrustum:function(b,c,a,e,g,h){var d=this.elements;d[0]=2*g/(c-b);d[4]=0;d[8]=(c+b)/(c-b);d[12]=0;d[1]=0;d[5]=2*g/(a-e);d[9]=(a+e)/(a-e);d[13]=0;d[2]=0;d[6]=0;d[10]=-(h+g)/(h-g);d[14]=-2*h*g/(h-g);d[3]=0;d[7]=0;d[11]=-1;d[15]=
0;return this},setPerspective:function(b,c,a,e){b=a*Math.tan(b/2);c*=b;return this.setFrustum(-c,c,b,-b,a,e)},setOrthographic:function(b,c,a,e,g,h){var d=this.elements,k=1/(c-b),l=1/(a-e),m=1/(h-g);d[0]=2*k;d[4]=0;d[8]=0;d[12]=-((c+b)*k);d[1]=0;d[5]=2*l;d[9]=0;d[13]=-((a+e)*l);d[2]=0;d[6]=0;d[10]=-2*m;d[14]=-((h+g)*m);d[3]=0;d[7]=0;d[11]=0;d[15]=1;return this},getInverse:function(){var b=new x,c=b.elements,a=this.elements,e=a[0],g=a[1],h=a[2],d=a[3],k=a[4],l=a[5],m=a[6],n=a[7],p=a[8],q=a[9],r=a[10],
t=a[11],u=a[12],f=a[13],w=a[14],a=a[15],B=q*w*n-f*r*n+f*m*t-l*w*t-q*m*a+l*r*a,y=u*r*n-p*w*n-u*m*t+k*w*t+p*m*a-k*r*a,z=p*f*n-u*q*n+u*l*t-k*f*t-p*l*a+k*q*a,A=u*q*m-p*f*m-u*l*r+k*f*r+p*l*w-k*q*w,v=e*B+g*y+h*z+d*A;if(0===v)return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),null;v=1/v;c[0]=B*v;c[1]=(f*r*d-q*w*d-f*h*t+g*w*t+q*h*a-g*r*a)*v;c[2]=(l*w*d-f*m*d+f*h*n-g*w*n-l*h*a+g*m*a)*v;c[3]=(q*m*d-l*r*d-q*h*n+g*r*n+l*h*t-g*m*t)*v;c[4]=y*v;c[5]=(p*w*d-u*r*d+u*h*t-e*w*t-p*h*a+
e*r*a)*v;c[6]=(u*m*d-k*w*d-u*h*n+e*w*n+k*h*a-e*m*a)*v;c[7]=(k*r*d-p*m*d+p*h*n-e*r*n-k*h*t+e*m*t)*v;c[8]=z*v;c[9]=(u*q*d-p*f*d-u*g*t+e*f*t+p*g*a-e*q*a)*v;c[10]=(k*f*d-u*l*d+u*g*n-e*f*n-k*g*a+e*l*a)*v;c[11]=(p*l*d-k*q*d-p*g*n+e*q*n+k*g*t-e*l*t)*v;c[12]=A*v;c[13]=(p*f*h-u*q*h+u*g*r-e*f*r-p*g*w+e*q*w)*v;c[14]=(u*l*h-k*f*h-u*g*m+e*f*m+k*g*w-e*l*w)*v;c[15]=(k*q*h-p*l*h+p*g*m-e*q*m-k*g*r+e*l*r)*v;return b}});var x=com.vizengine.math.Matrix4;B.extend("com.vizengine.math.Vector3",{init:function(b,c,a){this.set(b,
c,a)},set:function(b,c,a){this.x=null==b?0:b;this.y=null==c?0:c;this.z=null==a?0:a},applyMatrix4:function(b){var c=this.x,a=this.y,e=this.z;b=b.elements;this.x=b[0]*c+b[4]*a+b[8]*e+b[12];this.y=b[1]*c+b[5]*a+b[9]*e+b[13];this.z=b[2]*c+b[6]*a+b[10]*e+b[14];return this.multiplyScalar(1/(b[3]*c+b[7]*a+b[11]*e+b[15]))},multiplyScalar:function(b){this.x*=b;this.y*=b;this.z*=b;return this}})});
]]></res>
	<res path="./libs/vizengine_model3d.js"><![CDATA[module("/libs/vizengine_pano.js",function(){var k=com.vizengine.core.Object,m=com.vizengine.view.View,w=com.vizengine.gesture.PanGestureDetector,x=com.vizengine.gesture.SweepGestureDetector,y=com.vizengine.gesture.PinchGestureDetector,p=com.vizengine.animation.Animation,z=com.vizengine.animation.DecelerateInterpolator;p.extend({init:function(a){p.prototype.init.apply(this,arguments);this.modelGetureController=a;this.toZ=this.toY=this.toX=this.fromZ=this.fromY=this.fromX=0},animateFrame:function(a,
c){this.modelGetureController.setCameraPosition(this.fromX+(this.toX-this.fromX)*c,this.fromY+(this.toY-this.fromY)*c,this.fromZ+(this.toZ-this.fromZ)*c)}});p.extend({init:function(a){p.prototype.init.apply(this,arguments);this.modelGestureController=a;this.toDistance=this.fromDistance=0},animateFrame:function(a,c){this.modelGestureController._setDistance(this.fromDistance+(this.toDistance-this.fromDistance)*c)}});var A=p.extend({init:function(a){p.prototype.init.apply(this,arguments);this.modelGestureController=
a;this.toRoll=this.fromRoll=this.toPitch=this.toHeading=this.fromPitch=this.fromHeading=0},animateFrame:function(a,c){this.modelGestureController._setHeading(this.fromHeading+(this.toHeading-this.fromHeading)*c);this.modelGestureController._setPitch(this.fromPitch+(this.toPitch-this.fromPitch)*c)}}),t=k.extend({init:function(){k.prototype.init.apply(this,arguments);this.min=new THREE.Vector3;this.max=new THREE.Vector3},getWidth:function(){return this.max.x-this.min.x},getHeight:function(){return this.max.y-
this.min.y},getTall:function(){return this.max.z-this.min.z},getCenter:function(){var a=new THREE.Vector3;a.x=(this.min.x+this.max.x)/2;a.y=(this.min.y+this.max.y)/2;a.z=(this.min.z+this.max.z)/2;return a},getRadius:function(){return this.max.distanceTo(this.min)/2}}),r=function(){this.z=this.y=this.x=this.level=0};r.prototype.getPath=function(){return this.level+"/"+this.x+"_"+this.y+"_"+this.z};new function(){this.taskQueue=[];this.addTask=function(a){this.taskQueue.push(a);this.processTask()};
this.runningTaskCount=0;this.maxTaskCount=1;this.processTask=function(){if(0!=this.taskQueue.length&&!(this.runningTaskCount>=this.maxTaskCount)){var a=this;this.runningTaskCount++;this.taskQueue.shift()(function(){a.runningTaskCount--;a.processTask()})}}};var u=function(a,c,b){null==b&&(b="GET");var d=new XMLHttpRequest;d.open(b,a,!0);d.responseType="arraybuffer";d.onload=function(a){200==this.status&&c(this.response)};d.send()},v=function(a,c){for(var b=new Uint8Array(a),d=Uint8Array,e=c,f=new ArrayBuffer(e.length),
g=new Uint8Array(f),h=0,l=e.length;h<l;h++)g[h]=e.charCodeAt(h);c=new d(f);b=com.vizengine.Global.rc4(b,c);return String.fromCharCode.apply(null,new Uint8Array(b))};window.THREE&&THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader);var E=k.extend({init:function(){k.prototype.init.apply(this,arguments);this.index=new r;this.bound=new t;this.object=null;this.visible=!0;this.loadState=0;this.key=null},getIndexPath:function(a){null==a&&(a=this.index);return a.getPath()},setVisible:function(a){this.visible=
a;null!=this.object&&(this.object.visible=a)},getParentIndex:function(a){null==a&&(a=this.index);if(0>=a.level)return null;var c=new r;c.level=a.level-1;1==a.level?(c.x=a.x,c.y=a.y,c.z=a.z):(c.x=Math.floor(a.x/2),c.y=Math.floor(a.y/2),c.z=Math.floor(a.z/2));return c},walkBrotherIndex:function(a,c){null==c&&(c=this.index);if(0==c.level){for(var b=new r,d=b.level=0;2>d;d++)for(var e=0;2>e;e++)for(var f=0;2>f;f++)if(b.x=d,b.y=e,b.z=f,null!=this.modelView.boxiesIndex[b.getPath()]&&!a(b))return!1;return!0}b=
this.getParentIndex(c);return this.walkChildrenIndex(a,b)},walkChildrenIndex:function(a,c){null==c&&(c=this.index);var b=new r;b.level=c.level+1;if(0==c.level)return b.x=c.x,b.y=c.y,b.z=c.z,null==this.modelView.boxiesIndex[b.getPath()]?!0:a(b);for(var d=0;2>d;d++)for(var e=0;2>e;e++)for(var f=0;2>f;f++)if(b.x=d+2*c.x,b.y=e+2*c.y,b.z=f+2*c.z,null!=this.modelView.boxiesIndex[b.getPath()]&&!a(b))return!1;return!0},load:function(a){var c=this;c.loadInternal(function(b){a.call(c,b)})},reset:function(){this.loadState=
0;this.object=null},loadInternal:function(a){if(null!=this.object)this.loadState=2,a(this.object);else{var c=this;this.loadState=1;this.loadStartTime=(new Date).getTime();var b=new THREE.MTLLoader,d=b.load;b.crossOrigin="*";var e=this.modelSrc,f=c.modelView.formatProvider.getMtlUrl(c.index.level,c.index.x,c.index.y,c.index.z,c.fileId),g=c.modelView.formatProvider.getObjUrl(c.index.level,c.index.x,c.index.y,c.index.z,c.fileId);b.load=function(a,b,e,g){if(3>c.modelView.formatProvider.version)return d.apply(this,
arguments);a=f;var h=this;u(a,function(a){a=v(a,c.key);b(h.parse(a))})};var h=f.substring(0,f.lastIndexOf("/")+1),l=f.substring(f.lastIndexOf("/")+1);b.setPath(h);b.load(l,function(b){if(e==c.modelSrc){var d=new THREE.LoadingManager;d.onProgress=function(d,f,h){if(f==h&&e==c.modelSrc){d=null;if(1<c.modelView.formatProvider.version){d=new THREE.DRACOLoader;var l=d.decodeDracoFile;d.decodeDracoFile=function(a){if(3>c.modelView.formatProvider.version)return l.apply(this,arguments);for(var b=new Uint8Array(a),
d=Uint8Array,e=com.vizengine.core.Base64._utf8_encode(c.key),f=new ArrayBuffer(e.length),g=new Uint8Array(f),h=0,k=e.length;h<k;h++)g[h]=e.charCodeAt(h);d=new d(f);com.vizengine.Global.rc4(b,d);return l.call(this,a)}}else d=new THREE.OBJLoader;d.setMaterials(b);d.crossOrigin="*";d.load(g,function(b){e==c.modelSrc&&(c.modelView.debugEnable&&(b=c.compose(b)),c.loadState=2,c.object=b,c.object.visible=c.visible,c.loadFinishTime=(new Date).getTime(),a(c.object))},function(a){},function(){e==c.modelSrc&&
(c.loadState=3,c.object=null,c.loadFinishTime=(new Date).getTime(),a(c.object))})}};b.setManager(d);b.preload();b.side=THREE.DoubleSide;for(var f in b.materials)b.materials[f].side=THREE.DoubleSide}},function(){},function(){c.loadState=3;c.object=null;c.loadTextureTime=c.loadFinishTime=(new Date).getTime();a(c.object)})}},compose:function(a){if(null==a)return null;var c=new THREE.Object3D;c.add(a);a=new THREE.BoxBufferGeometry(this.bound.max.x-this.bound.min.x,this.bound.max.y-this.bound.min.y,this.bound.max.z-
this.bound.min.z);var b=new THREE.Texture,d=this.index.level+"("+this.index.x+"_"+this.index.y+"_"+this.index.z+")",e=document.createElement("canvas"),f=e.getContext("2d");e.width=256;e.height=256;f.strokeStyle="#FF0000";f.rect(0,0,256,256);f.lineWidth=2;f.stroke();f.fillStyle="#FF0000";f.font="26px regular";f.textBaseline="top";f.fillText(d,10,10);d=new Image;d.src=e.toDataURL("image/png");b.image=d;b.needsUpdate=!0;b=new THREE.MeshBasicMaterial({map:b,transparent:!0});a=new THREE.Mesh(a,b);a.position.x=
(this.bound.max.x+this.bound.min.x)/2;a.position.y=(this.bound.max.y+this.bound.min.y)/2;a.position.z=(this.bound.max.z+this.bound.min.z)/2;c.add(a);return c}}),B=k.extend({init:function(a,c){k.prototype.init.apply(this,arguments);this.sceneView=a;this.camera=c;this.distance=2;this.maxDistance=1.5*this.distance;this.minDistance=this.distance/2;this.rotation=new THREE.Euler;this.rotation.order="ZXY";var b=this;b.pinchVecX=0;b.pinchVecY=0;b.pinchVecZ=0;var d=new y;d.callback=function(a,c,d){c?(a=new THREE.Vector3(0,
0,-2),a.applyEuler(b.camera.rotation),b.initPinchVec=a):(a=Math.log(a)/Math.log(2),b.pinchVecX=b.initPinchVec.x*a,b.pinchVecY=b.initPinchVec.y*a,b.pinchVecZ=b.initPinchVec.z*a)};a.gestureDetectors.push(d);d=new w;d.callback=function(a,c,d){0==d.state?(b.sceneView.animation=null,b.initPitch=b._getPitch(),b.initHeading=b._getHeading(),b.initX=b.camera.position.x,b.initY=b.camera.position.y,b.initZ=b.camera.position.z):1>=d.touchPoints.length?(d=b._getAngleRate(),c=b.initPitch-c/d,b._setHeading(b.initHeading-
a/d),b._setPitch(c)):(a=new THREE.Vector3(-a/200,c/200,0),a.applyEuler(b.camera.rotation),b.initLeft=a,b.camera.position.x=b.initX+b.initLeft.x+b.pinchVecX,b.camera.position.y=b.initY+b.initLeft.y+b.pinchVecY,b.camera.position.z=b.initZ+b.initLeft.z+b.pinchVecZ);b.sceneView.requestDraw();return!0};a.gestureDetectors.push(d);d=new x;d.callback=function(a,c){b._fly(-a,-c)};d.cancelCallback=function(){b.sceneView.onCameraLocationChanged()};a.gestureDetectors.push(d)},_getAngleRate:function(){return 256},
_calculate:function(){var a=this;$.each(a.sceneView.subViews,function(c,b){var d=new THREE.Raycaster,e=new THREE.Vector2;e.x=b.translateX/window.innerWidth*2-1;e.y=2*-(b.translateY/window.innerHeight)+1;d.setFromCamera(e,a.camera);if(0<a.sceneView.scene.children.length){for(var e=[],f=0;f<a.sceneView.scene.children.length;f++)0==f?a.sceneView.scene.children[f].children[0]&&e.push(a.sceneView.scene.children[f].children[0].children[0]):e.push(a.sceneView.scene.children[f]);d=d.intersectObjects(e);0>=
d.length||(d[0].object==b.cube?b.visible||b.setVisible("true"):b.visible&&b.setVisible("false"))}})},_fly:function(a,c){var b=this._getAngleRate(),d=Math.abs(a)/5E-4,e=-(2.5E-4*d*d*(0<a?1:-1))/b,f=Math.abs(c)/5E-4,g=2.5E-4*f*f*(0<c?1:-1)/b,b=new z(2),d=d>f?d:f,f=this._getPitch(),g=f+g;g>Math.PI?g=Math.PI:0>g&&(g=0);var h=new A(this);h.fromHeading=this._getHeading();h.toHeading=h.fromHeading-e;h.fromPitch=f;h.toPitch=g;h.duration=d;h.timeInterplator=b;h.callback=function(){};this.sceneView.startAnimation(h)},
_apply:function(){this.camera.rotation.z=1*Math.PI+this.rotation.z;this.camera.rotation.x=2*Math.PI-this.rotation.x},_culCameraPosition:function(a){var c=new THREE.Vector3(0,0,-this.distance);c.applyEuler(this.rotation);c.x+=a.x;c.y+=a.y;c.z+=a.z;return c},setCameraPosition:function(a,c,b){this.camera.position.set(a,c,b);this.camera.updateProjectionMatrix();this.sceneView.requestDraw()},_updateDefaultDistance:function(a){this.distance=a;this._apply()},_setHeading:function(a){this.rotation.z=a;this._apply();
this.sceneView.requestDraw();if(null!=this.sceneView.onHeadingChangeCallback)this.sceneView.onHeadingChangeCallback()},_setPitch:function(a){this.rotation.x=a;this._apply();this.sceneView.requestDraw();if(null!=this.sceneView.onPitchChangeCallback)this.sceneView.onPitchChangeCallback()},_getHeading:function(){return this.rotation.z},_getPitch:function(){return this.rotation.x}}),C=k.extend({init:function(a,c){k.prototype.init.apply(this,arguments);this.sceneView=a;this.camera=c;this.distance=20;this.maxDistance=
2*this.distance;this.minDistance=this.distance/4;this.rotation=new THREE.Euler;this.rotation.order="ZXY";this.rotation.z=.25*Math.PI;var b=this,d=new w;d.callback=function(a,c,d){0==d.state?(log("stop animation..."),b.sceneView.startAnimation(null),b.initPitch=b._getPitch(),b.initHeading=b._getHeading(),b.sceneView._userControllBegin()):(d=b._getAngleRate(),c=b.initPitch+c/d,b._setHeading(b.initHeading-a/d),b._setPitch(c));b.sceneView.requestDraw();return!0};a.gestureDetectors.push(d);d=new x;d.callback=
function(a,c){b._fly(-a,c)};a.gestureDetectors.push(d);d=new y;d.callback=function(a,c){c?b.initDistance=b._getDistance():b._setDistance(b.initDistance/a)};a.gestureDetectors.push(d)},_getAngleRate:function(){return 64*this.maxDistance/this.distance},_updateDefaultDistance:function(a){this.distance=1.6*a;this.maxDistance=2*this.distance;this.minDistance=this.distance/4;this._apply()},_getDistance:function(){return this.distance},_setDistance:function(a){var c=0;this.distance=c=a<this.minDistance?
this.minDistance:a>this.maxDistance?this.maxDistance:a;this._apply()},_calculate:function(){var a=this;$.each(a.sceneView.subViews,function(c,b){var d=new THREE.Raycaster,e=new THREE.Vector2;e.x=b.translateX/window.innerWidth*2-1;e.y=2*-(b.translateY/window.innerHeight)+1;d.setFromCamera(e,a.camera);if(0<a.sceneView.scene.children.length){for(var e=[],f=0;f<a.sceneView.scene.children.length;f++)if(0==f){if(a.sceneView.scene.children[f].children)for(var g=0;g<a.sceneView.scene.children[f].children.length;g++)e.push(a.sceneView.scene.children[f].children[g].children[0])}else e.push(a.sceneView.scene.children[f]);
d=d.intersectObjects(e);0>=d.length||(d[0].object==b.cube?b.visible||b.setVisible("true"):b.visible&&b.setVisible("false"))}})},_fly:function(a,c){var b=this._getAngleRate(),d=this,e=Math.abs(a)/5E-4,f=-(2.5E-4*e*e*(0<a?1:-1))/b,g=Math.abs(c)/5E-4,h=2.5E-4*g*g*(0<c?1:-1)/b,b=new z(2),e=e>g?e:g,g=this._getPitch(),h=g+h;h>Math.PI?h=Math.PI:0>h&&(h=0);var l=new A(this);l.fromHeading=this._getHeading();l.toHeading=l.fromHeading-f;l.fromPitch=g;l.toPitch=h;l.duration=e;l.timeInterplator=b;l.callback=function(){d.sceneView._userControllEnd()};
this.sceneView.startAnimation(l)},_apply:function(){var a=this.sceneView.lookatLocation;null==a&&(a=new THREE.Vector3(0,0,0));var c=this._culCameraPosition(a);this.camera.position.x=c.x;this.camera.position.y=c.y;this.camera.position.z=c.z;if(null!=this.sceneView.lookatLocation){a=new THREE.Matrix4;a.lookAt(c,this.sceneView.lookatLocation,new THREE.Vector3(0,0,1));if(null!=this.sceneView.lookAnchor){var b=this.sceneView.frame.height/2/Math.tan(this.sceneView.fov*Math.PI/360),c=Math.atan((this.sceneView.frame.height*
this.sceneView.lookAnchor.y-this.sceneView.frame.height/2)/b),b=Math.atan((this.sceneView.frame.width*this.sceneView.lookAnchor.x-this.sceneView.frame.width/2)/b);a.multiply((new THREE.Matrix4).makeRotationX(c));a.multiply((new THREE.Matrix4).makeRotationY(b))}this.camera.rotation.setFromRotationMatrix(a)}else this.camera.rotation.z=Math.PI+this.rotation.z,this.camera.rotation.x=Math.PI-this.rotation.x},_culCameraPosition:function(a){var c=new THREE.Vector3(0,0,-1*this.distance);c.applyEuler(this.rotation);
c.x+=a.x;c.y+=a.y;c.z+=a.z;return c},_setHeading:function(a){this.rotation.z=a;this._apply();this.sceneView.requestDraw();if(null!=this.sceneView.onHeadingChangeCallback)this.sceneView.onHeadingChangeCallback()},_setPitch:function(a){var c=.99*Math.PI,b=.01*Math.PI;a>=c&&(a=c);a<=b&&(a=b);this.rotation.x=a;this._apply();this.sceneView.requestDraw();if(null!=this.sceneView.onPitchChangeCallback)this.sceneView.onPitchChangeCallback()},_getHeading:function(){return this.rotation.z},_getPitch:function(){return this.rotation.x}}),
n=k.extend({init:function(a){this.modelSrc=a},getObjUrl:function(a,c,b,d){},getMtlUrl:function(a,c,b,d){},getIndexUrl:function(a){}}),F=n.extend({init:function(){n.prototype.init.apply(this,arguments);this.modelName=this._getModelNameFromUrl();this.version=0},getObjUrl:function(a,c,b,d){return this.modelSrc+"/"+a+"/"+c+"_"+b+"_"+d+"/"+this.modelName+a+"_"+c+"_"+b+"_"+d+".obj"},getMtlUrl:function(a,c,b,d){return this.modelSrc+"/"+a+"/"+c+"_"+b+"_"+d+"/"+this.modelName+a+"_"+c+"_"+b+"_"+d+".mtl"},getIndexUrl:function(a){return this.modelSrc+
"/"+a+"/index.json"},_getModelNameFromUrl:function(){var a=this.modelSrc.lastIndexOf("/");return this.modelSrc.substring(a+1)}}),G=n.extend({init:function(){n.prototype.init.apply(this,arguments);this.version=1},getObjUrl:function(a,c,b,d){return this.modelSrc+"/"+a+"_"+c+"_"+b+"_"+d+".obj"},getMtlUrl:function(a,c,b,d){return this.modelSrc+"/"+a+"_"+c+"_"+b+"_"+d+".mtl"},getIndexUrl:function(a){return this.modelSrc+"/"+a+".index"}}),H=n.extend({init:function(){n.prototype.init.apply(this,arguments);
this.version=2},getObjUrl:function(a,c,b,d){return this.modelSrc+"/"+a+"/"+c+"_"+b+"_"+d+".obj.drc"},getMtlUrl:function(a,c,b,d){return this.modelSrc+"/"+a+"/"+c+"_"+b+"_"+d+".mtl"},getIndexUrl:function(a){return this.modelSrc+"/"+a+"/index.json"}}),I=n.extend({init:function(){n.prototype.init.apply(this,arguments);this.version=3},getObjUrl:function(a,c,b,d,e){return this.modelSrc+"/"+a+"/"+e+".o"},getMtlUrl:function(a,c,b,d,e){return this.modelSrc+"/"+a+"/"+e+".m"},getIndexUrl:function(a){return this.modelSrc+
"/"+a+"/index"}});k.extend("com.vizengine.view.ModelSparse",{init:function(){this.rootObject=new THREE.Object3D;this.boxiesIndex={};this.boxies=[];this.modelSrc=null;this.isInSide=!1;this.modelId=this.formatVersion=this.formatProvider=this.bound=null;this._splitRate=.6;this.bound=new t},setModelSrc:function(a,c){this.clear();this.modelSrc=a;var b=this;this._loadMeta(function(){if(b.isInSide){var a=b.bound.getCenter(),e=new THREE.Matrix4;e.makeTranslation(-a.x,-a.y,-a.z);a=new THREE.Matrix4;a.makeRotationX(-.8*
Math.PI/2);var f=new THREE.Matrix4;f.multiply(a);f.multiply(e);b.rootObject.applyMatrix(f)}b.onCameraLocationChanged();c&&c.call(b)})},_loadMeta:function(a){var c=this;loadResource(this.modelSrc+"/meta.json",function(b){b=JSON.parse(b);var d=null!=b.version?b.version:0;switch(d){case 0:c.formatProvider=new F(c.modelSrc);break;case 1:c.formatProvider=new G(c.modelSrc);break;case 2:c.formatProvider=new H(c.modelSrc);break;case 3:c.formatProvider=new I(c.modelSrc);break;default:alert("\u4e0d\u652f\u6301\u5f53\u524d\u6570\u636e\u683c\u5f0f\uff0c\u8bf7\u68c0\u67e5\u5f15\u64ce\u662f\u5426\u4e3a\u6700\u65b0\u7248\u672c!!");
return}c.formatVersion=d;null!=b.id&&(c.modelId=b.id);var e=new THREE.Vector3(b.bound[0],b.bound[1],b.bound[2]),f=new THREE.Vector3(b.bound[3],b.bound[4],b.bound[5]),g=b.levelnum;-1!=c.model3dView.levelCount&&c.model3dView.levelCount<g&&(g=c.model3dView.levelCount);c.bound.min=e;c.bound.max=f;3<=c.formatVersion?c._loadKey(function(){c._loadIndex(function(){a()},g,e,f)}):c._loadIndex(function(){a()},g,e,f)})},_loadKey:function(a){var c=this,b=["appId=test001","appSecret=secret_test001"];b[2]="id="+
this.modelId;b[3]="timestamp=1490175427373";b.sort();var d=b.join("&"),d=com.vizengine.Global.md5(d);b.splice(1,1);var b=b.join("&"),e="http://vbr3d.visualbusiness.cn/vbr3d-model-http-api/model/secret?"+b+"&signature="+d;0<=this.modelSrc.indexOf("http://test-")&&(e="http://test-vbr3d.visualbusiness.cn/vbr3d-model-http-api/model/secret?"+b+"&signature="+d);u(e,function(b){b=v(b,"secret_test001");b=JSON.parse(b);if(0!=parseInt(b.code))alert("\u65e0\u6cd5\u89e3\u5bc6\u6587\u4ef6,\u539f\u56e0:"+b.msg);
else{b=com.vizengine.Global.base64Decode(b.data);var d=parseInt(b.substring(0,2),16),e=parseInt(b.substring(2,4),16);c.key=b.substring(d+4,b.length-e);a()}},"POST")},_loadIndexData:function(a,c){var b=this,d=this.formatProvider.getIndexUrl(a);3>this.formatProvider.version?loadResource(d,function(a){c(a)}):u(d,function(a){a=v(a,b.key);c(a)})},_loadIndex:function(a,c,b,d){var e=0,f=this,g=function(){if(e>=c)a();else{var h=e;f._loadIndexData(e,function(a){0==h&&log(a);a=JSON.parse(a);for(var c in a){var e=
c.split("_"),k=h,m=0,n=0,p=0;3<e.length?(m=parseInt(e[1]),n=parseInt(e[2]),p=parseInt(e[3])):(m=parseInt(e[0]),n=parseInt(e[1]),p=parseInt(e[2]));var r=e=Math.pow(2,0==k?1:k),t=e,q=new E;q.key=f.key;q.modelView=f;q.index.level=k;q.index.x=m;q.index.y=n;q.index.z=p;"string"==typeof a[c]&&(q.fileId=a[c].split(",")[0]);q.bound.min=new THREE.Vector3(b.x+(d.x-b.x)*m/e,b.y+(d.y-b.y)*n/r,b.z+(d.z-b.z)*p/t);q.bound.max=new THREE.Vector3(b.x+(d.x-b.x)*(m+1)/e,b.y+(d.y-b.y)*(n+1)/r,b.z+(d.z-b.z)*(p+1)/t);f.boxies.push(q);
f.boxiesIndex[q.getIndexPath()]=q}g()});e++}};g()},onCameraLocationChanged:function(){this._updateBoxies()},_updateBoxies:function(){var a=null,c=0;a:for(;2>c;c++)for(var b=0;2>b;b++)for(var d=0;2>d;d++){var e=this.boxiesIndex["0/"+c+"_"+b+"_"+d];if(null!=e){a=e;break a}}var f={},g=this;a.walkBrotherIndex(function(a){g._updateBox(g.boxiesIndex[a.getPath()],f);return!0});this._loadBoxies(f)},_loadBoxies:function(a){if(null!=this.loadingBoxies)for(var c in this.loadingBoxies)null==a[c]&&this._removeBox(this.loadingBoxies[c]);
this.loadingBoxies=a;var b=this;this.loadingArray=[];for(c in this.loadingBoxies)this.loadingArray.push(this.loadingBoxies[c]);this.loadingArray.sort(function(a,c){return a.bound.getCenter().distanceTo(b.camera.position)-c.bound.getCenter().distanceTo(b.camera.position)});for(c=0;c<this.loadingArray.length;c++)if(a=this.loadingArray[c],!(0<a.loadState)){a.load(function(){""!=b.modelSrc&&(b.rootObject.add(this.object),b.onCameraLocationChanged(),b.model3dView.requestDraw())});break}},_updateBox:function(a,
c){if(null!=a){var b=a.bound.getCenter().distanceTo(this.camera.position);if(a.bound.getRadius()/b/(2*Math.tan(this.fov*Math.PI/360))>this._splitRate){var d=this,e=!1;a.walkChildrenIndex(function(a){e=!0;d._updateBox(d.boxiesIndex[a.getPath()],c);return!0});e?this._removeBox(a):c[a.index.getPath()]=a;d=null}else c[a.index.getPath()]=a}},_removeBox:function(a){null!=a.object&&(this.rootObject.remove(a.object),this._releaseObject3d(a.object),this.boxiesIndex[a.index.getPath()].reset())},_releaseObject3d:function(a){null!=
a.material&&(null!=a.material.map&&a.material.map.dispose(),a.material.dispose());null!=a.geometry&&a.geometry.dispose();for(var c=0;c<a.children.length;c++)this._releaseObject3d(a.children[c])},clear:function(){for(var a=0;a<this.boxies.length;a++)this._removeBox(this.boxies[a]);this.boxies.length=0;this.modelSrc=""}});var D=com.vizengine.view.ModelSparse,J=0;m.extend("com.vizengine.view.Model3DView",{init:function(){m.prototype.init.apply(this,arguments);this.firstLoad=!0;this.isInSide=!1;this.levelCount=
-1;this.onModelLoadedCallback=null;this.bound=new t;this.lookatLocation=null;this.boxies=[];this.baseUrl="http://cdn.visualbusiness.cn/3d/m/";this.modelId=this.modelSrc=this.formatProvider=null;this.mid="model"+J++;this.boxiesIndex=new k;this._backgroundColor=this._gestureController=null;this.debugEnable=this.loading=this._dirty=!1;this.autoplayLoopTime=11E4;this._splitRate=.6;this.onModelStilledCallback=this.onPitchChangeCallback=this.onHeadingChangeCallback=null;this.userControlling=!1;this.defaultDistanceRate=
.5;this.lookAnchor={x:.5,y:.5};this.setViewMode(!1);this.sparses=[]},_userControllBegin:function(){this.userControlling=!0},setLevelCount:function(a){this.levelCount=a},_userControllEnd:function(){this.userControlling=!1;this.lastControlEndTime=(new Date).getTime();if(null!=this.onModelStilledCallback)this.onModelStilledCallback();if(null!=this.autoplayAnimation){var a=this;setTimeout(function(){4900>(new Date).getTime()-a.lastControlEndTime||a.setAutoplayEnable(a.autoplayEnable)},5E3)}this.onCameraLocationChanged()},
setBackgroundColor:function(a){this._backgroundColor=a;this.renderer.setClearColor(a,1)},requestDraw:function(){if(!this._dirty){this._dirty=!0;var a=this;setTimeout(function(){a._dirty=!1;a.onDraw();a=null},0)}},startAnimation:function(){var a=m.prototype.startAnimation.apply(this,arguments);log("ID:"+this.mid+" start Animation:"+arguments[0]);return a},_createNativeView:function(){var a=m.prototype._createNativeView.apply(this,arguments),c=document.createElement("div");c.style.position="absolute";
var b=new THREE.WebGLRenderer;b.setPixelRatio(window.devicePixelRatio);b.setClearColor(16777215,1);this.scene=new THREE.Scene;this.rootObject=new THREE.Object3D;this.scene.add(this.rootObject);this.fov=45;this.camera=new THREE.PerspectiveCamera(this.fov,window.innerWidth/window.innerHeight,.01,1E3);this.camera.position.x=0;this.camera.position.y=0;this.camera.position.z=0;this.camera.rotation.order="ZXY";this.scene.add(this.camera);this.renderer=b;this.backgroundTexture=b=new THREE.Texture;b=new THREE.Mesh(new THREE.PlaneGeometry(2,
2,0),new THREE.MeshBasicMaterial({map:b}));b.material.depthTest=!1;b.material.depthWrite=!1;var d=new THREE.Scene,e=new THREE.Camera;d.add(e);d.add(b);this.backgroundScene=d;this.backgroundCamera=e;b=new THREE.DirectionalLight(4210752);b.position.set(1,0,1).normalize();this.scene.add(b);b=new THREE.AmbientLight(16777215);this.scene.add(b);c.appendChild(this.renderer.domElement);a.div=c;return a},setBackgroundTexture:function(a){var c=this,b=new THREE.TextureLoader;b.crossOrigin="*";b.load(a,function(a){c.backgroundTexture.image=
a.image;c.backgroundTexture.needsUpdate=!0},function(a){console.log(a.loaded/a.total*100+"% loaded")},function(a){console.log("An error happened")})},dispatchLayout:function(){m.prototype.dispatchLayout.apply(this,arguments);this.camera.aspect=this.frame.width/this.frame.height;this.camera.updateProjectionMatrix();this.renderer.setSize(this.frame.width,this.frame.height);this.renderer.setViewport(0,0,this.frame.width,this.frame.height);this._gestureController._apply();this.requestDraw()},setViewMode:function(a){this.isInSide=
m.parseBoolean(a);this.gestureDetectors.length=0;this._gestureController=this.isInSide?new B(this,this.camera):new C(this,this.camera)},getViewMode:function(){return this.isInSide},setHeading:function(a,c){null==c&&(c=!0);this.heading=a;a=parseFloat(a);a=a/180*-1*Math.PI;this._gestureController._setHeading(a);c&&this.autoplayEnable&&this.setAutoplayEnable(!0)},setPitch:function(a){this.pitch=a;a=-parseFloat(a);a=Math.PI*(90-a)/180;this._gestureController._setPitch(a)},getHeading:function(){return-180*
this._gestureController._getHeading()/Math.PI},getPitch:function(){return 180*this._gestureController._getPitch()/Math.PI-90},setDebugEnable:function(a){this.debugEnable=m.parseBoolean(a)},onDraw:function(){this._updateOutAnnotations();this.renderer.autoClear=!1;this.renderer.clear(!0);null==this._backgroundColor&&this.renderer.render(this.backgroundScene,this.backgroundCamera);this.renderer.render(this.scene,this.camera)},_updateInAnnotations:function(){for(var a in this.subViews){var c=this.subViews[a],
b=new THREE.Vector3(c.locationX,c.locationY,c.locationZ);b.applyMatrix4(this.camera.matrixWorldInverse);c.setVisible(0>b.z);b.applyMatrix4(this.camera.projectionMatrix);var d=this.frame.height/2-b.y*this.frame.height/2;c.setTranslateX(b.x*this.frame.width/2+this.frame.width/2-c.panoAnchorX*c.frame.width);c.setTranslateY(d-c.panoAnchorY*c.frame.height);c.setAnchorX(c.panoAnchorX);c.setAnchorY(c.panoAnchorY)}},_updateOutAnnotations:function(){for(var a in this.subViews){var c=this.subViews[a],b=new THREE.Vector3(c.locationX,
c.locationY,c.locationZ);b.applyMatrix4(this.camera.matrixWorldInverse);b.applyMatrix4(this.camera.projectionMatrix);var d=this.frame.height/2-b.y*this.frame.height/2;c.setTranslateX(b.x*this.frame.width/2+this.frame.width/2-c.anchorX*c.frame.width);c.setTranslateY(d-c.anchorY*c.frame.height)}},setCenter:function(a){this.center=a;this.isInSide||this._gestureController._apply()},setLookatLocation:function(a){this.lookatLocation=a;this._gestureController._apply();this.requestDraw()},setLookAnchor:function(a){this.lookAnchor=
a;this._gestureController._apply();this.requestDraw()},setDefaultDistanceRate:function(a){this.defaultDistanceRate=a;null!=this.bound&&(a=this.bound.min.distanceTo(this.bound.max),a*=this.defaultDistanceRate,null!=this._gestureController&&this._gestureController._updateDefaultDistance(a))},raycast:function(a,c){var b=new THREE.Raycaster,d=new THREE.Vector2;d.x=a/window.innerWidth*2-1;d.y=2*-(c/window.innerHeight)+1;b.setFromCamera(d,this.camera);if(0<this.scene.children.length){for(var d=[],e=0;e<
this.boxies.length;e++){var f=this.boxies[e].object;null!=f&&d.push(f)}b=b.intersectObjects(d,!0);return 0>=b.length?null:b[0].point}return null},setAutoplayLoopTime:function(a){this.autoplayLoopTime=m.parseFloat(a);this.setAutoplayEnable(this.autoplayEnable)},setAutoplayEnable:function(a){(this.autoplayEnable=m.parseBoolean(a))?(this.autoplayAnimation=new p,this.autoplayAnimation.duration=this.autoplayLoopTime,this.autoplayAnimation.startHeading=this.getHeading(),this.autoplayAnimation.repeatCount=
0,this.autoplayAnimation.animateFrame=function(a,b){a.setHeading(this.startHeading-360*b,!1)},this.userControlling||this.startAnimation(this.autoplayAnimation)):this.animation==this.autoplayAnimation&&(this.startAnimation(null),this.autoplayAnimation=null)},_loadMeta:function(a){var c=this;loadResource(this.modelSrc+"/meta.json",function(b){if(b=JSON.parse(b))if(b.sparse)for(var d in b.sparse)c._createSparse(d,function(){c.onCameraLocationChanged()});else d=new D,d.model3dView=c,d.camera=c.camera,
c.sparses.push(d),c.rootObject.add(d.rootObject),d.setModelSrc(c.modelSrc,function(){c.onCameraLocationChanged()});d=new THREE.Vector3(b.bound[0],b.bound[1],b.bound[2]);var e=new THREE.Vector3(b.bound[3],b.bound[4],b.bound[5]);c.bound.min=d;c.bound.max=e;c.setDefaultDistanceRate(.6);c.lookAnchor=null!=b.pose&&null!=b.pose.lookAnchor?b.pose.lookAnchor:{x:.5,y:.5};c.lookatLocation=null!=b.pose&&null!=b.pose.lookatLocation?b.pose.lookatLocation:c.bound.getCenter();c.rootObject.matrixAutoUpdate=!1;c.rootObject.matrix=
new THREE.Matrix4;null!=b.pose&&null!=b.pose.matrix&&(c.rootObject.matrix.elements=b.pose.matrix);if(c.isInSide){b=null!=c.heading?c.heading:0;var f=null!=c.pitch?c.pitch:0;c._gestureController||(c._gestureController=new B(c,c.camera))}else b=null!=c.heading?c.heading:0,f=null!=c.pitch?c.pitch:0,d=d.distanceTo(e),null!=c.defaultDistanceRate&&(d*=c.defaultDistanceRate),c._gestureController||(c._gestureController=new C(c,c.camera)),c._gestureController._updateDefaultDistance(d),c.camera.position.set(c.bound.getCenter().x,
c.bound.getCenter.y,c.bound.getCenter().z);c.setHeading(b);c.setPitch(f);a&&a.call(c)})},_createSparse:function(a,c){var b=new D;b.model3dView=this;b.camera=this.camera;this.sparses.push(b);this.rootObject.add(b.rootObject);b.setModelSrc(this.modelSrc+"/"+a,c)},setModelSrc:function(a,c){this.clear();this.modelSrc=a;this._loadMeta(c)},clear:function(){for(var a=0;a<this.sparses.length;a++)this.sparses[a].clear();this.sparses.length=0},setModelId:function(a){this.setModelSrc(this.baseUrl+a)},setBaseUrl:function(a){this.baseUrl=
a},getBaseUrl:function(){return this.baseUrl},onCameraLocationChanged:function(){for(var a=0;a<this.sparses.length;a++)this.sparses[a].onCameraLocationChanged()}})});
]]></res>
	<res path="./libs/vizengine_pano.js"><![CDATA[module("/libs/vizengine_location.js","/libs/vizengine_engine3d.js","/libs/vizengine_engine3d_webgl.js","/libs/vizengine_engine3d_css3d.js",function(){var p=com.vizengine.core.Object,k=com.vizengine.view.View,v=com.vizengine.gesture.PanGestureDetector,w=com.vizengine.gesture.SweepGestureDetector,x=com.vizengine.gesture.PinchGestureDetector,l=com.vizengine.animation.Animation,n=com.vizengine.animation.DecelerateInterpolator;if(com.vizengine.core.Platform.vizengineMobile)k.extend("com.vizengine.view.PanoView",
{setMarkerDragEnable:function(a){},isMarkerDragEnabled:function(){},setMarkerDragCallback:function(a){},setHDEnable:function(a){},setOnScaleCallback:function(a){},setOnFovChangeCallback:function(a){},isHDEnabled:function(){},setFov:function(a){},getFov:function(){},setZoom:function(a){},getZoom:function(){},_snapshot:function(){},getSnapshotDiv:function(){},isVREnabled:function(){},setVREnable:function(a){},setPanoId:function(a,b,c){},getPanoId:function(){},setAutoplayLoopTime:function(a){},setAutoplayEnable:function(a){},
isAutoplayEnabled:function(){},autoPlay:function(){},stopAutoPlay:function(){},setGravityEnable:function(a){},isGravityEnabled:function(){},isTrackingDevice:function(){},trackingDevice:function(){},stopTrackingDevice:function(){},setHeading:function(a){},setPitch:function(a){},setRoll:function(a){},getHeading:function(){},getPitch:function(){},getRoll:function(){}});else{l.extend("com.vizengine.animation.PanoAnimation",{init:function(){l.prototype.init.apply(this,arguments);this.toRoll=this.toPitch=
this.toHeading=this.fromFov=this.fromRoll=this.fromPitch=this.fromHeading=0;this.enableFov=this.enableRoll=this.enablePitch=this.enableHeading=!1},animateFrame:function(a,b){this.enableHeading&&a.panoViewInternal.setHeading(this.fromHeading+(this.toHeading-this.fromHeading)*b);this.enablePitch&&a.panoViewInternal.setPitch(this.fromPitch+(this.toPitch-this.fromPitch)*b);this.enableRoll&&a.panoViewInternal.setRoll(this.fromRoll+(this.toRoll-this.fromRoll)*b);this.enableFov&&a.panoViewInternal._setFov(this.fromFov+
(this.toFov-this.fromFov)*b)}});l.extend("com.vizengine.animation.PanoFlyAnimation",{init:function(){l.prototype.init.apply(this,arguments);this.toRoll=this.toPitch=this.toHeading=this.fromRoll=this.fromPitch=this.fromHeading=0;this.enablePitch=this.enableHeading=!0;this.enableRoll=!1},animateFrame:function(a,b){this.enableHeading&&a._setHeading(this.fromHeading+(this.toHeading-this.fromHeading)*b);this.enablePitch&&a._setPitch(this.fromPitch+(this.toPitch-this.fromPitch)*b);this.enableRoll&&a._setRoll(this.fromRoll+
(this.toRoll-this.fromRoll)*b)}});var r=com.vizengine.animation.PanoFlyAnimation;l.extend("com.vizengine.animation.PanoScaleAnimation",{init:function(){l.prototype.init.apply(this,arguments);this.toFov=this.fromFov=0},animateFrame:function(a,b){a._scaleCamera(this.fromFov+(this.toFov-this.fromFov)*b)}});var t=com.vizengine.animation.PanoScaleAnimation,y=new function(){this.taskQueue=[];this.addTask=function(a){this.taskQueue.push(a);this.processTask()};this.runningTaskCount=0;this.maxTaskCount=2;
this.processTask=function(){if(0!=this.taskQueue.length&&!(this.runningTaskCount>=this.maxTaskCount)){var a=this;this.runningTaskCount++;this.taskQueue.shift()(function(){a.runningTaskCount--;a.processTask()})}}},u=function(a,b,c){y.addTask(function(d){var e=new Image;e.crossOrigin="*";e.onload=function(){b(e);d();e=null};e.onerror=function(){null!=c&&c(null);d();e=null};a=(window.__pano__proxy||window.__vizengine__proxy||"")+a;e.src=a})};p.extend("BoxPanoTileLoader",{init:function(a,b,c,d){p.prototype.init.apply(this,
arguments);this.boxPano=a;this.level=b;this.column=c;this.row=d;this.textureLoadCallback=null;this.loadState=0;this.mcRow=this.boxPano._mcRow;this.position=new THREE.Vector3;this._setTilePosition(this.position);this.texture=this.material=this.geometry=null},_getTilePath:function(){return""+this.level+"/"+this.column+"_"+this.row},_generateTileUrl:function(){return this.boxPano.urlProvider(this.boxPano.panoView.panoId,this.level,this.row,this.column)},_getFaceId:function(){return Math.floor(this.column/
this._getFaceRowCount())},_getFaceRowCount:function(){return-1==this.level?Math.pow(2,this.level+1):Math.pow(2,this.level)*this.mcRow},_getFaceWidth:function(){return 400-2*this.level},_getCellWidth:function(){return this._getFaceWidth()/this._getFaceRowCount()},_getCellX:function(){var a=this._getFaceRowCount(),b=this._getFaceId();return this.column-a*b},_getCellY:function(){return this.row},_setTilePosition:function(a){var b=this._getFaceWidth(),c=this._getCellWidth(),d=this._getFaceId(),e=this._getCellX(),
f=this._getCellY();0==d?(a.x=-b/2+c/2+e*c,a.y=b/2,a.z=b/2-c/2-f*c):1==d?(a.x=b/2,a.y=b/2-c/2-e*c,a.z=b/2-c/2-f*c):2==d?(a.x=b/2-c/2-e*c,a.y=-b/2,a.z=b/2-c/2-f*c):3==d?(a.x=-b/2,a.y=-b/2+c/2+e*c,a.z=b/2-c/2-f*c):4==d?(a.x=-b/2+c/2+e*c,a.y=-b/2+c/2+f*c,a.z=b/2):5==d&&(a.x=-b/2+c/2+e*c,a.y=b/2-c/2-f*c,a.z=-b/2)},_setTileRotation:function(a){var b=this._getFaceId();0==b?a.x=Math.PI/2:1==b?(a.y=-Math.PI/2,a.z=-Math.PI/2):2==b?(a.x=-Math.PI/2,a.z=Math.PI):3==b?(a.y=Math.PI/2,a.z=Math.PI/2):4==b?a.x=Math.PI:
5==b&&(a.z=0)},_setFaceVertexUVS:function(a){if(!(0<=this.level)){var b=this._getFaceId();a[0][0][0].x=b/6;a[0][0][1].x=b/6;a[0][0][2].x=(b+1)/6;a[0][1][0].x=b/6;a[0][1][1].x=(b+1)/6;a[0][1][2].x=(b+1)/6}},_createMesh:function(a){var b=this;if(0==this.boxPano.panoView._renderType){var c=this._getCellWidth();this.texture=new THREE.Texture;this.texture.image=a;this.texture.needsUpdate=!0;this.material=new THREE.MeshBasicMaterial({map:this.texture});this.geometry=new THREE.PlaneGeometry(c,c,1);this.mesh=
new THREE.Mesh(this.geometry,this.material);this._setTilePosition(this.mesh.position);this._setTileRotation(this.mesh.rotation);this._setFaceVertexUVS(this.geometry.faceVertexUvs)}else this.mesh=new THREE.CSS3DObject(function(){var c=b._getCellWidth();if(0>b.level){var e=a,f=b._getFaceId(),g=document.createElement("canvas"),h=g.getContext("2d");g.width=c;g.height=c;h.drawImage(e,-f*c,0,6*c,c);a=g}else a=a.cloneNode(!0),a.width=c,a.height=c,a.style.width=c+"px",a.style.height=c+"px";return a}),this._setTilePosition(this.mesh.position),
this._setTileRotation(this.mesh.rotation);this.boxPano.rootObject.add(this.mesh)},setImage:function(a){this._createMesh(a);this.loadState=2;this.textureLoadCallback()},setImageWithoutCallback:function(a){this._createMesh(a);this.loadState=2},load:function(){var a=this;this.dispose();this.loadState=1;var b=this._generateTileUrl();u(b,function(b){0!=a.loadState&&(a.setImage(b),a=null)},function(){this.loadState=0})},dispose:function(){null!=this.boxPano&&null!=this.boxPano.rootObject&&null!=this.mesh&&
this.boxPano.rootObject.remove(this.mesh);null!=this.texture&&(this.texture.dispose(),this.texture=null);null!=this.material&&(this.material.dispose(),this.material=null);null!=this.geometry&&(this.geometry.dispose(),this.geometry=null);this.geometry=this.texture=this.material=this.mesh=null;this.loadState=0}});p.extend("BoxPano",{init:function(a){p.prototype.init.apply(this,arguments);this.panoId=null;this.panoView=a;this._tileLayerCount=1;this._maxVisibleTileCount=com.vizengine.core.Platform.mobile?
44:88;this._maxCacheTileCount=1536;this.urlProvider=function(a,c,d,e){0>c&&(e=d=0);if(a&&"[QQ]"==a.substring(0,4))return window.location.protocol+"//webapp.visualbusiness.cn/vizengine/v1.0.46/PanoViewer/TileProxy.jsp?panoId="+a+"&level="+c+"&column="+e+"&row="+d;var f=window.location.protocol+"//tiles.pano.visualbusiness.cn/";a&&"[TT]"==a.substring(0,4)&&(f=window.location.protocol+"//tilestest.pano.visualbusiness.cn/",a=a.substring(4));rootView&&rootView._interceptedPanotileUrl&&(f=rootView._interceptedPanotileUrl);
return-1>c?f+a+"/sv.xml":-1==c?f+a+"/cube/thumb.jpg":f+a+"/cube/"+c+"_"+d+"_"+e+".jpg"};this.tileLoaders=[];this._createObjects()},startCheck:function(){null==this.updater&&(this.updater={},this.contCheck())},contCheck:function(){if(null!=this.updater){this._checkAndLoadTiles();var a=this;setTimeout(function(){a.contCheck();a=null},3E3)}},stopCheck:function(){this.updater=null},_createObjects:function(){this.loader=new THREE.TextureLoader;this.loader.crossOrigin="*"},_createTileLoaders:function(){var a=
this,b=a._tileLayerCount;1>a._tileLayerCount&&(b=1);4<a._tileLayerCount&&(b=4);for(var c=-1;c<b;c++){var d=1;0<=c&&(d=Math.pow(2,c)*this._mcRow);for(var e=6*d,f=0;f<d;f++)for(var g=0;g<e;g++){var h=new BoxPanoTileLoader(this,c,g,f);h.textureLoadCallback=function(){a.textureLoadCallback();a._onTileLoaded()};h.loader=this.loader;h.index=c+"-"+g+"-"+f;this.tileLoaders.push(h)}}},_checkAndLoadTiles:function(){this.panoView._userControlling||(this._updateTileLoaderSeq(),this._loadMoreTiles())},_updateTileLoaderSeq:function(){var a=
new THREE.Vector3(0,0,-300),b=this.panoView.camera.rotation;null!=b&&a.applyEuler(b);var c=this.panoView._getCurrentSuitableLayer();this.tileLoaders.sort(function(b,e){var f=0>b.level;if(f!=0>e.level)return f?-1:1;f=b.level<=c;if(f!=e.level<=c)return f?-1:1;if(!f&&b.level!=e.level)return b.level-e.level;var f=b.position.distanceTo(a),g=e.position.distanceTo(a);return f-g})},_onTileLoaded:function(){this._checkAndLoadTiles()},_loadMoreTiles:function(){for(var a=this.panoView._getSuitableLayer(this.panoView._fov),
b=0;b<this.tileLoaders.length;b++){var c=this.tileLoaders[b];if(b<this._maxVisibleTileCount){if(0==c.loadState){c.load();break}}else(b>this._maxCacheTileCount-1||c.level>a)&&c.dispose()}},_loadThumbImage:function(a){var b=this.urlProvider(this.panoId,-1,0,0);u(b,a,a)},setPanoId:function(a,b){this.panoId=a;var c=this;this._loadThumbImage(function(d){if(a!=c.panoId)b.call(c);else{c.panoView.dispose();c.panoView.cleanScene();c.rootObject=new THREE.Object3D;b.call(c);c._createTileLoaders();for(var e=
0;6>e;e++)c.tileLoaders[e].setImageWithoutCallback(d);c.panoView.requestDraw();c._onTileLoaded();c._onTileLoaded();c._onTileLoaded();c.startCheck()}})},notifyUserControllEnd:function(){this._checkAndLoadTiles()},dispose:function(){for(var a in this.tileLoaders)this.tileLoaders[a].dispose();this.tileLoaders.length=0;this.stopCheck()}});l.extend("com.vizengine.animation.PanoViewFadeAnimation",{animateFrame:function(a,b){a.snapDiv.style.opacity=1-b}});var z=com.vizengine.animation.PanoViewFadeAnimation;
l.extend("com.vizengine.animation.PanoViewAlphaAnimation",{animateFrame:function(a,b){a.snapDiv.style.opacity=1-b;$(a.snapDiv).css("filter","blur("+5*(1-b)+"px)")}});k.extend("com.vizengine.view.PanoViewInternal",{init:function(a){k.prototype.init.apply(this,arguments);this.scene=new THREE.Scene;this.panoId="";this.drag=this.hd=!1;this.onFovChangeCallback=this.onPitchChangeCallback=this.onHeadingChangeCallback=this.onUserTouchBeginCallback=this.onScaleCallBack=null;this._headingNorthDelta=0;this._dirty=
!1;this._fov=this._defaultFov=com.vizengine.core.Platform.mobile?100:80;this._currentTrans=this._defaultTrans=330;this._deviceOrientationCallback=null;this._trackingDeviceHeading=this._trackingBaseDeviceHeading=this._trackingBaseCameraHeading=0;this._autoPlaying=!1;this._autoPlayLoopTime=14E4;this._needUpdateAnnotations=!0;this._userControlling=!1;this.onMarkerDragCallback=null;this.panoGestureDetectors=[];this.patches=[];var b=this,c=!1,d=new v,e=null;d.callback=function(a,d,h){if(b.drag)if(0==h.state){b.startAnimation(null);
b.initPitch=b._getPitch();b.initHeading=b._getHeading();b._userControllBegin();c=!1;for(d=0;d<b.panoView.leftEye.subViews.length-1;d++){a=b.panoView.leftEye.subViews[d];var k=null==a.dragEnable||a.dragEnable,l=h,q=a.translateX+a.frame.x,m=a.translateY+a.frame.y,A=q+a.frame.width,p=m+a.frame.height,n=l.getX(),l=l.getY();if(n>q&&n<A&&l>m&&l<p&&a.visible&&k){c=!0;e=a;if(null!=b.onMarkerDragCallback)b.onMarkerDragCallback(e,0);break}}null!=e&&(b.deltaDragX=h.getX()-(e.translateX+e.frame.x),b.deltaDragY=
h.getY()-(e.translateY+e.frame.y))}else if(c){if(null!=e&&(k=h.getX()-b.deltaDragX+e.anchorX*e.frame.width,a=h.getY()-b.deltaDragY+e.anchorY*e.frame.height,d=b.frame.height/2/Math.tan(b._fov/180*Math.PI/2),k-=b.frame.width/2,q=a-b.frame.height/2,a=b.getHeading()+180*Math.atan(k/d)/Math.PI,d=b.getPitch()+180*Math.atan(q/d)/Math.PI,e.panoHeading=a,e.panoPitch=d,b.panoView._updateAnnotations()),2==h.state&&null!=b.onMarkerDragCallback)b.onMarkerDragCallback(e,1)}else a=b.initHeading+a/b._currentTrans,
d=b.initPitch+d/b._currentTrans,b._setHeading(a),b._setPitch(d);else 0==h.state?(b.startAnimation(null),b.initPitch=b._getPitch(),b.initHeading=b._getHeading(),b._userControllBegin()):(a=b.initHeading+a/b._currentTrans,d=b.initPitch+d/b._currentTrans,b._setHeading(a),b._setPitch(d));b.requestDraw();return!0};this.panoGestureDetectors.push(d);d=new w;d.callback=function(a,d){c||b._fly(a,d)};d.cancelCallback=function(){b._userControllEnd(!0)};this.panoGestureDetectors.push(d);d=new x;d.callback=function(a,
c){if(c)b.initFov=b._getFov();else if(b._scaleCamera(b.initFov/a),null!=b.onScaleCallBack)b.onScaleCallBack()};this.panoGestureDetectors.push(d);this.setVREnable(!1)},setMarkerDragEnable:function(a){this.drag=k.parseBoolean(a)},isMarkerDragEnabled:function(){return this.drag},setMarkerDragCallback:function(a){this.onMarkerDragCallback=a},setHDEnable:function(a){this.hd=k.parseBoolean(a)},setOnScaleCallback:function(a){this.onScaleCallBack=a},setOnFovChangeCallback:function(a){this.onFovChangeCallback=
a},isHDEnabled:function(){return this.hd},_checkIfTryWebgl:function(){return!0},_webglAvailable:function(){try{if(!this._checkIfTryWebgl())return!1;var a=document.createElement("canvas");return!(!window.WebGLRenderingContext||!a.getContext("webgl")&&!a.getContext("experimental-webgl"))}catch(b){return!1}},_createRender:function(){this._webglAvailable()?(this.leftRenderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0}),this.rightRenderer=new THREE.WebGLRenderer({preserveDrawingBuffer:!0}),this._renderType=
0):(this.leftRenderer=new THREE.CSS3DRenderer,this.rightRenderer=new THREE.CSS3DRenderer,this._renderType=1)},_createPanoModel:function(){this.pano=new BoxPano(this);var a=this;this.textureLoadCallback=function(){a.requestDraw()};this.pano.textureLoadCallback=this.textureLoadCallback},_createNativeView:function(){var a=k.prototype._createNativeView.apply(this,arguments);this._createPanoModel();var b=document.createElement("div");b.style.position="absolute";var c=new THREE.PerspectiveCamera(90,window.innerWidth/
window.innerHeight,1,1E3);c.position.x=0;c.position.y=0;c.position.z=0;c.rotation.order="ZXY";c.rotation.x=Math.PI/2;c.rotation.y=0;c.rotation.z=0;this._createRender();var d=this.leftRenderer,e=this.rightRenderer;null!=d.setPixelRatio&&d.setPixelRatio(window.devicePixelRatio);null!=e.setPixelRatio&&e.setPixelRatio(window.devicePixelRatio);d.setClearColor(16777215,1);e.setClearColor(16777215,1);this.loader=new THREE.TextureLoader;this.loader.crossOrigin="*";this.scene=null;this.camera=c;this.leftContainer=
document.createElement("div");this.leftContainer.style.position="absolute";this.rightContainer=document.createElement("div");this.rightContainer.style.position="absolute";this.snapDiv=document.createElement("div");this.snapDiv.id="snapshot";this.snapDiv.style.position="absolute";this.snapDiv.style.display="none";this.leftContainer.appendChild(this.leftRenderer.domElement);this.rightContainer.appendChild(this.rightRenderer.domElement);b.appendChild(this.leftContainer);b.appendChild(this.rightContainer);
b.appendChild(this.snapDiv);b.style.overflow="hidden";a.div=b;a.oldAddNativeView=a.addNativeView;a.addNativeView=function(a,b){this.oldAddNativeView(a,b+3)};a.oldRemoveNativeViewAt=a.removeNativeViewAt;a.removeNativeViewAt=function(a){this.oldRemoveNativeViewAt(a+3)};return a},_getFov:function(){return this._fov},_setFov:function(a){this._fov=a;this._setFovForCamera(this.camera,a);if(null!=this.onFovChangeCallback)this.onFovChangeCallback(this.getFov());this.requestDraw()},_setFovForCamera:function(a,
b){a.fov=b;a.updateProjectionMatrix()},setFov:function(a){var b=this._getDefaultFov()/a;this._currentTrans=this._defaultTrans*b;this._setFov(a)},getFov:function(){return this._getFov()},_getDefaultFov:function(){return this._defaultFov},log2:function(a){return Math.log(a)/Math.log(2)},_getSuitableFov:function(a){a/=1.5;0>a&&(a=0);var b=this._getDefaultFov()/360*Math.PI;return 720*Math.atan(Math.tan(b/2)/Math.pow(2,a))/Math.PI},_getSuitableLayer:function(a){var b=this._getDefaultFov()/360*Math.PI;
a=this.log2(Math.tan(b/2)/Math.tan(a/360*Math.PI/2));return 1.5*a},_getCurrentSuitableLayer:function(a){null==a&&(a=this._getFov());a=this._getSuitableLayer(a);a=Math.floor(a);0>a&&(a=0);a>this.pano._tileLayerCount-1&&(a=this.pano._tileLayerCount-1);return a},setZoom:function(a){a=this._getSuitableFov(a);this._setFov(a)},getZoom:function(){return this._getSuitableLayer(this._fov)},_scaleCamera:function(a){var b=this._getDefaultFov();a>b&&(a=b);var c=this._getSuitableFov(this.pano._tileLayerCount-
.5);a<c&&(a=c);this._currentTrans=b/a*this._defaultTrans;this._setFov(a)},_fly:function(a,b){var c=this,d=Math.abs(a)/.002,e=-(.001*d*d*(0<a?1:-1))/this._currentTrans,f=Math.abs(b)/.002,g=.001*f*f*(0<b?1:-1)/this._currentTrans,h=new n(2),d=d>f?d:f,f=this._getPitch(),g=f+g;g>Math.PI?g=Math.PI:0>g&&(g=0);var k=new r;k.fromHeading=this._getHeading();k.toHeading=k.fromHeading-e;k.fromPitch=f;k.toPitch=g;k.duration=d;k.callback=function(){c._userControllEnd(!0)};k.timeInterplator=h;this.startAnimation(k)},
_userControllBegin:function(){this._userControlling=!0;if(null!=this.onUserTouchBeginCallback)this.onUserTouchBeginCallback()},_userControllEnd:function(a){this._userControlling=!1;this._trackingBaseCameraHeading=this._getHeading();this._trackingBaseDeviceHeading=this._trackingDeviceHeading;this._autoPlaying&&a&&this.delayAutoplay(1);if(null!=this._deviceOrientationCallback){a=new n(2);var b=new r;b.enableHeading=!1;b.enableRoll=!0;b.timeInterplator=a;b.duration=800;b.fromPitch=this._getPitch();b.toPitch=
null!=this._trackingDevicePitch?this._trackingDevicePitch:b.fromPitch;b.fromRoll=this._getRoll();b.toRoll=null!=this._trackingDeviceRoll?this._trackingDeviceRoll:b.fromRoll;b.pulling=!0;this.startAnimation(b)}null!=this.pano&&this.pano.notifyUserControllEnd()},dispatchLayout:function(){k.prototype.dispatchLayout.apply(this,arguments);var a=this._getDefaultFov();this._fov>a&&(this._fov=a);this._setFov(this._fov);this.camera.near=1;this.camera.far=4E4;if(this.enableVR){this.camera.aspect=.5*this.frame.width/
this.frame.height;var a=this.frame.width/2,b=this.frame.height;this.leftContainer.style.width=a+"px";this.leftContainer.style.height=b+"px";this.rightContainer.style.left=a+"px";this.rightContainer.style.width=a+"px";this.rightContainer.style.height=b+"px";this.leftRenderer.setSize(this.frame.width/2,this.frame.height);this.rightRenderer.setSize(this.frame.width/2,this.frame.height);null!=this.leftRenderer.setViewport&&this.leftRenderer.setViewport(0,0,this.frame.width/2,this.frame.height);null!=
this.rightRenderer.setViewport&&this.rightRenderer.setViewport(0,0,this.frame.width/2,this.frame.height)}else this.camera.aspect=this.frame.width/this.frame.height,a=this.frame.width,b=this.frame.height,this.leftContainer.style.width=a+"px",this.leftContainer.style.height=b+"px",this.leftRenderer.setSize(this.frame.width,this.frame.height),null!=this.leftRenderer.setViewport&&this.leftRenderer.setViewport(0,0,this.frame.width,this.frame.height);this.camera.updateProjectionMatrix();this.onDraw()},
cloneCanvas:function(a){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=a.width;b.height=a.height;c.drawImage(a,0,0);return b},_snapshot:function(){if(0==this._renderType){var a=this.cloneCanvas(this.leftRenderer.domElement);this.snapDiv.style.width=this.frame.width+"px";this.snapDiv.style.height=this.frame.height+"px";var b=this.snapDiv.childNodes.length-1}else a=this._nativeView.div.childNodes[0].cloneNode(!0),this.snapDiv.style.width=this.frame.width+"px",this.snapDiv.style.height=
this.frame.height+"px",b=this.snapDiv.childNodes.length-1;for(;0<=b;b--)this.snapDiv.removeChild(this.snapDiv.childNodes[b]);this.snapDiv.appendChild(a);a.style.width=this.frame.width+"px";a.style.height=this.frame.height+"px";return a},getSnapshotDiv:function(){return this.snapDiv},onDraw:function(){null!=this.scene&&(this._dirty=!1,this.enableVR?(this.leftRenderer.render(this.scene,this.camera),this.rightRenderer.render(this.scene,this.camera)):this.leftRenderer.render(this.scene,this.camera))},
removePatch:function(a){a=this.patches.indexOf(a);0<=a&&null!=this.patches[a].mesh&&this.scene.remove(this.patches[a].mesh);this.patches.splice(a,1)},_updatePatches:function(){for(var a=0;a<this.patches.length;a++)this._updatePatch(this.patches[a])},_updatePatch:function(a){if(null!=a.mesh){var b=new THREE.Euler(Math.PI*(90-a.pitch)/180,0,(a.heading+this._headingNorthDelta)/180*-1*Math.PI,"ZXY"),c=new THREE.Vector3(0,0,-100);c.applyEuler(b);a.mesh.position.copy(c);a.mesh.rotation.copy(b)}},addPatch:function(a,
b,c,d,e){a=k.resolvePath(this.getContextPath(),a);var f={imageUrl:a,heading:b,pitch:c,width:d,height:e,mesh:null};this.patches.push(f);"http"!=a.substring(0,4)&&"//"!=a.substring(0,2)&&"data:"!=a.substring(0,5)&&(a=window.__app__baseurl+a);var g=this;b=new THREE.TextureLoader;b.crossOrigin="*";b.load(a,function(a){var b=a.image;if(!(0>g.patches.indexOf(f))){if(0==g._renderType){a=new THREE.Texture;a.image=b;a.needsUpdate=!0;a=new THREE.MeshBasicMaterial({map:a});a.transparent=!0;var c=200*Math.tan(f.width*
Math.PI/360),d=200*Math.tan(f.height*Math.PI/360),e=new THREE.PlaneGeometry(c,d,1);a=new THREE.Mesh(e,a)}else c=200*Math.tan(f.width*Math.PI/360),d=200*Math.tan(f.height*Math.PI/360),a=new THREE.CSS3DObject(function(){var a=b.cloneNode(!0);a.width=c;a.height=d;a.style.width=c+"px";a.style.height=d+"px";return a});f.mesh=a;g._updatePatch(f);g.scene.add(a)}},function(a){console.log(a.loaded/a.total*100+"% loaded")},function(a){console.log("An error happened")});return f},isVREnabled:function(){return this.enableVR},
setVREnable:function(a){a?(this.trackingDevice(),this.enableVR=!0,this.leftContainer.style.display="block",this.rightContainer.style.display="block"):(this.stopTrackingDevice(),this.enableVR=!1,this.leftContainer.style.display="block",this.rightContainer.style.display="none");this.requestLayout()},_loadMeta:function(a){var b=this.pano.urlProvider(this.panoId,-2);if(null==b)a();else{var c=this;c._headingNorthDelta=0;b=(window.__pano__proxy||window.__vizengine__proxy||"")+b;loadResource(b,function(b){b=
nativeParseXMLToJson(b);b=JSON.parse(b);var e=b.children[0].attributes.dir;null!=e&&(c._headingNorthDelta=parseFloat(e));e=b.children[0].attributes.mcln;b=b.children[0].attributes.mclevel0.split("*")[0];c.pano._mcRow=parseInt(b);c.pano._tileLayerCount=parseInt(e);c.applyLimitFov();c._updatePatches();a&&a()})}},applyLimitFov:function(){var a=this._getSuitableFov(this.pano._tileLayerCount-1);this._fov<a?this._scaleCamera(a):this._scaleCamera(this._fov)},isPatch:function(a){for(var b=0;b<this.patches.length;b++)if(a==
this.patches[b].mesh)return!0;return!1},cleanScene:function(){for(var a=0;a<this.scene.children.length;a++){var b=this.scene.children[this.scene.children.length-a-1];this.isPatch(b)||this.scene.remove(b)}},_isDisablePanoAnimation:function(){return 0<=navigator.userAgent.indexOf("HUAWEI NXT-UL00 BUILD")?!0:!1},setPanoId:function(a,b,c){if(a==this.panoId)b&&b.call(this);else{null==c||1==c?(c=new z,c.duration=600):c=null;this._isDisablePanoAnimation()&&(c=null);this.enableVR&&(c=null);this.startAnimation(null);
var d=this;null!=c&&(d._snapshot(),d.snapDiv.style.display="block",d.snapDiv.style.opacity=1);this.panoId=a;this.dispose();com.vizengine.core.StringUtil.isEmpty(this.panoId)?b&&b.call(this):this._loadMeta(function(){a==d.panoId&&d.pano.setPanoId(a,function(){null!=d.pano.rootObject&&(d.pano.rootObject.add(d.camera),d.scene.add(d.pano.rootObject),null!=c?(c.callback=function(){d.startAnimation(null);d.snapDiv.style.display="none";d._userControllEnd(!0)},d.startAnimation(c)):(d.snapDiv.style.display=
"none",d._userControllEnd(!1)),null!=b&&b.call(d))})})}},getPanoId:function(){return this.panoId},dispose:function(){this.pano.dispose()},setAutoplayLoopTime:function(a){this._autoPlayLoopTime=a},setAutoplayEnable:function(a){a?this.autoPlay():this.stopAutoPlay()},isAutoplayEnabled:function(){return this._autoPlaying},autoPlay:function(){if(!this.isGravityEnabled()&&(this._autoPlaying=!0,null==this.animation)){var a=new r;a.fps=24;a.fromHeading=this._getHeading();a.toHeading=this._getHeading()-2*
Math.PI;a.enablePitch=!1;a.duration=this._autoPlayLoopTime*Math.pow(2,this._getSuitableLayer(this._fov));a.repeatCount=0;this.startAnimation(a)}},stopAutoPlay:function(){this._autoPlaying=!1;this.startAnimation(null)},setGravityEnable:function(a){a?this.trackingDevice():this.stopTrackingDevice()},isGravityEnabled:function(){return this.isTrackingDevice()},isTrackingDevice:function(){return null!=this._deviceOrientationCallback},trackingDevice:function(){var a=this;this.startAnimation(null);this.setAutoplayEnable(!1);
null==this._deviceOrientationCallback&&(this._deviceOrientationCallback=function(b){var c=b.gamma/180*Math.PI,d=b.beta/180*Math.PI;b=b.alpha/180*Math.PI;if(90==window.orientation){var e=new THREE.Euler;e.set(d,c,b,"ZXY");e.reorder("ZYX");b=e.z-Math.PI/2;d=-e.y;c=e.x}else-90==window.orientation&&(e=new THREE.Euler,e.set(d,c,b,"ZXY"),e.reorder("ZYX"),b=e.z+Math.PI/2,d=e.y,c=-e.x);a._trackingDeviceHeading=b;a._trackingDevicePitch=d;a._trackingDeviceRoll=c;a._autoPlaying||a._userControlling||(b=a._trackingBaseCameraHeading+
(a._trackingDeviceHeading-a._trackingBaseDeviceHeading),a._setHeading(b),null!=a.animation&&a.animation.pulling?a.animation.toPitch=d:(a._setPitch(d),a._setRoll(c)))},window.addEventListener("deviceorientation",this._deviceOrientationCallback));a._userControllEnd(!1)},stopTrackingDevice:function(){null!=this._deviceOrientationCallback&&(window.removeEventListener("deviceorientation",this._deviceOrientationCallback),this._deviceOrientationCallback=null,this.setRoll(0));this._userControllEnd(!1)},setHeading:function(a){a=
parseFloat(a);a=(a+this._headingNorthDelta)/180*-1*Math.PI;this._setHeading(a)},_setHeading:function(a){this.camera.rotation.z=a;this.requestDraw();if(null!=this.onHeadingChangeCallback)this.onHeadingChangeCallback(this.getHeading())},setPitch:function(a){a=parseFloat(a);a=Math.PI*(90-a)/180;this._setPitch(a)},_normalPitch:function(a){a%=2*Math.PI;0>a&&(a+=2*Math.PI);a>1.5*Math.PI?a=0:a>Math.PI&&(a=Math.PI);return a},_setPitch:function(a){null==this._deviceOrientationCallback&&(a=this._normalPitch(a));
this.camera.rotation.x=a;this.requestDraw();if(null!=this.onPitchChangeCallback)this.onPitchChangeCallback(this.getPitch())},delayAutoplay:function(a){this._autoPlaying&&null==this.animation&&this.setAutoplayEnable(!0)},requestDraw:function(){if(!this._dirty){this._dirty=!0;var a=this;setTimeout(function(){a._dirty=!1;a.onDraw()},0)}},setRoll:function(a){a=Math.PI*a/180;this._setRoll(a)},_setRoll:function(a){this.camera.rotation.y=a},getHeading:function(){return-180*this._getHeading()/Math.PI-this._headingNorthDelta},
_getHeading:function(){return this.camera.rotation.z},getPitch:function(){return 90-180*this._getPitch()/Math.PI},_getPitch:function(){return this.camera.rotation.x},getRoll:function(){return 180*this._getRoll()/Math.PI},_getRoll:function(){return this.camera.rotation.y}});k.extend("com.vizengine.view.PanoView",{init:function(){k.prototype.init.apply(this,arguments);var a=this;this.onFovChangeCallback=this.onHeadingChangeCallback=this.onPitchChangeCallback=null;this.panoViewInternal=new com.vizengine.view.PanoViewInternal;
this.panoViewInternal.panoView=this;this.panoViewInternal.onPitchChangeCallback=function(){a.onPitchChangeCallback&&a.onPitchChangeCallback.apply(a,arguments);a._updateAnnotations();a._checkUpdateCursorState()};this.panoViewInternal.onHeadingChangeCallback=function(){a.onHeadingChangeCallback&&a.onHeadingChangeCallback.apply(a,arguments);a._updateAnnotations();a._checkUpdateCursorState()};this.panoViewInternal.onFovChangeCallback=function(){a.onFovChangeCallback&&a.onFovChangeCallback.apply(a,arguments);
a._updateAnnotations();a._checkUpdateCursorState()};k.prototype.addView.call(this,this.panoViewInternal);this.leftEye=new k;this.leftEye.setId("leftEye");this.rightEye=new k;this.rightEye.setId("rightEye");this.leftEye.setClipToBounds(!0);this.leftEye.setGravity("left");this.rightEye.setClipToBounds(!0);this.rightEye.setGravity("right");k.prototype.addView.call(this,this.leftEye);k.prototype.addView.call(this,this.rightEye);this.keyEnable=this.mouseWheelEnable=!0;this._createVRCursor();var b=function(b){if(a.touchable&&
a.mouseWheelEnable){b.preventDefault();var c=window.event||b,f=0;c.ctrlKey?f=-c.deltaY/3:(f=Math.max(-1,Math.min(1,c.wheelDelta||-c.detail)),f*=2);var c=new n(2),g=a.panoViewInternal;g.startAnimation(null);if(0>f){var h=new t;h.fromFov=g._getFov();h.toFov=h.fromFov-f;h.duration=600;h.timeInterplator=c;h.callback=function(){g._scaleCamera(this.toFov);if(null!=a.onScaleCallBack)a.onScaleCallBack()};h.animateFrame(g,0);g.startAnimation(h)}else 0<f&&(h=new t,h.fromFov=g._getFov(),h.toFov=h.fromFov-f,
h.duration=600,h.timeInterplator=c,h.callback=function(){g._scaleCamera(this.toFov);if(null!=a.onScaleCallBack)a.onScaleCallBack()},h.animateFrame(g,0),g.startAnimation(h));b.stopPropagation()}},c=this._nativeView.div;c.addEventListener?(c.addEventListener("mousewheel",b,!1),c.addEventListener("DOMMouseScroll",b,!1)):c.attachEvent("onmousewheel",b);this.setVREnable(!1);this.adaptor={markers:[],getView:function(a){return this.markers[a]},getCount:function(){return this.markers.length}}},dispose:function(){this.panoViewInternal.dispose()},
dispatchTouch:function(a){k.prototype.dispatchTouch.apply(this,arguments);if(this.touchable)for(var b in this.panoViewInternal.panoGestureDetectors)this.panoViewInternal.panoGestureDetectors[b].detect(a);else window.__preventDefault__=!1},setMarkerDragCallback:function(a){this.panoViewInternal.setMarkerDragCallback(a)},dispatchKey:function(a){this.keyEnable&&(0==a.state?37==a.keyCode?(this.delayAutoplay(1),a=new com.vizengine.animation.Animation,a.duration=8E3,a.repeatCount=0,a.fromHeading=this.getHeading(),
a.toHeading=a.fromHeading-360,a.animateFrame=function(a,c){a.setHeading(this.fromHeading+(this.toHeading-this.fromHeading)*c)},this.panoViewInternal.startAnimation(a)):39==a.keyCode?(this.delayAutoplay(1),a=new com.vizengine.animation.Animation,a.duration=8E3,a.repeatCount=0,a.fromHeading=this.getHeading(),a.toHeading=a.fromHeading+360,a.animateFrame=function(a,c){a.setHeading(this.fromHeading+(this.toHeading-this.fromHeading)*c)},this.panoViewInternal.startAnimation(a)):38==a.keyCode?(this.delayAutoplay(1),
a=new com.vizengine.animation.Animation,a.duration=8E3*((this.getPitch()+90)/360),a.repeatCount=1,a.fromPitch=this.getPitch(),a.toPitch=-90,a.animateFrame=function(a,c){a.setPitch(this.fromPitch+(this.toPitch-this.fromPitch)*c)},this.panoViewInternal.startAnimation(a)):40==a.keyCode&&(this.delayAutoplay(1),a=new com.vizengine.animation.Animation,a.duration=8E3*((90-this.getPitch())/360),a.repeatCount=1,a.fromPitch=this.getPitch(),a.toPitch=90,a.animateFrame=function(a,c){a.setPitch(this.fromPitch+
(this.toPitch-this.fromPitch)*c)},this.panoViewInternal.startAnimation(a)):(this.panoViewInternal.startAnimation(null),this.delayAutoplay(1)))},delayAutoplay:function(a){this.panoViewInternal.delayAutoplay(a)},_createVRCursor:function(){var a={width:"27dp",height:"27dp",clipToBounds:"true",gravity:"center",children:[{id:"cursorImg",type:"ImageView",width:"wrap",height:"fill",src:"data:image/png;base64,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"}]};
this.leftCursor=k.parse(a);this.leftEye.addView(this.leftCursor);this.rightCursor=k.parse(a);this.rightEye.addView(this.rightCursor)},_setCursorProgress:function(a){0>a?(this.leftCursor.$("cursorImg").setTranslateX(0),this.rightCursor.$("cursorImg").setTranslateX(0)):(a=-27*(Math.floor(15*a)+1),this.leftCursor.$("cursorImg").setTranslateX(a),this.rightCursor.$("cursorImg").setTranslateX(a))},_startCursorSelect:function(){if(!this.cursorAnimation){var a=this;this.cursorAnimation=new l;this.cursorAnimation.duration=
2E3;this.cursorAnimation.animateFrame=function(b,c){a._setCursorProgress(c);1<=c&&(a.cursorAnimation=null,a.currentCursorMarker&&a.currentCursorMarker.trigerClick())};this.cursorAnimation.callback=function(){a._setCursorProgress(-1);a.cursorAnimation=null};this.cursorAnimation.cancelCallback=function(){a._setCursorProgress(-1);a.cursorAnimation=null};this.leftCursor.startAnimation(this.cursorAnimation)}},_cancelCursorSelect:function(){this.leftCursor.startAnimation(null)},_updateAnnotationsInEye:function(a){for(var b=
0;b<a.subViews.length-1;b++){var c=a.subViews[b];null==c.panoPitch&&(c.panoPitch=0);null==c.panoHeading&&(c.panoHeading=0);var d=new THREE.Euler(Math.PI*(90-c.panoPitch)/180,0,(c.panoHeading+this.panoViewInternal._headingNorthDelta)/180*-1*Math.PI,"ZXY"),e=new THREE.Vector3(0,0,-200);e.applyEuler(d);e.applyMatrix4(this.panoViewInternal.camera.matrixWorldInverse);c.setVisible(0>e.z);var d=c.measureWidth(),f=c.measureHeight();e.applyMatrix4(this.panoViewInternal.camera.projectionMatrix);var g=a.frame.height/
2-e.y*a.frame.height/2;c.setTranslateX(e.x*a.frame.width/2+a.frame.width/2-c.anchorX*d);c.setTranslateY(g-c.anchorY*f);d=new THREE.Vector3(0,0,-1);d.applyMatrix4(this.panoViewInternal.camera.matrixWorldInverse);e=d.x;d=d.y;e=(0>e?-1:1)*Math.round(Math.asin(d/Math.sqrt(e*e+d*d))/Math.PI*180)+90*(0>e?-1:1);isNaN(e)||c.setRotateZ(-e)}},_updateAnnotations:function(){this.vrEnable?(this._updateAnnotationsInEye(this.leftEye),this._updateAnnotationsInEye(this.rightEye)):this._updateAnnotationsInEye(this.leftEye)},
_checkUpdateCursorState:function(){if(this.vrEnable){for(var a=this.leftEye.frame.width/2,b=this.leftEye.frame.height/2,c=0;c<this.leftEye.subViews.length-1;c++){var d=this.leftEye.subViews[c],e=d.translateX,f=e+d.frame.width,g=d.translateY,h=g+d.frame.height;if(a>e&&a<f&&b>g&&b<h&&d.visible)return this._startCursorSelect(),this.currentCursorMarker=d}this._cancelCursorSelect();return null}},_interceptMarker:function(a){},addView:function(a,b){a.setVisible(!1);this._interceptMarker(a);null==b&&(b=
this.adaptor.markers.length);if(b<this.adaptor.markers.length){var c=this.adaptor.markers.slice(0,b),d=this.adaptor.markers.slice(b);c.push(a);this.adaptor.markers=c.concat(d)}else this.adaptor.markers.push(a);this.notifyDataChanged()},clearViews:function(){this.adaptor.markers.length=0;this.notifyDataChanged()},removeViewAt:function(a){this.adaptor.markers.splice(a,1);this.notifyDataChanged()},removeView:function(a){for(var b=-1,c=0;c<this.adaptor.markers.length;c++)if(this.adaptor.markers[c]==a){b=
c;break}0<=b&&this.removeViewAt(b)},addPatch:function(a,b,c,d,e){return this.panoViewInternal.addPatch.apply(this.panoViewInternal,arguments)},removePatch:function(a){this.panoViewInternal.removePatch(a)},setAdaptor:function(a){this.adaptor=a;this.notifyDataChanged()},notifyDataChanged:function(){if(null!=this.adaptor){for(;1<this.leftEye.subViews.length;)this.leftEye.removeViewAt(0);for(;1<this.rightEye.subViews.length;)this.rightEye.removeViewAt(0);for(var a=this.adaptor.getCount()-1;0<=a;a--){var b=
this.adaptor.getView(a);this._interceptMarker(b);this.leftEye.addView(b,0);this.vrEnable&&(b=this.adaptor.getView(a),this._interceptMarker(b),this.rightEye.addView(b,0))}this._updateAnnotations()}},setPanoId:function(a,b){var c=this;this.panoViewInternal.setPanoId(a,function(){b&&b.call(c);c._updateAnnotations()})},getPanoId:function(){return this.panoViewInternal.panoId},setHeading:function(a){this.panoViewInternal.setHeading(a)},setFov:function(a){this.panoViewInternal.setFov(a)},getHeading:function(){return this.panoViewInternal.getHeading()},
setPitch:function(a){this.panoViewInternal.setPitch(a)},getPitch:function(){return this.panoViewInternal.getPitch()},setVREnable:function(a){this.vrEnable=k.parseBoolean(a);this.panoViewInternal.setVREnable(this.vrEnable);this.vrEnable?(this.leftEye.setWidth("match 0.5"),this.rightEye.setWidth("match 0.5"),this.leftCursor.setVisible(!0)):(this.leftEye.setWidth("match 1"),this.rightEye.setWidth("0dp"),this.leftCursor.setVisible(!1));this.notifyDataChanged();this.requestLayout();window.rootView&&window.rootView.resize()},
setAutoplayEnable:function(a){this.autoplayEnable=k.parseBoolean(a);this.panoViewInternal.setAutoplayEnable(this.autoplayEnable)},setMouseWheelEnable:function(a){this.mouseWheelEnable=k.parseBoolean(a)},setKeyEnable:function(a){this.keyEnable=k.parseBoolean(a)},setMarkerDragEnable:function(a){this.panoViewInternal.setMarkerDragEnable(a)}});var m=com.vizengine.view.PanoView;m.getHeadingByLatLon=function(a,b,c,d){a=new LatLon(a,b);c=new LatLon(c,d);return a.bearingTo(c)};m.getPitchByLatLon=function(a,
b,c,d){a=new LatLon(a,b);c=new LatLon(c,d);c=a.distanceTo(c);return Math.atan(3/c)};var B=l.extend({init:function(a){l.prototype.init.apply(this,arguments);this.fromAngle=3*-Math.PI/4;this.toAngle=0;this.fromX=a.earthCamera.position.x;this.fromY=a.earthCamera.position.y;this.fromZ=a.earthCamera.position.z;this.toX=a.scene.position.x;this.toY=a.scene.position.y;this.toZ=a.scene.position.z;this.lkFromX=0;this.lkFromY=1E4;this.lkToX=this.lkFromZ=0;this.lkToY=2E4;this.lkToZ=0;this.repeatCount=1;this.duration=
6E3;this.timeInterplator=new n(2)},animateFrame:function(a,b){a.setCameraInfo(this.fromAngle+(this.toAngle-this.fromAngle)*b,this.fromX+(this.toX-this.fromX)*b,this.fromY+(this.toY-this.fromY)*b,this.fromZ+(this.toZ-this.fromZ)*b,this.lkFromX+(this.lkToX-this.lkFromX)*b,this.lkFromY+(this.lkToY-this.lkFromY)*b,this.lkFromZ+(this.lkToZ-this.lkFromZ)*b);a._nativeView.div.style.webkitFilter="blur("+(.94>b?0:1<b?0:.998>b?(b-.94)/(.998-.94)*10:10*(1-b)/(1-.998))+"px)"}});m.extend("com.vizengine.view.EarthPanoView",
{init:function(){m.prototype.init.apply(this,arguments);var a=new THREE.PerspectiveCamera(90,window.innerWidth/window.innerHeight,1,1E3);a.position.x=0;a.position.y=0;a.position.z=3E4;a.rotation.order="ZXY";a.rotation.x=0;a.rotation.y=0;a.rotation.z=0;this.earthCamera=a;this.earthScene=new THREE.Scene;a=new THREE.Matrix4;a.makeRotationY(200/180*Math.PI);var b=new THREE.Matrix4;b.makeRotationX(-23/180*Math.PI);a.multiplyMatrices(a,b);b=new THREE.Vector3(0,0,20200);b.applyMatrix4(a);var c=new THREE.Euler;
c.setFromRotationMatrix(a,"ZXY");this.scene.position.x=b.x;this.scene.position.y=b.y;this.scene.position.z=b.z;this.scene.rotation.x=c.x;this.scene.rotation.y=c.y;this.scene.rotation.z=c.z;this.earthCamera.position.x=5*b.x;this.earthCamera.position.y=5*b.y;this.earthCamera.position.z=5*b.z;this.earthScene.add(this.scene);this.createEarth();this.animation=new B(this)},setCameraInfo:function(a,b,c,d,e,f,g){var h=new THREE.Matrix4;h.makeRotationY(a);a=new THREE.Vector3(b,c,d);a.applyMatrix4(h);this.earthCamera.position.x=
a.x;this.earthCamera.position.y=a.y;this.earthCamera.position.z=a.z;this.earthCamera.lookAt(new THREE.Vector3(e,f,g))},createEarth:function(){var a=this;(new THREE.TextureLoader).load("earth.jpg",function(b){var c=new THREE.SphereGeometry(2E4,20,20);b=new THREE.MeshBasicMaterial({map:b,overdraw:.5});c=new THREE.Mesh(c,b);a.earthScene.add(c)})},dispatchLayout:function(){m.prototype.dispatchLayout.apply(this,arguments);this.earthCamera.aspect=this.frame.width/this.frame.height;this._setFovForCamera(this.earthCamera,
this._fov);this.earthCamera.near=1;this.earthCamera.far=4E5;this.earthCamera.updateProjectionMatrix()},onDraw:function(){m.prototype.init.apply(this,arguments);this.renderer.render(this.earthScene,this.earthCamera)}})}});
]]></res>
	<res path="./libs/vizengine_template.js"><![CDATA[!function(){function x(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function B(a,b){function c(a){return q+=a.split(/\n/).length-1,g&&(a=a.replace(/\s+/g," ").replace(/\x3c!--[\w\W]*?--\x3e/g,"")),a&&(a=m[1]+x(a)+m[2]+"\n"),a}function d(a){var c=q;if(k?a=k(a,b):f&&(a=a.replace(/\n/g,function(){return q++,"$line="+q+";"})),0===a.indexOf("=")){var e=n&&!/^=[=#]/.test(a);(a=a.replace(/^=[=#]?|[\s;]*$/g,""),e)?(e=a.replace(/\s*\([^\)]+\)/,""),r[e]||/^(include|print)$/.test(e)||
(a="$escape("+a+")")):a="$string("+a+")";a=m[1]+a+m[2]}return f&&(a="$line="+c+";"+a),z(a.replace(C,"").replace(D,",").replace(E,"").replace(F,"").replace(G,"").split(H),function(a){a&&!p[a]&&(w+=a+"="+("print"===a?u:"include"===a?v:r[a]?"$utils."+a:A[a]?"$helpers."+a:"$data."+a)+",",p[a]=!0)}),a+"\n"}var f=b.debug,e=b.closeTag,k=b.parser,g=b.compress,n=b.escape,q=1,p={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},h="".trim,m=h?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");",
"$out.join('')"],h=h?"$out+=text;return $out;":"$out.push(text);",u="function(){var text=''.concat.apply('',arguments);"+h+"}",v="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+h+"}",w="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(f?"$line=0,":""),l=m[0],h="return new String("+m[3]+");";z(a.split(b.openTag),function(a){a=a.split(e);var b=a[0],f=a[1];1===a.length?l+=c(b):(l+=d(b),f&&(l+=c(f)))});h=w+l+h;f&&(h="try{"+h+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+
x(a)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var t=new Function("$data","$filename",h);return t.prototype=r,t}catch(y){throw y.temp="function anonymous($data,$filename) {"+h+"}",y;}}var d=function(a,b){return"string"==typeof b?n(b,{filename:a}):t(a,b)};d.version="3.0.0";d.config=function(a,b){g[a]=b};var g=d.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},p=d.cache={};d.render=function(a,b){return n(a,b)};var t=d.renderFile=function(a,b){var c=d.get(a)||
u({filename:a,name:"Render Error",message:"Template not found"});return b?c(b):c};d.get=function(a){var b;if(p[a])b=p[a];else if("object"==typeof document){var c=document.getElementById(a);c&&(b=(c.value||c.innerHTML).replace(/^\s*|\s*$/g,""),b=n(b,{filename:a}))}return b};var v=function(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?v(a.call(a)):""),a},I={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},J=function(a){return I[a]},K=Array.isArray||function(a){return"[object Array]"===
{}.toString.call(a)},r=d.utils={$helpers:{},$include:t,$string:v,$escape:function(a){return v(a).replace(/&(?![\w#]+;)|[<>"']/g,J)},$each:function(a,b){var c,d;if(K(a))for(c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)}};d.helper=function(a,b){A[a]=b};var A=d.helpers=r.$helpers;d.onerror=function(a){var b="Template Error\n\n",c;for(c in a)b+="<"+c+">\n"+a[c]+"\n\n";"object"==typeof console&&console.error(b)};var u=function(a){return d.onerror(a),function(){return"{Template Error}"}},
n=d.compile=function(a,b){function c(c){try{return new e(c,f)+""}catch(d){return b.debug?u(d)():(b.debug=!0,n(a,b)(c))}}b=b||{};for(var d in g)void 0===b[d]&&(b[d]=g[d]);var f=b.filename;try{var e=B(a,b)}catch(k){return k.filename=f||"anonymous",k.name="Syntax Error",u(k)}return c.prototype=e.prototype,c.toString=function(){return e.toString()},f&&b.cache&&(p[f]=c),c},z=r.$each,C=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,D=/[^\w$]+/g,
E=new RegExp(""+("\\b"+"break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined".replace(/,/g,"\\b|\\b")+"\\b"),"g"),F=/^\d[^,]*|,\d[^,]*/g,
G=/^,+|,+$/g,H=/^$|,+/;g.openTag="{{";g.closeTag="}}";g.parser=function(a){a=a.replace(/^\s/,"");var b=a.split(" "),c=b.shift(),g=b.join(" ");switch(c){case "if":a="if("+g+"){";break;case "else":b="if"===b.shift()?" if("+b.join(" ")+")":"";a="}else"+b+"{";break;case "/if":a="}";break;case "each":c=b[0]||"$data";a=(b[2]||"$value")+","+(b[3]||"$index");"as"!==(b[1]||"as")&&(c="[]");a="$each("+c+",function("+a+"){";break;case "/each":a="});";break;case "echo":a="print("+g+");";break;case "print":case "include":a=
c+"("+b.join(",")+");";break;default:if(/^\s*\|\s*[\w\$]/.test(g)){b=!0;0===a.indexOf("#")&&(a=a.substr(1),b=!1);c=0;a=a.split("|");for(var g=a.length,f=a[c++];g>c;c++)var e=a[c].split(":"),k=e.shift(),e=e.join(":")||"",f=(e&&(e=", "+e),"$helpers."+k+"("+f+e+")");a=(b?"=":"=#")+f}else a=d.helpers[c]?"=#"+c+"("+b.join(",")+");":"="+a}return a};window.template=this.template=d}();
]]></res>
	<res path="./libs/vizengine_view.js"><![CDATA[module("vizengine_animation.js",function(){com.vizengine.view={};var u=com.vizengine.core.Object,r=com.vizengine.core.StringUtil,z=com.vizengine.gesture.TouchPoint,G=com.vizengine.gesture.TapGestureDetector,w=com.vizengine.animation.Animation,t=com.vizengine.animation.TranslateAnimation,H=com.vizengine.gesture.PanGestureDetector,I=com.vizengine.gesture.SweepGestureDetector,q=com.vizengine.animation.DecelerateInterpolator;com.vizengine.view.Layout={VERTICAL:0,HORIZONTAL:1,FRAME:2,FLOW:3,parse:function(a){return"horizontal"==
a?p.HORIZONTAL:"vertical"==a?p.VERTICAL:"flow"==a?p.FLOW:p.FRAME},toString:function(a){return a==p.VERTICAL?"vertical":a==p.HORIZONTAL?"horizontal":a==p.FLOW?"flow":"frame"}};var p=com.vizengine.view.Layout;com.vizengine.view.LayoutConstrain={FILL:-1,MATCH:-2,WRAP:-3,MATCH_HEIGHT:-4,MATCH_WIDTH:-5,NUMBER:-6,parse:function(a){return"fill"==a?m.FILL:"match"==a?m.MATCH:"wrap"==a?m.WRAP:"matchWidth"==a?m.MATCH_WIDTH:"matchHeight"==a?m.MATCH_HEIGHT:m.NUMBER},toString:function(a){return a==m.FILL?"fill":
a==m.MATCH?"match":a==m.WRAP?"wrap":a==m.MATCH_WIDTH?"matchWidth":a==m.MATCH_HEIGHT?"matchHeight":a+""}};var m=com.vizengine.view.LayoutConstrain;com.vizengine.view.Gravity={NONE:0,LEFT:1,TOP:2,RIGHT:4,BOTTOM:8,CENTER_HORIZONTAL:16,CENTER_VERTICAL:32,CENTER:64,isAlignLeft:function(a){return 0!=(a&h.LEFT)?!0:0!=(a&h.RIGHT)||0!=(a&h.CENTER_HORIZONTAL)||0!=(a&h.CENTER)?!1:!0},isAlignRight:function(a){return 0!=(a&h.RIGHT)?!0:!1},isAlignCenterHorizontal:function(a){return h.isAlignLeft(a)||h.isAlignRight(a)?
!1:!0},isAlignTop:function(a){return 0!=(a&h.TOP)?!0:0!=(a&h.BOTTOM)||0!=(a&h.CENTER_VERTICAL)||0!=(a&h.CENTER)?!1:!0},isAlignBottom:function(a){return 0!=(a&h.BOTTOM)?!0:!1},isAlignCenterVertical:function(a){return h.isAlignTop(a)||h.isAlignBottom(a)?!1:!0},parseElement:function(a){return"top"==a?com.vizengine.view.Gravity.TOP:"right"==a?com.vizengine.view.Gravity.RIGHT:"bottom"==a?h.BOTTOM:"left"==a?h.LEFT:"centerHorizontal"==a?h.CENTER_HORIZONTAL:"centerVertical"==a?h.CENTER_VERTICAL:"center"==
a?h.CENTER:h.NONE},toString:function(a){var b=[];0!=(h.TOP&a)&&b.push("top");0!=(h.RIGHT&a)&&b.push("right");0!=(h.BOTTOM&a)&&b.push("bottom");0!=(h.LEFT&a)&&b.push("left");0!=(h.CENTER_HORIZONTAL&a)&&b.push("centerHorizontal");0!=(h.CENTER_VERTICAL&a)&&b.push("centerVertical");0!=(h.CENTER&a)&&b.push("center");a="";for(var d=0;d<b.length;d++)0<d&&(a+="|"),a+=b[d];return a},parse:function(a){if(null==a)return h.NONE;a=a.split(/\|/);var b=h.NONE,d;for(d in a)b|=h.parseElement(a[d]);return b}};var h=
com.vizengine.view.Gravity;u.extend("com.vizengine.view.Rect",{init:function(){var a,b,d,f;4==arguments.length?(a=arguments[0],b=arguments[1],d=arguments[2],f=arguments[3]):1==arguments.length?(a=arguments[0].x,b=arguments[0].y,d=arguments[0].width,f=arguments[0].height):a=b=d=f=0;this.x=a;this.y=b;this.width=d;this.height=f},getLeft:function(){return this.x},getTop:function(){return this.y},getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height},hitTest:function(a,
b){return a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<=this.y+this.height}});var A=com.vizengine.view.Rect;u.extend("com.vizengine.view.Space",{init:function(){this.bottom=this.right=this.top=this.left=0},setTRBL:function(a){null!=a&&(a=a.split(/\s+/),null!=a&&0!=a.length&&(this.top=0<a.length?c.parseSize(a[0]):0,this.right=1<a.length?c.parseSize(a[1]):this.top,this.bottom=2<a.length?c.parseSize(a[2]):this.right,this.left=3<a.length?c.parseSize(a[3]):this.bottom))},hspace:function(){return this.left+
this.right},vspace:function(){return this.top+this.bottom}});u.extend("com.vizengine.view.LayoutParam",{init:function(){this.layout=com.vizengine.view.Layout.FRAME;this.layoutInParent=null;this.width=com.vizengine.view.LayoutConstrain.FILL;this.widthWeight=1;this.height=com.vizengine.view.LayoutConstrain.FILL;this.heightWeight=1;this.margin=new com.vizengine.view.Space;this.padding=new com.vizengine.view.Space;this.contentGravity=this.gravity=com.vizengine.view.Gravity.NONE}});var J=com.vizengine.view.LayoutParam;
u.extend("com.vizengine.view.VelocityTracker",{init:function(){u.prototype.init.apply(this,arguments);this.tracks=[]},track:function(a){var b=(new Date).getTime();for(this.tracks.push({time:b,value:a});;)if(1E3<b-this.tracks[0].time)this.tracks.shift();else break},getVelocity:function(){if(0==this.tracks.length)return 0;for(var a=this.tracks[this.tracks.length-1],b=a,d=1;d<this.tracks.length&&!(b=this.tracks[this.tracks.length-1-d],50<a.time-b.time);d++);return 0<a.time-b.time?(a.value-b.value)/(a.time-
b.time):0}});var B=com.vizengine.view.VelocityTracker;u.extend("com.vizengine.view.Color",{init:function(){this.a=this.b=this.g=this.r=0},setByHex:function(a){7==a.length?(this.r=parseInt(a.substring(1,3),16),this.g=parseInt(a.substring(3,5),16),this.b=parseInt(a.substring(5,7),16),this.a=255):9==a.length&&(this.a=parseInt(a.substring(1,3),16),this.r=parseInt(a.substring(3,5),16),this.g=parseInt(a.substring(5,7),16),this.b=parseInt(a.substring(7,9),16))},toString:function(){var a=function(a){return 10>
a?"0"+a:a.toString(16)};return"#"+a(this.a)+a(this.r)+a(this.g)+a(this.b)}});var C=com.vizengine.view.Color;C.parse=function(a){var b=new C;b.setByHex(a);return b};u.extend("com.vizengine.view.View",{init:function(a){null==a&&(a=this._createNativeView());a.setVirtualView(this);this._nativeView=a;this.parentView=this.id=null;this.subViews=[];this.frame=new A;this.layoutParam=new J;this.gone=!1;this.visible=this.touchable=!0;this.opaque=!1;this.gestureDetectors=[];this.onSizeChangeCallback=this.onScrollCallback=
this.onClickCallback=this.onTapGestureDetector=null;this.anchorY=this.anchorX=this.translateY=this.translateX=0;this.alpha=1;this.blur=0;this.contextPath=this.animation=null;this.velocityTrackerX=new B;this.velocityTrackerY=new B;this.measuredHeight=this.measuredWidth=null;this.isLayoutDirty=!0;this.isLayouting=!1;this.zorder=0;this.zorderUpdateRequested=!1;this.scaleY=this.scaleX=1;this.focusable=this.focus=!1;this.setHover(!1)},_createNativeView:function(){return createNativeObject("NativeView")},
snapshot:function(a){this._nativeView.snapshot(a)},getContextPath:function(){return null!=this.contextPath?this.contextPath:null!=this.parentView?this.parentView.getContextPath():null},resolvePath:function(a){return a=c.resolvePath(this.getContextPath(),a)},setHover:function(a){(this.hover=c.parseBoolean(a))&&this.setVisible(!1)},getHover:function(){return this.hover},setFocus:function(a){this.focus=c.parseBoolean(a);this._requestFocus(this,this.focus)},onFocusChanged:function(){this.setVisible(this.focus)},
_requestFocus:function(a,b){b?window.rootView.focusedView!=a&&(null!=window.rootView.focusedView&&(window.rootView.focusedView.focus=!1,window.rootView.focusedView.onFocusChanged()),window.rootView.focusedView=a,a.onFocusChanged()):window.rootView.focusedView==a&&(window.rootView.focusedView=null,a.onFocusChanged())},setFocusable:function(a){(this.focusable=c.parseBoolean(a))&&this.setVisible(!1)},setId:function(a){this.id=a;this._nativeView.setId(a)},setTouchable:function(a){this.touchable=c.parseBoolean(a)},
setOpaque:function(a){this.opaque=c.parseBoolean(a);this._nativeView.setOpaque(this.opaque?1:0)},getId:function(){return this.id},setLatitude:function(a){this.latitude=a},setLongitude:function(a){this.longitude=a},setBlur:function(a){this.blur=a=c.parseFloat(a);this._nativeView.setBlur(a)},setCameraDistance:function(a){a=c.parseSize(a);this._nativeView.setCameraDistance(a)},setAnchorX:function(a){this.anchorX=a=c.parseFloat(a);this._nativeView.setAnchorX(a)},setAnchorY:function(a){this.anchorY=a=
c.parseFloat(a);this._nativeView.setAnchorY(a)},setRotateX:function(a){a=c.parseFloat(a);this._nativeView.setRotateX(a)},setRotateY:function(a){a=c.parseFloat(a);this._nativeView.setRotateY(a)},setRotateZ:function(a){a=c.parseFloat(a);this._nativeView.setRotateZ(a)},setScaleX:function(a){this.scaleX=a=c.parseFloat(a);this._nativeView.setScaleX(a)},setScaleY:function(a){this.scaleY=a=c.parseFloat(a);this._nativeView.setScaleY(a)},setAlpha:function(a){this.alpha=a=c.parseFloat(a);this._nativeView.setAlpha(a)},
setBorderCorner:function(a){a=c.parseSize(a);this._nativeView.setBorderCorner(a)},setBorderWidth:function(a){a=c.parseSize(a);this._nativeView.setBorderWidth(a)},setBorderColor:function(a){this._nativeView.setBorderColor(a)},setClipToBounds:function(a){a=c.parseBoolean(a);this._nativeView.setClipToBounds(a?1:0)},onScroll:function(a,b){if(null!=this.onScrollCallback)this.onScrollCallback(a,b)},setTranslateX:function(a){a=c.parseSize(a);this.velocityTrackerX.track(a);var b=this.translateX;this.translateX=
a;this._nativeView.setTranslateX(a);this.onScroll(this.translateX-b,0)},setTranslateY:function(a){a=c.parseSize(a);this.velocityTrackerY.track(a);var b=this.translateY;this.translateY=a;this._nativeView.setTranslateY(a);this.onScroll(0,this.translateY-b)},setVisible:function(a){this.visible=c.parseBoolean(a);this._nativeView.setVisible(this.visible?1:0);this.requestDraw()},setGone:function(a){this.gone=c.parseBoolean(a);this.setVisible(this.gone?!1:!0);this.requestLayout()},setLayout:function(a){this.layoutParam.layout=
p.parse(a);this.requestLayout()},getLayout:function(){return p.toString(this.layoutParam.layout)},setWidth:function(a){a=a.split(/\s+/);null==a||1>a.length||(this.layoutParam.widthWeight=1<a.length?c.parseFloat(a[1],1):1,this.layoutParam.width=c.parseSize(a[0]),this.requestLayout())},getWidth:function(){return c.sizeToString(this.layoutParam.width)+(1!=this.layoutParam.widthWeight?" "+this.layoutParam.widthWeight:"")},setHeight:function(a){a=a.split(/\s+/);null==a||1>a.length||(this.layoutParam.heightWeight=
1<a.length?c.parseFloat(a[1],1):1,this.layoutParam.height=c.parseSize(a[0]),this.requestLayout())},getHeight:function(){return c.sizeToString(this.layoutParam.height)+(1!=this.layoutParam.heightWeight?" "+this.layoutParam.heightWeight:"")},setMargin:function(a){this.layoutParam.margin.setTRBL(a);this.requestLayout()},setMarginTop:function(a){this.layoutParam.margin.top=c.parseSize(a);this.requestLayout()},getMarginTop:function(){return this.layoutParam.margin.top+""},setMarginRight:function(a){this.layoutParam.margin.right=
c.parseSize(a);this.requestLayout()},getMarginRight:function(){return this.layoutParam.margin.right+""},setMarginBottom:function(a){this.layoutParam.margin.bottom=c.parseSize(a);this.requestLayout()},getMarginBottom:function(){return this.layoutParam.margin.bottom+""},setMarginLeft:function(a){this.layoutParam.margin.left=c.parseSize(a);this.requestLayout()},getMarginLeft:function(){return this.layoutParam.margin.left+""},setPadding:function(a){this.layoutParam.padding.setTRBL(a);this.requestLayout()},
setPaddingTop:function(a){this.layoutParam.padding.top=c.parseSize(a);this.requestLayout()},getPaddingTop:function(){return this.layoutParam.padding.top+""},setPaddingRight:function(a){this.layoutParam.padding.right=c.parseSize(a);this.requestLayout()},getPaddingRight:function(){return this.layoutParam.padding.right+""},setPaddingBottom:function(a){this.layoutParam.padding.bottom=c.parseSize(a);this.requestLayout()},getPaddingBottom:function(){return this.layoutParam.padding.bottom+""},setPaddingLeft:function(a){this.layoutParam.padding.left=
c.parseSize(a);this.requestLayout()},getPaddingLeft:function(){return this.layoutParam.padding.left+""},setGravity:function(a){this.layoutParam.gravity=h.parse(a);this.requestLayout()},getGravity:function(){return h.toString(this.layoutParam.gravity)},setContentGravity:function(a){this.layoutParam.contentGravity=h.parse(a);this.requestLayout()},getContentGravity:function(){return h.toString(this.layoutParam.contentGravity)},$:function(a){null==this._index_cache&&(this._index_cache={});return null!=
this._index_cache[a]?this._index_cache[a]:this._index_cache[a]=this.findViewById(a)},findViewByXY:function(a,b){for(var d=this.subViews.length-1;0<=d;d--){var f=this.subViews[d];if(f.hitTest(a,b)&&f.visible)return f.findViewByXY(a-f.frame.x-f.translateX,b-f.frame.y-f.translateY)}return this},findViewsByXY:function(a,b,d){for(var f=this.subViews.length-1;0<=f;f--){var e=this.subViews[f];e.hitTest(a,b)&&(d.push(e),e.findViewsByXY(a-e.frame.x-e.translateX,b-e.frame.y-e.translateY,d))}},_findViewByIdInParentExceptMe:function(a){if(null==
this.parentView)return null;for(var b=0;b<this.parentView.subViews.length;b++){var d=this.parentView.subViews[b];if(d.id==a||d!=this&&(d=d.findViewByIdInMyScope(a),null!=d))return d}return this.parentView._findViewByIdInParentExceptMe(a)},findViewByIdInMyScope:function(a){if(this.id==a)return this;for(var b=0;b<this.subViews.length;b++){var d=this.subViews[b];if(d.id==a)return d;d=this.subViews[b].findViewByIdInMyScope(a);if(null!=d)return d}return null},findViewById:function(a){return this.findViewByIdInMyScope(a)},
findViewByIdInTree:function(a){var b=this.findViewByIdInMyScope(a);null==b&&(b=this._findViewByIdInParentExceptMe(a));return b},addView:function(a,b,d){if(null!=a){null==b&&(b=this.subViews.length);null==d&&(d=!0);a.parentView=this;if(b<this.subViews.length){var f=this.subViews.slice(0,b),e=this.subViews.slice(b);f.push(a);this.subViews=f.concat(e)}else this.subViews.push(a);this._nativeView.addNativeView(a._nativeView,b);d&&this.requestLayout();return this}},removeViewAt:function(a,b){if(0>a||a>=
this.subViews.length)return null;null==b&&(b=!0);var d=this.subViews[a];this._nativeView.removeNativeViewAt(a);this.subViews.splice(a,1);b&&this.requestLayout();this._index_cache={};return d},removeView:function(a,b){var d=-1,f;for(f in this.subViews)if(this.subViews[f]==a){d=f;break}return this.removeViewAt(d,b)},clearViews:function(a){for(;0<this.subViews.length;)this.removeViewAt(0,a)},setBackground:function(a){this.background=a;this._nativeView.setBackground(a)},getBackground:function(){return this.background},
setZorder:function(a){this.zorder=a;this.parentView&&this.parentView._requestUpdateChildrenByZorder()},_requestUpdateChildrenByZorder:function(){if(!this.zorderUpdateRequested){this.zorderUpdateRequested=!0;var a=this;setTimeout(function(){a._updateChildrenByZorder()},0)}},_bubbleSort:function(a,b){for(var d=a.length,f,e;0<d;){for(f=0;f<d-1;f++)0<b(a[f],a[f+1])&&(e=a[f],a[f]=a[f+1],a[f+1]=e);d--}return a},_updateChildrenByZorder:function(){this.zorderUpdateRequested=!1;var a=this.subViews.concat([]);
this._bubbleSort(a,function(a,b){return a.zorder-b.zorder});this.clearViews(!1);for(var b=0;b<a.length;b++)this.addView(a[b],b,!1)},startAnimation:function(a,b){null==b&&(b=!0);b&&null!=this.animation&&com.vizengine.animation.Animation.terminateAnimation(this);this.animation=a;null!=this.animation&&com.vizengine.animation.Animation.requestAnimation(this)},dispatchDraw:function(){},trigerClick:function(a){return this.triggerClick(a)},triggerClick:function(a){var b=!1;null!=this.onClickCallback&&(b=
!0,this.onClickCallback.call(this,a));return b},setOnClick:function(a){if(null==a)null!=this.onTapGestureDetector&&(this.removeGestureDetector(this.onTapGestureDetector),this.onTapGestureDetector=null),this.onClickCallback=null;else{a instanceof Function&&(this.onClickCallback=a,null!=this._nativeView.div&&(this._nativeView.div.style.cursor="pointer"));var b=this;null==this.onTapGestureDetector&&(this.onTapGestureDetector=new G,this.onTapGestureDetector.callback=function(a){return b.triggerClick(a)},
this.gestureDetectors.push(this.onTapGestureDetector))}},addGestureDetector:function(a){this.gestureDetectors.push(a)},removeGestureDetector:function(a){for(var b=0;b<this.gestureDetectors;b++)if(this.gestureDetectors[b]==a){this.gestureDetectors.splice(b,1);break}},onTouch:function(a){var b=!1,d;for(d in this.gestureDetectors)this.gestureDetectors[d].detect(a)&&(b=!0);return b},getFrameInView:function(a){var b=this.getFrameInRootView();a=a.getFrameInRootView();b.x-=a.x;b.y-=a.y;return b},getRootView:function(){for(var a=
this;null!=a.parentView;)a=a.parentView;return a},getFrameInRootView:function(){for(var a=new A(this.frame),b=this;null!=b.parentView;)a.x+=b.translateX+b.parentView.frame.x,a.y+=b.translateY+b.parentView.frame.y,b=b.parentView;return a},_transformEventToChild:function(a,b){var d=new com.vizengine.math.Matrix4;d.identity();var f=new com.vizengine.math.Matrix4;f.setTranslation(a.frame.width*a.anchorX,a.frame.height*a.anchorY,0);d.multiply(f);f=new com.vizengine.math.Matrix4;f.setScale(1/a.scaleX,1/
a.scaleY,1);d.multiply(f);f=new com.vizengine.math.Matrix4;f.setTranslation(-a.frame.x-a.translateX-a.frame.width*a.anchorX,-a.frame.y-a.translateY-a.frame.height*a.anchorY,0);d.multiply(f);return b.applyMartix4(d)},dispatchKey:function(a){if(!this.visible)return!1;for(var b=0;b<this.subViews.length;b++){var d=this.subViews[b];d.visible&&d.dispatchKey(a)}},dispatchTouch:function(a){if(!this.touchable||!this.visible)return!1;if(this.isTouchInside(a)){this.touching||1!=a.state||(a=a.offsetCopy(0,0));
this.touching=2>a.state;for(var b=!1,d=!1,f=this.subViews.length,e=0;e<f;e++){var g=this.subViews[f-1-e];if(g.visible){var c=this._transformEventToChild(g,a);if(g.dispatchTouch(c)){d=!0;break}}}d||(b=this.onTouch(a));return b||d}if(this.touching){this.touching=!1;a=a.offsetCopy(0,0);a.state=3;d=b=!1;f=this.subViews.length;for(e=0;e<f;e++)if(g=this.subViews[f-1-e],g.visible&&(c=a.offsetCopy(-g.frame.x-g.translateX,-g.frame.y-g.translateY),g.dispatchTouch(c))){d=!0;break}d||(b=this.onTouch(a));return b||
d}},isTouchInside:function(a){var b=0+this.frame.width,d=0+this.frame.height,f;for(f in a.touchPoints){var e=a.touchPoints[f];if(0<e.x&&0<e.y&&e.x<b&&e.y<d)return!0}return!1},hitTest:function(a,b){return this.frame.hitTest(a-this.translateX,b-this.translateY)},dispatchLayout:function(){this.gone||(this._nativeView.setFrame(this.frame.x,this.frame.y,this.frame.width,this.frame.height),0<this.subViews.length&&(this.layoutParam.layout==p.FRAME?this.layoutChildrenByFrame():this.layoutParam.layout==p.VERTICAL?
this.layoutChildrenByVertical():this.layoutParam.layout==p.FLOW?this.layoutChildrenByFlow():this.layoutChildrenByHorizontal()),null!=this.onSizeChangeCallback&&this.onSizeChangeCallback.call(this,this.frame.width,this.frame.height))},layoutChildrenByFlow:function(){var a=this.frame.width-this.layoutParam.padding.hspace();this.layoutParam.padding.vspace();var b=this.subViews,d=this.layoutParam.padding.left,f=this.layoutParam.padding.top,e=0,g=[[]],c;for(c in b){var k=b[c],m=k.measureWidth(),n=k.measureHeight(),
p=m+k.layoutParam.margin.hspace(),q=n+k.layoutParam.margin.vspace();if(d+p>a||p>a&&d==this.layoutParam.padding.left)g[g.length-1].maxLineHeight=e,g[g.length-1].offsetY=f,g[g.length-1].offsetX=d,d=this.layoutParam.padding.left,f+=e,e=0,g.push([]);q>e&&(e=q);k.frame.x=d+k.layoutParam.margin.left;k.frame.y=f+k.layoutParam.margin.top;k.frame.width=m;k.frame.height=n;g[g.length-1].push(k);d+=p}null==g[g.length-1].maxLineHeight&&(g[g.length-1].maxLineHeight=e,g[g.length-1].offsetY=f,g[g.length-1].offsetX=
d);if(0!=(this.layoutParam.contentGravity&h.BOTTOM))for(b=this.frame.height-this.layoutParam.padding.bottom-(g[g.length-1].maxLineHeight+g[g.length-1].offsetY),c=0;c<g.length;c++)for(a=0;a<g[c].length;a++)d=g[c][a],d.frame.y+=b;else if(0!=(this.layoutParam.contentGravity&h.CENTER)||0!=(this.layoutParam.contentGravity&h.CENTER_VERTICAL))for(b=this.frame.height-this.layoutParam.padding.bottom-(g[g.length-1].maxLineHeight+g[g.length-1].offsetY),b/=2,c=0;c<g.length;c++)for(a=0;a<g[c].length;a++)d=g[c][a],
d.frame.y+=b;if(0!=(this.layoutParam.contentGravity&h.RIGHT))for(c=0;c<g.length;c++)for(b=g[c],d=this.frame.width-this.layoutParam.padding.right-b.offsetX,a=0;a<b.length;a++)b[a].frame.x+=d;else if(0!=(this.layoutParam.contentGravity&h.CENTER)||0!=(this.layoutParam.contentGravity&h.CENTER_HORIZONTAL))for(c=0;c<g.length;c++)for(b=g[c],d=this.frame.width-this.layoutParam.padding.right-b.offsetX,d/=2,a=0;a<b.length;a++)b[a].frame.x+=d;for(c=0;c<this.subViews.length;c++)k=this.subViews[c],k.dispatchLayout()},
layoutChildrenByFrame:function(){var a=this.frame.width,b=this.frame.height,d=a-this.layoutParam.padding.hspace(),f=b-this.layoutParam.padding.vspace(),e=this.subViews,g;for(g in e){var c=e[g];if(!c.gone){var k=c.measureWidth(),h=c.measureHeight(),m=0,n=0,m=c.isAlignLeft()?this.layoutParam.padding.left+c.layoutParam.margin.left:c.isAlignRight()?a-this.layoutParam.padding.right-c.layoutParam.margin.right-k:this.layoutParam.padding.left+(d-k-c.layoutParam.margin.hspace())/2+c.layoutParam.margin.left,
n=c.isAlignTop()?c.layoutParam.margin.top+this.layoutParam.padding.top:c.isAlignBottom()?b-this.layoutParam.padding.bottom-c.layoutParam.margin.bottom-h:this.layoutParam.padding.top+(f-h-c.layoutParam.margin.vspace())/2+c.layoutParam.margin.top;c.frame.x=m;c.frame.y=n;c.frame.width=k;c.frame.height=h;c.dispatchLayout()}}},layoutChildrenByVertical:function(){var a=this.frame.width,b=this.frame.height,d=a-this.layoutParam.padding.hspace(),f=b-this.layoutParam.padding.vspace(),e=this.layoutParam.padding.top,
c=this.subViews,l;for(l in c){var k=c[l];if(!k.gone){var m=k.measureWidth(),n=k.measureHeight();k.frame.width=m;k.frame.height=n;k.frame.y=e+k.layoutParam.margin.top;e+=n+k.layoutParam.margin.vspace();k.isAlignLeft()?k.frame.x=this.layoutParam.padding.left+k.layoutParam.margin.left:k.isAlignRight()?k.frame.x=a-this.layoutParam.padding.right-k.layoutParam.margin.right-m:k.frame.x=this.layoutParam.padding.left+(d-m-k.layoutParam.margin.hspace())/2+k.layoutParam.margin.left}}if(0==(this.layoutParam.contentGravity&
h.TOP))if(0!=(this.layoutParam.contentGravity&h.BOTTOM))for(l in b=b-this.layoutParam.padding.bottom-e,c)a=c[l],a.frame.y+=b;else if(0!=(this.layoutParam.contentGravity&h.CENTER)||0!=(this.layoutParam.contentGravity&h.CENTER_VERTICAL))for(l in b=(f-e+this.layoutParam.padding.top)/2,c)a=c[l],a.frame.y+=b;for(l in c)a=c[l],a.gone||a.dispatchLayout()},layoutChildrenByHorizontal:function(){var a=this.frame.width,b=this.frame.height,d=a-this.layoutParam.padding.hspace(),f=b-this.layoutParam.padding.vspace(),
e=this.layoutParam.padding.left,c=this.subViews,l;for(l in c){var k=c[l];if(!k.gone){var m=k.measureWidth(),n=k.measureHeight();k.frame.width=m;k.frame.height=n;k.frame.x=e+k.layoutParam.margin.left;e+=m+k.layoutParam.margin.hspace();k.isAlignTop()?k.frame.y=this.layoutParam.padding.top+k.layoutParam.margin.top:k.isAlignBottom()?k.frame.y=b-this.layoutParam.padding.bottom-k.layoutParam.margin.bottom-n:k.frame.y=this.layoutParam.padding.top+(f-n-k.layoutParam.margin.vspace())/2+k.layoutParam.margin.top}}if(0==
(this.layoutParam.contentGravity&h.LEFT))if(0!=(this.layoutParam.contentGravity&h.RIGHT))for(l in b=a-this.layoutParam.padding.right-e,c)a=c[l],a.frame.x+=b;else if(0!=(this.layoutParam.contentGravity&h.CENTER)||0!=(this.layoutParam.contentGravity&h.CENTER_HORIZONTAL))for(l in b=(d-e+this.layoutParam.padding.left)/2,c)a=c[l],a.frame.x+=b;for(l in c)a=c[l],a.gone||a.dispatchLayout()},isAlignLeft:function(){if(0!=(this.layoutParam.gravity&h.LEFT))return!0;if(0!=(this.layoutParam.gravity&h.RIGHT)||0!=
(this.layoutParam.gravity&h.CENTER_HORIZONTAL)||0!=(this.layoutParam.gravity&h.CENTER))return!1;var a=this.parentView;return null==a||0!=(a.layoutParam.contentGravity&h.LEFT)?!0:0!=(a.layoutParam.contentGravity&h.RIGHT)||0!=(a.layoutParam.contentGravity&h.CENTER_HORIZONTAL)||0!=(a.layoutParam.contentGravity&h.CENTER)?!1:!0},isAlignTop:function(){if(0!=(this.layoutParam.gravity&h.TOP))return!0;if(0!=(this.layoutParam.gravity&h.BOTTOM)||0!=(this.layoutParam.gravity&h.CENTER_VERTICAL)||0!=(this.layoutParam.gravity&
h.CENTER))return!1;var a=this.parentView;return null==a||0!=(a.layoutParam.contentGravity&h.TOP)?!0:0!=(a.layoutParam.contentGravity&h.BOTTOM)||0!=(a.layoutParam.contentGravity&h.CENTER_VERTICAL)||0!=(a.layoutParam.contentGravity&h.CENTER)?!1:!0},isAlignRight:function(){if(0!=(this.layoutParam.gravity&h.RIGHT))return!0;if(0!=(this.layoutParam.gravity&h.LEFT)||0!=(this.layoutParam.gravity&h.CENTER_HORIZONTAL)||0!=(this.layoutParam.gravity&h.CENTER))return!1;var a=this.parentView;return null==a?!1:
0!=(a.layoutParam.contentGravity&h.RIGHT)?!0:!1},isAlignBottom:function(){if(0!=(this.layoutParam.gravity&h.BOTTOM))return!0;if(0!=(this.layoutParam.gravity&h.TOP)||0!=(this.layoutParam.gravity&h.CENTER_VERTICAL)||0!=(this.layoutParam.gravity&h.CENTER))return!1;var a=this.parentView;return null==a?!1:0!=(a.layoutParam.contentGravity&h.BOTTOM)?!0:!1},setMinWidth:function(a){this.minWidth=null!=a?c.parseSize(a):null;this.requestLayout()},setMaxWidth:function(a){this.maxWidth=null!=a?c.parseSize(a):
null;this.requestLayout()},setMaxHeight:function(a){this.maxHeight=null!=a?c.parseSize(a):null;this.requestLayout()},measureWidth:function(){if(null!=this.measuredWidth)return this.measuredWidth;var a=this._measureWidth();null!=this.minWidth&&a<this.minWidth&&(a=this.minWidth);null!=this.maxWidth&&a>this.maxWidth&&(a=this.maxWidth);return this.measuredWidth=a},_measureWidth:function(){var a=this.parentView,b=this.subViews,d=null==a?null:a.subViews;if(this.gone)return 0;if(this.layoutParam.width==
m.MATCH)return null==a?this.measuredWidth=this.frame.width:a.measureWidth()*this.layoutParam.widthWeight;if(this.layoutParam.width==m.FILL){if(null==a)return this.frame.width;if(a.layoutParam.layout==p.FRAME||a.layoutParam.layout==p.VERTICAL)return a.measureContentWidth()-this.layoutParam.margin.hspace();var b=a.measureContentWidth(),f=0,e=0,c;for(c in d)a=d[c],a.gone||(a.layoutParam.width==m.FILL?(e+=a.layoutParam.widthWeight,f+=a.layoutParam.margin.hspace()):f+=a.measureBoxWidth());return(b-f)*
this.layoutParam.widthWeight/e}if(this.layoutParam.width==m.WRAP){d=0;if(this.layoutParam.layout==p.FRAME||this.layoutParam.layout==p.VERTICAL){for(c in b)a=b[c],a.gone||a.layoutParam.width==m.FILL||a.layoutParam.width==m.MATCH||(a=a.measureBoxWidth(),a>d&&(d=a));return d+this.layoutParam.padding.hspace()}for(c in b)a=b[c],a.gone||a.layoutParam.width==m.FILL||a.layoutParam.width==m.MATCH||(a=a.measureBoxWidth(),d+=a);return d+this.layoutParam.padding.hspace()}return this.layoutParam.width==m.MATCH_HEIGHT?
this.measureHeight()*this.layoutParam.widthWeight:this.layoutParam.width},measureHeight:function(){if(null!=this.measuredHeight)return this.measuredHeight;var a=this._measureHeight();null!=this.minHeight&&a<this.minHeight&&(a=this.minHeight);null!=this.maxHeight&&a>this.maxHeight&&(a=this.maxHeight);return this.measuredHeight=a},_measureHeight:function(){if(null!=this.measuredHeight)return this.measuredHeight;var a=this.parentView,b=this.subViews,d=null==a?null:a.subViews;if(this.gone)return 0;if(this.layoutParam.height==
m.MATCH)return null==a?this.measuredHeight=this.frame.height:this.measuredHeight=a.measureHeight()*this.layoutParam.heightWeight;if(this.layoutParam.height==m.FILL){if(null==a)return this.frame.height;if(a.layoutParam.layout==p.FRAME||a.layoutParam.layout==p.HORIZONTAL)return this.measuredHeight=a.measureContentHeight()-this.layoutParam.margin.vspace();var b=a.measureContentHeight(),f=0,e=0,c;for(c in d)a=d[c],a.gone||(a.layoutParam.height==m.FILL?(e+=a.layoutParam.heightWeight,f+=a.layoutParam.margin.vspace()):
f+=a.measureBoxHeight());return this.measuredHeight=(b-f)*this.layoutParam.heightWeight/e}if(this.layoutParam.height==m.WRAP){d=0;if(this.layoutParam.layout==p.FRAME||this.layoutParam.layout==p.HORIZONTAL){for(c in b)a=b[c],a.layoutParam.height!=m.FILL&&a.layoutParam.height!=m.MATCH&&(a=a.measureBoxHeight(),a>d&&(d=a));return this.measuredHeight=d+this.layoutParam.padding.vspace()}if(this.layoutParam.layout==p.FLOW){var d=this.measureContentWidth(),f=this.layoutParam.padding.vspace(),l=e=0;for(c in b){var a=
b[c],k=a.measureBoxWidth(),a=a.measureBoxHeight(),e=e+k;if(e>d||k>d&&0==e)f+=l,l=a,e=k;a>l&&(l=a)}return this.measuredHeight=f+l}for(c in b)a=b[c],a.layoutParam.height!=m.FILL&&a.layoutParam.height!=m.MATCH&&(a=a.measureBoxHeight(),d+=a);return this.measuredHeight=d+this.layoutParam.padding.vspace()}return this.layoutParam.height==m.MATCH_WIDTH?(d=this.measureWidth(),this.measuredHeight=d*this.layoutParam.heightWeight):this.measuredHeight=this.layoutParam.height},measureContentWidth:function(){return this.gone?
0:this.measureWidth()-this.layoutParam.padding.hspace()},measureContentHeight:function(){return this.gone?0:this.measureHeight()-this.layoutParam.padding.vspace()},measureBoxWidth:function(){return this.gone?0:this.measureWidth()+this.layoutParam.margin.hspace()},measureBoxHeight:function(){return this.gone?0:this.measureHeight()+this.layoutParam.margin.vspace()},requestLayout:function(){this.resetMeasureCache();null!=this.parentView&&this.parentView.requestLayout()},resetMeasureCache:function(){if(null!=
this.measuredWidth||null!=this.measuredHeight){this.measuredHeight=this.measuredWidth=null;for(var a=0;a<this.subViews.length;a++){var b=this.subViews[a];b.layoutParam.height!=m.FILL&&b.layoutParam.height!=m.MATCH&&b.layoutParam.width!=m.FILL&&b.layoutParam.width!=m.MATCH||b.resetMeasureCache()}}},requestDraw:function(){},getPage:function(){return this instanceof n?this:null!=this.parentView?this.parentView.getPage():null},set__template__path__:function(a){a=com.vizengine.moduleManager[a];null!=a&&
a.applyTemplateScripts(this)}});var c=com.vizengine.view.View;c.dip2px=function(a){return Math.round(a*window.devicePixelRatio)};c.px2dip=function(a){return Math.round(a/window.devicePixelRatio)};c.parseFloat=function(a,b){null==b&&(b=0);var d=parseFloat(a);return isNaN(d)?b:d};c.parseInt=function(a,b){null==b&&(b=0);var d=parseInt(a);return isNaN(d)?b:d};c.parseSize=function(a){if(null==a||""==a)return 0;if("number"==typeof a)return a;var b=m.parse(a);return b!=m.NUMBER?b:r.endsWith(a,"px")||r.endsWith(a,
"PX")?c.px2dip(c.parseFloat(a.substring(0,a.length-2))):r.endsWith(a,"dp")||r.endsWith(a,"DP")?c.parseFloat(a.substring(0,a.length-2)):c.parseFloat(a)};c.sizeToString=function(a){return m.toString(a)};c.parseBoolean=function(a){return null==a?!1:"string"==typeof a?"true"==a:a};c.deleteComment=function(a){return null==a?a:a.replace(/("([^\\\"]*(\\.)?)*")|('([^\\\']*(\\.)?)*')|(\/{2,}.*?(\r|\n|$))|(\/\*(\n|.)*?\*\/)/g,function(a){return/^\/{2,}/.test(a)||/^\/\*/.test(a)?"":a})};c.parseJson=function(a){a=
c.deleteComment(a);return JSON.parse(a)};c.inject=function(a,b,d){if(null!=a){var f=a["set"+r.firstToUpper(b)];null!=f&&f instanceof Function?f.call(a,d):a[b]=d}};c._resolveClass=function(a){if(a instanceof Function)return a;var b=eval("try{eval('com.vizengine.view."+a+"')}catch(e){}");if(null!=b&&b instanceof Function)return b;a=eval("try{eval('"+a+"')}catch(e){}");return null!=a&&a instanceof Function?a:null};c.resolvePath=function(a,b){if(null==a||null==b||""==b||r.startsWith(b,"http")||r.startsWith(b,
"/")||r.startsWith(b,"data:"))return b;r.endsWith(a,"/")&&(a=a.substring(0,a.length-1));var d=a.lastIndexOf("/");0<=d&&(a=a.substring(0,d+1));return a+b};var D=function(a,b){var d=a.attributes;return null!=d&&null!=d[b]?d[b]:a[b]},E=function(a,b){var d=a.attributes;null!=d&&null!=d[b]&&delete d[b];delete a[b]};c._resolveInstance=function(a,b){null==a&&(a="View");if("include"==a)return null;var d=c._resolveClass(a);if(null==d)throw new TypeError("can't resolve class :"+a);if(b instanceof d)return b;
d=new d;if(null==d)throw new TypeError("can't make instance for class :"+a);if(null!=b)for(var f in b)b[f]instanceof Function||c.inject(d,f,b[f]);return d};c.parse=function(a,b,d,f){"string"==typeof a&&(a=c.parseJson(a));var e=a.type;null==e&&(e="View");if("include"==e){var e=D(a,"src"),g=D(a,"data");E(a,"src");E(a,"data");null!=g&&(g=g.replace(/\'/g,'"'),g=c.parseJson(g),d=com.vizengine.mergeObject(d,g));if(com.vizengine.Module.isViewTemplate(e)){b=com.vizengine.view.View.resolvePath(f,e);b=com.vizengine.moduleManager[b].packageObject(d);
for(var l in a.attributes)"src"!=l&&"data"!=l&&c.inject(b,l,a.attributes[l])}}else b=c._resolveInstance(e,b);for(var k in a)if("type"!=k&&"children"!=k&&"__template__path__"!=k)if("attributes"==k)for(l in e=a[k],e)g=e[l],c.inject(b,l,g);else g=a[k],c.inject(b,k,g);for(k in a)if("type"!=k&&"style"!=k&&"children"==k)if(l=a[k],l instanceof Array)for(g=0;g<l.length;g++){var h=l[g],e=h.type,e=c._resolveInstance(e);null!=e?(b.addView(e),c.parse(h,e,d,f)):(e=c.parse(h,null,d,f),b.addView(e))}else h=l,e=
h.type,e=c._resolveInstance(e),null!=e?(b.addView(e),c.parse(h,e,d,f)):(e=c.parse(h,null,d,f),b.addView(e));null!=a.__template__path__&&(g=a.__template__path__,c.inject(b,"__template__path__",g));return b};c.extend("com.vizengine.view.ImageView",{init:function(){c.prototype.init.apply(this,arguments);this.crop=0;this.src=null},_createNativeView:function(){return createNativeObject("NativeImageView")},dispatchLayout:function(){this._nativeView.setPadding(this.layoutParam.padding.left,this.layoutParam.padding.top,
this.layoutParam.padding.right,this.layoutParam.padding.bottom);c.prototype.dispatchLayout.apply(this,arguments)},setRatio:function(a){this._nativeView.setRatio(c.parseFloat(a));this.requestLayout()},_measureWidth:function(){if(this.layoutParam.width==m.WRAP){var a=this._nativeView.getImageWidth(),b=this._nativeView.getImageHeight();if(this.layoutParam.height==m.WRAP){var d=b,f=a;this.maxHeight&&d>this.maxHeight&&(d=this.maxHeight);this.maxWidth&&f>this.maxWidth&&(f=this.maxWidth);a=b/a;d/f<a&&(f=
d/a);return f+this.layoutParam.padding.hspace()}if(0==b||0==a)return 0;d=this.measureHeight();return d/(b/a)}if(this.layoutParam.width==m.FILL&&this.crop){d=this.parentView.measureContentWidth();f=this.parentView.measureContentHeight();a=this._nativeView.getImageWidth();b=this._nativeView.getImageHeight();if(0==f||0==b)return 0;a/=b;return d/f>a?1==this.crop?d:f*a:1==this.crop?f*a:d}return c.prototype._measureWidth.apply(this,arguments)},_measureHeight:function(){if(this.layoutParam.height==m.WRAP){var a=
this._nativeView.getImageWidth(),b=this._nativeView.getImageHeight();if(this.layoutParam.width==m.WRAP){var d=b,f=a;this.maxHeight&&d>this.maxHeight&&(d=this.maxHeight);this.maxWidth&&f>this.maxWidth&&(f=this.maxWidth);a=b/a;d/f>a&&(d=f*a);return d+this.layoutParam.padding.vspace()}if(0==b||0==a)return 0;d=this.measureWidth();return b/a*d}if(this.layoutParam.height==m.FILL&&this.crop){d=this.parentView.measureContentWidth();f=this.parentView.measureContentHeight();a=this._nativeView.getImageWidth();
b=this._nativeView.getImageHeight();if(0==f||0==b)return 0;a/=b;return d/f>a?1==this.crop?d/a:f:1==this.crop?f:d/a}return c.prototype._measureHeight.apply(this,arguments)},setDefaultSrc:function(a){var b=this;this._nativeView.setDefaultSrc(c.resolvePath(this.getContextPath(),a),function(){b.requestLayout()})},setSrc:function(a,b){a=c.resolvePath(this.getContextPath(),a);if(a!=this.src){this.src=a;var d=this;this._nativeView.setSrc(a,function(){d.requestLayout();b&&b()})}},getSrc:function(){return this.src},
setCrop:function(a){this.crop=c.parseInt(a)},getCrop:function(){return this.crop},setStretchX:function(a){if(!r.endsWith(a,"px"))throw new TypeError("stretch should specified by px");a=c.parseInt(a.substring(0,a.length-2));this._nativeView.setStretchX(a)},setStretchWidth:function(a){if(!r.endsWith(a,"px"))throw new TypeError("stretch should specified by px");a=c.parseInt(a.substring(0,a.length-2));this._nativeView.setStretchWidth(a)},setStretchY:function(a){if(!r.endsWith(a,"px"))throw new TypeError("stretch should specified by px");
a=c.parseInt(a.substring(0,a.length-2));this._nativeView.setStretchY(a)},setStretchHeight:function(a){if(!r.endsWith(a,"px"))throw new TypeError("stretch should specified by px");a=c.parseInt(a.substring(0,a.length-2));this._nativeView.setStretchHeight(a)}});ImageView=com.vizengine.view.ImageView;c.extend("com.vizengine.view.Button",{init:function(){c.prototype.init.apply(this,arguments);this.setLayout("frame")},setBackgroundNormal:function(a){var b=new c;b.setBackground(a);0==this.subViews.length?
this.addView(b,0):this.addView(b,1)},setBackgroundPressed:function(a){var b=new c;b.setBackground(a);this.addView(b,0)},addView:function(){var a=c.prototype.addView.apply(this,arguments);1<this.subViews.length&&(this.subViews[1].setVisible(!0),this.subViews[0].setVisible(!1));return a},dispatchTouch:function(a){var b=c.prototype.dispatchTouch.apply(this,arguments);(this.isTouchInside(a)||2<=a.state)&&1<this.subViews.length&&(0==a.state?(this.subViews[1].setVisible(!1),this.subViews[0].setVisible(!0)):
2<=a.state&&(this.subViews[1].setVisible(!0),this.subViews[0].setVisible(!1)));return b}});c.extend("com.vizengine.view.ToggleButton",{init:function(){c.prototype.init.apply(this,arguments);this.setLayout("frame");this.toggle=!1;this.onToggleChangeCallback=null},setToggleChangeCallback:function(a){this.onToggleChangeCallback=a},setToggle:function(a){this.toggle=c.parseBoolean(a);if(null!=this.onToggleChangeCallback)this.onToggleChangeCallback(this.toggle);this.updateVisible()},getToggle:function(){return this.toggle},
updateVisible:function(){1<this.subViews.length&&(this.toggle?(this.subViews[0].setVisible(!0),this.subViews[1].setVisible(!1)):(this.subViews[0].setVisible(!1),this.subViews[1].setVisible(!0)))},dispatchTouch:function(a){var b=c.prototype.dispatchTouch.apply(this,arguments);if(!this.touchable)return b;this.parentView instanceof K||this.isTouchInside(a)&&2<=a.state&&this.setToggle(!this.toggle);return b}});var F=com.vizengine.view.ToggleButton;c.extend("com.vizengine.view.ToggleButtonGroup",{init:function(){c.prototype.init.apply(this,
arguments);this.onToggleChangeCallback=null;this.toggle=-1},dispatchLayout:function(a){c.prototype.dispatchLayout.apply(this,arguments);0>this.toggle&&this.setToggle(0)},setOnToggleChangeCallback:function(a){this.onToggleChangeCallback=a},setToggle:function(a){for(var b=0,d=0;d<this.subViews.length;d++){var f=this.subViews[d];if(f instanceof F){if(b==a){if(f.setToggle(!0),this.toggle=a,null!=this.onToggleChangeCallback)this.onToggleChangeCallback(a)}else f.setToggle(!1);b++}}},getToggle:function(){return this.toggle},
dispatchTouch:function(a){for(var b=c.prototype.dispatchTouch.apply(this,arguments),d=0,f=0;1!=a.status&&f<this.subViews.length;f++){var e=this.subViews[f];if(e instanceof F){0==a.state&&(e.preTouchX=a.getAbsX(),e.preTouchY=a.getAbsY());if(2==a.state){var g=a.getX(),l=a.getY(),k=a.getAbsX(),h=a.getAbsY(),k=50<Math.abs(k-e.preTouchX)||50<Math.abs(h-e.preTouchY);e.hitTest(g,l)&&!k&&this.setToggle(d)}d++}}return b}});var K=com.vizengine.view.ToggleButtonGroup;c.extend("com.vizengine.view.SelectView",
{select:function(a){for(var b=0;b<this.subViews.length;b++){var d=this.subViews[b];if(b==a){if(d.setVisible(!0),null!=d.onSelected)d.onSelected()}else d.setVisible(!1)}}});c.extend("com.vizengine.view.TextView",{text:null,html:null,init:function(){c.prototype.init.apply(this,arguments);this.setFontColor("#000000");this.setFontSize("14dp");this.setFontBold(!1);this.setLineSpace("4dp");this.setWordSpace("0dp");this.copyEnable=!com.vizengine.core.Platform.mobile},_createNativeView:function(){return createNativeObject("NativeTextView")},
setCopyEnable:function(a){this.copyEnable=c.parseBoolean(a)},dispatchTouch:function(){return c.prototype.dispatchTouch.apply(this,arguments)},dispatchLayout:function(){this._nativeView.setPadding(this.layoutParam.padding.left,this.layoutParam.padding.top,this.layoutParam.padding.right,this.layoutParam.padding.bottom);c.prototype.dispatchLayout.apply(this,arguments)},setContentGravity:function(a){c.prototype.setContentGravity.apply(this,arguments);this._nativeView.setContentGravity(this.layoutParam.contentGravity);
this.requestLayout()},setMaxLine:function(a){this.maxLine=a;this._nativeView.setMaxLine(a);this.requestLayout()},setText:function(a){a!=this.text&&(this.text=a,this._nativeView.setText(a),this.requestLayout())},getText:function(){return this.text},setHtml:function(a){this.html!=a&&(this._nativeView.setHtml(a),this.requestLayout())},_checkColor:function(a){return null==a||7>a.length||"#"!=a[0]?!1:!0},setFontFamily:function(a){this.fontFamily=a;this._nativeView.setFontFamily(a)},setFontColor:function(a){this._checkColor(a)&&
(this.fontColor=a,this._nativeView.setFontColor(a))},getFontColor:function(){return this.fontColor},setFontSize:function(a){this.fontSize=c.parseSize(a);this._nativeView.setFontSize(this.fontSize);this.requestLayout()},getFontSize:function(){return this.fontSize},setWordSpace:function(a){this.wordSpace=c.parseSize(a);this._nativeView.setWordSpace(this.wordSpace);this.requestLayout()},getWordSpace:function(){return this.wordSpace},setLineSpace:function(a){this.lineSpace=c.parseSize(a);this._nativeView.setLineSpace(this.lineSpace)},
getLineSpace:function(){return this.lineSpace},setFontBold:function(a){this.fontBold=c.parseBoolean(a);this._nativeView.setFontBold(this.fontBold?1:0)},getFontBold:function(){return this.fontBold},measureWidth:function(){if(this.layoutParam.width==m.WRAP){var a=this._nativeView.measureTextWidth()+this.layoutParam.padding.hspace();return null!=this.maxWidth&&a>this.maxWidth?this.maxWidth:a}return c.prototype.measureWidth.apply(this,arguments)},measureHeight:function(){if(this.layoutParam.height==m.WRAP){var a=
this.measureWidth(),a=this._nativeView.measureTextHeight(a)+this.layoutParam.padding.vspace();return null!=this.maxHeight&&a>this.maxHeight?this.maxHeight:a}return c.prototype.measureHeight.apply(this,arguments)}});c.extend("com.vizengine.view.TextareaView",{init:function(){c.prototype.init.apply(this,arguments);this.setFontSize("14dp");this.setFontColor("#000000");this.setFontBold(!1)},_createNativeView:function(){return createNativeObject("NativeTextareaView")},dispatchTouch:function(a){var b=c.prototype.dispatchTouch.apply(this,
arguments);this.isTouchInside(a)&&(window.__preventDefault__=!1);return b},setOnInputCallback:function(a){this.onInputCallback=a;this._nativeView.setOnInputCallback(a)},_checkColor:function(a){return null==a||7>a.length||"#"!=a[0]?!1:!0},setText:function(a){this.text=a;this._nativeView.setText(a);this.requestLayout()},getText:function(){return this.text=this._nativeView.getText()},setFontColor:function(a){this._checkColor(a)&&(this.fontColor=a,this._nativeView.setFontColor(a))},getFontColor:function(){return this.fontColor},
setMaxLength:function(a){this.maxLength=parseInt(a);this._nativeView.setMaxLength(this.maxLength)},setFontSize:function(a){this.fontSize=c.parseSize(a);this._nativeView.setFontSize(this.fontSize)},getFontSize:function(){return this.fontSize},setWordSpace:function(a){this.wordSpace=c.parseSize(a);this._nativeView.setWordSpace(this.wordSpace)},getWordSpace:function(){return this.wordSpace},setHint:function(a){this._nativeView.setHint(a)},setHintColor:function(a){this._nativeView.setHintColor(a)},setLineSpace:function(a){this.lineSpace=
c.parseSize(a);this._nativeView.setLineSpace(this.lineSpace)},getLineSpace:function(){return this.lineSpace},setFontBold:function(a){this.fontBold=c.parseBoolean(a);this._nativeView.setFontBold(this.fontBold?1:0)},getFontBold:function(){return this.fontBold}});c.extend("com.vizengine.view.InputView",{init:function(){c.prototype.init.apply(this,arguments);this.onConfirmCallback=this.onFocusChangeCallback=this.onInputCallback=null;var a=this;this._nativeView.setOnFocusChangeCallback(function(b){b&&
(v.focusedInputView=a);if(null!=a.onFocusChangeCallback)a.onFocusChangeCallback(b)});this.setFontSize("18dp");this.setFontColor("#000000");this.setContentGravity("centerVertical");this.setFontBold(!1)},_createNativeView:function(){return createNativeObject("NativeInputView")},measureHeight:function(){return this.layoutParam.height==m.WRAP?this._nativeView.measureContentHeight():c.prototype.measureHeight.apply(this,arguments)},setContentGravity:function(a){c.prototype.setContentGravity.apply(this,
arguments);this._nativeView.setContentGravity(this.layoutParam.contentGravity);this.requestLayout()},dispatchTouch:function(a){var b=c.prototype.dispatchTouch.apply(this,arguments);this.isTouchInside(a)&&this.touchable&&(window.__preventDefault__=!1);return b},dispatchLayout:function(){this._nativeView.setPadding(this.layoutParam.padding.left,this.layoutParam.padding.top,this.layoutParam.padding.right,this.layoutParam.padding.bottom);c.prototype.dispatchLayout.apply(this,arguments)},setOnInputCallback:function(a){this.onInputCallback=
a;this._nativeView.setOnInputCallback(a)},setOnFocusChangeCallback:function(a){this.onFocusChangeCallback=a},setOnConfirmCallback:function(a){this.onConfirmCallback=a;this._nativeView.setOnConfirmCallback(a)},clearFocus:function(){this._nativeView.setFocus(0)},setFocus:function(a){a=c.parseBoolean(a);this._nativeView.setFocus(a?1:0)},setText:function(a){this.text=a;this._nativeView.setText(a)},getText:function(){return""+this._nativeView.getText()},setHint:function(a){this._nativeView.setHint(a)},
setHintColor:function(a){this._nativeView.setHintColor(a)},setFontColor:function(a){this._nativeView.setFontColor(a)},setFontSize:function(a){this._nativeView.setFontSize(c.parseSize(a))},setFontBold:function(a){this.fontBold=c.parseBoolean(a);this._nativeView.setFontBold(this.fontBold?1:0)},getFontBold:function(){return this.fontBold},setInputType:function(a){this._nativeView.setInputType(a)}});var v=com.vizengine.view.InputView;v.focusedInputView=null;v.clearFocus=function(){null!=v.focusedInputView&&
v.focusedInputView.clearFocus()};var x=t.extend({init:function(){t.prototype.init.apply(this,arguments)},animateFrame:function(a,b){t.prototype.animateFrame.apply(this,arguments);if(a.verticalScroll){var d=a.getMinTranslateY(),f=a.getMaxTranslateY();if(a.translateY>f||a.translateY<d)a.startAnimation(null),d=a.velocityTrackerY.getVelocity(),a.forceMove(0,d)}else if(d=a.getMinTranslateX(),f=a.getMaxTranslateX(),a.translateX>f||a.translateX<d)a.startAnimation(null),d=a.velocityTrackerX.getVelocity(),
a.forceMove(d,0)}});c.extend("com.vizengine.view.ScrollView",{init:function(){c.prototype.init.apply(this,arguments);this.verticalScroll=!0;this.layoutParam.layout=p.VERTICAL;this.pageScrollEnable=!1;this.myGestureDetectors=[];this.maxTranslateY=this.maxTranslateX=0;this.onScrollEndCallback=null;var a=this,b=new H;b.callback=function(b,f,e){if(a.gestureEnable){if(0==e.state)a.startAnimation(null,!1),this.initTranslateY=a.translateY,this.initTranslateX=a.translateX,a.interceptState=0;else{if(2==a.interceptState)return!1;
if(a.verticalScroll){if(0==a.interceptState){e=Math.abs(b);c=Math.abs(f);if(10>(e>c?e:c))return!0;if(Math.abs(f)>Math.abs(b))a.interceptState=1;else return a.interceptState=2,!1}b=a.getMinTranslateY();e=a.getMaxTranslateY();f=this.initTranslateY+f;f>e&&(c=f-e,c*=.3+(.2-.2*c/a.frame.height),f=e+c);f<b&&(c=b-f,c*=.3+(.2-.2*c/a.frame.height),f=b-c);a.setTranslateY(f)}else{if(0==a.interceptState){e=Math.abs(b);var c=Math.abs(f);if(10>(e>c?e:c))return!0;if(Math.abs(b)>Math.abs(f))a.interceptState=1;else return a.interceptState=
2,!1}f=a.getMinTranslateX();e=a.getMaxTranslateX();b=this.initTranslateX+b;b>e&&(c=b-e,c*=.3+(.2-.2*c/a.frame.width),b=e+c);b<f&&(c=f-b,c*=.3+(.2-.2*c/a.frame.width),b=f-c);a.setTranslateX(b)}a.requestDraw()}return!0}};this.myGestureDetectors.push(b);b=new I;b.callback=function(b,f,c){a.gestureEnable&&(1==a.interceptState?a.fly(b,f):a.fly(0,0))};this.myGestureDetectors.push(b);this.gestureEnable=!0},setLayout:function(a){c.prototype.setLayout.apply(this,arguments);this.verticalScroll="horizontal"==
a?!1:!0},setGestureEnable:function(a){this.gestureEnable=c.parseBoolean(a)},hitTest:function(a,b){return this.frame.hitTest(a,b)},dispatchTouch:function(a){var b=this.touching,d=c.prototype.dispatchTouch.apply(this,arguments);if(this.isTouchInside(a))for(var f in this.myGestureDetectors)this.myGestureDetectors[f].detect(a)&&(d=!0);else if(b)for(f in a.state=3,this.myGestureDetectors)this.myGestureDetectors[f].detect(a)&&(d=!0);return d},isTouchInside:function(a){var b=this.verticalScroll?0:-this.translateX,
d=this.verticalScroll?-this.translateY:0,f=b+this.frame.width,c=d+this.frame.height,g;for(g in a.touchPoints){var l=a.touchPoints[g];if(l.x>b&&l.y>d&&l.x<f&&l.y<c)return!0}return!1},setPageScrollEnable:function(a){this.pageScrollEnable=c.parseBoolean(a)},_pullback:function(){var a=this;if(this.verticalScroll){var b=this.getMaxTranslateY();this.translateY>b?(d=new q,d.factor=2,f=new t,f.timeInterplator=d,f.fromTranslateY=this.translateY,f.toTranslateY=b,f.duration=800,f.callback=function(){a.onScrollEnd()},
this.startAnimation(f),this.requestDraw()):(b=this.getMinTranslateY(),this.translateY<b&&(d=new q,d.factor=2,f=new t,f.timeInterplator=d,f.fromTranslateY=this.translateY,f.toTranslateY=b,f.duration=800,f.callback=function(){a.onScrollEnd()},this.startAnimation(f),this.requestDraw()))}else if(b=this.getMaxTranslateX(),this.translateX>b){var d=new q;d.factor=2;var f=new t;f.timeInterplator=d;f.fromTranslateX=this.translateX;f.toTranslateX=b;f.duration=800;f.callback=function(){a.onScrollEnd()};this.startAnimation(f)}else b=
this.getMinTranslateX(),this.translateX<b&&(d=new q,d.factor=2,f=new t,f.timeInterplator=d,f.fromTranslateX=this.translateX,f.toTranslateX=b,f.duration=800,f.callback=function(){a.onScrollEnd()},this.startAnimation(f))},forceMove:function(a,b){if(this.verticalScroll){var d=.03,f=.5*Math.abs(b)/d,c=this.translateY,g=c+.5*d*f*f*(0<b?1:-1),l=this,d=new q,k=new t;k.timeInterplator=d;k.fromTranslateY=c;k.toTranslateY=g}else{var d=.03,f=.5*Math.abs(a)/d,c=this.translateX,g=c+.5*d*f*f*(0<a?1:-1),l=this,
d=new q,k=new t;k.timeInterplator=d;k.fromTranslateX=c;k.toTranslateX=g}k.duration=f;k.callback=function(){l._pullback()};this.startAnimation(k);this.requestDraw()},fly:function(a,b){var d=this;if(this.verticalScroll){var f=this.getMinTranslateY(),c=this.getMaxTranslateY();if(this.translateY>c||this.translateY<f){this.forceMove(a,b);return}c=.001;f=Math.abs(b)/c;g=.5*c*f*f*(0<b?1:-1);c=this.translateY+g;this.pageScrollEnable&&(c=0<g?Math.ceil(this.translateY/this.frame.height)*this.frame.height:Math.floor(this.translateY/
this.frame.height)*this.frame.height,f=500);g=new x;g.timeInterplator=new q(2);g.fromTranslateY=this.translateY;g.toTranslateY=c}else{f=this.getMinTranslateX();c=this.getMaxTranslateX();if(this.translateX>c||this.translateX<f){this.forceMove(a,b);return}var c=.001,f=Math.abs(a)/c,g=.5*c*f*f*(0<a?1:-1),c=this.translateX+g;this.pageScrollEnable&&(c=0<g?Math.ceil(this.translateX/this.frame.width)*this.frame.width:0>g?Math.floor(this.translateX/this.frame.width)*this.frame.width:Math.round(this.translateX/
this.frame.width)*this.frame.width,f=500);g=new x;g.timeInterplator=new q(2);g.fromTranslateX=this.translateX;g.toTranslateX=c}g.duration=f;g.callback=function(){d.onScrollEnd()};this.startAnimation(g);this.requestDraw()},onScrollEnd:function(){if(null!=this.onScrollEndCallback)this.onScrollEndCallback()},getMaxTranslateX:function(){return this.maxTranslateX},getMaxTranslateY:function(){return this.maxTranslateY},getMinTranslateY:function(){var a=0,b;for(b in this.subViews){var d=this.subViews[b],
d=-(d.frame.getBottom()+d.layoutParam.margin.bottom)+this.frame.height-this.layoutParam.padding.bottom;d<a&&(a=d)}return a},getMinTranslateX:function(){var a=0,b;for(b in this.subViews){var d=this.subViews[b],d=-(d.frame.getRight()+d.layoutParam.margin.right)+this.frame.width-this.layoutParam.padding.right;d<a&&(a=d)}return a},pageScrollForward:function(){if(this.verticalScroll){var a=this.translateY;null!=this.animation&&null!=this.animation.toTranslateY&&(a=this.animation.toTranslateY)}else a=this.translateX,
null!=this.animation&&null!=this.animation.toTranslateX&&(a=this.animation.toTranslateX);this.scrollToSmoothly(a-this.frame.width)},pageScrollBackward:function(){if(this.verticalScroll){var a=this.translateY;null!=this.animation&&null!=this.animation.toTranslateY&&(a=this.animation.toTranslateY);this.scrollToSmoothly(a+this.frame.height)}else a=this.translateX,null!=this.animation&&null!=this.animation.toTranslateX&&(a=this.animation.toTranslateX),this.scrollToSmoothly(a+this.frame.width)},startAnimation:function(){return c.prototype.startAnimation.apply(this,
arguments)},scrollToSmoothly:function(a,b){var d=this;if(this.verticalScroll){this.pageScrollEnable&&(a=this.translateY<a?Math.ceil(a/this.frame.height)*this.frame.height:this.translateX>a?Math.floor(a/this.frame.height)*this.frame.height:Math.round(a/this.frame.height)*this.frame.height);var c=this.translateY,e=this.getMinTranslateY(),g=this.getMaxTranslateY();a<e&&(a=e);a>g&&a>g;c<e&&(c=e);c>g&&(c=g);a==c?b&&b.call(d,!1):(e=new x,e.timeInterplator=new q(2),e.fromTranslateY=c,e.toTranslateY=a,e.duration=
500,e.callback=function(a){d.onScrollEnd();b&&b.call(d,a)},this.startAnimation(e,!1))}else{this.pageScrollEnable&&(a=this.translateX<a?Math.ceil(a/this.frame.width)*this.frame.width:this.translateX>a?Math.floor(a/this.frame.width)*this.frame.width:Math.round(a/this.frame.width)*this.frame.width);var e=this.getMinTranslateX(),g=this.getMaxTranslateX(),c=this.translateX;c<e&&(c=e);c>g&&(c=g);a<e&&(a=e);a>g&&(a=g);a==c?(log("not start anim due to not change:"+a),this.startAnimation(null),b&&b.call(d,
!1)):(e=new x,e.timeInterplator=new q(2),e.fromTranslateX=c,e.toTranslateX=a,e.duration=500,e.callback=function(a){d.onScrollEnd();b&&b.call(d,a)},log("start anim to :"+a),this.startAnimation(e))}}});var y=com.vizengine.view.ScrollView;u.extend("com.vizengine.view.ListViewAdaptor",{getCellView:function(a,b){null==a&&(a=new c,a.setHeight("100dp"));return a},getCount:function(){return 0}});var L=com.vizengine.view.ListViewAdaptor;y.extend("com.vizengine.view.ListView",{init:function(){y.prototype.init.apply(this,
arguments);this.adaptor=new L;this.layoutParam.layout=p.FRAME;this.cellInfos=[];this.reuseCells=[];this.lastVisiblePosition=this.firstVisiblePosition=-1;this.minTranslateX=Math.MIN_VALUE;this.maxTranslateX=0;this.minTranslateY=Math.MIN_VALUE;this.maxTranslateY=0},setAdaptor:function(a){this.adaptor=a},setLayout:function(a){this.verticalScroll="horizontal"==a?!1:!0},onScroll:function(){this.updateMinTranslateY();y.prototype.onScroll.apply(this,arguments);this.checkCells()},getMinTranslateY:function(){return this.minTranslateY},
getMinTranslateX:function(){return this.minTranslateX},dispatchLayout:function(){y.prototype.dispatchLayout.apply(this,arguments);this.checkCells()},_getLastVisibleCellTop:function(){return 0>this.lastVisiblePosition?0:this.cellInfos[this.lastVisiblePosition].top},_getLastVisibleCellHeight:function(){return 0>this.lastVisiblePosition?0:this.cellInfos[this.lastVisiblePosition].height},_getContentBottom:function(){var a=this._getLastVisibleCellTop()+this._getLastVisibleCellHeight(),b=0,b=this.verticalScroll?
this.frame.height:this.frame.width;a<b&&(a=b);return a},updateMinTranslateY:function(){var a=this.adaptor.getCount();this.lastVisiblePosition==a-1?this.verticalScroll?this.minTranslateY=-(this._getContentBottom()+this.layoutParam.padding.bottom)+this.frame.height:this.minTranslateX=-(this._getContentBottom()+this.layoutParam.padding.right)+this.frame.width:this.verticalScroll?this.minTranslateY=Math.MIN_VALUE:this.minTranslateX=Math.MIN_VALUE},checkCells:function(){this.packPreCells();this.packPostCells();
this.addPreCells();this.addPostCells()},updateCellInfo:function(a){for(var b=this.adaptor.getCount(),d=0;d<=a&&this.cellInfos.length<b;d++){var c=this.adaptor.getCellView(this.reuseCells.pop(),d);this.reuseCells.push(c);var c=this._measureCellHeight(c),e=0;0==d?e=this.verticalScroll?this.layoutParam.padding.top:this.layoutParam.padding.left:(e=this.cellInfos[d-1],e=e.top+e.height);d<this.cellInfos.length?(this.cellInfos[d].top=e,this.cellInfos[d].height=c):this.cellInfos.push({top:e,height:c})}},
ensureCellInfo:function(a){for(var b=this.adaptor.getCount();a>=this.cellInfos.length;){var d=this.cellInfos.length;if(d>=b)break;var c=this.adaptor.getCellView(this.reuseCells.pop(),d);this.reuseCells.push(c);var c=this._measureCellHeight(c),e=0;0==d?e=this.verticalScroll?this.layoutParam.padding.top:this.layoutParam.padding.left:(d=this.cellInfos[this.cellInfos.length-1],e=d.top+d.height);this.cellInfos.push({top:e,height:c})}},getFirstVisiblePosition:function(){return this.firstVisiblePosition},
getLastVisiblePosition:function(){return this.lastVisiblePosition},packPreCells:function(){if(!(0>this.firstVisiblePosition))for(var a=0,b=this.getScrollTop();this.firstVisiblePosition<this.cellInfos.length;){a=this.cellInfos[this.firstVisiblePosition].top+this.cellInfos[this.firstVisiblePosition].height;if(a>b)break;this._removeCellView(this.firstVisiblePosition);this.firstVisiblePosition++}},packPostCells:function(){if(!(0>this.lastVisiblePosition))for(var a=0,b=this.getScrollBottom();0<=this.lastVisiblePosition;){a=
this.cellInfos[this.lastVisiblePosition].top;if(a<b)break;this._removeCellView(this.lastVisiblePosition);this.lastVisiblePosition--}},_removeCellView:function(a){var b=this.cellInfos[a].view;null!=b&&(this.reuseCells.push(b),this.verticalScroll?b.setTranslateY(-10*this.cellInfos[a].height):b.setTranslateX(-10*this.cellInfos[a].height),this.cellInfos[a].view=null)},addPreCells:function(){if(0!=this.adaptor.getCount()){var a=0,b=this.getFirstVisiblePosition();0<=b&&(this.ensureCellInfo(b),a=this.cellInfos[b].top);
for(var d=this.getScrollTop();a>d;){var c=b-1;if(0>c)break;this.ensureCellInfo(c);var e=this.adaptor.getCellView(this.reuseCells.pop(),c),a=this.cellInfos[c].top;this._addCellView(e,c,a,this.cellInfos[c].height);b--;this.firstVisiblePosition--}}},addPostCells:function(){if(0!=this.adaptor.getCount()){var a=0,b=this.getLastVisiblePosition();0<=b&&(this.ensureCellInfo(b),a=this.cellInfos[b].top+this.cellInfos[b].height);for(var d=this.getScrollBottom();a<d;){var c=b+1;if(c>=this.adaptor.getCount())break;
this.ensureCellInfo(c);var e=this.adaptor.getCellView(this.reuseCells.pop(),c),g=this.cellInfos[c].height,a=this.cellInfos[c].top;this._addCellView(e,c,a,g);a+=g;b++;0>this.firstVisiblePosition&&(this.firstVisiblePosition=0);this.lastVisiblePosition++}}},_addCellView:function(a,b,d,c){this.cellInfos[b].view=a;a._top_=d;a._height_=c;if(null==a.parentView){this.addView(a,null,!1);var e=this;a._requestedLayout_=!1;a._dispatchLayout_=function(){this._requestedLayout_=!1;e.verticalScroll?(this.frame.x=
e.layoutParam.padding.left+this.layoutParam.margin.left,this.frame.y=e.layoutParam.padding.top+this.layoutParam.margin.top,this.frame.width=this.measureWidth(),this.frame.height=this._height_-this.layoutParam.margin.vspace(),this.dispatchLayout(),this.setTranslateY(this._top_+this.layoutParam.margin.top-this.frame.y)):(this.frame.x=e.layoutParam.padding.left+this.layoutParam.margin.left,this.frame.y=e.layoutParam.padding.top+this.layoutParam.margin.top,this.frame.height=this.measureHeight(),this.frame.width=
this._height_-this.layoutParam.margin.hspace(),this.dispatchLayout(),this.setTranslateX(this._top_+this.layoutParam.margin.left-this.frame.x))};a.requestLayout=function(){this._requestedLayout_||(this._requestedLayout_=!0,setTimeout(function(){a._dispatchLayout_()},0))}}a.requestLayout()},_measureCellHeight:function(a){var b=0;null==a.parentView?(a.parentView=this,b=this.verticalScroll?a.measureBoxHeight():a.measureBoxWidth(),a.parentView=null):b=this.verticalScroll?a.measureBoxHeight():a.measureBoxWidth();
return b},getScrollTop:function(){return this.verticalScroll?-this.translateY:-this.translateX},getScrollBottom:function(){return this.verticalScroll?-this.translateY+this.frame.height:-this.translateX+this.frame.width},notifyDataChanged:function(){var a=this.adaptor.getCount();this.lastVisiblePosition>=a&&(this.lastVisiblePosition=a-1,this.firstVisiblePosition>=this.lastVisiblePosition&&(this.firstVisiblePosition=this.lastVisiblePosition));this.updateCellInfo(this.lastVisiblePosition);for(var a=
[],b=this.firstVisiblePosition;b<=this.lastVisiblePosition&&0<=b;b++){var d=this.adaptor.getCellView(this.cellInfos[b].view,b);this._addCellView(d,b,this.cellInfos[b].top,this.cellInfos[b].height);a.push(d)}for(b=this.subViews.length-1;0<=b;b--)0>a.indexOf(this.subViews[b])&&this.subViews[b].setTranslateY(-1024);this.checkCells();0<this.frame.width&&0<this.frame.height&&this.fly(0,0)},reset:function(){this.firstVisiblePosition=this.lastVisiblePosition=-1;this.clearViews();this.cellInfos.length=0;
this.checkCells()}});var M=com.vizengine.view.ListView;c.extend("com.vizengine.view.PullToRefreshView",{init:function(){c.prototype.init.apply(this,arguments);this.headerViewContainer=new c;this.addView(this.headerViewContainer);this.headerView=null;this.listView=new M;this.addView(this.listView);var a=this;this.listView.onScrollCallback=function(){a.headerViewContainer.setTranslateY(a.listView.translateY);if(null!=a.listView.adaptor&&null!=a.listView.adaptor.onPull&&0<=a.listView.translateY&&0==
a.listView.maxTranslateY)a.listView.adaptor.onPull(a.listView.translateY,1)}},setLayout:function(a){c.prototype.setLayout.call(this,"frame")},dispatchTouch:function(a){c.prototype.dispatchTouch.apply(this,arguments);if(0==this.listView.maxTranslateY)if(0==a.state){if(null!=this.listView.adaptor&&null!=this.listView.adaptor.onPull)this.listView.adaptor.onPull(this.listView.translateY,0)}else if(2<=a.state&&null!=this.listView.adaptor&&null!=this.listView.adaptor.onPull){var b=this.listView.translateY>
this.headerView.frame.height?2:3;2==b&&(this.listView.maxTranslateY=this.headerView.frame.height);this.listView.adaptor.onPull(this.listView.translateY,b)}},setHeaderView:function(a){var b=a.measureBoxHeight();a.layoutParam.margin.top-=b;this.headerView=a;this.headerViewContainer.addView(a)},getHeaderView:function(){return this.headerView},setAdaptor:function(a){this.listView.setAdaptor(a)},notifyDataChanged:function(){this.listView.notifyDataChanged();this.listView.maxTranslateY=0;0<this.listView.translateY&&
this.listView._pullback()}});c.extend("com.vizengine.view.ScannerView",{init:function(){c.prototype.init.apply(this,arguments)},_createNativeView:function(){return createNativeObject("NativeScannerView")},setScannerRect:function(a,b,d,c){this._nativeView.setScannerRect(a,b,d,c)},scan:function(a){this._nativeView.scan(a)}});c.extend("com.vizengine.view.WebView",{_createNativeView:function(){return createNativeObject("NativeWebView")},setSrc:function(a,b){this._nativeView.setSrc(a,function(){b&&b()})},
setData:function(a){this._nativeView.setData(a);this.requestLayout()},measureHeight:function(){if(this.layoutParam.height==m.WRAP){var a=this.measureWidth();return this._nativeView.measureContentHeight(a)}return c.prototype.measureHeight.apply(this,arguments)}});c.extend("com.vizengine.view.Page",{_backPage:null,init:function(){c.prototype.init.apply(this,arguments)},updateStatusBarLight:function(){var a=n.defaultStatusBarLight;null!=this.statusBarLight&&(a=this.statusBarLight);com.vizengine.$.setStatusBarLight(a);
com.vizengine.$.setStatusBarHidden(this.statusBarHidden&&"true"==this.statusBarHidden?1:0)},onPageWillShown:function(a){},onPageDidShown:function(a){},onPageWillHidden:function(a){},onPageDidHidden:function(a){},backward:function(a){if(!(2>this._getPageStack().length)&&this.peek().pageInstance==this)if(this.parentView._switching)log("WARN: backward when page swithing");else{this.parentView._switching=!0;this.pop();var b=this.peekAndRestore();a=com.vizengine.core.RequestUtil.getRequestParam("?"+a);
a=n.getPageAnimation(a.frameworkParams.animation,!1);this._cancelPageAnimation();var d=this.parentView;d.addView(b.pageInstance,0);b.pageInstance.updateStatusBarLight();this.onPageWillHidden(!1);b.pageInstance.onPageWillShown(!1);var c=this;null!=a?(d.touchable=!1,a(this,b.pageInstance,function(){d.touchable=!0;d.removeView(c);c.onPageDidHidden(!1);b.pageInstance.onPageDidShown(!1);n.navigationListener&&n.navigationListener(b.pageInstance);d._switching=!1})):(d.removeView(this),this.onPageDidHidden(!1),
b.pageInstance.onPageDidShown(!1),d._switching=!1)}},forwardTo:function(a,b){var d=this.parentView;if(d._switching)log('WARN: forward To "'+a+'" when page swithing');else{d._switching=!0;a=c.resolvePath(this.getContextPath(),a);var f=this;this.loadPage(a,b,function(a){f._forwardToPage(a)})}},_forwardToPage:function(a){var b=n.getPageAnimation(a.pageParam.frameworkParams.animation,!0);this._cancelPageAnimation();this.push(a);var d=this.parentView;d.addView(a);var c=this;a.updateStatusBarLight();this.onPageWillHidden(!0);
a.onPageWillShown(!0);null!=b?(d.touchable=!1,b(this,a,function(){d.touchable=!0;d.removeView(c);c.onPageDidHidden(!0);a.onPageDidShown(!0);n.navigationListener&&n.navigationListener(a);d._switching=!1})):(d.removeView(this),this.onPageDidHidden(!0),a.onPageDidShown(!0),n.navigationListener&&n.navigationListener(a),d._switching=!1,this.requestLayout())},_cancelPageAnimation:function(){for(var a=this.parentView,b=0;b<a.subViews.length;b++)a.subViews[b].startAnimation(null)},_getPageStack:function(){null==
this.parentView.pageStack&&(this.parentView.pageStack=[]);return this.parentView.pageStack},push:function(a){this._getPageStack().push({pageInstance:a,pageParam:a.pageParam,pageCallback:a.pageCallback})},peek:function(a){null==a&&(a=0);var b=this._getPageStack();return 0==b.length?null:b[b.length-1-a]},peekAndRestore:function(a){a=this.peek(a);a.pageInstance.pageParam=a.pageParam;a.pageInstance.pageCallback=a.pageCallback;return a},pop:function(){var a=this._getPageStack();return 0==a.length?null:
a.pop()},loadPage:function(a,b,d){var f=com.vizengine.core.RequestUtil.getRequestParam(a),e=a.indexOf("?");0<=e&&(a=a.substring(0,e));module(a,function(e){var l=null;e instanceof n?l=e:e instanceof Function&&(c.parseBoolean(f.frameworkParams.singleInstance)?(null==e.instance&&(e.instance=e(f)),l=e.instance):l=e(f));null==l.contextPath&&(l.contextPath=a);l.pageParam=f;l.pageCallback=b;if("clearTop"==f.frameworkParams.launchMode){e=l._getPageStack();for(var k=0;k<e.length;k++)if(e[k].pageInstance.getContextPath()==
l.getContextPath()){e.length=k;break}}d(l)})}});var n=com.vizengine.view.Page;n.loadPage=function(a,b,d){var f=com.vizengine.core.RequestUtil.getRequestParam(a),e=a.indexOf("?");0<=e&&(a=a.substring(0,e));module(a,function(e){var l=null;e instanceof n?l=e:e instanceof Function&&(c.parseBoolean(f.frameworkParams.singleInstance)?(null==e.instance&&(e.instance=e(f)),l=e.instance):l=e(f));null==l.contextPath&&(l.contextPath=a);l.pageParam=f;l.pageCallback=b;d(l)})};n.navigationListener=null;n.defaultStatusBarLight=
!1;n.getPageAnimation=function(a,b){var d=n.pageAnimaions[a];return d?d:b?n.pageAnimaions.pushLeft:n.pageAnimaions.popRight};n.registAnimation=function(a,b){n.pageAnimaions[a]=b};n.pageAnimaions={"null":function(a,b,d){d()},pushLeft:function(a,b,d){var c=new q(2);a.setTranslateX(0);b.setTranslateX(a.frame.width);var e=new w;e.animateFrame=function(d,c){a.setTranslateX(0-a.frame.width*c);b.setTranslateX(a.frame.width*(1-c))};e.duration=700;e.timeInterplator=c;e.callback=function(){d();a.setTranslateX(0);
b.setTranslateX(0)};a.startAnimation(e)},popRight:function(a,b,d){var c=new q(2),e=new w;e.animateFrame=function(c,d){a.setTranslateX(a.frame.width*d);b.setTranslateX(a.frame.width*(d-1))};e.duration=700;e.timeInterplator=c;e.callback=function(){d();a.setTranslateX(0);b.setTranslateX(0)};a.setTranslateX(0);b.setTranslateX(-a.frame.width);a.startAnimation(e)},pushTop:function(a,b,d){var c=new q(2);a.setTranslateX(0);b.setTranslateX(0);a.setTranslateY(0);b.setTranslateY(a.frame.height);var e=new w;
e.animateFrame=function(c,d){b.setTranslateY(a.frame.height*(1-d))};e.duration=700;e.timeInterplator=c;e.callback=function(){d();b.setTranslateY(0)};a.startAnimation(e)},popBottom:function(a,b,c){var f=new q(2);a.setTranslateX(0);b.setTranslateX(0);a.setTranslateY(0);b.setTranslateY(0);var e=new w;e.animateFrame=function(b,c){a.setTranslateY(a.frame.height*c)};e.duration=700;e.timeInterplator=f;e.callback=function(){c();b.setTranslateX(0)};a.startAnimation(e)},alpha:function(a,b,c){var f=new q(2),
e=new w;e.animateFrame=function(c,d){a.setAlpha(1-d);b.setAlpha(d)};e.duration=700;e.timeInterplator=f;e.callback=function(){c();a.setAlpha(1);b.setAlpha(1)};a.startAnimation(e)}};c.extend("com.vizengine.view.MapViewInternal",{_createNativeView:function(){return createNativeObject("NativeMapView")}});c.extend("com.vizengine.view.MapView",{init:function(){c.prototype.init.apply(this,arguments);this.viewportChangeCallback=null;this.innerMapView=new com.vizengine.view.MapViewInternal;this.addView(this.innerMapView);
var a=this;this.innerMapView._nativeView.setViewportChangeCallback(function(){a.viewportChangeCallback&&a.viewportChangeCallback()})},clearViews:function(a){for(;1<this.subViews.length;)this.removeViewAt(1,a)},start:function(){this.innerMapView._nativeView.start()},stop:function(){this.innerMapView._nativeView.stop()},addView:function(a,b,d){a!=this.innerMapView&&a._nativeView.setTouchable(0);return"undefined"==typeof b?c.prototype.addView.apply(this,arguments):c.prototype.addView.call(this,a,b+1,
d)},addMarker:function(a){this.innerMapView._nativeView.addMarker(a._nativeView,a)},removeMarker:function(a){this.innerMapView._nativeView.removeMarker(a)},clearMarkers:function(){this.innerMapView._nativeView.clearMarkers()},selectMarker:function(a){this.innerMapView._nativeView.selectMarker(a)},updateMarker:function(a){this.innerMapView._nativeView.updateMarker(a._nativeView,a)},getCoordinate:function(a){return this.innerMapView._nativeView.getCoordinate(a)},getPoint:function(a){return this.innerMapView._nativeView.getPoint(a)},
setMapCenter:function(a,b){null==b&&(b=!1);this.innerMapView._nativeView.setMapCenter(a,b?1:0)},setZoom:function(a,b){null==b&&(b=!1);this.innerMapView._nativeView.setZoom(a,b?1:0)},setMapBound:function(a,b){null==b&&(b=!1);this.innerMapView._nativeView.setMapBound(a,b?1:0)},getZoom:function(){return this.innerMapView._nativeView.getZoom()},getMapCenter:function(){return this.getCoordinate({x:this.frame.width/2,y:this.frame.height/2})},disableRotateCamera:function(){this.innerMapView._nativeView.disableRotateCamera()}});
window.createRootView=function(a){var b=new c(a);b.checkAndHideKeyboard=function(a,b){var c=com.vizengine.view.InputView.focusedInputView;null!=c&&(c=c.getFrameInRootView(),(a<c.x||a>c.x+c.width||b<c.y||b>c.y+c.height)&&com.vizengine.view.InputView.clearFocus())};b.latestEvent=null;b.nativeTouch=function(a,c){var e=com.vizengine.gesture.TouchEvent,g=null;switch(a){case 0:g=latestEvent=new e;for(e=g.state=0;e<c.length/2;e++){var h=new z;h.absX=h.x=c[2*e];h.absY=h.y=c[2*e+1];g.touchPoints[e]=h}return b.dispatchTouch(g);
case 2:g=new e;g.state=2;for(e=0;e<c.length/2;e++)h=new z,h.absX=h.x=c[2*e],h.absY=h.y=c[2*e+1],g.touchPoints[e]=h;0==g.touchPoints.length&&(g.touchPoints=latestEvent.touchPoints,g.ghost=!0);e=b.dispatchTouch(g);b.checkAndHideKeyboard(g.getAbsX(),g.getAbsY());return e;case 1:g=latestEvent=new e;g.state=1;for(e=0;e<c.length/2;e++)h=new z,h.absX=h.x=c[2*e],h.absY=h.y=c[2*e+1],g.touchPoints[e]=h;return b.dispatchTouch(g)}return!1};b.onKeyboardChange=function(a){var c=v.focusedInputView;if(null!=c)if(0<
a){var e=this.frame,c=c.getFrameInRootView().getBottom();a=e.getBottom()-a-20;c>a&&(e=new com.vizengine.animation.TranslateAnimation,e.fromTranslateY=0,e.toTranslateY=a-c,e.duration=300,e.timeInterplator=new com.vizengine.animation.DecelerateInterpolator(2),e.callback=function(){window.rootView.subViews[0].requestLayout()},this.subViews[0].startAnimation(e))}else e=new com.vizengine.animation.TranslateAnimation,e.fromTranslateY=this.subViews[0].translateY,e.toTranslateY=0,e.duration=300,e.timeInterplator=
new com.vizengine.animation.DecelerateInterpolator(2),e.callback=function(){b.subViews[0].requestLayout()},this.subViews[0].startAnimation(e)};b.initRootView=function(a){a instanceof Function&&(a=a());a.setClipToBounds(!0);b.clearViews();b.addView(a);b.resize();a instanceof n&&(a.push(a),a.updateStatusBarLight(),a.onPageWillShown(!0),a.onPageDidShown(!0),n.navigationListener&&n.navigationListener(a))};b.isLayouting=!1;b.isLayoutDirty=!0;b.resize=function(){this.isLayoutDirty=!1;this.isLayouting=!0;
var a=window.nativeRootView.getViewportWidth(),b=window.nativeRootView.getViewportHeight();0<a&&0<b&&(this.frame.width=a,this.frame.height=b,this.dispatchLayout(),this.requestDraw(),this.setVisible(!0));this.isLayouting=!1;this.isLayoutDirty&&this.resize()};b.interceptMethod("requestLayout",function(){var a=this._origin.apply(this,arguments);this.isLayouting?this.isLayoutDirty=!0:(this.isLayouting=!0,setTimeout(function(){b.resize()},0));return a});return b}});
]]></res>
</bundle>
