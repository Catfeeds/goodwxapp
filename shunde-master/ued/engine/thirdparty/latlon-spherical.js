if("undefined"!=typeof module&&module.exports)var Dms=require("./dms");function LatLon(a,c){if(!(this instanceof LatLon))return new LatLon(a,c);this.lat=Number(a);this.lon=Number(c)}
LatLon.prototype.distanceTo=function(a,c){if(!(a instanceof LatLon))throw new TypeError("point is not LatLon object");var b=c=void 0===c?6371E3:Number(c),d=this.lat.toRadians(),e=this.lon.toRadians(),g=a.lat.toRadians(),f=a.lon.toRadians(),h=g-d,e=f-e,d=Math.sin(h/2)*Math.sin(h/2)+Math.cos(d)*Math.cos(g)*Math.sin(e/2)*Math.sin(e/2);return 2*b*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))};
LatLon.prototype.bearingTo=function(a){if(!(a instanceof LatLon))throw new TypeError("point is not LatLon object");var c=this.lat.toRadians(),b=a.lat.toRadians();a=(a.lon-this.lon).toRadians();return(Math.atan2(Math.sin(a)*Math.cos(b),Math.cos(c)*Math.sin(b)-Math.sin(c)*Math.cos(b)*Math.cos(a)).toDegrees()+360)%360};LatLon.prototype.finalBearingTo=function(a){if(!(a instanceof LatLon))throw new TypeError("point is not LatLon object");return(a.bearingTo(this)+180)%360};
LatLon.prototype.midpointTo=function(a){if(!(a instanceof LatLon))throw new TypeError("point is not LatLon object");var c=this.lat.toRadians(),b=this.lon.toRadians(),d=a.lat.toRadians(),e=(a.lon-this.lon).toRadians();a=Math.cos(d)*Math.cos(e);e=Math.cos(d)*Math.sin(e);b+=Math.atan2(e,Math.cos(c)+a);return new LatLon(Math.atan2(Math.sin(c)+Math.sin(d),Math.sqrt((Math.cos(c)+a)*(Math.cos(c)+a)+e*e)).toDegrees(),(b.toDegrees()+540)%360-180)};
LatLon.prototype.destinationPoint=function(a,c,b){b=void 0===b?6371E3:Number(b);a=Number(a)/b;b=Number(c).toRadians();var d=this.lat.toRadians(),e=this.lon.toRadians();c=Math.asin(Math.sin(d)*Math.cos(a)+Math.cos(d)*Math.sin(a)*Math.cos(b));a=e+Math.atan2(Math.sin(b)*Math.sin(a)*Math.cos(d),Math.cos(a)-Math.sin(d)*Math.sin(c));return new LatLon(c.toDegrees(),(a.toDegrees()+540)%360-180)};
LatLon.intersection=function(a,c,b,d){if(!(a instanceof LatLon))throw new TypeError("p1 is not LatLon object");if(!(b instanceof LatLon))throw new TypeError("p2 is not LatLon object");var e=a.lat.toRadians();a=a.lon.toRadians();var g=b.lat.toRadians();b=b.lon.toRadians();c=Number(c).toRadians();d=Number(d).toRadians();var f=g-e,h=b-a,f=2*Math.asin(Math.sqrt(Math.sin(f/2)*Math.sin(f/2)+Math.cos(e)*Math.cos(g)*Math.sin(h/2)*Math.sin(h/2)));if(0==f)return null;h=Math.acos((Math.sin(g)-Math.sin(e)*Math.cos(f))/
(Math.sin(f)*Math.cos(e)));isNaN(h)&&(h=0);g=Math.acos((Math.sin(e)-Math.sin(g)*Math.cos(f))/(Math.sin(f)*Math.cos(g)));h=(c-(0<Math.sin(b-a)?h:2*Math.PI-h)+Math.PI)%(2*Math.PI)-Math.PI;b=((0<Math.sin(b-a)?2*Math.PI-g:g)-d+Math.PI)%(2*Math.PI)-Math.PI;if(0==Math.sin(h)&&0==Math.sin(b)||0>Math.sin(h)*Math.sin(b))return null;g=Math.atan2(Math.sin(f)*Math.sin(h)*Math.sin(b),Math.cos(b)+Math.cos(h)*Math.cos(Math.acos(-Math.cos(h)*Math.cos(b)+Math.sin(h)*Math.sin(b)*Math.cos(f))));b=Math.asin(Math.sin(e)*
Math.cos(g)+Math.cos(e)*Math.sin(g)*Math.cos(c));e=a+Math.atan2(Math.sin(c)*Math.sin(g)*Math.cos(e),Math.cos(g)-Math.sin(e)*Math.sin(b));return new LatLon(b.toDegrees(),(e.toDegrees()+540)%360-180)};
LatLon.prototype.crossTrackDistanceTo=function(a,c,b){if(!(a instanceof LatLon))throw new TypeError("pathStart is not LatLon object");if(!(c instanceof LatLon))throw new TypeError("pathEnd is not LatLon object");b=void 0===b?6371E3:Number(b);var d=a.distanceTo(this,b)/b,e=a.bearingTo(this).toRadians();a=a.bearingTo(c).toRadians();return Math.asin(Math.sin(d)*Math.sin(e-a))*b};
LatLon.prototype.maxLatitude=function(a){a=Number(a).toRadians();var c=this.lat.toRadians();return Math.acos(Math.abs(Math.sin(a)*Math.cos(c))).toDegrees()};
LatLon.crossingParallels=function(a,c,b){b=Number(b).toRadians();var d=a.lat.toRadians();a=a.lon.toRadians();var e=c.lat.toRadians(),g=c.lon.toRadians()-a;c=Math.sin(d)*Math.cos(e)*Math.cos(b)*Math.sin(g);var f=Math.sin(d)*Math.cos(e)*Math.cos(b)*Math.cos(g)-Math.cos(d)*Math.sin(e)*Math.cos(b),d=Math.cos(d)*Math.cos(e)*Math.sin(b)*Math.sin(g);if(d*d>c*c+f*f)return null;b=Math.atan2(-f,c);d=Math.acos(d/Math.sqrt(c*c+f*f));c=a+b+d;return{lon1:((a+b-d).toDegrees()+540)%360-180,lon2:(c.toDegrees()+540)%
360-180}};LatLon.prototype.rhumbDistanceTo=function(a,c){if(!(a instanceof LatLon))throw new TypeError("point is not LatLon object");var b=c=void 0===c?6371E3:Number(c),d=this.lat.toRadians(),e=a.lat.toRadians(),g=e-d,f=Math.abs(a.lon-this.lon).toRadians();Math.abs(f)>Math.PI&&(f=0<f?-(2*Math.PI-f):2*Math.PI+f);e=Math.log(Math.tan(e/2+Math.PI/4)/Math.tan(d/2+Math.PI/4));d=1E-11<Math.abs(e)?g/e:Math.cos(d);return Math.sqrt(g*g+d*d*f*f)*b};
LatLon.prototype.rhumbBearingTo=function(a){if(!(a instanceof LatLon))throw new TypeError("point is not LatLon object");var c=this.lat.toRadians(),b=a.lat.toRadians();a=(a.lon-this.lon).toRadians();Math.abs(a)>Math.PI&&(a=0<a?-(2*Math.PI-a):2*Math.PI+a);return(Math.atan2(a,Math.log(Math.tan(b/2+Math.PI/4)/Math.tan(c/2+Math.PI/4))).toDegrees()+360)%360};
LatLon.prototype.rhumbDestinationPoint=function(a,c,b){b=void 0===b?6371E3:Number(b);a=Number(a)/b;b=this.lat.toRadians();var d=this.lon.toRadians(),e=Number(c).toRadians(),g=a*Math.cos(e);c=b+g;Math.abs(c)>Math.PI/2&&(c=0<c?Math.PI-c:-Math.PI-c);var f=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(b/2+Math.PI/4));a=d+a*Math.sin(e)/(1E-11<Math.abs(f)?g/f:Math.cos(b));return new LatLon(c.toDegrees(),(a.toDegrees()+540)%360-180)};
LatLon.prototype.rhumbMidpointTo=function(a){if(!(a instanceof LatLon))throw new TypeError("point is not LatLon object");var c=this.lat.toRadians(),b=this.lon.toRadians(),d=a.lat.toRadians();a=a.lon.toRadians();Math.abs(a-b)>Math.PI&&(b+=2*Math.PI);var e=(c+d)/2,c=Math.tan(Math.PI/4+c/2),d=Math.tan(Math.PI/4+d/2),d=((a-b)*Math.log(Math.tan(Math.PI/4+e/2))+b*Math.log(d)-a*Math.log(c))/Math.log(d/c);isFinite(d)||(d=(b+a)/2);return LatLon(e.toDegrees(),(d.toDegrees()+540)%360-180)};
LatLon.prototype.toString=function(a,c){return Dms.toLat(this.lat,a,c)+", "+Dms.toLon(this.lon,a,c)};void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180});void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI});"undefined"!=typeof module&&module.exports&&(module.exports=LatLon);
