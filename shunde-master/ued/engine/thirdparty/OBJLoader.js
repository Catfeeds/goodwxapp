THREE.OBJLoader=function(f){this.manager=void 0!==f?f:THREE.DefaultLoadingManager;this.materials=null;this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,
face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};
THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(f,c,e,a){var d=this,b=new THREE.XHRLoader(d.manager);b.setPath(this.path);b.load(f,function(a){c(d.parse(a))},e,a)},setPath:function(f){this.path=f},setMaterials:function(f){this.materials=f},_createParserState:function(){var f={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(c,e){if(this.object&&!1===this.object.fromDeclaration)this.object.name=c,this.object.fromDeclaration=!1!==e;else{this.object&&
"function"===typeof this.object._finalize&&this.object._finalize();var a=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;this.object={name:c||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(a,b){var c=this._finalize(!1);c&&(c.inherited||0>=c.groupCount)&&this.materials.splice(c.index,1);c={index:this.materials.length,name:a||"",mtllib:Array.isArray(b)&&0<b.length?b[b.length-1]:"",smooth:void 0!==
c?c.smooth:this.smooth,groupStart:void 0!==c?c.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(a){return{index:"number"===typeof a?a:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:this.groupEnd,groupEnd:-1,groupCount:-1,inherited:!1}}};this.materials.push(c);return c},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(a){var b=this.currentMaterial();b&&-1===b.groupEnd&&(b.groupEnd=this.geometry.vertices.length/
3,b.groupCount=b.groupEnd-b.groupStart,b.inherited=!1);!1!==a&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth});return b}};a&&a.name&&"function"===typeof a.clone&&(a=a.clone(0),a.inherited=!0,this.object.materials.push(a));this.objects.push(this.object)}},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize()},parseVertexIndex:function(c,e){var a=parseInt(c,10);return 3*(0<=a?a-1:a+e/3)},parseNormalIndex:function(c,e){var a=
parseInt(c,10);return 3*(0<=a?a-1:a+e/3)},parseUVIndex:function(c,e){var a=parseInt(c,10);return 2*(0<=a?a-1:a+e/2)},addVertex:function(c,e,a){var d=this.vertices,b=this.object.geometry.vertices;b.push(d[c+0]);b.push(d[c+1]);b.push(d[c+2]);b.push(d[e+0]);b.push(d[e+1]);b.push(d[e+2]);b.push(d[a+0]);b.push(d[a+1]);b.push(d[a+2])},addVertexLine:function(c){var e=this.vertices,a=this.object.geometry.vertices;a.push(e[c+0]);a.push(e[c+1]);a.push(e[c+2])},addNormal:function(c,e,a){var d=this.normals,b=
this.object.geometry.normals;b.push(d[c+0]);b.push(d[c+1]);b.push(d[c+2]);b.push(d[e+0]);b.push(d[e+1]);b.push(d[e+2]);b.push(d[a+0]);b.push(d[a+1]);b.push(d[a+2])},addUV:function(c,e,a){var d=this.uvs,b=this.object.geometry.uvs;b.push(d[c+0]);b.push(d[c+1]);b.push(d[e+0]);b.push(d[e+1]);b.push(d[a+0]);b.push(d[a+1])},addUVLine:function(c){var e=this.uvs,a=this.object.geometry.uvs;a.push(e[c+0]);a.push(e[c+1])},addFace:function(c,e,a,d,b,f,q,n,h,k,l,p){var g=this.vertices.length;c=this.parseVertexIndex(c,
g);e=this.parseVertexIndex(e,g);a=this.parseVertexIndex(a,g);void 0===d?this.addVertex(c,e,a):(g=this.parseVertexIndex(d,g),this.addVertex(c,e,g),this.addVertex(e,a,g));void 0!==b&&(g=this.uvs.length,c=this.parseUVIndex(b,g),e=this.parseUVIndex(f,g),a=this.parseUVIndex(q,g),void 0===d?this.addUV(c,e,a):(g=this.parseUVIndex(n,g),this.addUV(c,e,g),this.addUV(e,a,g)));void 0!==h&&(b=this.normals.length,c=this.parseNormalIndex(h,b),e=h===k?c:this.parseNormalIndex(k,b),a=h===l?c:this.parseNormalIndex(l,
b),void 0===d?this.addNormal(c,e,a):(g=this.parseNormalIndex(p,b),this.addNormal(c,e,g),this.addNormal(e,a,g)))},addLineGeometry:function(c,e){this.object.geometry.type="Line";for(var a=this.vertices.length,d=this.uvs.length,b=0,f=c.length;b<f;b++)this.addVertexLine(this.parseVertexIndex(c[b],a));a=0;for(f=e.length;a<f;a++)this.addUVLine(this.parseUVIndex(e[a],d))}};f.startObject("",!1);return f},parse:function(f){console.time("OBJLoader");var c=this._createParserState();-1!==f.indexOf("\r\n")&&(f=
f.replace("\r\n","\n"));var e=f.split("\n"),a="",d="",d="",d=0,b=[],m="function"===typeof"".trimLeft;f=0;for(var q=e.length;f<q;f++)if(a=e[f],a=m?a.trimLeft():a.trim(),d=a.length,0!==d&&(d=a.charAt(0),"#"!==d))if("v"===d)if(d=a.charAt(1)," "===d&&null!==(b=this.regexp.vertex_pattern.exec(a)))c.vertices.push(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]));else if("n"===d&&null!==(b=this.regexp.normal_pattern.exec(a)))c.normals.push(parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]));else if("t"===
d&&null!==(b=this.regexp.uv_pattern.exec(a)))c.uvs.push(parseFloat(b[1]),parseFloat(b[2]));else throw Error("Unexpected vertex/normal/uv line: '"+a+"'");else if("f"===d)if(null!==(b=this.regexp.face_vertex_uv_normal.exec(a)))c.addFace(b[1],b[4],b[7],b[10],b[2],b[5],b[8],b[11],b[3],b[6],b[9],b[12]);else if(null!==(b=this.regexp.face_vertex_uv.exec(a)))c.addFace(b[1],b[3],b[5],b[7],b[2],b[4],b[6],b[8]);else if(null!==(b=this.regexp.face_vertex_normal.exec(a)))c.addFace(b[1],b[3],b[5],b[7],void 0,void 0,
void 0,void 0,b[2],b[4],b[6],b[8]);else if(null!==(b=this.regexp.face_vertex.exec(a)))c.addFace(b[1],b[2],b[3],b[4]);else throw Error("Unexpected face line: '"+a+"'");else if("l"===d){var d=a.substring(1).trim().split(" "),n=[],h=[];if(-1===a.indexOf("/"))n=d;else for(var a=0,k=d.length;a<k;a++){var l=d[a].split("/");""!==l[0]&&n.push(l[0]);""!==l[1]&&h.push(l[1])}c.addLineGeometry(n,h)}else if(null!==(b=this.regexp.object_pattern.exec(a)))a=b[0].substr(1).trim(),c.startObject(a);else if(this.regexp.material_use_pattern.test(a))c.object.startMaterial(a.substring(7).trim(),
c.materialLibraries);else if(this.regexp.material_library_pattern.test(a))c.materialLibraries.push(a.substring(7).trim());else if(null!==(b=this.regexp.smoothing_pattern.exec(a))){if(a=b[1].trim().toLowerCase(),c.object.smooth="1"===a||"on"===a,a=c.object.currentMaterial())a.smooth=c.object.smooth}else if("\x00"!==a)throw Error("Unexpected line: '"+a+"'");c.finalize();e=new THREE.Group;e.materialLibraries=[].concat(c.materialLibraries);f=0;for(q=c.objects.length;f<q;f++)if(b=c.objects[f],a=b.geometry,
n=b.materials,m="Line"===a.type,0!==a.vertices.length){d=new THREE.BufferGeometry;d.addAttribute("position",new THREE.BufferAttribute(new Float32Array(a.vertices),3));0<a.normals.length?d.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(a.normals),3)):d.computeVertexNormals();0<a.uvs.length&&d.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(a.uvs),2));h=[];k=0;for(l=n.length;k<l;k++){var p=n[k],a=void 0;if(null!==this.materials&&(a=this.materials.create(p.name),m&&a&&
!(a instanceof THREE.LineBasicMaterial))){var g=new THREE.LineBasicMaterial;g.copy(a);a=g}a||(a=m?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial,a.name=p.name);a.shading=p.smooth?THREE.SmoothShading:THREE.FlatShading;h.push(a)}if(1<h.length){k=0;for(l=n.length;k<l;k++)p=n[k],d.addGroup(p.groupStart,p.groupCount,k);a=new THREE.MultiMaterial(h);m=m?new THREE.Line(d,a):new THREE.Mesh(d,a)}else m=m?new THREE.Line(d,h[0]):new THREE.Mesh(d,h[0]);m.name=b.name;e.add(m)}console.timeEnd("OBJLoader");
return e}};
