<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>微景平台</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0" />
    <style>
      html{
        font-size: calc(100vw / 3.75);
      }
      html,body{
        font-family: PingFangSC;
        margin: 0;
        padding: 0;
        background: #F8F8F8
      }
      .bg-wrap{
        width: 100vw;
        height: 100vh;
        background-size: 100% 100%;
        text-align: center;
        background: #F8F8F8
      }
      .contain{
        padding-top: 1.8rem;
        background: #F8F8F8;
        display: none;
      }
      #text{
        font-size: .24rem;
        line-height: .36rem;
        color: #333;
        margin: 0;
        font-weight: bold;
        letter-spacing: 2px;
        font-family: PingFangSC-Regular;
      }
      #text1 {
        font-size: .20rem;
      }
      .sub-text{
        font-size: .14rem;
      }
    </style>
  </head>
  <body>
    <div class="bg-wrap">
      <div class="contain contain-suc">
        <img src="success.jpg">
        <div id='text'>请前往PC端操作</div>
      </div>
      <div class="contain contain-fail">
        <img src="fail.jpg">
        <div id='text1'>提交失败</div>
        <div id='text'>请重新扫码</div>
      </div>
    </div>
    <script src="jquery.js"></script>
    <script>
      function urlArgs(){
          var args = {},
              data = null,
              urlData = location.search,
              arrData;
          if(arguments.length == 1){
              data = arguments[0];
              if(typeof data === "string"){
                  var arr = this.location();
                  args = arr[data] || '';
              }else if(typeof data === "object"){
                  if(urlData.indexOf('?')>-1){
                      var oldLocation = this.location();
                      var newLocation = $.extend(oldLocation, data);
                      args = '?' + $.param(newLocation);
                  }else{
                      args = '?' + $.param(data);
                  }
              }
          }else if(arguments.length == 2){
              if(arguments[1] === ''){
                  args = this.location();
                  if(args[arguments[0]]){
                      delete args[arguments[0]];
                  }
                  args = $.isEmptyObject(args) ? '' : ('?' + $.param(args));
              }else{
                  args[arguments[0]] = arguments[1];
                  args = this.location(args);
              }
          }else{
              urlData = urlData.replace('?','');
              if(urlData.indexOf('&')>-1){
                  arrData = urlData.split('&');
                  $.each(arrData,function(i,n){
                      if(n.indexOf('=')>-1){
                          n = n.split('=');
                          args[n[0]] = decodeURIComponent(n[1]+'');
                      }else{
                          args[n] = '';
                      }
                  })
              }else{
                  if(urlData.indexOf('=')>-1){
                      arrData = urlData.split('=');
                      args[arrData[0]] = arrData[1];
                  }else{
                      args[urlData] = '';
                  }
              }
          }
          return args;
      }
      let hostName =''
      hostName = location.protocol+ location.host + location.pathname;
      let server_host =''
      let appid =''
      let server_wx_host =''
      if(location.host == "shot.vb.com.cn"){
        server_host = location.protocol + "//api.shot.vb.com.cn";
        server_wx_host = location.protocol + "//pay.visualbusiness.cn/pay-service/identity/wx/userInfo";
        appid = "wx7e0e1de2365ddbaf"
      }else if (location.host == "shot.vizen.cn") {
        server_host = location.protocol + "//api.shot.vb.com.cn";
        server_wx_host = location.protocol + "//pay.visualbusiness.cn/pay-service/identity/wx/userInfo";
        appid = "wx7e0e1de2365ddbaf"
      }else if (location.host == "shot.pre.visualbusiness.cn") {
        server_host = location.protocol + "//api.shot.pre.visualbusiness.cn";
        server_wx_host = location.protocol + "//pay.visualbusiness.cn/pay-service/identity/wx/userInfo";
        appid = "wx7e0e1de2365ddbaf"
      } else if(location.host == "shot.test.vb.com.cn"){
        server_host = location.protocol + "//api.shot.test.vb.com.cn";
        server_wx_host = location.protocol + "//luna-test.visualbusiness.cn/pay-service/identity/wx/userInfo";
        appid = "wx7423eda676c24b7f"
      } else {
        server_host = location.protocol + "//localhost:8083";
        server_wx_host = location.protocol + "//luna-test.visualbusiness.cn/pay-service/identity/wx/userInfo";
        appid = "wx7423eda676c24b7f"
      }
      console.log(hostName)
      window.onload=function(){
        let args = urlArgs();
        console.log(args)
        if (!args.openId) {
          window.location.href = server_wx_host + "?appId=" + appid + '&redirectUrl=' + location.href;
        } else {
          $.ajax({
            type:"POST",
            url: server_host + "/api/weixin/scanCashOutResult",
            dataType:"json",
            data:{
              random: args.random,
              openId: args.openId
            },
            success:function(json){
              $(".contain-suc").css("display","block");
            },
            error:function(json){
              console.log("error")
              $(".contain-fail").css("display","block");
            }
          });
        }
      }
    </script>
  </body>
</html>
