<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="ThemeBucket">
		<link rel="shortcut icon" href="#" type="image/png">

		<title>广告位管理</title>
		<!--pickers css-->
		<link rel="stylesheet" type="text/css" href="js/bootstrap-datepicker/css/datepicker-custom.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-timepicker/css/timepicker.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-colorpicker/css/colorpicker.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-daterangepicker/daterangepicker-bs3.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-datetimepicker/css/datetimepicker-custom.css" />
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/select2.min.css"/>
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
			  <script src="js/html5shiv.js"></script>
			  <script src="js/respond.min.js"></script>
			  <![endif]-->
		<!-- Placed js at the end of the document so the pages load faster -->
		<script src="js/jquery-1.10.2.min.js"></script>
		<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
		<script src="js/jquery-migrate-1.2.1.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/modernizr.min.js"></script>
		<script src="js/jquery.nicescroll.js"></script>

		<!--pickers plugins-->
		<script type="text/javascript" src="js/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-daterangepicker/moment.min.js"></script>
		<script type="text/javascript" src="js/bootstrap-daterangepicker/daterangepicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>

		<!--bootstrap Table-->
		<script src='js/bootstrap-table.js'></script>
		<script src='js/bootstrap-table-zh-CN.js'></script>
		<script src='js/bootstrap-editable.js'></script>
		<script src='js/bootstrap-table-editable.js'></script>

		<!--pickers initialization-->
		<script src="js/pickers-init.js"></script>

		<!--common scripts for all pages-->
		<script src="js/layer.js"></script>
		<script src="js/scripts.js"></script>
		<script src="js/ysh_comm.js"></script>
		<script src="js/MD5.js"></script>
		<script src="js/select2.min.js"></script>
		<!--bootStrap Validator-->
		<script type="text/javascript" src="js/bootstrapValidator.js"></script>

		<script type="text/javascript">
			checkPermission();
		</script>
	</head>

	<body class="children-body">
		<section>
			<div>
				<section class="panel">
					<div class="panel-body">
						<div class="page-heading">
							<h3 id="htt"></h3>
						</div>
					</div>
				</section>

				<section class="wrapper">
					<section class="panel">
						<div class="panel-body">
							<div class="col-lg-6">
								<form class="form-horizontal" role="form" id="condition">
									<div class="row" style="height: 14px;"></div>
									<div class="row" id="ADdiv">
										<div class="col-lg-2" style="text-align: right;">
											<span>广告位编号:</span>
										</div>

										<div class="col-lg-7">
											<input type="text" class="form-control" readonly="readonly" id="ADId" name="ADId" />
										</div>
									</div>
									<div class="row" style="height: 14px;"></div>

									<div class="row">
										<div class="col-lg-2" style="text-align: right;">
											<span>广告位名称:</span>
										</div>

										<div class="col-lg-7">
											<input type="text" class="form-control" id="ADName" name="ADName" />
										</div>
										<div class="col-lg-1">
											<span style="color:red">*</span>
										</div>
									</div>

									<div class="row" style="height: 14px;"></div>

									<div class="row">
									<div class="col-lg-2" style="text-align: right;">
										<span>广告位页面:</span>
									</div>

									<div class="col-lg-7">
										<input type="text" class="form-control" id="ADPage" name="ADPage" />
									</div>
									<div class="col-lg-1">
										<span style="color:red">*</span>
									</div>
								</div>

								<div class="row" style="height: 14px;"></div>

								<div class="row">
									<div class="col-lg-2" style="text-align: right;">
										<span>广告位容器:</span>
									</div>
									<div class="col-lg-7">
										<input type="text" class="form-control" id="ADContainerHide" style="display: none;"/>
										<select name="" id="ADContainer" name="ADContainer" class="form-control">
											<option value="0">请选择</option>
										</select>
									</div>
									<div class="col-lg-1">
										<span style="color:red">*</span>
									</div>
								</div>

								<div class="row" style="height: 14px;"></div>

								<div class="row">
									<div class="col-lg-2" style="text-align: right;">
										<span>是否启用:</span>
									</div>
									<div class="col-lg-7">
										<input type="checkbox" id="Active" name="Active" />
									</div>
									<!--<div class="col-lg-1">
										<span style="color:red">*</span>
									</div>-->
								</div>

								<div class="row" style="height: 14px;"></div>

								<div class="row">
									<div class="col-lg-2" style="text-align: right;">
										<span>备注:</span>
									</div>
									<div class="col-lg-7">
										<textarea  style="resize: none;" rows="5" class="form-control" id="Remark" name="Remark"> </textarea>
									</div>
								</div>

								<div class="row" style="height: 14px;"></div>

								<div class="row">
									<div class="col-lg-2" style="text-align: right;">

									</div>
									<div class="col-lg-7 text-center">
										<button class="btn btn-success" onclick="change()" id="confirm" id="bconfirm">保存</button>
										<button class="btn btn-danger" onclick="redirectToList()" id="bcancel">取消</button>
									</div>
								</div>

								</form>
							</div>

							<div class="col-lg-6 text-center">
								<div class="row" style="height: 28px;"></div>
								<div class="row text-center"><strong>广告位示意图</strong></div>
								<div class="row" style="height: 14px;"></div>
								<div class="row"><img src="images/adcs.jpg" alt="" /></div>
							</div>
						</div>
					</section>
				</section>
			</div>
		</section>

		<script>
			var $condition = $("#condition")

			function redirectToList() {
				window.history.back();
			}
			//转换查询条件
			function convertToParams(array) {
				var obj = {};
				$.each(array, function(i, v) {
					obj[v.name] = v.value;
				})
				return obj;
			}

			function change() {
				$form.data('bootstrapValidator').validate();
				if($form.data('bootstrapValidator').isValid()) {
					var ADContainer = $("#ADContainer").val();
					var p = parseUrl();
					var conditions = convertParams("condition");
					conditions.ADContainer = ADContainer;
					if(conditions.Active == "on") {
						conditions.Active = 1;
					} else {
						conditions.Active = 0;
					}
					if(p.name == "Add") {
						if(conditions.ADContainer == 0){
							ysh_msg("请选择广告位容器");
						} else {
							getDataList(yshurl + "SC_ADPosition_Edit_insertInfo", conditions, function(d) {
								ysh_msg("添加广告位成功！");
								setTimeout(function() {
									window.history.back();
								}, 1500);
							});
						}
					} else if(p.name == "Edit") {
						if(conditions.Active == 0) {
							conditions.Positionid = conditions.ADId
							getDataList(yshurl + "DeleteADposition", conditions, function(ret) {
								if(ret.aaData[0][0].content != 0) {
									ysh_msg("广告位被占用中，不允许删除")
								} else {
									if(conditions.ADContainer == 0){
										ysh_msg("请选择广告位容器");
									} else {
										getDataList(yshurl + "SC_ADPosition_Edit_UpdateInfo", conditions, function(d) {
											ysh_msg("更新广告位成功！");
											setTimeout(function() {
												window.history.back();
											}, 1500);
										});
									}
								}
							}, true)
						} else {
							if(conditions.ADContainer == 0){
								ysh_msg("请选择广告位容器");
							} else {
								getDataList(yshurl + "SC_ADPosition_Edit_UpdateInfo", conditions, function(d) {
									ysh_msg("更新广告位成功！");
									setTimeout(function() {
										window.history.back();
									}, 1500);
								});
							}
						}
					}
				}
			}
			//从url中提取参数		   	
			function parseUrl() {
				var url = location.href;
				var i = url.indexOf('?');
				if(i == -1) return;
				var querystr = url.substr(i + 1);
				var arr1 = querystr.split('&');
				var arr2 = new Object();
				for(i in arr1) {
					var ta = arr1[i].split('=');
					arr2[ta[0]] = ta[1];
				}
				return arr2;
			}
			//构建select
			function appendSelectList(f1, array) {
				$.each(array, function(i, v) {
					f1.append("<option value=" + v.value + ">" + v.text + "</option>");
				});
			}

			//获取广告位容器下拉
			function getChannelSelect(callback) {
				var url = yshurl + "GetADpositionMainList"
				var param = {}
				getDataList(url, param, function(ret) {
					callback && callback(ret)
				}, true)
			}
			// 初始化表格
			function initFormData(obj, flag) {
				$.each(obj, function(i, v) {
					if(v != null) {
						if($("#" + i).is("p"))
							$("#" + i).text(v);
						else if($("#" + i).attr("type") == "checkbox") {
							if(v == 1)
								$("#" + i).attr("checked", true);
						} else
							$("#" + i).val(v);
					}
					if(flag == 1)
						$("#" + i).attr("disabled", "disabled");
				})
			}
			var $form = $('#condition');
			$(function() {
				var params = parseUrl();
				var id = params.Id;
				
				$('select').select2();
				
				//获取广告位容器下拉
				getChannelSelect(function(ret) {
					var str = ""
					for(var num in ret.aaData) {
						str += "<option value=" + ret.aaData[num].datastatus + ">" + ret.aaData[num].datastatus + "</option>"
					}
					$("#ADContainer").append(str)
				})
				getDataList(yshurl + "SC_ADPosition_Edit_GetUserInfo", {
					ADId: id
				}, function(d) {
					if(params.name == "Add") {
						$("#ADdiv").hide();
						$("#htt").text("新增广告位");
					} else if(params.name == "Edit") {
						initFormData(d.aaData[0]);
						var EditThisADC = "<option value=" + d.aaData[0].ADContainer + " selected='selected'>" + d.aaData[0].ADContainer + "</option>"
						$("#ADContainer").append(EditThisADC);
						$("#htt").text("广告位编辑");
					} else if(params.name == "Search") {
						$("#ADContainerHide").show().attr("disabled","disabled").val(d.aaData[0].ADContainer);
						$("#ADContainer,.select2-selection").hide();
						initFormData(d.aaData[0], 1);
						$("#htt").text("广告位编辑");
						$("#confirm").remove();
						$("#bcancel").text("返回");
					}
				});
				$condition.bootstrapValidator({
					message: '输入数据格式不对请确认后重新输入',
					feedbackIcons: {
						valid: 'glyphicon glyphicon-ok',
						invalid: 'glyphicon glyphicon-remove',
						validating: 'glyphicon glyphicon-refresh'
					},
					fields: {
						ADName: {
							validators: {
								notEmpty: {
									message: '广告位名称不能为空'
								},
								stringLength: {
									min: 1,
									max: 15,
									message: '广告位名称不能超过15个字符'
								},
								regexp: {
									regexp: /^[\u4E00-\u9FA5a-zA-Z0-9_\.]+$/,
									message: '广告位名称只能由汉字，数字，字母，点和下划线组成'
								}
							}
						},
						ADPage: {
							validators: {
								notEmpty: {
									message: '广告位页面不能为空'
								},
								stringLength: {
									min: 1,
									max: 50,
									message: '广告位名称不能超过50个字符'
								},
								regexp: {
									regexp: /^[\u4E00-\u9FA5a-zA-Z0-9_\.]+$/,
									message: '广告页面名称只能由汉字，数字，字母，点和下划线组成'
								}
							}
						},
						Remark: {
							validators: {
								stringLength: {
									max: 200,
									message: '备注长度不能超过200字符'
								}
							}
						},
						ADContainer: {
							validators: {
								stringLength: {
									max: 20,
									message: '容器不能超过20字符'
								},
								regexp: {
									regexp: /^[a-zA-Z0-9_]+$/,
									message: '容器名称只能由数字，字母，下划线组成'
								}
							}
						}
					}
				});
				setIframeHeight();
			});
		</script>
	</body>

</html>