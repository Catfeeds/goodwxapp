<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="ThemeBucket">
		<link rel="shortcut icon" href="#" type="image/png">

		<title>进场管理</title>
		<!--pickers css-->
		<link rel="stylesheet" type="text/css" href="js/bootstrap-datepicker/css/datepicker-custom.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-timepicker/css/timepicker.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-colorpicker/css/colorpicker.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-daterangepicker/daterangepicker-bs3.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-datetimepicker/css/datetimepicker-custom.css" />
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet">
		<script src="js/jquery-1.10.2.min.js"></script>
		<script src="js/ysh_comm.js"></script>
		<!--adddate-->
		<script src="js/adddate.js"></script>
		<script type="text/javascript">
			checkPermission();
		</script>
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
	</head>

	<body class="children-body">

		<!--body wrapper start-->
		<section class="">
			<!-- page start-->
			<div class="row">
				<div class="col-lg-12">
					<section class="panel">
						<header class="panel-heading">
							进场管理
						</header>
						<div class="panel-body">
							<form class="form-horizontal" role="form">
								<div class="row clearfix">
									<div class="col-lg-4">
										<div class="form-group">
											<label class="col-sm-3 control-label col-lg-3">卖家编号</label>
											<div class="col-lg-9">

												<input type="text" class="form-control" id="txt_sellerId">

											</div>
										</div>
									</div>
									<div class="col-lg-4">
										<div class="form-group">
											<label class="col-sm-3 control-label col-lg-3">商品名称</label>
											<div class="col-lg-9">

												<input type="text" class="form-control" id="txt_productname">

											</div>
										</div>
									</div>
								</div>
								<div class="row clearfix">
									<div class="col-lg-4">
										<div class="form-group">
											<label class="control-label col-lg-3 col-sm-3 ">进场时间</label>
											<div class="col-lg-9">
												<!--<div data-date-viewmode="years" data-date-format="yyyy-mm-dd" data-date="2016-01-01" class="input-append date dpYears">
													<input type="text" readonly="" value="" size="16" class="form-control" id="recordstarttime">
													<span class="input-group-btn add-on">
                                                            <button class="btn btn-primary" type="button"><i class="fa fa-calendar"></i></button>
                                                          </span>
												</div>-->
												<input type="text" value="" size="16" class="form-control" id="recordstarttime" onclick="SelectDate(this,'yyyy-MM-dd')" />

											</div>
										</div>
									</div>
									<div class="col-lg-4">
										<div class="form-group">
											<label class="control-label col-lg-3 col-sm-3 ">至</label>
											<div class="col-lg-9">
												<!--<div data-date-viewmode="years" data-date-format="yyyy-mm-dd" data-date="2016-12-12" class="input-append date dpYears">
													<input type="text" readonly="" value="" size="16" class="form-control" id="recordendtime">
													<span class="input-group-btn add-on">
                                                            <button class="btn btn-primary" type="button"><i class="fa fa-calendar"></i></button>
                                                          </span>
												</div>-->
												<input type="text" value="" size="16" class="form-control" id="recordendtime" onclick="SelectDate(this,'yyyy-MM-dd')" />

											</div>
										</div>
									</div>

									<div class="col-lg-4">
										<div class="text-right">
											<button class="btn btn-info" type="button" id="btn_search">搜索</button>
										</div>
									</div>
								</div>
							</form>
						</div>
					</section>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-12">
					<section class="panel">
						<div class="panel-heading">
							<div class="text-right">
								<button class="btn btn-success" type="button" onclick="gotoEdit(0)">添加</button>
								<!--<button class="btn btn-danger" type="button">删除</button>
																<button class="btn btn-warning" type="button">导出</button>-->
							</div>
						</div>
						<div class="panel-body">
							<table id="bs" class="table table-striped table-condensed table-hover talbe-border" data-side-pagination="server">
								<thead>
									<tr>
										<th data-field="status" data-align="center" data-checkbox="true"></th>
										<th data-field="Seller_ID" data-align="center">卖家编号</th>
										<th data-field="Seller_Name" data-align="center">卖家名称</th>
										<th data-field="Goods_Code" data-align="center">商品编码</th>
										<th data-field="Goods_Name" data-align="center">商品名称</th>
										<th data-field="Weight" data-align="center">重量</th>
										<th data-field="Price" data-align="center">单价</th>
										<th data-field="Batch_ID" data-align="center">批次号</th>
										<th data-field="SuyuanCode" data-align="center">溯源码</th>
										<th data-field="CreateDatestr" data-align="center">进场日期</th>
										<th data-field="Operation" data-align="center" data-formatter="operationFormatter">操作</th>
									</tr>
								</thead>
							</table>

						</div>
					</section>

					<!--body wrapper end-->

				</div>
				<!-- main content end-->
			</div>
		</section>

		<!-- Placed js at the end of the document so the pages load faster -->
		<script src="js/jquery-1.10.2.min.js"></script>
		<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
		<script src="js/jquery-migrate-1.2.1.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/modernizr.min.js"></script>
		<script src="js/jquery.nicescroll.js"></script>

		<!--pickers plugins-->
		<script type="text/javascript" src="js/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-daterangepicker/moment.min.js"></script>
		<script type="text/javascript" src="js/bootstrap-daterangepicker/daterangepicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>

		<!--bootstrap Table-->
		<script src='js/bootstrap-table.js'></script>
		<script src='js/bootstrap-table-zh-CN.js'></script>
		<script src='js/bootstrap-editable.js'></script>
		<script src='js/bootstrap-table-editable.js'></script>

		<!--pickers initialization-->
		<script src="js/pickers-init.js"></script>

		<!--common scripts for all pages-->
		<script src="js/scripts.js"></script>
		<script src="js/ysh_comm.js"></script>
		<script src="js/layer.js"></script>

		<script>
			var checkList = new Array();
			var $table = $("#bs");

			function loadSuyuan(Id) {
				window.location.href = "traceAll.html?inmarkinfoid=" + Id;
			}

			function operationFormatter(value, row, index) {
				var result = [
					'<button onclick="gotoEdit(' + row.Id + ')" class="btn btn-info">编辑</button>', '<button type="button" onclick="loadSuyuan(' + row.Id + ')" class="btn btn-success">溯源</button>'
				];
				return result.join(' ');
			}

			function gotoEdit(Id) {
				window.location.href = "AddInMarketInfo.html?Id=" + Id;
			}
			$(document).ready(function() {
				checkList = new Array();
				$table.bootstrapTable({
					pagination: true, //分页
					onCheck: function(row) {
						checkList.push(row.Id);
						$.unique(checkList);
					},
					onUncheck: function(row) {
						$.unique(checkList);
						var pIndex = $.inArray(row.Id, checkList);
						checkList.splice(pIndex, 1);
					},
					onCheckAll: function(rows) {
						$.each(rows, function(index) {
							checkList.push(rows[index].Id);
						});
						$.unique(checkList);
					},
					onUncheckAll: function(rows) {
						$.unique(checkList);
						var filterarray = $.grep(checkList, function(value) {
							var isDel = false;
							for(var i = 0; i < rows.length; i++) {
								if(rows[i].Id == value) {
									isDel = true;
									break;
								}
							}
							return !isDel;
						});
						checkList = filterarray;
					},
					escape: true,
					pageList: [10]
				});
				getdata(0);
			});

			//表格加载数据
			function loadData(f1, data) {
				f1.bootstrapTable('load', data);
				var hashTemp = window.location.hash || "1"

				hashTemp = hashTemp.replace("#", "")
				$(".pagination").find('a').each(function() {
					if($(this).text() == hashTemp)
						$(this).click()
				})
			};
			var getdata = function(offset) {
					var data = new Array();
					var totalcount = 0;
					condition = {
						sellerId: $("#txt_sellerId").val(),
						productname: $("#txt_productname").val(),
						recordstarttime: $("#recordstarttime").val(),
						recordendtime: $("#recordendtime").val()
					}
					condition.p_limit = $table.bootstrapTable('getOptions').pageSize;
					//console.log($table.bootstrapTable('getOptions'));
					condition.p_offset = offset;
					var options = $table.bootstrapTable('getOptions');
					if(offset == 0) {
						options.pageNumber = 1;
						$table.bootstrapTable('refreshOptions', options);
					}
					getDataList(yshurl + "AM_GetInmarketInfoList", condition, function(d) {
						data = d.many[0];
						totalcount = d.many[1][0].totalcount;
						//						console.log(d.many);
					});
					var pdata = {
						total: totalcount,
						rows: data
					};
					loadData($table, pdata);
					setIframeHeight();
				}
				//分页点击
			$table.on('page-change.bs.table', function(e, number, size) {
				var os = (number - 1) * size;
				window.location.hash = number;
				getdata(os);
			});

			// onhashchange可以监控hash变化
			window.onhashchange = function() {
				var hash = window.location.hash;
				var id;
				if(hash != "") {
					id = parseInt(hash.substr(1));
				} else {
					id = 1
				}
				var os = (id - 1) * 10;
				getdata(os);
				console.info(hash)
				$("ul.pagination").children().eq(id).addClass("active").siblings().removeClass("active");
			};

			$("#btn_search").click(function() {
				getdata(0);
			});
		</script>

	</body>

</html>