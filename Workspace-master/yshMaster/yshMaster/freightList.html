<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="ThemeBucket">
		<link rel="shortcut icon" href="#" type="image/png">
		<title>Form Layouts</title>
		<!--pickers css-->
		<link rel="stylesheet" type="text/css" href="js/bootstrap-datepicker/css/datepicker-custom.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-timepicker/css/timepicker.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-colorpicker/css/colorpicker.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-daterangepicker/daterangepicker-bs3.css" />
		<link rel="stylesheet" type="text/css" href="js/bootstrap-datetimepicker/css/datetimepicker-custom.css" />
		<link href="css/style.css" rel="stylesheet">
		<link href="css/style-responsive.css" rel="stylesheet">
		<link href="css/bootstrapValidator.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/select2.min.css"/>
		
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
  
  		<script src="js/jquery-1.10.2.min.js"></script>
  		<script src="js/ysh_comm.js"></script>
  		<script type="text/javascript">
  			checkPermission();
  		</script>
	</head>

	<body style="background: #EFF0F4;" class="children-body">
		<section>
			<div>
				<section class="panel">
					<div class="panel-body">
						<div class="page-heading">
							<h3>运费列表</h3>
						</div>
					</div>
				</section>

				<section class="wrapper">
					<section class="panel">
						<div class="panel-body">
							<div class="row" style="height: 14px;"></div>
							<div class="row">
								<div class="col-lg-4">
									<div class="form-group">
										<div class="col-lg-3" style="margin-top: 7px;text-align: right;">模板名</div>
										<div class="col-lg-9">
											<input type="text" class="form-control" id="txt_TempletName">
										</div>
									</div>
								</div>
								<div class="col-lg-4">
									<div class="form-group">
										<div class="col-lg-3" style="margin-top: 7px;text-align: right;">是否包邮</div>
										<div class="col-lg-9">

											<select class="form-control m-bot15" id="sel_Isbaoyou">
                                                                           
								                            </select>
										</div>
									</div>
								</div>

							</div>
							<div class="row" style="height: 14px;"></div>
							<div class="row">
								<div class="col-lg-4">
									<div class="form-group">
										<div class="col-lg-3" style="margin-top: 7px;text-align: right;">运送方式</div>
										<div class="col-lg-9">

											<select class="form-control m-bot15" id="sel_DeliveryMode">
                                                                             
								                            </select>
										</div>
									</div>
								</div>
								<div class="col-lg-4">
									<div class="form-group">
										<div class="col-lg-3" style="margin-top: 7px;text-align: right;">计价方式</div>
										<div class="col-lg-9">

											<select class="form-control m-bot15" id="sel_PricingMode">
                                                                            
								                            </select>
										</div>
									</div>
								</div>
								<div class="col-lg-4 text-right">
									<button class="btn btn-success" type="button" id="btn_Search">搜索</button>
								</div>
							</div>
							<div class="row" style="height: 14px;"></div>
							<div class="row">
								<div class="col-lg-10"></div>
								<div class="col-lg-2 text-right">
									<button class="btn btn-success" type="button" onclick="window.location.href='freighDetial.html'">添加</button>
									<button class="btn btn-danger" type="button" id="btn_batchDel">批量删除</button>
								</div>
							</div>
						</div>
					</section>

					<section class="panel">
						<div class="panel-body">
							<table id="bs" class="table table-bordered table-striped table-condensed ysh_table" data-side-pagination="server">
								<thead>

									<tr>
										<th data-field="status" data-align="center" data-checkbox="true"></th>
										<th data-field="Id" data-align="center">模板序号</th>
										<th data-field="TempletName" data-align="center">模板名称</th>
										<th data-field="Isbaoyoustr" data-align="center">是否包邮</th>
										<th data-field="PricingModestr" data-align="center">计价方式</th>
										<th data-field="DeliveryModestr" data-align="center">运送方式</th>
										<th data-field="Id" data-align="center" data-formatter="operationFormatter">操作</th>
									</tr>

								</thead>
							</table>
						</div>
					</section>
				</section>
			</div>
		</section>

		<!-- Placed js at the end of the document so the pages load faster -->
		<script src="js/jquery-1.10.2.min.js"></script>
		<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
		<script src="js/jquery-migrate-1.2.1.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/modernizr.min.js"></script>
		<script src="js/jquery.nicescroll.js"></script>

		<!--pickers plugins-->
		<script type="text/javascript" src="js/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-daterangepicker/moment.min.js"></script>
		<script type="text/javascript" src="js/bootstrap-daterangepicker/daterangepicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
		<script type="text/javascript" src="js/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>

		<!--bootstrap Table-->
		<script src='js/bootstrap-table.js'></script>
		<script src='js/bootstrap-table-zh-CN.js'></script>
		<script src='js/bootstrap-editable.js'></script>
		<script src='js/bootstrap-table-editable.js'></script>

		<!--pickers initialization-->
		<script src="js/pickers-init.js"></script>

		<!--common scripts for all pages-->
		<script src="js/scripts.js"></script>
		<script src="js/ysh_comm.js"></script>
		<script src="js/layer.js"></script>
		<script src="js/bootstrapValidator.js"></script>
		<script src="js/select2.min.js"></script>
		
		<script>
			var checkList = new Array();
			var $table = $("#bs");
			
			function operationFormatter(value, row, index) {
				var result = [
					'<button onclick="EditTemp(' + value + ')" class="btn btn-info">编辑</button>', '<button type="button" class="btn btn-danger" onclick="DelOneTemp(' + value + ')">删除</button>'
				];
				return result.join(" ");
			}
			//编辑
			function EditTemp(id) {
				window.location.href = 'EditfreighDetial.html?TempId=' + id;
			}
			//初始化
			$(function() {
				$('select').select2();
				checkList = new Array();
				$table.bootstrapTable({
					pagination: true, //分页
					onCheck: function(row) {
						checkList.push(row.Id);
						$.unique(checkList);
					},
					onUncheck: function(row) {
						$.unique(checkList);
						var pIndex = $.inArray(row.Id, checkList);
						checkList.splice(pIndex, 1);
					},
					onCheckAll: function(rows) {
						$.each(rows, function(index) {
							checkList.push(rows[index].Id);
						});
						$.unique(checkList);
					},
					onUncheckAll: function(rows) {
						checkList = new Array();
					},
					escape: true,
					pageList: [10]
				});
				binddropdownlist();
				getdata(0);
			});
			
			//绑定下拉列表
			function binddropdownlist() {
				getDataList(yshurl + "AM_GetLogisticalDropdlist", {}, function(d) {
					if (d.state == 0 && d.many[0].length > 0) { //包邮
						var htmlstr = '<option value="-1">全部</option>';
						for (var i = 0; i < d.many[0].length; i++) {
							htmlstr += '<option value="' + d.many[0][i].dictionaryID + '">' + d.many[0][i].datastatus + '</option>';
						}
						$("#sel_Isbaoyou").html(htmlstr);
					}
					if (d.state == 0 && d.many[1].length > 0) { //运送方式
						var htmlstr = '<option value="-1">全部</option>';
						for (var i = 0; i < d.many[1].length; i++) {
							htmlstr += '<option value="' + d.many[1][i].dictionaryID + '">' + d.many[1][i].datastatus + '</option>';
						}
						$("#sel_DeliveryMode").html(htmlstr);
					}
					if (d.state == 0 && d.many[2].length > 0) { //计价方式
						var htmlstr = '<option value="-1">全部</option>';
						for (var i = 0; i < d.many[2].length; i++) {
							htmlstr += '<option value="' + d.many[2][i].dictionaryID + '">' + d.many[2][i].datastatus + '</option>';
						}
						$("#sel_PricingMode").html(htmlstr);
					}
				});
			}
			
			//表格加载数据
			function loadData(f1, data) {
				f1.bootstrapTable('load', data);
				var hashTemp = window.location.hash || "1"

				hashTemp = hashTemp.replace("#", "")
				$(".pagination").find('a').each(function() {
					if($(this).text() == hashTemp)
						$(this).click()
				})
			};
			
			//获取数据
			var getdata = function(offset) {
				var data = new Array();
				var totalcount = 0;
				condition = {
					TempletName: $("#txt_TempletName").val(),
					Isbaoyou: $("#sel_Isbaoyou").find("option:selected").val(),
					DeliveryMode: $("#sel_DeliveryMode").find("option:selected").val(),
					PricingMode: $("#sel_PricingMode").find("option:selected").val()
				};
				condition.p_limit = $table.bootstrapTable('getOptions').pageSize;
				condition.p_offset = offset;
				var options = $table.bootstrapTable('getOptions');
				if (offset == 0) {
					options.pageNumber = 1;
					$table.bootstrapTable('refreshOptions', options);
				}
				getDataList(yshurl + "AM_GetOrd_LogisticalTempList", condition, function(d) {
					data = d.many[0];
					totalcount = d.many[1][0].totalcount;
				});
				var pdata = {
					total: totalcount,
					rows: data
				};
				loadData($table,pdata);
				setIframeHeight();
			};
			
			//分页点击
			$table.on('page-change.bs.table', function(e, number, size) {
				var os = (number - 1) * size;
				window.location.hash = number;
			});
			// onhashchange可以监控hash变化
		    window.onhashchange = function() {
		        var hash = window.location.hash;
		        var id;
		        if(hash != ""){
		        	id = parseInt(hash.substr(1));
		        } else{
		        	id = 1
		        }
		        var os = (id - 1) * 10;
				getdata(os);
		       	$("ul.pagination").children().eq(id).addClass("active").siblings().removeClass("active");
		    };
		    
			//搜索
			$("#btn_Search").click(function() {
				getdata(0);
			});

			function DelOneTemp(id) {
				ysh_confirm("确定删除吗？", "确定", "取消", function(ret) {
					if (ret) {
						DelTemp(id);
					}
				});
			}
			//删除
			function DelTemp(Idlist) {
				getDataList(yshurl + "AM_DelLogisticalTemp", {
					LogisticalTempIDlist: Idlist
				}, function(d) {
					if(d.aaData[0][0].ErrorCode == -1) {
						ysh_msg("删除失败，以下模板["+d.aaData[0][0].ErrorMsg+"]存在关联的商品，不能被删除！")
					}
					else{
						ysh_msg("删除成功");
					}
					getdata(0);
				});
			}
			//批量删除
			$("#btn_batchDel").click(function() {
				if (checkList.length <= 0) {
					ysh_alert("请选中删除项", "warning");
					return;
				}
				$.unique(checkList);
				ysh_confirm("确定要删除选中项吗？", "确定", "取消", function(ret) {
					if (ret) {
						DelTemp(checkList.join(","));
					}
				});
			});
		</script>
	</body>

</html>