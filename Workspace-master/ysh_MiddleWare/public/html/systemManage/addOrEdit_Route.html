<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>控制台</title>
    <link rel="stylesheet" type="text/css" href="../../Css/identify.css" />
    <link rel="stylesheet" type="text/css" href="../../Css/layout.css" />
    <link rel="stylesheet" type="text/css" href="../../Css/account.css" />
    <link rel="stylesheet" type="text/css" href="../../Css/style.css" />
    <link rel="stylesheet" type="text/css" href="" />
    <link rel="stylesheet" type="text/css" href="../../Css/control_index.css" />
    <style type="text/css">
    	#saveBtn,#back{
		    display: block;
		    line-height: 30px;													
		    width: 55px;										
		    padding: 0 10px;
		    margin: 0 auto; 
		    color: #87898b;
		    border-radius: 3px;
		    margin-top: 20px;
		    background: #f5f6fa;
    	}
    </style>
</head>


<body>
    <div class="view-body">
        <div class="view-product" style="left: 0px;right: 0;top: 0px;">
            <div class="authority">
                <div class="authority-head">
                    <div class="manage-head">
                        <h6 class="layout padding-left manage-head-con">路由编辑</h6>
                    </div>
                </div>
                <div class="authority-content">
                    <div class="list-content show">
                        <div class="offcial-table tr-border margin-big-top clearfix">
                            <div class="tr-th clearfix" style="color: white;">
                                <div class="th w35"></div>
                                <div class="th w5">
                                    <div class="h5">route:</div>
                                </div>
                                <div class="th w5"></div>
                                <div class="th w20">
                                    <input class="input" placeholder="route" id="route">
                                </div>
                                <div class="th w35"></div>   
                            </div>
                            <div class="tr-th clearfix" style="color: white;">
                                <div class="th w35"></div>
                                <div class="th w5">
                                    <div class="h5">cmd:</div>
                                </div>
                                <div class="th w5"></div>
                                <div class="th w20">
                                    <input class="input" placeholder="cmd" id="cmd">
                                </div>
                                <div class="th w35"></div>   
                            </div>
                            <div class="tr-th clearfix" style="color: white;">
                                <div class="th w35"></div>
                                <div class="th w5">
                                    <div class="h5">Interface:</div>
                                </div>
                                <div class="th w5"></div>
                                <div class="th w20">
                                    <input class="input" placeholder="Interface" id="Interface">
                                </div>
                                <div class="th w35"></div>   
                            </div>
                            <div class="tr-th clearfix" style="color: white;">
                                <div class="th w35"></div>
                                <div class="th w5">
                                    <div class="h5">project:</div>
                                </div>
                                <div class="th w5"></div>
                                <div class="th w20">
                                    <select id="pro_selectView" style="background:#fff;border: solid 1px #ccc">
                                        
                                    </select>
                                </div>
                                <div class="th w35"></div>   
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                 	<button id="saveBtn">保存</button>
                    <button id="back" style="display: none">返回</button>
                </div>
            </div>
        </div>
        <script type="text/javascript" src="../../Js/jquery-1.7.2.min.js"></script>
        <script type="text/javascript" src="../../Js/haidao.offcial.general.js"></script>
        <script type="text/javascript" src="../../Js/select.js"></script>
        <script type="text/javascript" src="../../Js/laytpl.js"></script>
        <script type="text/javascript" src="../../Js/layer.js"></script>
        <script type="text/javascript" src="../../Js/haidao.validate.js"></script>
        <script type="text/javascript" src="../../Js/public_fuc.js"></script>

        <script id="pro_selectTpl" type="text/html">
            <option value={{d.Id}}>{{d.projectName}}</option>
        </script>

        <script>

            //获取projectName
            $.ajax({
                url: "http://localhost:3000/MiddleWare/get_projectNameSelect",
                dataType: "json",
                async: true,
                type: "POST",
                success: function(msn) {                
                    if(msn.aaData && msn.aaData.length != 0){
                        var pro_selectTpl = $("#pro_selectTpl").html();
                        var pro_selectView = $("#pro_selectView");
                        showData(pro_selectView,pro_selectTpl,msn.aaData)
                    } else {
                        alert(JSON.stringify(msn))
                    }
                }
            })


	        var id = GetRequest().id;
            var action = GetRequest().action;
        
            // 初始化数据
            function initPage (){
                var param = new Object;
                param.Id = id;
                param.pagenum = 0;

                $.ajax({
                    url: "http://localhost:3000/MiddleWare/select_route",
                    dataType: "json",
                    async: true,
                    data: param,
                    type: "POST",
                    success: function(msn) {
                        if(msn.aaData && msn.aaData.length != 0){
                            $("#route").val(msn.aaData[0].route);
                            $("#Interface").val(msn.aaData[0].Interface);
                            $("#cmd").val(msn.aaData[0].cmd);
                            $("#pro_selectView").val(msn.aaData[0].projectId);
                            
                            if (action == "search") {
                                $("#back").css("display","block");
                                $("#saveBtn").hide();
                                $("input").each(function(){
                                    $(this).attr("disabled",true);
                                })
                                $("select").attr("disabled",true)
                            }
                            if (action == "editor") {
                                $("input").each(function(){
                                    $(this).attr("disabled",false);
                                })
                            }
                            if (action == "add") {
                                $("input").each(function(){
                                    $(this).val("")
                                })
                            }
                        } else {
                            alert(JSON.stringify(msn))
                        }
                    }
                })
            }
            initPage();


            // 查看返回
            $("#back").on("click",function(){
                window.location.href = "routeManage.html"
            })

            //编辑保存
            if(action == "editor"){
                $("#saveBtn").on("click", function() {
                    var param = new Object;
                    param.Id = id;
                    param.ysh_route = $("#route").val();
                    param.ysh_cmd = $("#cmd").val();
                    param.ysh_Interface = $("#Interface").val();
                    param.projectId = $("#pro_selectView").val();

                    $.ajax({
                        url: "http://localhost:3000/MiddleWare/update_route",
                        dataType: "json",
                        async: true,
                        data: param,
                        type: "POST",
                        success: function(msn) {
                            if (msn.err && msn.err.status == 0){
                                window.location.href = "routeManage.html";
                            } else {
                                alert(JSON.stringify(msn))
                            }
                        }
                    })
                })
            }

            //添加保存
            if (action == "add") {
                $("#saveBtn").on("click", function() {
                    var param = new Object;
                    param.ysh_route = $("#route").val();
                    param.ysh_cmd = $("#cmd").val();
                    param.ysh_Interface = $("#Interface").val();
                    param.projectId = $("#pro_selectView").val();
                    $.ajax({
                        url: "http://localhost:3000/MiddleWare/insert_route",
                        dataType: "json",
                        async: true,
                        data: param,
                        type: "POST",
                        success: function(msn) {
                            if (msn.err && msn.err.status == 0){
                                window.location.href = "routeManage.html";
                            } else {
                                alert(JSON.stringify(msn))
                            }
                        }
                    })
                })
            }
        </script>
    </div>
</body>

</html>
